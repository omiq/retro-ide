(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();function G0(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var oa={exports:{}};/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */var _g=oa.exports,yl;function xg(){return yl||(yl=1,function(i){(function(t,e){i.exports=t.document?e(t,!0):function(s){if(!s.document)throw new Error("jQuery requires a window with a document");return e(s)}})(typeof window<"u"?window:_g,function(t,e){var s=[],r=Object.getPrototypeOf,a=s.slice,c=s.flat?function(n){return s.flat.call(n)}:function(n){return s.concat.apply([],n)},h=s.push,m=s.indexOf,d={},p=d.toString,b=d.hasOwnProperty,w=b.toString,C=w.call(Object),y={},R=function(o){return typeof o=="function"&&typeof o.nodeType!="number"&&typeof o.item!="function"},U=function(o){return o!=null&&o===o.window},M=t.document,X={type:!0,src:!0,nonce:!0,noModule:!0};function Y(n,o,u){u=u||M;var f,g,_=u.createElement("script");if(_.text=n,o)for(f in X)g=o[f]||o.getAttribute&&o.getAttribute(f),g&&_.setAttribute(f,g);u.head.appendChild(_).parentNode.removeChild(_)}function N(n){return n==null?n+"":typeof n=="object"||typeof n=="function"?d[p.call(n)]||"object":typeof n}var Q="3.7.1",rt=/HTML$/i,l=function(n,o){return new l.fn.init(n,o)};l.fn=l.prototype={jquery:Q,constructor:l,length:0,toArray:function(){return a.call(this)},get:function(n){return n==null?a.call(this):n<0?this[n+this.length]:this[n]},pushStack:function(n){var o=l.merge(this.constructor(),n);return o.prevObject=this,o},each:function(n){return l.each(this,n)},map:function(n){return this.pushStack(l.map(this,function(o,u){return n.call(o,u,o)}))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(l.grep(this,function(n,o){return(o+1)%2}))},odd:function(){return this.pushStack(l.grep(this,function(n,o){return o%2}))},eq:function(n){var o=this.length,u=+n+(n<0?o:0);return this.pushStack(u>=0&&u<o?[this[u]]:[])},end:function(){return this.prevObject||this.constructor()},push:h,sort:s.sort,splice:s.splice},l.extend=l.fn.extend=function(){var n,o,u,f,g,_,x=arguments[0]||{},E=1,S=arguments.length,D=!1;for(typeof x=="boolean"&&(D=x,x=arguments[E]||{},E++),typeof x!="object"&&!R(x)&&(x={}),E===S&&(x=this,E--);E<S;E++)if((n=arguments[E])!=null)for(o in n)f=n[o],!(o==="__proto__"||x===f)&&(D&&f&&(l.isPlainObject(f)||(g=Array.isArray(f)))?(u=x[o],g&&!Array.isArray(u)?_=[]:!g&&!l.isPlainObject(u)?_={}:_=u,g=!1,x[o]=l.extend(D,_,f)):f!==void 0&&(x[o]=f));return x},l.extend({expando:"jQuery"+(Q+Math.random()).replace(/\D/g,""),isReady:!0,error:function(n){throw new Error(n)},noop:function(){},isPlainObject:function(n){var o,u;return!n||p.call(n)!=="[object Object]"?!1:(o=r(n),o?(u=b.call(o,"constructor")&&o.constructor,typeof u=="function"&&w.call(u)===C):!0)},isEmptyObject:function(n){var o;for(o in n)return!1;return!0},globalEval:function(n,o,u){Y(n,{nonce:o&&o.nonce},u)},each:function(n,o){var u,f=0;if(G(n))for(u=n.length;f<u&&o.call(n[f],f,n[f])!==!1;f++);else for(f in n)if(o.call(n[f],f,n[f])===!1)break;return n},text:function(n){var o,u="",f=0,g=n.nodeType;if(!g)for(;o=n[f++];)u+=l.text(o);return g===1||g===11?n.textContent:g===9?n.documentElement.textContent:g===3||g===4?n.nodeValue:u},makeArray:function(n,o){var u=o||[];return n!=null&&(G(Object(n))?l.merge(u,typeof n=="string"?[n]:n):h.call(u,n)),u},inArray:function(n,o,u){return o==null?-1:m.call(o,n,u)},isXMLDoc:function(n){var o=n&&n.namespaceURI,u=n&&(n.ownerDocument||n).documentElement;return!rt.test(o||u&&u.nodeName||"HTML")},merge:function(n,o){for(var u=+o.length,f=0,g=n.length;f<u;f++)n[g++]=o[f];return n.length=g,n},grep:function(n,o,u){for(var f,g=[],_=0,x=n.length,E=!u;_<x;_++)f=!o(n[_],_),f!==E&&g.push(n[_]);return g},map:function(n,o,u){var f,g,_=0,x=[];if(G(n))for(f=n.length;_<f;_++)g=o(n[_],_,u),g!=null&&x.push(g);else for(_ in n)g=o(n[_],_,u),g!=null&&x.push(g);return c(x)},guid:1,support:y}),typeof Symbol=="function"&&(l.fn[Symbol.iterator]=s[Symbol.iterator]),l.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(n,o){d["[object "+o+"]"]=o.toLowerCase()});function G(n){var o=!!n&&"length"in n&&n.length,u=N(n);return R(n)||U(n)?!1:u==="array"||o===0||typeof o=="number"&&o>0&&o-1 in n}function W(n,o){return n.nodeName&&n.nodeName.toLowerCase()===o.toLowerCase()}var K=s.pop,Z=s.sort,dt=s.splice,nt="[\\x20\\t\\r\\n\\f]",pt=new RegExp("^"+nt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+nt+"+$","g");l.contains=function(n,o){var u=o&&o.parentNode;return n===u||!!(u&&u.nodeType===1&&(n.contains?n.contains(u):n.compareDocumentPosition&&n.compareDocumentPosition(u)&16))};var Bt=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function It(n,o){return o?n==="\0"?"ï¿½":n.slice(0,-1)+"\\"+n.charCodeAt(n.length-1).toString(16)+" ":"\\"+n}l.escapeSelector=function(n){return(n+"").replace(Bt,It)};var Dt=M,re=h;(function(){var n,o,u,f,g,_=re,x,E,S,D,B,H=l.expando,P=0,q=0,mt=On(),St=On(),bt=On(),se=On(),qt=function(v,T){return v===T&&(g=!0),0},pi="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",mi="(?:\\\\[\\da-fA-F]{1,6}"+nt+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Ct="\\["+nt+"*("+mi+")(?:"+nt+"*([*^$|!~]?=)"+nt+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+mi+"))|)"+nt+"*\\]",_s=":("+mi+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+Ct+")*)|.*)\\)|)",Et=new RegExp(nt+"+","g"),$t=new RegExp("^"+nt+"*,"+nt+"*"),$r=new RegExp("^"+nt+"*([>+~]|"+nt+")"+nt+"*"),so=new RegExp(nt+"|>"),gi=new RegExp(_s),Hr=new RegExp("^"+mi+"$"),_i={ID:new RegExp("^#("+mi+")"),CLASS:new RegExp("^\\.("+mi+")"),TAG:new RegExp("^("+mi+"|[*])"),ATTR:new RegExp("^"+Ct),PSEUDO:new RegExp("^"+_s),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+nt+"*(even|odd|(([+-]|)(\\d*)n|)"+nt+"*(?:([+-]|)"+nt+"*(\\d+)|))"+nt+"*\\)|)","i"),bool:new RegExp("^(?:"+pi+")$","i"),needsContext:new RegExp("^"+nt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+nt+"*((?:-\\d)?\\d*)"+nt+"*\\)|)(?=[^-]|$)","i")},Vi=/^(?:input|select|textarea|button)$/i,Ki=/^h\d$/i,He=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ro=/[+~]/,Ai=new RegExp("\\\\[\\da-fA-F]{1,6}"+nt+"?|\\\\([^\\r\\n\\f])","g"),ki=function(v,T){var L="0x"+v.slice(1)-65536;return T||(L<0?String.fromCharCode(L+65536):String.fromCharCode(L>>10|55296,L&1023|56320))},lg=function(){qi()},ug=Nn(function(v){return v.disabled===!0&&W(v,"fieldset")},{dir:"parentNode",next:"legend"});function fg(){try{return x.activeElement}catch{}}try{_.apply(s=a.call(Dt.childNodes),Dt.childNodes),s[Dt.childNodes.length].nodeType}catch{_={apply:function(T,L){re.apply(T,a.call(L))},call:function(T){re.apply(T,a.call(arguments,1))}}}function Rt(v,T,L,I){var $,J,it,ot,st,yt,ft,gt=T&&T.ownerDocument,vt=T?T.nodeType:9;if(L=L||[],typeof v!="string"||!v||vt!==1&&vt!==9&&vt!==11)return L;if(!I&&(qi(T),T=T||x,S)){if(vt!==11&&(st=He.exec(v)))if($=st[1]){if(vt===9)if(it=T.getElementById($)){if(it.id===$)return _.call(L,it),L}else return L;else if(gt&&(it=gt.getElementById($))&&Rt.contains(T,it)&&it.id===$)return _.call(L,it),L}else{if(st[2])return _.apply(L,T.getElementsByTagName(v)),L;if(($=st[3])&&T.getElementsByClassName)return _.apply(L,T.getElementsByClassName($)),L}if(!se[v+" "]&&(!D||!D.test(v))){if(ft=v,gt=T,vt===1&&(so.test(v)||$r.test(v))){for(gt=ro.test(v)&&no(T.parentNode)||T,(gt!=T||!y.scope)&&((ot=T.getAttribute("id"))?ot=l.escapeSelector(ot):T.setAttribute("id",ot=H)),yt=zr(v),J=yt.length;J--;)yt[J]=(ot?"#"+ot:":scope")+" "+Mn(yt[J]);ft=yt.join(",")}try{return _.apply(L,gt.querySelectorAll(ft)),L}catch{se(v,!0)}finally{ot===H&&T.removeAttribute("id")}}}return bl(v.replace(pt,"$1"),T,L,I)}function On(){var v=[];function T(L,I){return v.push(L+" ")>o.cacheLength&&delete T[v.shift()],T[L+" "]=I}return T}function si(v){return v[H]=!0,v}function Ys(v){var T=x.createElement("fieldset");try{return!!v(T)}catch{return!1}finally{T.parentNode&&T.parentNode.removeChild(T),T=null}}function dg(v){return function(T){return W(T,"input")&&T.type===v}}function pg(v){return function(T){return(W(T,"input")||W(T,"button"))&&T.type===v}}function _l(v){return function(T){return"form"in T?T.parentNode&&T.disabled===!1?"label"in T?"label"in T.parentNode?T.parentNode.disabled===v:T.disabled===v:T.isDisabled===v||T.isDisabled!==!v&&ug(T)===v:T.disabled===v:"label"in T?T.disabled===v:!1}}function xs(v){return si(function(T){return T=+T,si(function(L,I){for(var $,J=v([],L.length,T),it=J.length;it--;)L[$=J[it]]&&(L[$]=!(I[$]=L[$]))})})}function no(v){return v&&typeof v.getElementsByTagName<"u"&&v}function qi(v){var T,L=v?v.ownerDocument||v:Dt;return L==x||L.nodeType!==9||!L.documentElement||(x=L,E=x.documentElement,S=!l.isXMLDoc(x),B=E.matches||E.webkitMatchesSelector||E.msMatchesSelector,E.msMatchesSelector&&Dt!=x&&(T=x.defaultView)&&T.top!==T&&T.addEventListener("unload",lg),y.getById=Ys(function(I){return E.appendChild(I).id=l.expando,!x.getElementsByName||!x.getElementsByName(l.expando).length}),y.disconnectedMatch=Ys(function(I){return B.call(I,"*")}),y.scope=Ys(function(){return x.querySelectorAll(":scope")}),y.cssHas=Ys(function(){try{return x.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),y.getById?(o.filter.ID=function(I){var $=I.replace(Ai,ki);return function(J){return J.getAttribute("id")===$}},o.find.ID=function(I,$){if(typeof $.getElementById<"u"&&S){var J=$.getElementById(I);return J?[J]:[]}}):(o.filter.ID=function(I){var $=I.replace(Ai,ki);return function(J){var it=typeof J.getAttributeNode<"u"&&J.getAttributeNode("id");return it&&it.value===$}},o.find.ID=function(I,$){if(typeof $.getElementById<"u"&&S){var J,it,ot,st=$.getElementById(I);if(st){if(J=st.getAttributeNode("id"),J&&J.value===I)return[st];for(ot=$.getElementsByName(I),it=0;st=ot[it++];)if(J=st.getAttributeNode("id"),J&&J.value===I)return[st]}return[]}}),o.find.TAG=function(I,$){return typeof $.getElementsByTagName<"u"?$.getElementsByTagName(I):$.querySelectorAll(I)},o.find.CLASS=function(I,$){if(typeof $.getElementsByClassName<"u"&&S)return $.getElementsByClassName(I)},D=[],Ys(function(I){var $;E.appendChild(I).innerHTML="<a id='"+H+"' href='' disabled='disabled'></a><select id='"+H+"-\r\\' disabled='disabled'><option selected=''></option></select>",I.querySelectorAll("[selected]").length||D.push("\\["+nt+"*(?:value|"+pi+")"),I.querySelectorAll("[id~="+H+"-]").length||D.push("~="),I.querySelectorAll("a#"+H+"+*").length||D.push(".#.+[+~]"),I.querySelectorAll(":checked").length||D.push(":checked"),$=x.createElement("input"),$.setAttribute("type","hidden"),I.appendChild($).setAttribute("name","D"),E.appendChild(I).disabled=!0,I.querySelectorAll(":disabled").length!==2&&D.push(":enabled",":disabled"),$=x.createElement("input"),$.setAttribute("name",""),I.appendChild($),I.querySelectorAll("[name='']").length||D.push("\\["+nt+"*name"+nt+"*="+nt+`*(?:''|"")`)}),y.cssHas||D.push(":has"),D=D.length&&new RegExp(D.join("|")),qt=function(I,$){if(I===$)return g=!0,0;var J=!I.compareDocumentPosition-!$.compareDocumentPosition;return J||(J=(I.ownerDocument||I)==($.ownerDocument||$)?I.compareDocumentPosition($):1,J&1||!y.sortDetached&&$.compareDocumentPosition(I)===J?I===x||I.ownerDocument==Dt&&Rt.contains(Dt,I)?-1:$===x||$.ownerDocument==Dt&&Rt.contains(Dt,$)?1:f?m.call(f,I)-m.call(f,$):0:J&4?-1:1)}),x}Rt.matches=function(v,T){return Rt(v,null,null,T)},Rt.matchesSelector=function(v,T){if(qi(v),S&&!se[T+" "]&&(!D||!D.test(T)))try{var L=B.call(v,T);if(L||y.disconnectedMatch||v.document&&v.document.nodeType!==11)return L}catch{se(T,!0)}return Rt(T,x,null,[v]).length>0},Rt.contains=function(v,T){return(v.ownerDocument||v)!=x&&qi(v),l.contains(v,T)},Rt.attr=function(v,T){(v.ownerDocument||v)!=x&&qi(v);var L=o.attrHandle[T.toLowerCase()],I=L&&b.call(o.attrHandle,T.toLowerCase())?L(v,T,!S):void 0;return I!==void 0?I:v.getAttribute(T)},Rt.error=function(v){throw new Error("Syntax error, unrecognized expression: "+v)},l.uniqueSort=function(v){var T,L=[],I=0,$=0;if(g=!y.sortStable,f=!y.sortStable&&a.call(v,0),Z.call(v,qt),g){for(;T=v[$++];)T===v[$]&&(I=L.push($));for(;I--;)dt.call(v,L[I],1)}return f=null,v},l.fn.uniqueSort=function(){return this.pushStack(l.uniqueSort(a.apply(this)))},o=l.expr={cacheLength:50,createPseudo:si,match:_i,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(v){return v[1]=v[1].replace(Ai,ki),v[3]=(v[3]||v[4]||v[5]||"").replace(Ai,ki),v[2]==="~="&&(v[3]=" "+v[3]+" "),v.slice(0,4)},CHILD:function(v){return v[1]=v[1].toLowerCase(),v[1].slice(0,3)==="nth"?(v[3]||Rt.error(v[0]),v[4]=+(v[4]?v[5]+(v[6]||1):2*(v[3]==="even"||v[3]==="odd")),v[5]=+(v[7]+v[8]||v[3]==="odd")):v[3]&&Rt.error(v[0]),v},PSEUDO:function(v){var T,L=!v[6]&&v[2];return _i.CHILD.test(v[0])?null:(v[3]?v[2]=v[4]||v[5]||"":L&&gi.test(L)&&(T=zr(L,!0))&&(T=L.indexOf(")",L.length-T)-L.length)&&(v[0]=v[0].slice(0,T),v[2]=L.slice(0,T)),v.slice(0,3))}},filter:{TAG:function(v){var T=v.replace(Ai,ki).toLowerCase();return v==="*"?function(){return!0}:function(L){return W(L,T)}},CLASS:function(v){var T=mt[v+" "];return T||(T=new RegExp("(^|"+nt+")"+v+"("+nt+"|$)"))&&mt(v,function(L){return T.test(typeof L.className=="string"&&L.className||typeof L.getAttribute<"u"&&L.getAttribute("class")||"")})},ATTR:function(v,T,L){return function(I){var $=Rt.attr(I,v);return $==null?T==="!=":T?($+="",T==="="?$===L:T==="!="?$!==L:T==="^="?L&&$.indexOf(L)===0:T==="*="?L&&$.indexOf(L)>-1:T==="$="?L&&$.slice(-L.length)===L:T==="~="?(" "+$.replace(Et," ")+" ").indexOf(L)>-1:T==="|="?$===L||$.slice(0,L.length+1)===L+"-":!1):!0}},CHILD:function(v,T,L,I,$){var J=v.slice(0,3)!=="nth",it=v.slice(-4)!=="last",ot=T==="of-type";return I===1&&$===0?function(st){return!!st.parentNode}:function(st,yt,ft){var gt,vt,ut,Ot,Se,ne=J!==it?"nextSibling":"previousSibling",ze=st.parentNode,xi=ot&&st.nodeName.toLowerCase(),Xs=!ft&&!ot,de=!1;if(ze){if(J){for(;ne;){for(ut=st;ut=ut[ne];)if(ot?W(ut,xi):ut.nodeType===1)return!1;Se=ne=v==="only"&&!Se&&"nextSibling"}return!0}if(Se=[it?ze.firstChild:ze.lastChild],it&&Xs){for(vt=ze[H]||(ze[H]={}),gt=vt[v]||[],Ot=gt[0]===P&&gt[1],de=Ot&&gt[2],ut=Ot&&ze.childNodes[Ot];ut=++Ot&&ut&&ut[ne]||(de=Ot=0)||Se.pop();)if(ut.nodeType===1&&++de&&ut===st){vt[v]=[P,Ot,de];break}}else if(Xs&&(vt=st[H]||(st[H]={}),gt=vt[v]||[],Ot=gt[0]===P&&gt[1],de=Ot),de===!1)for(;(ut=++Ot&&ut&&ut[ne]||(de=Ot=0)||Se.pop())&&!((ot?W(ut,xi):ut.nodeType===1)&&++de&&(Xs&&(vt=ut[H]||(ut[H]={}),vt[v]=[P,de]),ut===st)););return de-=$,de===I||de%I===0&&de/I>=0}}},PSEUDO:function(v,T){var L,I=o.pseudos[v]||o.setFilters[v.toLowerCase()]||Rt.error("unsupported pseudo: "+v);return I[H]?I(T):I.length>1?(L=[v,v,"",T],o.setFilters.hasOwnProperty(v.toLowerCase())?si(function($,J){for(var it,ot=I($,T),st=ot.length;st--;)it=m.call($,ot[st]),$[it]=!(J[it]=ot[st])}):function($){return I($,0,L)}):I}},pseudos:{not:si(function(v){var T=[],L=[],I=ho(v.replace(pt,"$1"));return I[H]?si(function($,J,it,ot){for(var st,yt=I($,null,ot,[]),ft=$.length;ft--;)(st=yt[ft])&&($[ft]=!(J[ft]=st))}):function($,J,it){return T[0]=$,I(T,null,it,L),T[0]=null,!L.pop()}}),has:si(function(v){return function(T){return Rt(v,T).length>0}}),contains:si(function(v){return v=v.replace(Ai,ki),function(T){return(T.textContent||l.text(T)).indexOf(v)>-1}}),lang:si(function(v){return Hr.test(v||"")||Rt.error("unsupported lang: "+v),v=v.replace(Ai,ki).toLowerCase(),function(T){var L;do if(L=S?T.lang:T.getAttribute("xml:lang")||T.getAttribute("lang"))return L=L.toLowerCase(),L===v||L.indexOf(v+"-")===0;while((T=T.parentNode)&&T.nodeType===1);return!1}}),target:function(v){var T=t.location&&t.location.hash;return T&&T.slice(1)===v.id},root:function(v){return v===E},focus:function(v){return v===fg()&&x.hasFocus()&&!!(v.type||v.href||~v.tabIndex)},enabled:_l(!1),disabled:_l(!0),checked:function(v){return W(v,"input")&&!!v.checked||W(v,"option")&&!!v.selected},selected:function(v){return v.parentNode&&v.parentNode.selectedIndex,v.selected===!0},empty:function(v){for(v=v.firstChild;v;v=v.nextSibling)if(v.nodeType<6)return!1;return!0},parent:function(v){return!o.pseudos.empty(v)},header:function(v){return Ki.test(v.nodeName)},input:function(v){return Vi.test(v.nodeName)},button:function(v){return W(v,"input")&&v.type==="button"||W(v,"button")},text:function(v){var T;return W(v,"input")&&v.type==="text"&&((T=v.getAttribute("type"))==null||T.toLowerCase()==="text")},first:xs(function(){return[0]}),last:xs(function(v,T){return[T-1]}),eq:xs(function(v,T,L){return[L<0?L+T:L]}),even:xs(function(v,T){for(var L=0;L<T;L+=2)v.push(L);return v}),odd:xs(function(v,T){for(var L=1;L<T;L+=2)v.push(L);return v}),lt:xs(function(v,T,L){var I;for(L<0?I=L+T:L>T?I=T:I=L;--I>=0;)v.push(I);return v}),gt:xs(function(v,T,L){for(var I=L<0?L+T:L;++I<T;)v.push(I);return v})}},o.pseudos.nth=o.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[n]=dg(n);for(n in{submit:!0,reset:!0})o.pseudos[n]=pg(n);function xl(){}xl.prototype=o.filters=o.pseudos,o.setFilters=new xl;function zr(v,T){var L,I,$,J,it,ot,st,yt=St[v+" "];if(yt)return T?0:yt.slice(0);for(it=v,ot=[],st=o.preFilter;it;){(!L||(I=$t.exec(it)))&&(I&&(it=it.slice(I[0].length)||it),ot.push($=[])),L=!1,(I=$r.exec(it))&&(L=I.shift(),$.push({value:L,type:I[0].replace(pt," ")}),it=it.slice(L.length));for(J in o.filter)(I=_i[J].exec(it))&&(!st[J]||(I=st[J](I)))&&(L=I.shift(),$.push({value:L,type:J,matches:I}),it=it.slice(L.length));if(!L)break}return T?it.length:it?Rt.error(v):St(v,ot).slice(0)}function Mn(v){for(var T=0,L=v.length,I="";T<L;T++)I+=v[T].value;return I}function Nn(v,T,L){var I=T.dir,$=T.next,J=$||I,it=L&&J==="parentNode",ot=q++;return T.first?function(st,yt,ft){for(;st=st[I];)if(st.nodeType===1||it)return v(st,yt,ft);return!1}:function(st,yt,ft){var gt,vt,ut=[P,ot];if(ft){for(;st=st[I];)if((st.nodeType===1||it)&&v(st,yt,ft))return!0}else for(;st=st[I];)if(st.nodeType===1||it)if(vt=st[H]||(st[H]={}),$&&W(st,$))st=st[I]||st;else{if((gt=vt[J])&&gt[0]===P&&gt[1]===ot)return ut[2]=gt[2];if(vt[J]=ut,ut[2]=v(st,yt,ft))return!0}return!1}}function ao(v){return v.length>1?function(T,L,I){for(var $=v.length;$--;)if(!v[$](T,L,I))return!1;return!0}:v[0]}function mg(v,T,L){for(var I=0,$=T.length;I<$;I++)Rt(v,T[I],L);return L}function Bn(v,T,L,I,$){for(var J,it=[],ot=0,st=v.length,yt=T!=null;ot<st;ot++)(J=v[ot])&&(!L||L(J,I,$))&&(it.push(J),yt&&T.push(ot));return it}function oo(v,T,L,I,$,J){return I&&!I[H]&&(I=oo(I)),$&&!$[H]&&($=oo($,J)),si(function(it,ot,st,yt){var ft,gt,vt,ut,Ot=[],Se=[],ne=ot.length,ze=it||mg(T||"*",st.nodeType?[st]:st,[]),xi=v&&(it||!T)?Bn(ze,Ot,v,st,yt):ze;if(L?(ut=$||(it?v:ne||I)?[]:ot,L(xi,ut,st,yt)):ut=xi,I)for(ft=Bn(ut,Se),I(ft,[],st,yt),gt=ft.length;gt--;)(vt=ft[gt])&&(ut[Se[gt]]=!(xi[Se[gt]]=vt));if(it){if($||v){if($){for(ft=[],gt=ut.length;gt--;)(vt=ut[gt])&&ft.push(xi[gt]=vt);$(null,ut=[],ft,yt)}for(gt=ut.length;gt--;)(vt=ut[gt])&&(ft=$?m.call(it,vt):Ot[gt])>-1&&(it[ft]=!(ot[ft]=vt))}}else ut=Bn(ut===ot?ut.splice(ne,ut.length):ut),$?$(null,ot,ut,yt):_.apply(ot,ut)})}function co(v){for(var T,L,I,$=v.length,J=o.relative[v[0].type],it=J||o.relative[" "],ot=J?1:0,st=Nn(function(gt){return gt===T},it,!0),yt=Nn(function(gt){return m.call(T,gt)>-1},it,!0),ft=[function(gt,vt,ut){var Ot=!J&&(ut||vt!=u)||((T=vt).nodeType?st(gt,vt,ut):yt(gt,vt,ut));return T=null,Ot}];ot<$;ot++)if(L=o.relative[v[ot].type])ft=[Nn(ao(ft),L)];else{if(L=o.filter[v[ot].type].apply(null,v[ot].matches),L[H]){for(I=++ot;I<$&&!o.relative[v[I].type];I++);return oo(ot>1&&ao(ft),ot>1&&Mn(v.slice(0,ot-1).concat({value:v[ot-2].type===" "?"*":""})).replace(pt,"$1"),L,ot<I&&co(v.slice(ot,I)),I<$&&co(v=v.slice(I)),I<$&&Mn(v))}ft.push(L)}return ao(ft)}function gg(v,T){var L=T.length>0,I=v.length>0,$=function(J,it,ot,st,yt){var ft,gt,vt,ut=0,Ot="0",Se=J&&[],ne=[],ze=u,xi=J||I&&o.find.TAG("*",yt),Xs=P+=ze==null?1:Math.random()||.1,de=xi.length;for(yt&&(u=it==x||it||yt);Ot!==de&&(ft=xi[Ot])!=null;Ot++){if(I&&ft){for(gt=0,!it&&ft.ownerDocument!=x&&(qi(ft),ot=!S);vt=v[gt++];)if(vt(ft,it||x,ot)){_.call(st,ft);break}yt&&(P=Xs)}L&&((ft=!vt&&ft)&&ut--,J&&Se.push(ft))}if(ut+=Ot,L&&Ot!==ut){for(gt=0;vt=T[gt++];)vt(Se,ne,it,ot);if(J){if(ut>0)for(;Ot--;)Se[Ot]||ne[Ot]||(ne[Ot]=K.call(st));ne=Bn(ne)}_.apply(st,ne),yt&&!J&&ne.length>0&&ut+T.length>1&&l.uniqueSort(st)}return yt&&(P=Xs,u=ze),Se};return L?si($):$}function ho(v,T){var L,I=[],$=[],J=bt[v+" "];if(!J){for(T||(T=zr(v)),L=T.length;L--;)J=co(T[L]),J[H]?I.push(J):$.push(J);J=bt(v,gg($,I)),J.selector=v}return J}function bl(v,T,L,I){var $,J,it,ot,st,yt=typeof v=="function"&&v,ft=!I&&zr(v=yt.selector||v);if(L=L||[],ft.length===1){if(J=ft[0]=ft[0].slice(0),J.length>2&&(it=J[0]).type==="ID"&&T.nodeType===9&&S&&o.relative[J[1].type]){if(T=(o.find.ID(it.matches[0].replace(Ai,ki),T)||[])[0],T)yt&&(T=T.parentNode);else return L;v=v.slice(J.shift().value.length)}for($=_i.needsContext.test(v)?0:J.length;$--&&(it=J[$],!o.relative[ot=it.type]);)if((st=o.find[ot])&&(I=st(it.matches[0].replace(Ai,ki),ro.test(J[0].type)&&no(T.parentNode)||T))){if(J.splice($,1),v=I.length&&Mn(J),!v)return _.apply(L,I),L;break}}return(yt||ho(v,ft))(I,T,!S,L,!T||ro.test(v)&&no(T.parentNode)||T),L}y.sortStable=H.split("").sort(qt).join("")===H,qi(),y.sortDetached=Ys(function(v){return v.compareDocumentPosition(x.createElement("fieldset"))&1}),l.find=Rt,l.expr[":"]=l.expr.pseudos,l.unique=l.uniqueSort,Rt.compile=ho,Rt.select=bl,Rt.setDocument=qi,Rt.tokenize=zr,Rt.escape=l.escapeSelector,Rt.getText=l.text,Rt.isXML=l.isXMLDoc,Rt.selectors=l.expr,Rt.support=l.support,Rt.uniqueSort=l.uniqueSort})();var Pt=function(n,o,u){for(var f=[],g=u!==void 0;(n=n[o])&&n.nodeType!==9;)if(n.nodeType===1){if(g&&l(n).is(u))break;f.push(n)}return f},Be=function(n,o){for(var u=[];n;n=n.nextSibling)n.nodeType===1&&n!==o&&u.push(n);return u},Je=l.expr.match.needsContext,le=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Ft(n,o,u){return R(o)?l.grep(n,function(f,g){return!!o.call(f,g,f)!==u}):o.nodeType?l.grep(n,function(f){return f===o!==u}):typeof o!="string"?l.grep(n,function(f){return m.call(o,f)>-1!==u}):l.filter(o,n,u)}l.filter=function(n,o,u){var f=o[0];return u&&(n=":not("+n+")"),o.length===1&&f.nodeType===1?l.find.matchesSelector(f,n)?[f]:[]:l.find.matches(n,l.grep(o,function(g){return g.nodeType===1}))},l.fn.extend({find:function(n){var o,u,f=this.length,g=this;if(typeof n!="string")return this.pushStack(l(n).filter(function(){for(o=0;o<f;o++)if(l.contains(g[o],this))return!0}));for(u=this.pushStack([]),o=0;o<f;o++)l.find(n,g[o],u);return f>1?l.uniqueSort(u):u},filter:function(n){return this.pushStack(Ft(this,n||[],!1))},not:function(n){return this.pushStack(Ft(this,n||[],!0))},is:function(n){return!!Ft(this,typeof n=="string"&&Je.test(n)?l(n):n||[],!1).length}});var ue,zt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,De=l.fn.init=function(n,o,u){var f,g;if(!n)return this;if(u=u||ue,typeof n=="string")if(n[0]==="<"&&n[n.length-1]===">"&&n.length>=3?f=[null,n,null]:f=zt.exec(n),f&&(f[1]||!o))if(f[1]){if(o=o instanceof l?o[0]:o,l.merge(this,l.parseHTML(f[1],o&&o.nodeType?o.ownerDocument||o:M,!0)),le.test(f[1])&&l.isPlainObject(o))for(f in o)R(this[f])?this[f](o[f]):this.attr(f,o[f]);return this}else return g=M.getElementById(f[2]),g&&(this[0]=g,this.length=1),this;else return!o||o.jquery?(o||u).find(n):this.constructor(o).find(n);else{if(n.nodeType)return this[0]=n,this.length=1,this;if(R(n))return u.ready!==void 0?u.ready(n):n(l)}return l.makeArray(n,this)};De.prototype=l.fn,ue=l(M);var Fe=/^(?:parents|prev(?:Until|All))/,ye={children:!0,contents:!0,next:!0,prev:!0};l.fn.extend({has:function(n){var o=l(n,this),u=o.length;return this.filter(function(){for(var f=0;f<u;f++)if(l.contains(this,o[f]))return!0})},closest:function(n,o){var u,f=0,g=this.length,_=[],x=typeof n!="string"&&l(n);if(!Je.test(n)){for(;f<g;f++)for(u=this[f];u&&u!==o;u=u.parentNode)if(u.nodeType<11&&(x?x.index(u)>-1:u.nodeType===1&&l.find.matchesSelector(u,n))){_.push(u);break}}return this.pushStack(_.length>1?l.uniqueSort(_):_)},index:function(n){return n?typeof n=="string"?m.call(l(n),this[0]):m.call(this,n.jquery?n[0]:n):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(n,o){return this.pushStack(l.uniqueSort(l.merge(this.get(),l(n,o))))},addBack:function(n){return this.add(n==null?this.prevObject:this.prevObject.filter(n))}});function ti(n,o){for(;(n=n[o])&&n.nodeType!==1;);return n}l.each({parent:function(n){var o=n.parentNode;return o&&o.nodeType!==11?o:null},parents:function(n){return Pt(n,"parentNode")},parentsUntil:function(n,o,u){return Pt(n,"parentNode",u)},next:function(n){return ti(n,"nextSibling")},prev:function(n){return ti(n,"previousSibling")},nextAll:function(n){return Pt(n,"nextSibling")},prevAll:function(n){return Pt(n,"previousSibling")},nextUntil:function(n,o,u){return Pt(n,"nextSibling",u)},prevUntil:function(n,o,u){return Pt(n,"previousSibling",u)},siblings:function(n){return Be((n.parentNode||{}).firstChild,n)},children:function(n){return Be(n.firstChild)},contents:function(n){return n.contentDocument!=null&&r(n.contentDocument)?n.contentDocument:(W(n,"template")&&(n=n.content||n),l.merge([],n.childNodes))}},function(n,o){l.fn[n]=function(u,f){var g=l.map(this,o,u);return n.slice(-5)!=="Until"&&(f=u),f&&typeof f=="string"&&(g=l.filter(f,g)),this.length>1&&(ye[n]||l.uniqueSort(g),Fe.test(n)&&g.reverse()),this.pushStack(g)}});var Xt=/[^\x20\t\r\n\f]+/g;function di(n){var o={};return l.each(n.match(Xt)||[],function(u,f){o[f]=!0}),o}l.Callbacks=function(n){n=typeof n=="string"?di(n):l.extend({},n);var o,u,f,g,_=[],x=[],E=-1,S=function(){for(g=g||n.once,f=o=!0;x.length;E=-1)for(u=x.shift();++E<_.length;)_[E].apply(u[0],u[1])===!1&&n.stopOnFalse&&(E=_.length,u=!1);n.memory||(u=!1),o=!1,g&&(u?_=[]:_="")},D={add:function(){return _&&(u&&!o&&(E=_.length-1,x.push(u)),function B(H){l.each(H,function(P,q){R(q)?(!n.unique||!D.has(q))&&_.push(q):q&&q.length&&N(q)!=="string"&&B(q)})}(arguments),u&&!o&&S()),this},remove:function(){return l.each(arguments,function(B,H){for(var P;(P=l.inArray(H,_,P))>-1;)_.splice(P,1),P<=E&&E--}),this},has:function(B){return B?l.inArray(B,_)>-1:_.length>0},empty:function(){return _&&(_=[]),this},disable:function(){return g=x=[],_=u="",this},disabled:function(){return!_},lock:function(){return g=x=[],!u&&!o&&(_=u=""),this},locked:function(){return!!g},fireWith:function(B,H){return g||(H=H||[],H=[B,H.slice?H.slice():H],x.push(H),o||S()),this},fire:function(){return D.fireWith(this,arguments),this},fired:function(){return!!f}};return D};function fe(n){return n}function Ue(n){throw n}function zi(n,o,u,f){var g;try{n&&R(g=n.promise)?g.call(n).done(o).fail(u):n&&R(g=n.then)?g.call(n,o,u):o.apply(void 0,[n].slice(f))}catch(_){u.apply(void 0,[_])}}l.extend({Deferred:function(n){var o=[["notify","progress",l.Callbacks("memory"),l.Callbacks("memory"),2],["resolve","done",l.Callbacks("once memory"),l.Callbacks("once memory"),0,"resolved"],["reject","fail",l.Callbacks("once memory"),l.Callbacks("once memory"),1,"rejected"]],u="pending",f={state:function(){return u},always:function(){return g.done(arguments).fail(arguments),this},catch:function(_){return f.then(null,_)},pipe:function(){var _=arguments;return l.Deferred(function(x){l.each(o,function(E,S){var D=R(_[S[4]])&&_[S[4]];g[S[1]](function(){var B=D&&D.apply(this,arguments);B&&R(B.promise)?B.promise().progress(x.notify).done(x.resolve).fail(x.reject):x[S[0]+"With"](this,D?[B]:arguments)})}),_=null}).promise()},then:function(_,x,E){var S=0;function D(B,H,P,q){return function(){var mt=this,St=arguments,bt=function(){var qt,pi;if(!(B<S)){if(qt=P.apply(mt,St),qt===H.promise())throw new TypeError("Thenable self-resolution");pi=qt&&(typeof qt=="object"||typeof qt=="function")&&qt.then,R(pi)?q?pi.call(qt,D(S,H,fe,q),D(S,H,Ue,q)):(S++,pi.call(qt,D(S,H,fe,q),D(S,H,Ue,q),D(S,H,fe,H.notifyWith))):(P!==fe&&(mt=void 0,St=[qt]),(q||H.resolveWith)(mt,St))}},se=q?bt:function(){try{bt()}catch(qt){l.Deferred.exceptionHook&&l.Deferred.exceptionHook(qt,se.error),B+1>=S&&(P!==Ue&&(mt=void 0,St=[qt]),H.rejectWith(mt,St))}};B?se():(l.Deferred.getErrorHook?se.error=l.Deferred.getErrorHook():l.Deferred.getStackHook&&(se.error=l.Deferred.getStackHook()),t.setTimeout(se))}}return l.Deferred(function(B){o[0][3].add(D(0,B,R(E)?E:fe,B.notifyWith)),o[1][3].add(D(0,B,R(_)?_:fe)),o[2][3].add(D(0,B,R(x)?x:Ue))}).promise()},promise:function(_){return _!=null?l.extend(_,f):f}},g={};return l.each(o,function(_,x){var E=x[2],S=x[5];f[x[1]]=E.add,S&&E.add(function(){u=S},o[3-_][2].disable,o[3-_][3].disable,o[0][2].lock,o[0][3].lock),E.add(x[3].fire),g[x[0]]=function(){return g[x[0]+"With"](this===g?void 0:this,arguments),this},g[x[0]+"With"]=E.fireWith}),f.promise(g),n&&n.call(g,g),g},when:function(n){var o=arguments.length,u=o,f=Array(u),g=a.call(arguments),_=l.Deferred(),x=function(E){return function(S){f[E]=this,g[E]=arguments.length>1?a.call(arguments):S,--o||_.resolveWith(f,g)}};if(o<=1&&(zi(n,_.done(x(u)).resolve,_.reject,!o),_.state()==="pending"||R(g[u]&&g[u].then)))return _.then();for(;u--;)zi(g[u],x(u),_.reject);return _.promise()}});var ds=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;l.Deferred.exceptionHook=function(n,o){t.console&&t.console.warn&&n&&ds.test(n.name)&&t.console.warn("jQuery.Deferred exception: "+n.message,n.stack,o)},l.readyException=function(n){t.setTimeout(function(){throw n})};var Wi=l.Deferred();l.fn.ready=function(n){return Wi.then(n).catch(function(o){l.readyException(o)}),this},l.extend({isReady:!1,readyWait:1,ready:function(n){(n===!0?--l.readyWait:l.isReady)||(l.isReady=!0,!(n!==!0&&--l.readyWait>0)&&Wi.resolveWith(M,[l]))}}),l.ready.then=Wi.then;function ei(){M.removeEventListener("DOMContentLoaded",ei),t.removeEventListener("load",ei),l.ready()}M.readyState==="complete"||M.readyState!=="loading"&&!M.documentElement.doScroll?t.setTimeout(l.ready):(M.addEventListener("DOMContentLoaded",ei),t.addEventListener("load",ei));var Mt=function(n,o,u,f,g,_,x){var E=0,S=n.length,D=u==null;if(N(u)==="object"){g=!0;for(E in u)Mt(n,o,E,u[E],!0,_,x)}else if(f!==void 0&&(g=!0,R(f)||(x=!0),D&&(x?(o.call(n,f),o=null):(D=o,o=function(B,H,P){return D.call(l(B),P)})),o))for(;E<S;E++)o(n[E],u,x?f:f.call(n[E],E,o(n[E],u)));return g?n:D?o.call(n):S?o(n[0],u):_},ve=/^-ms-/,Zt=/-([a-z])/g;function Re(n,o){return o.toUpperCase()}function Le(n){return n.replace(ve,"ms-").replace(Zt,Re)}var Gi=function(n){return n.nodeType===1||n.nodeType===9||!+n.nodeType};function Si(){this.expando=l.expando+Si.uid++}Si.uid=1,Si.prototype={cache:function(n){var o=n[this.expando];return o||(o={},Gi(n)&&(n.nodeType?n[this.expando]=o:Object.defineProperty(n,this.expando,{value:o,configurable:!0}))),o},set:function(n,o,u){var f,g=this.cache(n);if(typeof o=="string")g[Le(o)]=u;else for(f in o)g[Le(f)]=o[f];return g},get:function(n,o){return o===void 0?this.cache(n):n[this.expando]&&n[this.expando][Le(o)]},access:function(n,o,u){return o===void 0||o&&typeof o=="string"&&u===void 0?this.get(n,o):(this.set(n,o,u),u!==void 0?u:o)},remove:function(n,o){var u,f=n[this.expando];if(f!==void 0){if(o!==void 0)for(Array.isArray(o)?o=o.map(Le):(o=Le(o),o=o in f?[o]:o.match(Xt)||[]),u=o.length;u--;)delete f[o[u]];(o===void 0||l.isEmptyObject(f))&&(n.nodeType?n[this.expando]=void 0:delete n[this.expando])}},hasData:function(n){var o=n[this.expando];return o!==void 0&&!l.isEmptyObject(o)}};var at=new Si,ie=new Si,kn=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Tn=/[A-Z]/g;function km(n){return n==="true"?!0:n==="false"?!1:n==="null"?null:n===+n+""?+n:kn.test(n)?JSON.parse(n):n}function $h(n,o,u){var f;if(u===void 0&&n.nodeType===1)if(f="data-"+o.replace(Tn,"-$&").toLowerCase(),u=n.getAttribute(f),typeof u=="string"){try{u=km(u)}catch{}ie.set(n,o,u)}else u=void 0;return u}l.extend({hasData:function(n){return ie.hasData(n)||at.hasData(n)},data:function(n,o,u){return ie.access(n,o,u)},removeData:function(n,o){ie.remove(n,o)},_data:function(n,o,u){return at.access(n,o,u)},_removeData:function(n,o){at.remove(n,o)}}),l.fn.extend({data:function(n,o){var u,f,g,_=this[0],x=_&&_.attributes;if(n===void 0){if(this.length&&(g=ie.get(_),_.nodeType===1&&!at.get(_,"hasDataAttrs"))){for(u=x.length;u--;)x[u]&&(f=x[u].name,f.indexOf("data-")===0&&(f=Le(f.slice(5)),$h(_,f,g[f])));at.set(_,"hasDataAttrs",!0)}return g}return typeof n=="object"?this.each(function(){ie.set(this,n)}):Mt(this,function(E){var S;if(_&&E===void 0)return S=ie.get(_,n),S!==void 0||(S=$h(_,n),S!==void 0)?S:void 0;this.each(function(){ie.set(this,n,E)})},null,o,arguments.length>1,null,!0)},removeData:function(n){return this.each(function(){ie.remove(this,n)})}}),l.extend({queue:function(n,o,u){var f;if(n)return o=(o||"fx")+"queue",f=at.get(n,o),u&&(!f||Array.isArray(u)?f=at.access(n,o,l.makeArray(u)):f.push(u)),f||[]},dequeue:function(n,o){o=o||"fx";var u=l.queue(n,o),f=u.length,g=u.shift(),_=l._queueHooks(n,o),x=function(){l.dequeue(n,o)};g==="inprogress"&&(g=u.shift(),f--),g&&(o==="fx"&&u.unshift("inprogress"),delete _.stop,g.call(n,x,_)),!f&&_&&_.empty.fire()},_queueHooks:function(n,o){var u=o+"queueHooks";return at.get(n,u)||at.access(n,u,{empty:l.Callbacks("once memory").add(function(){at.remove(n,[o+"queue",u])})})}}),l.fn.extend({queue:function(n,o){var u=2;return typeof n!="string"&&(o=n,n="fx",u--),arguments.length<u?l.queue(this[0],n):o===void 0?this:this.each(function(){var f=l.queue(this,n,o);l._queueHooks(this,n),n==="fx"&&f[0]!=="inprogress"&&l.dequeue(this,n)})},dequeue:function(n){return this.each(function(){l.dequeue(this,n)})},clearQueue:function(n){return this.queue(n||"fx",[])},promise:function(n,o){var u,f=1,g=l.Deferred(),_=this,x=this.length,E=function(){--f||g.resolveWith(_,[_])};for(typeof n!="string"&&(o=n,n=void 0),n=n||"fx";x--;)u=at.get(_[x],n+"queueHooks"),u&&u.empty&&(f++,u.empty.add(E));return E(),g.promise(o)}});var Hh=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Or=new RegExp("^(?:([+-])=|)("+Hh+")([a-z%]*)$","i"),Ei=["Top","Right","Bottom","Left"],ps=M.documentElement,Ws=function(n){return l.contains(n.ownerDocument,n)},Tm={composed:!0};ps.getRootNode&&(Ws=function(n){return l.contains(n.ownerDocument,n)||n.getRootNode(Tm)===n.ownerDocument});var Dn=function(n,o){return n=o||n,n.style.display==="none"||n.style.display===""&&Ws(n)&&l.css(n,"display")==="none"};function zh(n,o,u,f){var g,_,x=20,E=f?function(){return f.cur()}:function(){return l.css(n,o,"")},S=E(),D=u&&u[3]||(l.cssNumber[o]?"":"px"),B=n.nodeType&&(l.cssNumber[o]||D!=="px"&&+S)&&Or.exec(l.css(n,o));if(B&&B[3]!==D){for(S=S/2,D=D||B[3],B=+S||1;x--;)l.style(n,o,B+D),(1-_)*(1-(_=E()/S||.5))<=0&&(x=0),B=B/_;B=B*2,l.style(n,o,B+D),u=u||[]}return u&&(B=+B||+S||0,g=u[1]?B+(u[1]+1)*u[2]:+u[2],f&&(f.unit=D,f.start=B,f.end=g)),g}var Wh={};function Dm(n){var o,u=n.ownerDocument,f=n.nodeName,g=Wh[f];return g||(o=u.body.appendChild(u.createElement(f)),g=l.css(o,"display"),o.parentNode.removeChild(o),g==="none"&&(g="block"),Wh[f]=g,g)}function Gs(n,o){for(var u,f,g=[],_=0,x=n.length;_<x;_++)f=n[_],f.style&&(u=f.style.display,o?(u==="none"&&(g[_]=at.get(f,"display")||null,g[_]||(f.style.display="")),f.style.display===""&&Dn(f)&&(g[_]=Dm(f))):u!=="none"&&(g[_]="none",at.set(f,"display",u)));for(_=0;_<x;_++)g[_]!=null&&(n[_].style.display=g[_]);return n}l.fn.extend({show:function(){return Gs(this,!0)},hide:function(){return Gs(this)},toggle:function(n){return typeof n=="boolean"?n?this.show():this.hide():this.each(function(){Dn(this)?l(this).show():l(this).hide()})}});var Mr=/^(?:checkbox|radio)$/i,Gh=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Vh=/^$|^module$|\/(?:java|ecma)script/i;(function(){var n=M.createDocumentFragment(),o=n.appendChild(M.createElement("div")),u=M.createElement("input");u.setAttribute("type","radio"),u.setAttribute("checked","checked"),u.setAttribute("name","t"),o.appendChild(u),y.checkClone=o.cloneNode(!0).cloneNode(!0).lastChild.checked,o.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!o.cloneNode(!0).lastChild.defaultValue,o.innerHTML="<option></option>",y.option=!!o.lastChild})();var $e={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};$e.tbody=$e.tfoot=$e.colgroup=$e.caption=$e.thead,$e.th=$e.td,y.option||($e.optgroup=$e.option=[1,"<select multiple='multiple'>","</select>"]);function Ce(n,o){var u;return typeof n.getElementsByTagName<"u"?u=n.getElementsByTagName(o||"*"):typeof n.querySelectorAll<"u"?u=n.querySelectorAll(o||"*"):u=[],o===void 0||o&&W(n,o)?l.merge([n],u):u}function Wa(n,o){for(var u=0,f=n.length;u<f;u++)at.set(n[u],"globalEval",!o||at.get(o[u],"globalEval"))}var Rm=/<|&#?\w+;/;function Kh(n,o,u,f,g){for(var _,x,E,S,D,B,H=o.createDocumentFragment(),P=[],q=0,mt=n.length;q<mt;q++)if(_=n[q],_||_===0)if(N(_)==="object")l.merge(P,_.nodeType?[_]:_);else if(!Rm.test(_))P.push(o.createTextNode(_));else{for(x=x||H.appendChild(o.createElement("div")),E=(Gh.exec(_)||["",""])[1].toLowerCase(),S=$e[E]||$e._default,x.innerHTML=S[1]+l.htmlPrefilter(_)+S[2],B=S[0];B--;)x=x.lastChild;l.merge(P,x.childNodes),x=H.firstChild,x.textContent=""}for(H.textContent="",q=0;_=P[q++];){if(f&&l.inArray(_,f)>-1){g&&g.push(_);continue}if(D=Ws(_),x=Ce(H.appendChild(_),"script"),D&&Wa(x),u)for(B=0;_=x[B++];)Vh.test(_.type||"")&&u.push(_)}return H}var qh=/^([^.]*)(?:\.(.+)|)/;function Vs(){return!0}function Ks(){return!1}function Ga(n,o,u,f,g,_){var x,E;if(typeof o=="object"){typeof u!="string"&&(f=f||u,u=void 0);for(E in o)Ga(n,E,u,f,o[E],_);return n}if(f==null&&g==null?(g=u,f=u=void 0):g==null&&(typeof u=="string"?(g=f,f=void 0):(g=f,f=u,u=void 0)),g===!1)g=Ks;else if(!g)return n;return _===1&&(x=g,g=function(S){return l().off(S),x.apply(this,arguments)},g.guid=x.guid||(x.guid=l.guid++)),n.each(function(){l.event.add(this,o,g,f,u)})}l.event={global:{},add:function(n,o,u,f,g){var _,x,E,S,D,B,H,P,q,mt,St,bt=at.get(n);if(Gi(n))for(u.handler&&(_=u,u=_.handler,g=_.selector),g&&l.find.matchesSelector(ps,g),u.guid||(u.guid=l.guid++),(S=bt.events)||(S=bt.events=Object.create(null)),(x=bt.handle)||(x=bt.handle=function(se){return typeof l<"u"&&l.event.triggered!==se.type?l.event.dispatch.apply(n,arguments):void 0}),o=(o||"").match(Xt)||[""],D=o.length;D--;)E=qh.exec(o[D])||[],q=St=E[1],mt=(E[2]||"").split(".").sort(),q&&(H=l.event.special[q]||{},q=(g?H.delegateType:H.bindType)||q,H=l.event.special[q]||{},B=l.extend({type:q,origType:St,data:f,handler:u,guid:u.guid,selector:g,needsContext:g&&l.expr.match.needsContext.test(g),namespace:mt.join(".")},_),(P=S[q])||(P=S[q]=[],P.delegateCount=0,(!H.setup||H.setup.call(n,f,mt,x)===!1)&&n.addEventListener&&n.addEventListener(q,x)),H.add&&(H.add.call(n,B),B.handler.guid||(B.handler.guid=u.guid)),g?P.splice(P.delegateCount++,0,B):P.push(B),l.event.global[q]=!0)},remove:function(n,o,u,f,g){var _,x,E,S,D,B,H,P,q,mt,St,bt=at.hasData(n)&&at.get(n);if(!(!bt||!(S=bt.events))){for(o=(o||"").match(Xt)||[""],D=o.length;D--;){if(E=qh.exec(o[D])||[],q=St=E[1],mt=(E[2]||"").split(".").sort(),!q){for(q in S)l.event.remove(n,q+o[D],u,f,!0);continue}for(H=l.event.special[q]||{},q=(f?H.delegateType:H.bindType)||q,P=S[q]||[],E=E[2]&&new RegExp("(^|\\.)"+mt.join("\\.(?:.*\\.|)")+"(\\.|$)"),x=_=P.length;_--;)B=P[_],(g||St===B.origType)&&(!u||u.guid===B.guid)&&(!E||E.test(B.namespace))&&(!f||f===B.selector||f==="**"&&B.selector)&&(P.splice(_,1),B.selector&&P.delegateCount--,H.remove&&H.remove.call(n,B));x&&!P.length&&((!H.teardown||H.teardown.call(n,mt,bt.handle)===!1)&&l.removeEvent(n,q,bt.handle),delete S[q])}l.isEmptyObject(S)&&at.remove(n,"handle events")}},dispatch:function(n){var o,u,f,g,_,x,E=new Array(arguments.length),S=l.event.fix(n),D=(at.get(this,"events")||Object.create(null))[S.type]||[],B=l.event.special[S.type]||{};for(E[0]=S,o=1;o<arguments.length;o++)E[o]=arguments[o];if(S.delegateTarget=this,!(B.preDispatch&&B.preDispatch.call(this,S)===!1)){for(x=l.event.handlers.call(this,S,D),o=0;(g=x[o++])&&!S.isPropagationStopped();)for(S.currentTarget=g.elem,u=0;(_=g.handlers[u++])&&!S.isImmediatePropagationStopped();)(!S.rnamespace||_.namespace===!1||S.rnamespace.test(_.namespace))&&(S.handleObj=_,S.data=_.data,f=((l.event.special[_.origType]||{}).handle||_.handler).apply(g.elem,E),f!==void 0&&(S.result=f)===!1&&(S.preventDefault(),S.stopPropagation()));return B.postDispatch&&B.postDispatch.call(this,S),S.result}},handlers:function(n,o){var u,f,g,_,x,E=[],S=o.delegateCount,D=n.target;if(S&&D.nodeType&&!(n.type==="click"&&n.button>=1)){for(;D!==this;D=D.parentNode||this)if(D.nodeType===1&&!(n.type==="click"&&D.disabled===!0)){for(_=[],x={},u=0;u<S;u++)f=o[u],g=f.selector+" ",x[g]===void 0&&(x[g]=f.needsContext?l(g,this).index(D)>-1:l.find(g,this,null,[D]).length),x[g]&&_.push(f);_.length&&E.push({elem:D,handlers:_})}}return D=this,S<o.length&&E.push({elem:D,handlers:o.slice(S)}),E},addProp:function(n,o){Object.defineProperty(l.Event.prototype,n,{enumerable:!0,configurable:!0,get:R(o)?function(){if(this.originalEvent)return o(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[n]},set:function(u){Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:u})}})},fix:function(n){return n[l.expando]?n:new l.Event(n)},special:{load:{noBubble:!0},click:{setup:function(n){var o=this||n;return Mr.test(o.type)&&o.click&&W(o,"input")&&Rn(o,"click",!0),!1},trigger:function(n){var o=this||n;return Mr.test(o.type)&&o.click&&W(o,"input")&&Rn(o,"click"),!0},_default:function(n){var o=n.target;return Mr.test(o.type)&&o.click&&W(o,"input")&&at.get(o,"click")||W(o,"a")}},beforeunload:{postDispatch:function(n){n.result!==void 0&&n.originalEvent&&(n.originalEvent.returnValue=n.result)}}}};function Rn(n,o,u){if(!u){at.get(n,o)===void 0&&l.event.add(n,o,Vs);return}at.set(n,o,!1),l.event.add(n,o,{namespace:!1,handler:function(f){var g,_=at.get(this,o);if(f.isTrigger&1&&this[o]){if(_)(l.event.special[o]||{}).delegateType&&f.stopPropagation();else if(_=a.call(arguments),at.set(this,o,_),this[o](),g=at.get(this,o),at.set(this,o,!1),_!==g)return f.stopImmediatePropagation(),f.preventDefault(),g}else _&&(at.set(this,o,l.event.trigger(_[0],_.slice(1),this)),f.stopPropagation(),f.isImmediatePropagationStopped=Vs)}})}l.removeEvent=function(n,o,u){n.removeEventListener&&n.removeEventListener(o,u)},l.Event=function(n,o){if(!(this instanceof l.Event))return new l.Event(n,o);n&&n.type?(this.originalEvent=n,this.type=n.type,this.isDefaultPrevented=n.defaultPrevented||n.defaultPrevented===void 0&&n.returnValue===!1?Vs:Ks,this.target=n.target&&n.target.nodeType===3?n.target.parentNode:n.target,this.currentTarget=n.currentTarget,this.relatedTarget=n.relatedTarget):this.type=n,o&&l.extend(this,o),this.timeStamp=n&&n.timeStamp||Date.now(),this[l.expando]=!0},l.Event.prototype={constructor:l.Event,isDefaultPrevented:Ks,isPropagationStopped:Ks,isImmediatePropagationStopped:Ks,isSimulated:!1,preventDefault:function(){var n=this.originalEvent;this.isDefaultPrevented=Vs,n&&!this.isSimulated&&n.preventDefault()},stopPropagation:function(){var n=this.originalEvent;this.isPropagationStopped=Vs,n&&!this.isSimulated&&n.stopPropagation()},stopImmediatePropagation:function(){var n=this.originalEvent;this.isImmediatePropagationStopped=Vs,n&&!this.isSimulated&&n.stopImmediatePropagation(),this.stopPropagation()}},l.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},l.event.addProp),l.each({focus:"focusin",blur:"focusout"},function(n,o){function u(f){if(M.documentMode){var g=at.get(this,"handle"),_=l.event.fix(f);_.type=f.type==="focusin"?"focus":"blur",_.isSimulated=!0,g(f),_.target===_.currentTarget&&g(_)}else l.event.simulate(o,f.target,l.event.fix(f))}l.event.special[n]={setup:function(){var f;if(Rn(this,n,!0),M.documentMode)f=at.get(this,o),f||this.addEventListener(o,u),at.set(this,o,(f||0)+1);else return!1},trigger:function(){return Rn(this,n),!0},teardown:function(){var f;if(M.documentMode)f=at.get(this,o)-1,f?at.set(this,o,f):(this.removeEventListener(o,u),at.remove(this,o));else return!1},_default:function(f){return at.get(f.target,n)},delegateType:o},l.event.special[o]={setup:function(){var f=this.ownerDocument||this.document||this,g=M.documentMode?this:f,_=at.get(g,o);_||(M.documentMode?this.addEventListener(o,u):f.addEventListener(n,u,!0)),at.set(g,o,(_||0)+1)},teardown:function(){var f=this.ownerDocument||this.document||this,g=M.documentMode?this:f,_=at.get(g,o)-1;_?at.set(g,o,_):(M.documentMode?this.removeEventListener(o,u):f.removeEventListener(n,u,!0),at.remove(g,o))}}}),l.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(n,o){l.event.special[n]={delegateType:o,bindType:o,handle:function(u){var f,g=this,_=u.relatedTarget,x=u.handleObj;return(!_||_!==g&&!l.contains(g,_))&&(u.type=x.origType,f=x.handler.apply(this,arguments),u.type=o),f}}}),l.fn.extend({on:function(n,o,u,f){return Ga(this,n,o,u,f)},one:function(n,o,u,f){return Ga(this,n,o,u,f,1)},off:function(n,o,u){var f,g;if(n&&n.preventDefault&&n.handleObj)return f=n.handleObj,l(n.delegateTarget).off(f.namespace?f.origType+"."+f.namespace:f.origType,f.selector,f.handler),this;if(typeof n=="object"){for(g in n)this.off(g,o,n[g]);return this}return(o===!1||typeof o=="function")&&(u=o,o=void 0),u===!1&&(u=Ks),this.each(function(){l.event.remove(this,n,u,o)})}});var Lm=/<script|<style|<link/i,Pm=/checked\s*(?:[^=]|=\s*.checked.)/i,Im=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function jh(n,o){return W(n,"table")&&W(o.nodeType!==11?o:o.firstChild,"tr")&&l(n).children("tbody")[0]||n}function Om(n){return n.type=(n.getAttribute("type")!==null)+"/"+n.type,n}function Mm(n){return(n.type||"").slice(0,5)==="true/"?n.type=n.type.slice(5):n.removeAttribute("type"),n}function Yh(n,o){var u,f,g,_,x,E,S;if(o.nodeType===1){if(at.hasData(n)&&(_=at.get(n),S=_.events,S)){at.remove(o,"handle events");for(g in S)for(u=0,f=S[g].length;u<f;u++)l.event.add(o,g,S[g][u])}ie.hasData(n)&&(x=ie.access(n),E=l.extend({},x),ie.set(o,E))}}function Nm(n,o){var u=o.nodeName.toLowerCase();u==="input"&&Mr.test(n.type)?o.checked=n.checked:(u==="input"||u==="textarea")&&(o.defaultValue=n.defaultValue)}function qs(n,o,u,f){o=c(o);var g,_,x,E,S,D,B=0,H=n.length,P=H-1,q=o[0],mt=R(q);if(mt||H>1&&typeof q=="string"&&!y.checkClone&&Pm.test(q))return n.each(function(St){var bt=n.eq(St);mt&&(o[0]=q.call(this,St,bt.html())),qs(bt,o,u,f)});if(H&&(g=Kh(o,n[0].ownerDocument,!1,n,f),_=g.firstChild,g.childNodes.length===1&&(g=_),_||f)){for(x=l.map(Ce(g,"script"),Om),E=x.length;B<H;B++)S=g,B!==P&&(S=l.clone(S,!0,!0),E&&l.merge(x,Ce(S,"script"))),u.call(n[B],S,B);if(E)for(D=x[x.length-1].ownerDocument,l.map(x,Mm),B=0;B<E;B++)S=x[B],Vh.test(S.type||"")&&!at.access(S,"globalEval")&&l.contains(D,S)&&(S.src&&(S.type||"").toLowerCase()!=="module"?l._evalUrl&&!S.noModule&&l._evalUrl(S.src,{nonce:S.nonce||S.getAttribute("nonce")},D):Y(S.textContent.replace(Im,""),S,D))}return n}function Xh(n,o,u){for(var f,g=o?l.filter(o,n):n,_=0;(f=g[_])!=null;_++)!u&&f.nodeType===1&&l.cleanData(Ce(f)),f.parentNode&&(u&&Ws(f)&&Wa(Ce(f,"script")),f.parentNode.removeChild(f));return n}l.extend({htmlPrefilter:function(n){return n},clone:function(n,o,u){var f,g,_,x,E=n.cloneNode(!0),S=Ws(n);if(!y.noCloneChecked&&(n.nodeType===1||n.nodeType===11)&&!l.isXMLDoc(n))for(x=Ce(E),_=Ce(n),f=0,g=_.length;f<g;f++)Nm(_[f],x[f]);if(o)if(u)for(_=_||Ce(n),x=x||Ce(E),f=0,g=_.length;f<g;f++)Yh(_[f],x[f]);else Yh(n,E);return x=Ce(E,"script"),x.length>0&&Wa(x,!S&&Ce(n,"script")),E},cleanData:function(n){for(var o,u,f,g=l.event.special,_=0;(u=n[_])!==void 0;_++)if(Gi(u)){if(o=u[at.expando]){if(o.events)for(f in o.events)g[f]?l.event.remove(u,f):l.removeEvent(u,f,o.handle);u[at.expando]=void 0}u[ie.expando]&&(u[ie.expando]=void 0)}}}),l.fn.extend({detach:function(n){return Xh(this,n,!0)},remove:function(n){return Xh(this,n)},text:function(n){return Mt(this,function(o){return o===void 0?l.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=o)})},null,n,arguments.length)},append:function(){return qs(this,arguments,function(n){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var o=jh(this,n);o.appendChild(n)}})},prepend:function(){return qs(this,arguments,function(n){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var o=jh(this,n);o.insertBefore(n,o.firstChild)}})},before:function(){return qs(this,arguments,function(n){this.parentNode&&this.parentNode.insertBefore(n,this)})},after:function(){return qs(this,arguments,function(n){this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling)})},empty:function(){for(var n,o=0;(n=this[o])!=null;o++)n.nodeType===1&&(l.cleanData(Ce(n,!1)),n.textContent="");return this},clone:function(n,o){return n=n??!1,o=o??n,this.map(function(){return l.clone(this,n,o)})},html:function(n){return Mt(this,function(o){var u=this[0]||{},f=0,g=this.length;if(o===void 0&&u.nodeType===1)return u.innerHTML;if(typeof o=="string"&&!Lm.test(o)&&!$e[(Gh.exec(o)||["",""])[1].toLowerCase()]){o=l.htmlPrefilter(o);try{for(;f<g;f++)u=this[f]||{},u.nodeType===1&&(l.cleanData(Ce(u,!1)),u.innerHTML=o);u=0}catch{}}u&&this.empty().append(o)},null,n,arguments.length)},replaceWith:function(){var n=[];return qs(this,arguments,function(o){var u=this.parentNode;l.inArray(this,n)<0&&(l.cleanData(Ce(this)),u&&u.replaceChild(o,this))},n)}}),l.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(n,o){l.fn[n]=function(u){for(var f,g=[],_=l(u),x=_.length-1,E=0;E<=x;E++)f=E===x?this:this.clone(!0),l(_[E])[o](f),h.apply(g,f.get());return this.pushStack(g)}});var Va=new RegExp("^("+Hh+")(?!px)[a-z%]+$","i"),Ka=/^--/,Ln=function(n){var o=n.ownerDocument.defaultView;return(!o||!o.opener)&&(o=t),o.getComputedStyle(n)},Zh=function(n,o,u){var f,g,_={};for(g in o)_[g]=n.style[g],n.style[g]=o[g];f=u.call(n);for(g in o)n.style[g]=_[g];return f},Bm=new RegExp(Ei.join("|"),"i");(function(){function n(){if(D){S.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",D.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ps.appendChild(S).appendChild(D);var B=t.getComputedStyle(D);u=B.top!=="1%",E=o(B.marginLeft)===12,D.style.right="60%",_=o(B.right)===36,f=o(B.width)===36,D.style.position="absolute",g=o(D.offsetWidth/3)===12,ps.removeChild(S),D=null}}function o(B){return Math.round(parseFloat(B))}var u,f,g,_,x,E,S=M.createElement("div"),D=M.createElement("div");D.style&&(D.style.backgroundClip="content-box",D.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle=D.style.backgroundClip==="content-box",l.extend(y,{boxSizingReliable:function(){return n(),f},pixelBoxStyles:function(){return n(),_},pixelPosition:function(){return n(),u},reliableMarginLeft:function(){return n(),E},scrollboxSize:function(){return n(),g},reliableTrDimensions:function(){var B,H,P,q;return x==null&&(B=M.createElement("table"),H=M.createElement("tr"),P=M.createElement("div"),B.style.cssText="position:absolute;left:-11111px;border-collapse:separate",H.style.cssText="box-sizing:content-box;border:1px solid",H.style.height="1px",P.style.height="9px",P.style.display="block",ps.appendChild(B).appendChild(H).appendChild(P),q=t.getComputedStyle(H),x=parseInt(q.height,10)+parseInt(q.borderTopWidth,10)+parseInt(q.borderBottomWidth,10)===H.offsetHeight,ps.removeChild(B)),x}}))})();function Nr(n,o,u){var f,g,_,x,E=Ka.test(o),S=n.style;return u=u||Ln(n),u&&(x=u.getPropertyValue(o)||u[o],E&&x&&(x=x.replace(pt,"$1")||void 0),x===""&&!Ws(n)&&(x=l.style(n,o)),!y.pixelBoxStyles()&&Va.test(x)&&Bm.test(o)&&(f=S.width,g=S.minWidth,_=S.maxWidth,S.minWidth=S.maxWidth=S.width=x,x=u.width,S.width=f,S.minWidth=g,S.maxWidth=_)),x!==void 0?x+"":x}function Qh(n,o){return{get:function(){if(n()){delete this.get;return}return(this.get=o).apply(this,arguments)}}}var Jh=["Webkit","Moz","ms"],tl=M.createElement("div").style,el={};function Fm(n){for(var o=n[0].toUpperCase()+n.slice(1),u=Jh.length;u--;)if(n=Jh[u]+o,n in tl)return n}function qa(n){var o=l.cssProps[n]||el[n];return o||(n in tl?n:el[n]=Fm(n)||n)}var Um=/^(none|table(?!-c[ea]).+)/,$m={position:"absolute",visibility:"hidden",display:"block"},il={letterSpacing:"0",fontWeight:"400"};function sl(n,o,u){var f=Or.exec(o);return f?Math.max(0,f[2]-(u||0))+(f[3]||"px"):o}function ja(n,o,u,f,g,_){var x=o==="width"?1:0,E=0,S=0,D=0;if(u===(f?"border":"content"))return 0;for(;x<4;x+=2)u==="margin"&&(D+=l.css(n,u+Ei[x],!0,g)),f?(u==="content"&&(S-=l.css(n,"padding"+Ei[x],!0,g)),u!=="margin"&&(S-=l.css(n,"border"+Ei[x]+"Width",!0,g))):(S+=l.css(n,"padding"+Ei[x],!0,g),u!=="padding"?S+=l.css(n,"border"+Ei[x]+"Width",!0,g):E+=l.css(n,"border"+Ei[x]+"Width",!0,g));return!f&&_>=0&&(S+=Math.max(0,Math.ceil(n["offset"+o[0].toUpperCase()+o.slice(1)]-_-S-E-.5))||0),S+D}function rl(n,o,u){var f=Ln(n),g=!y.boxSizingReliable()||u,_=g&&l.css(n,"boxSizing",!1,f)==="border-box",x=_,E=Nr(n,o,f),S="offset"+o[0].toUpperCase()+o.slice(1);if(Va.test(E)){if(!u)return E;E="auto"}return(!y.boxSizingReliable()&&_||!y.reliableTrDimensions()&&W(n,"tr")||E==="auto"||!parseFloat(E)&&l.css(n,"display",!1,f)==="inline")&&n.getClientRects().length&&(_=l.css(n,"boxSizing",!1,f)==="border-box",x=S in n,x&&(E=n[S])),E=parseFloat(E)||0,E+ja(n,o,u||(_?"border":"content"),x,f,E)+"px"}l.extend({cssHooks:{opacity:{get:function(n,o){if(o){var u=Nr(n,"opacity");return u===""?"1":u}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(n,o,u,f){if(!(!n||n.nodeType===3||n.nodeType===8||!n.style)){var g,_,x,E=Le(o),S=Ka.test(o),D=n.style;if(S||(o=qa(E)),x=l.cssHooks[o]||l.cssHooks[E],u!==void 0){if(_=typeof u,_==="string"&&(g=Or.exec(u))&&g[1]&&(u=zh(n,o,g),_="number"),u==null||u!==u)return;_==="number"&&!S&&(u+=g&&g[3]||(l.cssNumber[E]?"":"px")),!y.clearCloneStyle&&u===""&&o.indexOf("background")===0&&(D[o]="inherit"),(!x||!("set"in x)||(u=x.set(n,u,f))!==void 0)&&(S?D.setProperty(o,u):D[o]=u)}else return x&&"get"in x&&(g=x.get(n,!1,f))!==void 0?g:D[o]}},css:function(n,o,u,f){var g,_,x,E=Le(o),S=Ka.test(o);return S||(o=qa(E)),x=l.cssHooks[o]||l.cssHooks[E],x&&"get"in x&&(g=x.get(n,!0,u)),g===void 0&&(g=Nr(n,o,f)),g==="normal"&&o in il&&(g=il[o]),u===""||u?(_=parseFloat(g),u===!0||isFinite(_)?_||0:g):g}}),l.each(["height","width"],function(n,o){l.cssHooks[o]={get:function(u,f,g){if(f)return Um.test(l.css(u,"display"))&&(!u.getClientRects().length||!u.getBoundingClientRect().width)?Zh(u,$m,function(){return rl(u,o,g)}):rl(u,o,g)},set:function(u,f,g){var _,x=Ln(u),E=!y.scrollboxSize()&&x.position==="absolute",S=E||g,D=S&&l.css(u,"boxSizing",!1,x)==="border-box",B=g?ja(u,o,g,D,x):0;return D&&E&&(B-=Math.ceil(u["offset"+o[0].toUpperCase()+o.slice(1)]-parseFloat(x[o])-ja(u,o,"border",!1,x)-.5)),B&&(_=Or.exec(f))&&(_[3]||"px")!=="px"&&(u.style[o]=f,f=l.css(u,o)),sl(u,f,B)}}}),l.cssHooks.marginLeft=Qh(y.reliableMarginLeft,function(n,o){if(o)return(parseFloat(Nr(n,"marginLeft"))||n.getBoundingClientRect().left-Zh(n,{marginLeft:0},function(){return n.getBoundingClientRect().left}))+"px"}),l.each({margin:"",padding:"",border:"Width"},function(n,o){l.cssHooks[n+o]={expand:function(u){for(var f=0,g={},_=typeof u=="string"?u.split(" "):[u];f<4;f++)g[n+Ei[f]+o]=_[f]||_[f-2]||_[0];return g}},n!=="margin"&&(l.cssHooks[n+o].set=sl)}),l.fn.extend({css:function(n,o){return Mt(this,function(u,f,g){var _,x,E={},S=0;if(Array.isArray(f)){for(_=Ln(u),x=f.length;S<x;S++)E[f[S]]=l.css(u,f[S],!1,_);return E}return g!==void 0?l.style(u,f,g):l.css(u,f)},n,o,arguments.length>1)}});function we(n,o,u,f,g){return new we.prototype.init(n,o,u,f,g)}l.Tween=we,we.prototype={constructor:we,init:function(n,o,u,f,g,_){this.elem=n,this.prop=u,this.easing=g||l.easing._default,this.options=o,this.start=this.now=this.cur(),this.end=f,this.unit=_||(l.cssNumber[u]?"":"px")},cur:function(){var n=we.propHooks[this.prop];return n&&n.get?n.get(this):we.propHooks._default.get(this)},run:function(n){var o,u=we.propHooks[this.prop];return this.options.duration?this.pos=o=l.easing[this.easing](n,this.options.duration*n,0,1,this.options.duration):this.pos=o=n,this.now=(this.end-this.start)*o+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),u&&u.set?u.set(this):we.propHooks._default.set(this),this}},we.prototype.init.prototype=we.prototype,we.propHooks={_default:{get:function(n){var o;return n.elem.nodeType!==1||n.elem[n.prop]!=null&&n.elem.style[n.prop]==null?n.elem[n.prop]:(o=l.css(n.elem,n.prop,""),!o||o==="auto"?0:o)},set:function(n){l.fx.step[n.prop]?l.fx.step[n.prop](n):n.elem.nodeType===1&&(l.cssHooks[n.prop]||n.elem.style[qa(n.prop)]!=null)?l.style(n.elem,n.prop,n.now+n.unit):n.elem[n.prop]=n.now}}},we.propHooks.scrollTop=we.propHooks.scrollLeft={set:function(n){n.elem.nodeType&&n.elem.parentNode&&(n.elem[n.prop]=n.now)}},l.easing={linear:function(n){return n},swing:function(n){return .5-Math.cos(n*Math.PI)/2},_default:"swing"},l.fx=we.prototype.init,l.fx.step={};var js,Pn,Hm=/^(?:toggle|show|hide)$/,zm=/queueHooks$/;function Ya(){Pn&&(M.hidden===!1&&t.requestAnimationFrame?t.requestAnimationFrame(Ya):t.setTimeout(Ya,l.fx.interval),l.fx.tick())}function nl(){return t.setTimeout(function(){js=void 0}),js=Date.now()}function In(n,o){var u,f=0,g={height:n};for(o=o?1:0;f<4;f+=2-o)u=Ei[f],g["margin"+u]=g["padding"+u]=n;return o&&(g.opacity=g.width=n),g}function al(n,o,u){for(var f,g=(ii.tweeners[o]||[]).concat(ii.tweeners["*"]),_=0,x=g.length;_<x;_++)if(f=g[_].call(u,o,n))return f}function Wm(n,o,u){var f,g,_,x,E,S,D,B,H="width"in o||"height"in o,P=this,q={},mt=n.style,St=n.nodeType&&Dn(n),bt=at.get(n,"fxshow");u.queue||(x=l._queueHooks(n,"fx"),x.unqueued==null&&(x.unqueued=0,E=x.empty.fire,x.empty.fire=function(){x.unqueued||E()}),x.unqueued++,P.always(function(){P.always(function(){x.unqueued--,l.queue(n,"fx").length||x.empty.fire()})}));for(f in o)if(g=o[f],Hm.test(g)){if(delete o[f],_=_||g==="toggle",g===(St?"hide":"show"))if(g==="show"&&bt&&bt[f]!==void 0)St=!0;else continue;q[f]=bt&&bt[f]||l.style(n,f)}if(S=!l.isEmptyObject(o),!(!S&&l.isEmptyObject(q))){H&&n.nodeType===1&&(u.overflow=[mt.overflow,mt.overflowX,mt.overflowY],D=bt&&bt.display,D==null&&(D=at.get(n,"display")),B=l.css(n,"display"),B==="none"&&(D?B=D:(Gs([n],!0),D=n.style.display||D,B=l.css(n,"display"),Gs([n]))),(B==="inline"||B==="inline-block"&&D!=null)&&l.css(n,"float")==="none"&&(S||(P.done(function(){mt.display=D}),D==null&&(B=mt.display,D=B==="none"?"":B)),mt.display="inline-block")),u.overflow&&(mt.overflow="hidden",P.always(function(){mt.overflow=u.overflow[0],mt.overflowX=u.overflow[1],mt.overflowY=u.overflow[2]})),S=!1;for(f in q)S||(bt?"hidden"in bt&&(St=bt.hidden):bt=at.access(n,"fxshow",{display:D}),_&&(bt.hidden=!St),St&&Gs([n],!0),P.done(function(){St||Gs([n]),at.remove(n,"fxshow");for(f in q)l.style(n,f,q[f])})),S=al(St?bt[f]:0,f,P),f in bt||(bt[f]=S.start,St&&(S.end=S.start,S.start=0))}}function Gm(n,o){var u,f,g,_,x;for(u in n)if(f=Le(u),g=o[f],_=n[u],Array.isArray(_)&&(g=_[1],_=n[u]=_[0]),u!==f&&(n[f]=_,delete n[u]),x=l.cssHooks[f],x&&"expand"in x){_=x.expand(_),delete n[f];for(u in _)u in n||(n[u]=_[u],o[u]=g)}else o[f]=g}function ii(n,o,u){var f,g,_=0,x=ii.prefilters.length,E=l.Deferred().always(function(){delete S.elem}),S=function(){if(g)return!1;for(var H=js||nl(),P=Math.max(0,D.startTime+D.duration-H),q=P/D.duration||0,mt=1-q,St=0,bt=D.tweens.length;St<bt;St++)D.tweens[St].run(mt);return E.notifyWith(n,[D,mt,P]),mt<1&&bt?P:(bt||E.notifyWith(n,[D,1,0]),E.resolveWith(n,[D]),!1)},D=E.promise({elem:n,props:l.extend({},o),opts:l.extend(!0,{specialEasing:{},easing:l.easing._default},u),originalProperties:o,originalOptions:u,startTime:js||nl(),duration:u.duration,tweens:[],createTween:function(H,P){var q=l.Tween(n,D.opts,H,P,D.opts.specialEasing[H]||D.opts.easing);return D.tweens.push(q),q},stop:function(H){var P=0,q=H?D.tweens.length:0;if(g)return this;for(g=!0;P<q;P++)D.tweens[P].run(1);return H?(E.notifyWith(n,[D,1,0]),E.resolveWith(n,[D,H])):E.rejectWith(n,[D,H]),this}}),B=D.props;for(Gm(B,D.opts.specialEasing);_<x;_++)if(f=ii.prefilters[_].call(D,n,B,D.opts),f)return R(f.stop)&&(l._queueHooks(D.elem,D.opts.queue).stop=f.stop.bind(f)),f;return l.map(B,al,D),R(D.opts.start)&&D.opts.start.call(n,D),D.progress(D.opts.progress).done(D.opts.done,D.opts.complete).fail(D.opts.fail).always(D.opts.always),l.fx.timer(l.extend(S,{elem:n,anim:D,queue:D.opts.queue})),D}l.Animation=l.extend(ii,{tweeners:{"*":[function(n,o){var u=this.createTween(n,o);return zh(u.elem,n,Or.exec(o),u),u}]},tweener:function(n,o){R(n)?(o=n,n=["*"]):n=n.match(Xt);for(var u,f=0,g=n.length;f<g;f++)u=n[f],ii.tweeners[u]=ii.tweeners[u]||[],ii.tweeners[u].unshift(o)},prefilters:[Wm],prefilter:function(n,o){o?ii.prefilters.unshift(n):ii.prefilters.push(n)}}),l.speed=function(n,o,u){var f=n&&typeof n=="object"?l.extend({},n):{complete:u||!u&&o||R(n)&&n,duration:n,easing:u&&o||o&&!R(o)&&o};return l.fx.off?f.duration=0:typeof f.duration!="number"&&(f.duration in l.fx.speeds?f.duration=l.fx.speeds[f.duration]:f.duration=l.fx.speeds._default),(f.queue==null||f.queue===!0)&&(f.queue="fx"),f.old=f.complete,f.complete=function(){R(f.old)&&f.old.call(this),f.queue&&l.dequeue(this,f.queue)},f},l.fn.extend({fadeTo:function(n,o,u,f){return this.filter(Dn).css("opacity",0).show().end().animate({opacity:o},n,u,f)},animate:function(n,o,u,f){var g=l.isEmptyObject(n),_=l.speed(o,u,f),x=function(){var E=ii(this,l.extend({},n),_);(g||at.get(this,"finish"))&&E.stop(!0)};return x.finish=x,g||_.queue===!1?this.each(x):this.queue(_.queue,x)},stop:function(n,o,u){var f=function(g){var _=g.stop;delete g.stop,_(u)};return typeof n!="string"&&(u=o,o=n,n=void 0),o&&this.queue(n||"fx",[]),this.each(function(){var g=!0,_=n!=null&&n+"queueHooks",x=l.timers,E=at.get(this);if(_)E[_]&&E[_].stop&&f(E[_]);else for(_ in E)E[_]&&E[_].stop&&zm.test(_)&&f(E[_]);for(_=x.length;_--;)x[_].elem===this&&(n==null||x[_].queue===n)&&(x[_].anim.stop(u),g=!1,x.splice(_,1));(g||!u)&&l.dequeue(this,n)})},finish:function(n){return n!==!1&&(n=n||"fx"),this.each(function(){var o,u=at.get(this),f=u[n+"queue"],g=u[n+"queueHooks"],_=l.timers,x=f?f.length:0;for(u.finish=!0,l.queue(this,n,[]),g&&g.stop&&g.stop.call(this,!0),o=_.length;o--;)_[o].elem===this&&_[o].queue===n&&(_[o].anim.stop(!0),_.splice(o,1));for(o=0;o<x;o++)f[o]&&f[o].finish&&f[o].finish.call(this);delete u.finish})}}),l.each(["toggle","show","hide"],function(n,o){var u=l.fn[o];l.fn[o]=function(f,g,_){return f==null||typeof f=="boolean"?u.apply(this,arguments):this.animate(In(o,!0),f,g,_)}}),l.each({slideDown:In("show"),slideUp:In("hide"),slideToggle:In("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(n,o){l.fn[n]=function(u,f,g){return this.animate(o,u,f,g)}}),l.timers=[],l.fx.tick=function(){var n,o=0,u=l.timers;for(js=Date.now();o<u.length;o++)n=u[o],!n()&&u[o]===n&&u.splice(o--,1);u.length||l.fx.stop(),js=void 0},l.fx.timer=function(n){l.timers.push(n),l.fx.start()},l.fx.interval=13,l.fx.start=function(){Pn||(Pn=!0,Ya())},l.fx.stop=function(){Pn=null},l.fx.speeds={slow:600,fast:200,_default:400},l.fn.delay=function(n,o){return n=l.fx&&l.fx.speeds[n]||n,o=o||"fx",this.queue(o,function(u,f){var g=t.setTimeout(u,n);f.stop=function(){t.clearTimeout(g)}})},function(){var n=M.createElement("input"),o=M.createElement("select"),u=o.appendChild(M.createElement("option"));n.type="checkbox",y.checkOn=n.value!=="",y.optSelected=u.selected,n=M.createElement("input"),n.value="t",n.type="radio",y.radioValue=n.value==="t"}();var ol,Br=l.expr.attrHandle;l.fn.extend({attr:function(n,o){return Mt(this,l.attr,n,o,arguments.length>1)},removeAttr:function(n){return this.each(function(){l.removeAttr(this,n)})}}),l.extend({attr:function(n,o,u){var f,g,_=n.nodeType;if(!(_===3||_===8||_===2)){if(typeof n.getAttribute>"u")return l.prop(n,o,u);if((_!==1||!l.isXMLDoc(n))&&(g=l.attrHooks[o.toLowerCase()]||(l.expr.match.bool.test(o)?ol:void 0)),u!==void 0){if(u===null){l.removeAttr(n,o);return}return g&&"set"in g&&(f=g.set(n,u,o))!==void 0?f:(n.setAttribute(o,u+""),u)}return g&&"get"in g&&(f=g.get(n,o))!==null?f:(f=l.find.attr(n,o),f??void 0)}},attrHooks:{type:{set:function(n,o){if(!y.radioValue&&o==="radio"&&W(n,"input")){var u=n.value;return n.setAttribute("type",o),u&&(n.value=u),o}}}},removeAttr:function(n,o){var u,f=0,g=o&&o.match(Xt);if(g&&n.nodeType===1)for(;u=g[f++];)n.removeAttribute(u)}}),ol={set:function(n,o,u){return o===!1?l.removeAttr(n,u):n.setAttribute(u,u),u}},l.each(l.expr.match.bool.source.match(/\w+/g),function(n,o){var u=Br[o]||l.find.attr;Br[o]=function(f,g,_){var x,E,S=g.toLowerCase();return _||(E=Br[S],Br[S]=x,x=u(f,g,_)!=null?S:null,Br[S]=E),x}});var Vm=/^(?:input|select|textarea|button)$/i,Km=/^(?:a|area)$/i;l.fn.extend({prop:function(n,o){return Mt(this,l.prop,n,o,arguments.length>1)},removeProp:function(n){return this.each(function(){delete this[l.propFix[n]||n]})}}),l.extend({prop:function(n,o,u){var f,g,_=n.nodeType;if(!(_===3||_===8||_===2))return(_!==1||!l.isXMLDoc(n))&&(o=l.propFix[o]||o,g=l.propHooks[o]),u!==void 0?g&&"set"in g&&(f=g.set(n,u,o))!==void 0?f:n[o]=u:g&&"get"in g&&(f=g.get(n,o))!==null?f:n[o]},propHooks:{tabIndex:{get:function(n){var o=l.find.attr(n,"tabindex");return o?parseInt(o,10):Vm.test(n.nodeName)||Km.test(n.nodeName)&&n.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),y.optSelected||(l.propHooks.selected={get:function(n){var o=n.parentNode;return o&&o.parentNode&&o.parentNode.selectedIndex,null},set:function(n){var o=n.parentNode;o&&(o.selectedIndex,o.parentNode&&o.parentNode.selectedIndex)}}),l.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){l.propFix[this.toLowerCase()]=this});function ms(n){var o=n.match(Xt)||[];return o.join(" ")}function gs(n){return n.getAttribute&&n.getAttribute("class")||""}function Xa(n){return Array.isArray(n)?n:typeof n=="string"?n.match(Xt)||[]:[]}l.fn.extend({addClass:function(n){var o,u,f,g,_,x;return R(n)?this.each(function(E){l(this).addClass(n.call(this,E,gs(this)))}):(o=Xa(n),o.length?this.each(function(){if(f=gs(this),u=this.nodeType===1&&" "+ms(f)+" ",u){for(_=0;_<o.length;_++)g=o[_],u.indexOf(" "+g+" ")<0&&(u+=g+" ");x=ms(u),f!==x&&this.setAttribute("class",x)}}):this)},removeClass:function(n){var o,u,f,g,_,x;return R(n)?this.each(function(E){l(this).removeClass(n.call(this,E,gs(this)))}):arguments.length?(o=Xa(n),o.length?this.each(function(){if(f=gs(this),u=this.nodeType===1&&" "+ms(f)+" ",u){for(_=0;_<o.length;_++)for(g=o[_];u.indexOf(" "+g+" ")>-1;)u=u.replace(" "+g+" "," ");x=ms(u),f!==x&&this.setAttribute("class",x)}}):this):this.attr("class","")},toggleClass:function(n,o){var u,f,g,_,x=typeof n,E=x==="string"||Array.isArray(n);return R(n)?this.each(function(S){l(this).toggleClass(n.call(this,S,gs(this),o),o)}):typeof o=="boolean"&&E?o?this.addClass(n):this.removeClass(n):(u=Xa(n),this.each(function(){if(E)for(_=l(this),g=0;g<u.length;g++)f=u[g],_.hasClass(f)?_.removeClass(f):_.addClass(f);else(n===void 0||x==="boolean")&&(f=gs(this),f&&at.set(this,"__className__",f),this.setAttribute&&this.setAttribute("class",f||n===!1?"":at.get(this,"__className__")||""))}))},hasClass:function(n){var o,u,f=0;for(o=" "+n+" ";u=this[f++];)if(u.nodeType===1&&(" "+ms(gs(u))+" ").indexOf(o)>-1)return!0;return!1}});var qm=/\r/g;l.fn.extend({val:function(n){var o,u,f,g=this[0];return arguments.length?(f=R(n),this.each(function(_){var x;this.nodeType===1&&(f?x=n.call(this,_,l(this).val()):x=n,x==null?x="":typeof x=="number"?x+="":Array.isArray(x)&&(x=l.map(x,function(E){return E==null?"":E+""})),o=l.valHooks[this.type]||l.valHooks[this.nodeName.toLowerCase()],(!o||!("set"in o)||o.set(this,x,"value")===void 0)&&(this.value=x))})):g?(o=l.valHooks[g.type]||l.valHooks[g.nodeName.toLowerCase()],o&&"get"in o&&(u=o.get(g,"value"))!==void 0?u:(u=g.value,typeof u=="string"?u.replace(qm,""):u??"")):void 0}}),l.extend({valHooks:{option:{get:function(n){var o=l.find.attr(n,"value");return o??ms(l.text(n))}},select:{get:function(n){var o,u,f,g=n.options,_=n.selectedIndex,x=n.type==="select-one",E=x?null:[],S=x?_+1:g.length;for(_<0?f=S:f=x?_:0;f<S;f++)if(u=g[f],(u.selected||f===_)&&!u.disabled&&(!u.parentNode.disabled||!W(u.parentNode,"optgroup"))){if(o=l(u).val(),x)return o;E.push(o)}return E},set:function(n,o){for(var u,f,g=n.options,_=l.makeArray(o),x=g.length;x--;)f=g[x],(f.selected=l.inArray(l.valHooks.option.get(f),_)>-1)&&(u=!0);return u||(n.selectedIndex=-1),_}}}}),l.each(["radio","checkbox"],function(){l.valHooks[this]={set:function(n,o){if(Array.isArray(o))return n.checked=l.inArray(l(n).val(),o)>-1}},y.checkOn||(l.valHooks[this].get=function(n){return n.getAttribute("value")===null?"on":n.value})});var Fr=t.location,cl={guid:Date.now()},Za=/\?/;l.parseXML=function(n){var o,u;if(!n||typeof n!="string")return null;try{o=new t.DOMParser().parseFromString(n,"text/xml")}catch{}return u=o&&o.getElementsByTagName("parsererror")[0],(!o||u)&&l.error("Invalid XML: "+(u?l.map(u.childNodes,function(f){return f.textContent}).join(`
`):n)),o};var hl=/^(?:focusinfocus|focusoutblur)$/,ll=function(n){n.stopPropagation()};l.extend(l.event,{trigger:function(n,o,u,f){var g,_,x,E,S,D,B,H,P=[u||M],q=b.call(n,"type")?n.type:n,mt=b.call(n,"namespace")?n.namespace.split("."):[];if(_=H=x=u=u||M,!(u.nodeType===3||u.nodeType===8)&&!hl.test(q+l.event.triggered)&&(q.indexOf(".")>-1&&(mt=q.split("."),q=mt.shift(),mt.sort()),S=q.indexOf(":")<0&&"on"+q,n=n[l.expando]?n:new l.Event(q,typeof n=="object"&&n),n.isTrigger=f?2:3,n.namespace=mt.join("."),n.rnamespace=n.namespace?new RegExp("(^|\\.)"+mt.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=void 0,n.target||(n.target=u),o=o==null?[n]:l.makeArray(o,[n]),B=l.event.special[q]||{},!(!f&&B.trigger&&B.trigger.apply(u,o)===!1))){if(!f&&!B.noBubble&&!U(u)){for(E=B.delegateType||q,hl.test(E+q)||(_=_.parentNode);_;_=_.parentNode)P.push(_),x=_;x===(u.ownerDocument||M)&&P.push(x.defaultView||x.parentWindow||t)}for(g=0;(_=P[g++])&&!n.isPropagationStopped();)H=_,n.type=g>1?E:B.bindType||q,D=(at.get(_,"events")||Object.create(null))[n.type]&&at.get(_,"handle"),D&&D.apply(_,o),D=S&&_[S],D&&D.apply&&Gi(_)&&(n.result=D.apply(_,o),n.result===!1&&n.preventDefault());return n.type=q,!f&&!n.isDefaultPrevented()&&(!B._default||B._default.apply(P.pop(),o)===!1)&&Gi(u)&&S&&R(u[q])&&!U(u)&&(x=u[S],x&&(u[S]=null),l.event.triggered=q,n.isPropagationStopped()&&H.addEventListener(q,ll),u[q](),n.isPropagationStopped()&&H.removeEventListener(q,ll),l.event.triggered=void 0,x&&(u[S]=x)),n.result}},simulate:function(n,o,u){var f=l.extend(new l.Event,u,{type:n,isSimulated:!0});l.event.trigger(f,null,o)}}),l.fn.extend({trigger:function(n,o){return this.each(function(){l.event.trigger(n,o,this)})},triggerHandler:function(n,o){var u=this[0];if(u)return l.event.trigger(n,o,u,!0)}});var jm=/\[\]$/,ul=/\r?\n/g,Ym=/^(?:submit|button|image|reset|file)$/i,Xm=/^(?:input|select|textarea|keygen)/i;function Qa(n,o,u,f){var g;if(Array.isArray(o))l.each(o,function(_,x){u||jm.test(n)?f(n,x):Qa(n+"["+(typeof x=="object"&&x!=null?_:"")+"]",x,u,f)});else if(!u&&N(o)==="object")for(g in o)Qa(n+"["+g+"]",o[g],u,f);else f(n,o)}l.param=function(n,o){var u,f=[],g=function(_,x){var E=R(x)?x():x;f[f.length]=encodeURIComponent(_)+"="+encodeURIComponent(E??"")};if(n==null)return"";if(Array.isArray(n)||n.jquery&&!l.isPlainObject(n))l.each(n,function(){g(this.name,this.value)});else for(u in n)Qa(u,n[u],o,g);return f.join("&")},l.fn.extend({serialize:function(){return l.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var n=l.prop(this,"elements");return n?l.makeArray(n):this}).filter(function(){var n=this.type;return this.name&&!l(this).is(":disabled")&&Xm.test(this.nodeName)&&!Ym.test(n)&&(this.checked||!Mr.test(n))}).map(function(n,o){var u=l(this).val();return u==null?null:Array.isArray(u)?l.map(u,function(f){return{name:o.name,value:f.replace(ul,`\r
`)}}):{name:o.name,value:u.replace(ul,`\r
`)}}).get()}});var Zm=/%20/g,Qm=/#.*$/,Jm=/([?&])_=[^&]*/,tg=/^(.*?):[ \t]*([^\r\n]*)$/mg,eg=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ig=/^(?:GET|HEAD)$/,sg=/^\/\//,fl={},Ja={},dl="*/".concat("*"),to=M.createElement("a");to.href=Fr.href;function pl(n){return function(o,u){typeof o!="string"&&(u=o,o="*");var f,g=0,_=o.toLowerCase().match(Xt)||[];if(R(u))for(;f=_[g++];)f[0]==="+"?(f=f.slice(1)||"*",(n[f]=n[f]||[]).unshift(u)):(n[f]=n[f]||[]).push(u)}}function ml(n,o,u,f){var g={},_=n===Ja;function x(E){var S;return g[E]=!0,l.each(n[E]||[],function(D,B){var H=B(o,u,f);if(typeof H=="string"&&!_&&!g[H])return o.dataTypes.unshift(H),x(H),!1;if(_)return!(S=H)}),S}return x(o.dataTypes[0])||!g["*"]&&x("*")}function eo(n,o){var u,f,g=l.ajaxSettings.flatOptions||{};for(u in o)o[u]!==void 0&&((g[u]?n:f||(f={}))[u]=o[u]);return f&&l.extend(!0,n,f),n}function rg(n,o,u){for(var f,g,_,x,E=n.contents,S=n.dataTypes;S[0]==="*";)S.shift(),f===void 0&&(f=n.mimeType||o.getResponseHeader("Content-Type"));if(f){for(g in E)if(E[g]&&E[g].test(f)){S.unshift(g);break}}if(S[0]in u)_=S[0];else{for(g in u){if(!S[0]||n.converters[g+" "+S[0]]){_=g;break}x||(x=g)}_=_||x}if(_)return _!==S[0]&&S.unshift(_),u[_]}function ng(n,o,u,f){var g,_,x,E,S,D={},B=n.dataTypes.slice();if(B[1])for(x in n.converters)D[x.toLowerCase()]=n.converters[x];for(_=B.shift();_;)if(n.responseFields[_]&&(u[n.responseFields[_]]=o),!S&&f&&n.dataFilter&&(o=n.dataFilter(o,n.dataType)),S=_,_=B.shift(),_){if(_==="*")_=S;else if(S!=="*"&&S!==_){if(x=D[S+" "+_]||D["* "+_],!x){for(g in D)if(E=g.split(" "),E[1]===_&&(x=D[S+" "+E[0]]||D["* "+E[0]],x)){x===!0?x=D[g]:D[g]!==!0&&(_=E[0],B.unshift(E[1]));break}}if(x!==!0)if(x&&n.throws)o=x(o);else try{o=x(o)}catch(H){return{state:"parsererror",error:x?H:"No conversion from "+S+" to "+_}}}}return{state:"success",data:o}}l.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Fr.href,type:"GET",isLocal:eg.test(Fr.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":dl,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":l.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(n,o){return o?eo(eo(n,l.ajaxSettings),o):eo(l.ajaxSettings,n)},ajaxPrefilter:pl(fl),ajaxTransport:pl(Ja),ajax:function(n,o){typeof n=="object"&&(o=n,n=void 0),o=o||{};var u,f,g,_,x,E,S,D,B,H,P=l.ajaxSetup({},o),q=P.context||P,mt=P.context&&(q.nodeType||q.jquery)?l(q):l.event,St=l.Deferred(),bt=l.Callbacks("once memory"),se=P.statusCode||{},qt={},pi={},mi="canceled",Ct={readyState:0,getResponseHeader:function(Et){var $t;if(S){if(!_)for(_={};$t=tg.exec(g);)_[$t[1].toLowerCase()+" "]=(_[$t[1].toLowerCase()+" "]||[]).concat($t[2]);$t=_[Et.toLowerCase()+" "]}return $t==null?null:$t.join(", ")},getAllResponseHeaders:function(){return S?g:null},setRequestHeader:function(Et,$t){return S==null&&(Et=pi[Et.toLowerCase()]=pi[Et.toLowerCase()]||Et,qt[Et]=$t),this},overrideMimeType:function(Et){return S==null&&(P.mimeType=Et),this},statusCode:function(Et){var $t;if(Et)if(S)Ct.always(Et[Ct.status]);else for($t in Et)se[$t]=[se[$t],Et[$t]];return this},abort:function(Et){var $t=Et||mi;return u&&u.abort($t),_s(0,$t),this}};if(St.promise(Ct),P.url=((n||P.url||Fr.href)+"").replace(sg,Fr.protocol+"//"),P.type=o.method||o.type||P.method||P.type,P.dataTypes=(P.dataType||"*").toLowerCase().match(Xt)||[""],P.crossDomain==null){E=M.createElement("a");try{E.href=P.url,E.href=E.href,P.crossDomain=to.protocol+"//"+to.host!=E.protocol+"//"+E.host}catch{P.crossDomain=!0}}if(P.data&&P.processData&&typeof P.data!="string"&&(P.data=l.param(P.data,P.traditional)),ml(fl,P,o,Ct),S)return Ct;D=l.event&&P.global,D&&l.active++===0&&l.event.trigger("ajaxStart"),P.type=P.type.toUpperCase(),P.hasContent=!ig.test(P.type),f=P.url.replace(Qm,""),P.hasContent?P.data&&P.processData&&(P.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(P.data=P.data.replace(Zm,"+")):(H=P.url.slice(f.length),P.data&&(P.processData||typeof P.data=="string")&&(f+=(Za.test(f)?"&":"?")+P.data,delete P.data),P.cache===!1&&(f=f.replace(Jm,"$1"),H=(Za.test(f)?"&":"?")+"_="+cl.guid+++H),P.url=f+H),P.ifModified&&(l.lastModified[f]&&Ct.setRequestHeader("If-Modified-Since",l.lastModified[f]),l.etag[f]&&Ct.setRequestHeader("If-None-Match",l.etag[f])),(P.data&&P.hasContent&&P.contentType!==!1||o.contentType)&&Ct.setRequestHeader("Content-Type",P.contentType),Ct.setRequestHeader("Accept",P.dataTypes[0]&&P.accepts[P.dataTypes[0]]?P.accepts[P.dataTypes[0]]+(P.dataTypes[0]!=="*"?", "+dl+"; q=0.01":""):P.accepts["*"]);for(B in P.headers)Ct.setRequestHeader(B,P.headers[B]);if(P.beforeSend&&(P.beforeSend.call(q,Ct,P)===!1||S))return Ct.abort();if(mi="abort",bt.add(P.complete),Ct.done(P.success),Ct.fail(P.error),u=ml(Ja,P,o,Ct),!u)_s(-1,"No Transport");else{if(Ct.readyState=1,D&&mt.trigger("ajaxSend",[Ct,P]),S)return Ct;P.async&&P.timeout>0&&(x=t.setTimeout(function(){Ct.abort("timeout")},P.timeout));try{S=!1,u.send(qt,_s)}catch(Et){if(S)throw Et;_s(-1,Et)}}function _s(Et,$t,$r,so){var gi,Hr,_i,Vi,Ki,He=$t;S||(S=!0,x&&t.clearTimeout(x),u=void 0,g=so||"",Ct.readyState=Et>0?4:0,gi=Et>=200&&Et<300||Et===304,$r&&(Vi=rg(P,Ct,$r)),!gi&&l.inArray("script",P.dataTypes)>-1&&l.inArray("json",P.dataTypes)<0&&(P.converters["text script"]=function(){}),Vi=ng(P,Vi,Ct,gi),gi?(P.ifModified&&(Ki=Ct.getResponseHeader("Last-Modified"),Ki&&(l.lastModified[f]=Ki),Ki=Ct.getResponseHeader("etag"),Ki&&(l.etag[f]=Ki)),Et===204||P.type==="HEAD"?He="nocontent":Et===304?He="notmodified":(He=Vi.state,Hr=Vi.data,_i=Vi.error,gi=!_i)):(_i=He,(Et||!He)&&(He="error",Et<0&&(Et=0))),Ct.status=Et,Ct.statusText=($t||He)+"",gi?St.resolveWith(q,[Hr,He,Ct]):St.rejectWith(q,[Ct,He,_i]),Ct.statusCode(se),se=void 0,D&&mt.trigger(gi?"ajaxSuccess":"ajaxError",[Ct,P,gi?Hr:_i]),bt.fireWith(q,[Ct,He]),D&&(mt.trigger("ajaxComplete",[Ct,P]),--l.active||l.event.trigger("ajaxStop")))}return Ct},getJSON:function(n,o,u){return l.get(n,o,u,"json")},getScript:function(n,o){return l.get(n,void 0,o,"script")}}),l.each(["get","post"],function(n,o){l[o]=function(u,f,g,_){return R(f)&&(_=_||g,g=f,f=void 0),l.ajax(l.extend({url:u,type:o,dataType:_,data:f,success:g},l.isPlainObject(u)&&u))}}),l.ajaxPrefilter(function(n){var o;for(o in n.headers)o.toLowerCase()==="content-type"&&(n.contentType=n.headers[o]||"")}),l._evalUrl=function(n,o,u){return l.ajax({url:n,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(f){l.globalEval(f,o,u)}})},l.fn.extend({wrapAll:function(n){var o;return this[0]&&(R(n)&&(n=n.call(this[0])),o=l(n,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&o.insertBefore(this[0]),o.map(function(){for(var u=this;u.firstElementChild;)u=u.firstElementChild;return u}).append(this)),this},wrapInner:function(n){return R(n)?this.each(function(o){l(this).wrapInner(n.call(this,o))}):this.each(function(){var o=l(this),u=o.contents();u.length?u.wrapAll(n):o.append(n)})},wrap:function(n){var o=R(n);return this.each(function(u){l(this).wrapAll(o?n.call(this,u):n)})},unwrap:function(n){return this.parent(n).not("body").each(function(){l(this).replaceWith(this.childNodes)}),this}}),l.expr.pseudos.hidden=function(n){return!l.expr.pseudos.visible(n)},l.expr.pseudos.visible=function(n){return!!(n.offsetWidth||n.offsetHeight||n.getClientRects().length)},l.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch{}};var ag={0:200,1223:204},Ur=l.ajaxSettings.xhr();y.cors=!!Ur&&"withCredentials"in Ur,y.ajax=Ur=!!Ur,l.ajaxTransport(function(n){var o,u;if(y.cors||Ur&&!n.crossDomain)return{send:function(f,g){var _,x=n.xhr();if(x.open(n.type,n.url,n.async,n.username,n.password),n.xhrFields)for(_ in n.xhrFields)x[_]=n.xhrFields[_];n.mimeType&&x.overrideMimeType&&x.overrideMimeType(n.mimeType),!n.crossDomain&&!f["X-Requested-With"]&&(f["X-Requested-With"]="XMLHttpRequest");for(_ in f)x.setRequestHeader(_,f[_]);o=function(E){return function(){o&&(o=u=x.onload=x.onerror=x.onabort=x.ontimeout=x.onreadystatechange=null,E==="abort"?x.abort():E==="error"?typeof x.status!="number"?g(0,"error"):g(x.status,x.statusText):g(ag[x.status]||x.status,x.statusText,(x.responseType||"text")!=="text"||typeof x.responseText!="string"?{binary:x.response}:{text:x.responseText},x.getAllResponseHeaders()))}},x.onload=o(),u=x.onerror=x.ontimeout=o("error"),x.onabort!==void 0?x.onabort=u:x.onreadystatechange=function(){x.readyState===4&&t.setTimeout(function(){o&&u()})},o=o("abort");try{x.send(n.hasContent&&n.data||null)}catch(E){if(o)throw E}},abort:function(){o&&o()}}}),l.ajaxPrefilter(function(n){n.crossDomain&&(n.contents.script=!1)}),l.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(n){return l.globalEval(n),n}}}),l.ajaxPrefilter("script",function(n){n.cache===void 0&&(n.cache=!1),n.crossDomain&&(n.type="GET")}),l.ajaxTransport("script",function(n){if(n.crossDomain||n.scriptAttrs){var o,u;return{send:function(f,g){o=l("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",u=function(_){o.remove(),u=null,_&&g(_.type==="error"?404:200,_.type)}),M.head.appendChild(o[0])},abort:function(){u&&u()}}}});var gl=[],io=/(=)\?(?=&|$)|\?\?/;l.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=gl.pop()||l.expando+"_"+cl.guid++;return this[n]=!0,n}}),l.ajaxPrefilter("json jsonp",function(n,o,u){var f,g,_,x=n.jsonp!==!1&&(io.test(n.url)?"url":typeof n.data=="string"&&(n.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&io.test(n.data)&&"data");if(x||n.dataTypes[0]==="jsonp")return f=n.jsonpCallback=R(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,x?n[x]=n[x].replace(io,"$1"+f):n.jsonp!==!1&&(n.url+=(Za.test(n.url)?"&":"?")+n.jsonp+"="+f),n.converters["script json"]=function(){return _||l.error(f+" was not called"),_[0]},n.dataTypes[0]="json",g=t[f],t[f]=function(){_=arguments},u.always(function(){g===void 0?l(t).removeProp(f):t[f]=g,n[f]&&(n.jsonpCallback=o.jsonpCallback,gl.push(f)),_&&R(g)&&g(_[0]),_=g=void 0}),"script"}),y.createHTMLDocument=function(){var n=M.implementation.createHTMLDocument("").body;return n.innerHTML="<form></form><form></form>",n.childNodes.length===2}(),l.parseHTML=function(n,o,u){if(typeof n!="string")return[];typeof o=="boolean"&&(u=o,o=!1);var f,g,_;return o||(y.createHTMLDocument?(o=M.implementation.createHTMLDocument(""),f=o.createElement("base"),f.href=M.location.href,o.head.appendChild(f)):o=M),g=le.exec(n),_=!u&&[],g?[o.createElement(g[1])]:(g=Kh([n],o,_),_&&_.length&&l(_).remove(),l.merge([],g.childNodes))},l.fn.load=function(n,o,u){var f,g,_,x=this,E=n.indexOf(" ");return E>-1&&(f=ms(n.slice(E)),n=n.slice(0,E)),R(o)?(u=o,o=void 0):o&&typeof o=="object"&&(g="POST"),x.length>0&&l.ajax({url:n,type:g||"GET",dataType:"html",data:o}).done(function(S){_=arguments,x.html(f?l("<div>").append(l.parseHTML(S)).find(f):S)}).always(u&&function(S,D){x.each(function(){u.apply(this,_||[S.responseText,D,S])})}),this},l.expr.pseudos.animated=function(n){return l.grep(l.timers,function(o){return n===o.elem}).length},l.offset={setOffset:function(n,o,u){var f,g,_,x,E,S,D,B=l.css(n,"position"),H=l(n),P={};B==="static"&&(n.style.position="relative"),E=H.offset(),_=l.css(n,"top"),S=l.css(n,"left"),D=(B==="absolute"||B==="fixed")&&(_+S).indexOf("auto")>-1,D?(f=H.position(),x=f.top,g=f.left):(x=parseFloat(_)||0,g=parseFloat(S)||0),R(o)&&(o=o.call(n,u,l.extend({},E))),o.top!=null&&(P.top=o.top-E.top+x),o.left!=null&&(P.left=o.left-E.left+g),"using"in o?o.using.call(n,P):H.css(P)}},l.fn.extend({offset:function(n){if(arguments.length)return n===void 0?this:this.each(function(g){l.offset.setOffset(this,n,g)});var o,u,f=this[0];if(f)return f.getClientRects().length?(o=f.getBoundingClientRect(),u=f.ownerDocument.defaultView,{top:o.top+u.pageYOffset,left:o.left+u.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var n,o,u,f=this[0],g={top:0,left:0};if(l.css(f,"position")==="fixed")o=f.getBoundingClientRect();else{for(o=this.offset(),u=f.ownerDocument,n=f.offsetParent||u.documentElement;n&&(n===u.body||n===u.documentElement)&&l.css(n,"position")==="static";)n=n.parentNode;n&&n!==f&&n.nodeType===1&&(g=l(n).offset(),g.top+=l.css(n,"borderTopWidth",!0),g.left+=l.css(n,"borderLeftWidth",!0))}return{top:o.top-g.top-l.css(f,"marginTop",!0),left:o.left-g.left-l.css(f,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var n=this.offsetParent;n&&l.css(n,"position")==="static";)n=n.offsetParent;return n||ps})}}),l.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(n,o){var u=o==="pageYOffset";l.fn[n]=function(f){return Mt(this,function(g,_,x){var E;if(U(g)?E=g:g.nodeType===9&&(E=g.defaultView),x===void 0)return E?E[o]:g[_];E?E.scrollTo(u?E.pageXOffset:x,u?x:E.pageYOffset):g[_]=x},n,f,arguments.length)}}),l.each(["top","left"],function(n,o){l.cssHooks[o]=Qh(y.pixelPosition,function(u,f){if(f)return f=Nr(u,o),Va.test(f)?l(u).position()[o]+"px":f})}),l.each({Height:"height",Width:"width"},function(n,o){l.each({padding:"inner"+n,content:o,"":"outer"+n},function(u,f){l.fn[f]=function(g,_){var x=arguments.length&&(u||typeof g!="boolean"),E=u||(g===!0||_===!0?"margin":"border");return Mt(this,function(S,D,B){var H;return U(S)?f.indexOf("outer")===0?S["inner"+n]:S.document.documentElement["client"+n]:S.nodeType===9?(H=S.documentElement,Math.max(S.body["scroll"+n],H["scroll"+n],S.body["offset"+n],H["offset"+n],H["client"+n])):B===void 0?l.css(S,D,E):l.style(S,D,B,E)},o,x?g:void 0,x)}})}),l.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(n,o){l.fn[o]=function(u){return this.on(o,u)}}),l.fn.extend({bind:function(n,o,u){return this.on(n,null,o,u)},unbind:function(n,o){return this.off(n,null,o)},delegate:function(n,o,u,f){return this.on(o,n,u,f)},undelegate:function(n,o,u){return arguments.length===1?this.off(n,"**"):this.off(o,n||"**",u)},hover:function(n,o){return this.on("mouseenter",n).on("mouseleave",o||n)}}),l.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(n,o){l.fn[o]=function(u,f){return arguments.length>0?this.on(o,null,u,f):this.trigger(o)}});var og=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;l.proxy=function(n,o){var u,f,g;if(typeof o=="string"&&(u=n[o],o=n,n=u),!!R(n))return f=a.call(arguments,2),g=function(){return n.apply(o||this,f.concat(a.call(arguments)))},g.guid=n.guid=n.guid||l.guid++,g},l.holdReady=function(n){n?l.readyWait++:l.ready(!0)},l.isArray=Array.isArray,l.parseJSON=JSON.parse,l.nodeName=W,l.isFunction=R,l.isWindow=U,l.camelCase=Le,l.type=N,l.now=Date.now,l.isNumeric=function(n){var o=l.type(n);return(o==="number"||o==="string")&&!isNaN(n-parseFloat(n))},l.trim=function(n){return n==null?"":(n+"").replace(og,"$1")};var cg=t.jQuery,hg=t.$;return l.noConflict=function(n){return t.$===l&&(t.$=hg),n&&t.jQuery===l&&(t.jQuery=cg),l},typeof e>"u"&&(t.jQuery=t.$=l),l})}(oa)),oa.exports}var bg=xg();const F=G0(bg);var V0="1.13.7",vl=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},ka=Array.prototype,Bc=Object.prototype,Cl=typeof Symbol<"u"?Symbol.prototype:null,yg=ka.push,mn=ka.slice,rn=Bc.toString,vg=Bc.hasOwnProperty,K0=typeof ArrayBuffer<"u",Cg=typeof DataView<"u",wg=Array.isArray,wl=Object.keys,Sl=Object.create,El=K0&&ArrayBuffer.isView,Sg=isNaN,Eg=isFinite,q0=!{toString:null}.propertyIsEnumerable("toString"),Al=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Ag=Math.pow(2,53)-1;function Ae(i,t){return t=t==null?i.length-1:+t,function(){for(var e=Math.max(arguments.length-t,0),s=Array(e),r=0;r<e;r++)s[r]=arguments[r+t];switch(t){case 0:return i.call(this,s);case 1:return i.call(this,arguments[0],s);case 2:return i.call(this,arguments[0],arguments[1],s)}var a=Array(t+1);for(r=0;r<t;r++)a[r]=arguments[r];return a[t]=s,i.apply(this,a)}}function Bs(i){var t=typeof i;return t==="function"||t==="object"&&!!i}function kg(i){return i===null}function j0(i){return i===void 0}function Y0(i){return i===!0||i===!1||rn.call(i)==="[object Boolean]"}function Tg(i){return!!(i&&i.nodeType===1)}function he(i){var t="[object "+i+"]";return function(e){return rn.call(e)===t}}const Fc=he("String"),X0=he("Number"),Dg=he("Date"),Rg=he("RegExp"),Lg=he("Error"),Z0=he("Symbol"),Q0=he("ArrayBuffer");var J0=he("Function"),Pg=vl.document&&vl.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof Pg!="function"&&(J0=function(i){return typeof i=="function"||!1});const xe=J0,tf=he("Object");var ef=Cg&&(!/\[native code\]/.test(String(DataView))||tf(new DataView(new ArrayBuffer(8)))),Uc=typeof Map<"u"&&tf(new Map),Ig=he("DataView");function Og(i){return i!=null&&xe(i.getInt8)&&Q0(i.buffer)}const ma=ef?Og:Ig,Fs=wg||he("Array");function hs(i,t){return i!=null&&vg.call(i,t)}var sc=he("Arguments");(function(){sc(arguments)||(sc=function(i){return hs(i,"callee")})})();const $c=sc;function Mg(i){return!Z0(i)&&Eg(i)&&!isNaN(parseFloat(i))}function sf(i){return X0(i)&&Sg(i)}function rf(i){return function(){return i}}function nf(i){return function(t){var e=i(t);return typeof e=="number"&&e>=0&&e<=Ag}}function af(i){return function(t){return t==null?void 0:t[i]}}const ga=af("byteLength"),Ng=nf(ga);var Bg=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function Fg(i){return El?El(i)&&!ma(i):Ng(i)&&Bg.test(rn.call(i))}const of=K0?Fg:rf(!1),ke=af("length");function Ug(i){for(var t={},e=i.length,s=0;s<e;++s)t[i[s]]=!0;return{contains:function(r){return t[r]===!0},push:function(r){return t[r]=!0,i.push(r)}}}function cf(i,t){t=Ug(t);var e=Al.length,s=i.constructor,r=xe(s)&&s.prototype||Bc,a="constructor";for(hs(i,a)&&!t.contains(a)&&t.push(a);e--;)a=Al[e],a in i&&i[a]!==r[a]&&!t.contains(a)&&t.push(a)}function ee(i){if(!Bs(i))return[];if(wl)return wl(i);var t=[];for(var e in i)hs(i,e)&&t.push(e);return q0&&cf(i,t),t}function $g(i){if(i==null)return!0;var t=ke(i);return typeof t=="number"&&(Fs(i)||Fc(i)||$c(i))?t===0:ke(ee(i))===0}function hf(i,t){var e=ee(t),s=e.length;if(i==null)return!s;for(var r=Object(i),a=0;a<s;a++){var c=e[a];if(t[c]!==r[c]||!(c in r))return!1}return!0}function Tt(i){if(i instanceof Tt)return i;if(!(this instanceof Tt))return new Tt(i);this._wrapped=i}Tt.VERSION=V0;Tt.prototype.value=function(){return this._wrapped};Tt.prototype.valueOf=Tt.prototype.toJSON=Tt.prototype.value;Tt.prototype.toString=function(){return String(this._wrapped)};function kl(i){return new Uint8Array(i.buffer||i,i.byteOffset||0,ga(i))}var Tl="[object DataView]";function rc(i,t,e,s){if(i===t)return i!==0||1/i===1/t;if(i==null||t==null)return!1;if(i!==i)return t!==t;var r=typeof i;return r!=="function"&&r!=="object"&&typeof t!="object"?!1:lf(i,t,e,s)}function lf(i,t,e,s){i instanceof Tt&&(i=i._wrapped),t instanceof Tt&&(t=t._wrapped);var r=rn.call(i);if(r!==rn.call(t))return!1;if(ef&&r=="[object Object]"&&ma(i)){if(!ma(t))return!1;r=Tl}switch(r){case"[object RegExp]":case"[object String]":return""+i==""+t;case"[object Number]":return+i!=+i?+t!=+t:+i==0?1/+i===1/t:+i==+t;case"[object Date]":case"[object Boolean]":return+i==+t;case"[object Symbol]":return Cl.valueOf.call(i)===Cl.valueOf.call(t);case"[object ArrayBuffer]":case Tl:return lf(kl(i),kl(t),e,s)}var a=r==="[object Array]";if(!a&&of(i)){var c=ga(i);if(c!==ga(t))return!1;if(i.buffer===t.buffer&&i.byteOffset===t.byteOffset)return!0;a=!0}if(!a){if(typeof i!="object"||typeof t!="object")return!1;var h=i.constructor,m=t.constructor;if(h!==m&&!(xe(h)&&h instanceof h&&xe(m)&&m instanceof m)&&"constructor"in i&&"constructor"in t)return!1}e=e||[],s=s||[];for(var d=e.length;d--;)if(e[d]===i)return s[d]===t;if(e.push(i),s.push(t),a){if(d=i.length,d!==t.length)return!1;for(;d--;)if(!rc(i[d],t[d],e,s))return!1}else{var p=ee(i),b;if(d=p.length,ee(t).length!==d)return!1;for(;d--;)if(b=p[d],!(hs(t,b)&&rc(i[b],t[b],e,s)))return!1}return e.pop(),s.pop(),!0}function Hg(i,t){return rc(i,t)}function gn(i){if(!Bs(i))return[];var t=[];for(var e in i)t.push(e);return q0&&cf(i,t),t}function Hc(i){var t=ke(i);return function(e){if(e==null)return!1;var s=gn(e);if(ke(s))return!1;for(var r=0;r<t;r++)if(!xe(e[i[r]]))return!1;return i!==df||!xe(e[zc])}}var zc="forEach",uf="has",Wc=["clear","delete"],ff=["get",uf,"set"],zg=Wc.concat(zc,ff),df=Wc.concat(ff),Wg=["add"].concat(Wc,zc,uf);const Gg=Uc?Hc(zg):he("Map"),Vg=Uc?Hc(df):he("WeakMap"),Kg=Uc?Hc(Wg):he("Set"),qg=he("WeakSet");function vr(i){for(var t=ee(i),e=t.length,s=Array(e),r=0;r<e;r++)s[r]=i[t[r]];return s}function jg(i){for(var t=ee(i),e=t.length,s=Array(e),r=0;r<e;r++)s[r]=[t[r],i[t[r]]];return s}function pf(i){for(var t={},e=ee(i),s=0,r=e.length;s<r;s++)t[i[e[s]]]=e[s];return t}function nc(i){var t=[];for(var e in i)xe(i[e])&&t.push(e);return t.sort()}function Gc(i,t){return function(e){var s=arguments.length;if(t&&(e=Object(e)),s<2||e==null)return e;for(var r=1;r<s;r++)for(var a=arguments[r],c=i(a),h=c.length,m=0;m<h;m++){var d=c[m];(!t||e[d]===void 0)&&(e[d]=a[d])}return e}}const mf=Gc(gn),_a=Gc(ee),gf=Gc(gn,!0);function Yg(){return function(){}}function _f(i){if(!Bs(i))return{};if(Sl)return Sl(i);var t=Yg();t.prototype=i;var e=new t;return t.prototype=null,e}function Xg(i,t){var e=_f(i);return t&&_a(e,t),e}function Zg(i){return Bs(i)?Fs(i)?i.slice():mf({},i):i}function Qg(i,t){return t(i),i}function xf(i){return Fs(i)?i:[i]}Tt.toPath=xf;function _n(i){return Tt.toPath(i)}function Vc(i,t){for(var e=t.length,s=0;s<e;s++){if(i==null)return;i=i[t[s]]}return e?i:void 0}function bf(i,t,e){var s=Vc(i,_n(t));return j0(s)?e:s}function Jg(i,t){t=_n(t);for(var e=t.length,s=0;s<e;s++){var r=t[s];if(!hs(i,r))return!1;i=i[r]}return!!e}function Kc(i){return i}function nn(i){return i=_a({},i),function(t){return hf(t,i)}}function qc(i){return i=_n(i),function(t){return Vc(t,i)}}function xn(i,t,e){if(t===void 0)return i;switch(e??3){case 1:return function(s){return i.call(t,s)};case 3:return function(s,r,a){return i.call(t,s,r,a)};case 4:return function(s,r,a,c){return i.call(t,s,r,a,c)}}return function(){return i.apply(t,arguments)}}function yf(i,t,e){return i==null?Kc:xe(i)?xn(i,t,e):Bs(i)&&!Fs(i)?nn(i):qc(i)}function jc(i,t){return yf(i,t,1/0)}Tt.iteratee=jc;function Te(i,t,e){return Tt.iteratee!==jc?Tt.iteratee(i,t):yf(i,t,e)}function t1(i,t,e){t=Te(t,e);for(var s=ee(i),r=s.length,a={},c=0;c<r;c++){var h=s[c];a[h]=t(i[h],h,i)}return a}function vf(){}function e1(i){return i==null?vf:function(t){return bf(i,t)}}function i1(i,t,e){var s=Array(Math.max(0,i));t=xn(t,e,1);for(var r=0;r<i;r++)s[r]=t(r);return s}function ac(i,t){return t==null&&(t=i,i=0),i+Math.floor(Math.random()*(t-i+1))}const an=Date.now||function(){return new Date().getTime()};function Cf(i){var t=function(a){return i[a]},e="(?:"+ee(i).join("|")+")",s=RegExp(e),r=RegExp(e,"g");return function(a){return a=a==null?"":""+a,s.test(a)?a.replace(r,t):a}}const wf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},s1=Cf(wf),r1=pf(wf),n1=Cf(r1),a1=Tt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var lo=/(.)^/,o1={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},c1=/\\|'|\r|\n|\u2028|\u2029/g;function h1(i){return"\\"+o1[i]}var l1=/^\s*(\w|\$)+\s*$/;function u1(i,t,e){!t&&e&&(t=e),t=gf({},t,Tt.templateSettings);var s=RegExp([(t.escape||lo).source,(t.interpolate||lo).source,(t.evaluate||lo).source].join("|")+"|$","g"),r=0,a="__p+='";i.replace(s,function(d,p,b,w,C){return a+=i.slice(r,C).replace(c1,h1),r=C+d.length,p?a+=`'+
((__t=(`+p+`))==null?'':_.escape(__t))+
'`:b?a+=`'+
((__t=(`+b+`))==null?'':__t)+
'`:w&&(a+=`';
`+w+`
__p+='`),d}),a+=`';
`;var c=t.variable;if(c){if(!l1.test(c))throw new Error("variable is not a bare identifier: "+c)}else a=`with(obj||{}){
`+a+`}
`,c="obj";a=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+a+`return __p;
`;var h;try{h=new Function(c,"_",a)}catch(d){throw d.source=a,d}var m=function(d){return h.call(this,d,Tt)};return m.source="function("+c+`){
`+a+"}",m}function f1(i,t,e){t=_n(t);var s=t.length;if(!s)return xe(e)?e.call(i):e;for(var r=0;r<s;r++){var a=i==null?void 0:i[t[r]];a===void 0&&(a=e,r=s),i=xe(a)?a.call(i):a}return i}var d1=0;function p1(i){var t=++d1+"";return i?i+t:t}function m1(i){var t=Tt(i);return t._chain=!0,t}function Sf(i,t,e,s,r){if(!(s instanceof t))return i.apply(e,r);var a=_f(i.prototype),c=i.apply(a,r);return Bs(c)?c:a}var Cr=Ae(function(i,t){var e=Cr.placeholder,s=function(){for(var r=0,a=t.length,c=Array(a),h=0;h<a;h++)c[h]=t[h]===e?arguments[r++]:t[h];for(;r<arguments.length;)c.push(arguments[r++]);return Sf(i,s,this,this,c)};return s});Cr.placeholder=Tt;const Ef=Ae(function(i,t,e){if(!xe(i))throw new TypeError("Bind must be called on a function");var s=Ae(function(r){return Sf(i,s,t,this,e.concat(r))});return s}),Ne=nf(ke);function Us(i,t,e,s){if(s=s||[],!t&&t!==0)t=1/0;else if(t<=0)return s.concat(i);for(var r=s.length,a=0,c=ke(i);a<c;a++){var h=i[a];if(Ne(h)&&(Fs(h)||$c(h)))if(t>1)Us(h,t-1,e,s),r=s.length;else for(var m=0,d=h.length;m<d;)s[r++]=h[m++];else e||(s[r++]=h)}return s}const g1=Ae(function(i,t){t=Us(t,!1,!1);var e=t.length;if(e<1)throw new Error("bindAll must be passed function names");for(;e--;){var s=t[e];i[s]=Ef(i[s],i)}return i});function _1(i,t){var e=function(s){var r=e.cache,a=""+(t?t.apply(this,arguments):s);return hs(r,a)||(r[a]=i.apply(this,arguments)),r[a]};return e.cache={},e}const Af=Ae(function(i,t,e){return setTimeout(function(){return i.apply(null,e)},t)}),x1=Cr(Af,Tt,1);function b1(i,t,e){var s,r,a,c,h=0;e||(e={});var m=function(){h=e.leading===!1?0:an(),s=null,c=i.apply(r,a),s||(r=a=null)},d=function(){var p=an();!h&&e.leading===!1&&(h=p);var b=t-(p-h);return r=this,a=arguments,b<=0||b>t?(s&&(clearTimeout(s),s=null),h=p,c=i.apply(r,a),s||(r=a=null)):!s&&e.trailing!==!1&&(s=setTimeout(m,b)),c};return d.cancel=function(){clearTimeout(s),h=0,s=r=a=null},d}function y1(i,t,e){var s,r,a,c,h,m=function(){var p=an()-r;t>p?s=setTimeout(m,t-p):(s=null,e||(c=i.apply(h,a)),s||(a=h=null))},d=Ae(function(p){return h=this,a=p,r=an(),s||(s=setTimeout(m,t),e&&(c=i.apply(h,a))),c});return d.cancel=function(){clearTimeout(s),s=a=h=null},d}function v1(i,t){return Cr(t,i)}function Yc(i){return function(){return!i.apply(this,arguments)}}function C1(){var i=arguments,t=i.length-1;return function(){for(var e=t,s=i[t].apply(this,arguments);e--;)s=i[e].call(this,s);return s}}function w1(i,t){return function(){if(--i<1)return t.apply(this,arguments)}}function kf(i,t){var e;return function(){return--i>0&&(e=t.apply(this,arguments)),i<=1&&(t=null),e}}const S1=Cr(kf,2);function Tf(i,t,e){t=Te(t,e);for(var s=ee(i),r,a=0,c=s.length;a<c;a++)if(r=s[a],t(i[r],r,i))return r}function Df(i){return function(t,e,s){e=Te(e,s);for(var r=ke(t),a=i>0?0:r-1;a>=0&&a<r;a+=i)if(e(t[a],a,t))return a;return-1}}const Xc=Df(1),Rf=Df(-1);function Lf(i,t,e,s){e=Te(e,s,1);for(var r=e(t),a=0,c=ke(i);a<c;){var h=Math.floor((a+c)/2);e(i[h])<r?a=h+1:c=h}return a}function Pf(i,t,e){return function(s,r,a){var c=0,h=ke(s);if(typeof a=="number")i>0?c=a>=0?a:Math.max(a+h,c):h=a>=0?Math.min(a+1,h):a+h+1;else if(e&&a&&h)return a=e(s,r),s[a]===r?a:-1;if(r!==r)return a=t(mn.call(s,c,h),sf),a>=0?a+c:-1;for(a=i>0?c:h-1;a>=0&&a<h;a+=i)if(s[a]===r)return a;return-1}}const If=Pf(1,Xc,Lf),E1=Pf(-1,Rf);function oc(i,t,e){var s=Ne(i)?Xc:Tf,r=s(i,t,e);if(r!==void 0&&r!==-1)return i[r]}function A1(i,t){return oc(i,nn(t))}function Fi(i,t,e){t=xn(t,e);var s,r;if(Ne(i))for(s=0,r=i.length;s<r;s++)t(i[s],s,i);else{var a=ee(i);for(s=0,r=a.length;s<r;s++)t(i[a[s]],a[s],i)}return i}function Ls(i,t,e){t=Te(t,e);for(var s=!Ne(i)&&ee(i),r=(s||i).length,a=Array(r),c=0;c<r;c++){var h=s?s[c]:c;a[c]=t(i[h],h,i)}return a}function Of(i){var t=function(e,s,r,a){var c=!Ne(e)&&ee(e),h=(c||e).length,m=i>0?0:h-1;for(a||(r=e[c?c[m]:m],m+=i);m>=0&&m<h;m+=i){var d=c?c[m]:m;r=s(r,e[d],d,e)}return r};return function(e,s,r,a){var c=arguments.length>=3;return t(e,xn(s,a,4),r,c)}}const uo=Of(1),Dl=Of(-1);function dr(i,t,e){var s=[];return t=Te(t,e),Fi(i,function(r,a,c){t(r,a,c)&&s.push(r)}),s}function k1(i,t,e){return dr(i,Yc(Te(t)),e)}function Rl(i,t,e){t=Te(t,e);for(var s=!Ne(i)&&ee(i),r=(s||i).length,a=0;a<r;a++){var c=s?s[a]:a;if(!t(i[c],c,i))return!1}return!0}function Ll(i,t,e){t=Te(t,e);for(var s=!Ne(i)&&ee(i),r=(s||i).length,a=0;a<r;a++){var c=s?s[a]:a;if(t(i[c],c,i))return!0}return!1}function Oi(i,t,e,s){return Ne(i)||(i=vr(i)),(typeof e!="number"||s)&&(e=0),If(i,t,e)>=0}const T1=Ae(function(i,t,e){var s,r;return xe(t)?r=t:(t=_n(t),s=t.slice(0,-1),t=t[t.length-1]),Ls(i,function(a){var c=r;if(!c){if(s&&s.length&&(a=Vc(a,s)),a==null)return;c=a[t]}return c==null?c:c.apply(a,e)})});function Zc(i,t){return Ls(i,qc(t))}function D1(i,t){return dr(i,nn(t))}function Mf(i,t,e){var s=-1/0,r=-1/0,a,c;if(t==null||typeof t=="number"&&typeof i[0]!="object"&&i!=null){i=Ne(i)?i:vr(i);for(var h=0,m=i.length;h<m;h++)a=i[h],a!=null&&a>s&&(s=a)}else t=Te(t,e),Fi(i,function(d,p,b){c=t(d,p,b),(c>r||c===-1/0&&s===-1/0)&&(s=d,r=c)});return s}function R1(i,t,e){var s=1/0,r=1/0,a,c;if(t==null||typeof t=="number"&&typeof i[0]!="object"&&i!=null){i=Ne(i)?i:vr(i);for(var h=0,m=i.length;h<m;h++)a=i[h],a!=null&&a<s&&(s=a)}else t=Te(t,e),Fi(i,function(d,p,b){c=t(d,p,b),(c<r||c===1/0&&s===1/0)&&(s=d,r=c)});return s}var L1=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Nf(i){return i?Fs(i)?mn.call(i):Fc(i)?i.match(L1):Ne(i)?Ls(i,Kc):vr(i):[]}function Bf(i,t,e){if(t==null||e)return Ne(i)||(i=vr(i)),i[ac(i.length-1)];var s=Nf(i),r=ke(s);t=Math.max(Math.min(t,r),0);for(var a=r-1,c=0;c<t;c++){var h=ac(c,a),m=s[c];s[c]=s[h],s[h]=m}return s.slice(0,t)}function P1(i){return Bf(i,1/0)}function I1(i,t,e){var s=0;return t=Te(t,e),Zc(Ls(i,function(r,a,c){return{value:r,index:s++,criteria:t(r,a,c)}}).sort(function(r,a){var c=r.criteria,h=a.criteria;if(c!==h){if(c>h||c===void 0)return 1;if(c<h||h===void 0)return-1}return r.index-a.index}),"value")}function Ta(i,t){return function(e,s,r){var a=t?[[],[]]:{};return s=Te(s,r),Fi(e,function(c,h){var m=s(c,h,e);i(a,c,m)}),a}}const O1=Ta(function(i,t,e){hs(i,e)?i[e].push(t):i[e]=[t]}),M1=Ta(function(i,t,e){i[e]=t}),N1=Ta(function(i,t,e){hs(i,e)?i[e]++:i[e]=1}),B1=Ta(function(i,t,e){i[e?0:1].push(t)},!0);function F1(i){return i==null?0:Ne(i)?i.length:ee(i).length}function U1(i,t,e){return t in e}const Ff=Ae(function(i,t){var e={},s=t[0];if(i==null)return e;xe(s)?(t.length>1&&(s=xn(s,t[1])),t=gn(i)):(s=U1,t=Us(t,!1,!1),i=Object(i));for(var r=0,a=t.length;r<a;r++){var c=t[r],h=i[c];s(h,c,i)&&(e[c]=h)}return e}),$1=Ae(function(i,t){var e=t[0],s;return xe(e)?(e=Yc(e),t.length>1&&(s=t[1])):(t=Ls(Us(t,!1,!1),String),e=function(r,a){return!Oi(t,a)}),Ff(i,e,s)});function Uf(i,t,e){return mn.call(i,0,Math.max(0,i.length-(t==null||e?1:t)))}function fo(i,t,e){return i==null||i.length<1?t==null||e?void 0:[]:t==null||e?i[0]:Uf(i,i.length-t)}function ca(i,t,e){return mn.call(i,t==null||e?1:t)}function H1(i,t,e){return i==null||i.length<1?t==null||e?void 0:[]:t==null||e?i[i.length-1]:ca(i,Math.max(0,i.length-t))}function z1(i){return dr(i,Boolean)}function W1(i,t){return Us(i,t,!1)}const $f=Ae(function(i,t){return t=Us(t,!0,!0),dr(i,function(e){return!Oi(t,e)})}),G1=Ae(function(i,t){return $f(i,t)});function cc(i,t,e,s){Y0(t)||(s=e,e=t,t=!1),e!=null&&(e=Te(e,s));for(var r=[],a=[],c=0,h=ke(i);c<h;c++){var m=i[c],d=e?e(m,c,i):m;t&&!e?((!c||a!==d)&&r.push(m),a=d):e?Oi(a,d)||(a.push(d),r.push(m)):Oi(r,m)||r.push(m)}return r}const V1=Ae(function(i){return cc(Us(i,!0,!0))});function K1(i){for(var t=[],e=arguments.length,s=0,r=ke(i);s<r;s++){var a=i[s];if(!Oi(t,a)){var c;for(c=1;c<e&&Oi(arguments[c],a);c++);c===e&&t.push(a)}}return t}function hc(i){for(var t=i&&Mf(i,ke).length||0,e=Array(t),s=0;s<t;s++)e[s]=Zc(i,s);return e}const q1=Ae(hc);function j1(i,t){for(var e={},s=0,r=ke(i);s<r;s++)t?e[i[s]]=t[s]:e[i[s][0]]=i[s][1];return e}function Y1(i,t,e){t==null&&(t=i||0,i=0),e||(e=t<i?-1:1);for(var s=Math.max(Math.ceil((t-i)/e),0),r=Array(s),a=0;a<s;a++,i+=e)r[a]=i;return r}function X1(i,t){if(t==null||t<1)return[];for(var e=[],s=0,r=i.length;s<r;)e.push(mn.call(i,s,s+=t));return e}function Qc(i,t){return i._chain?Tt(t).chain():t}function Hf(i){return Fi(nc(i),function(t){var e=Tt[t]=i[t];Tt.prototype[t]=function(){var s=[this._wrapped];return yg.apply(s,arguments),Qc(this,e.apply(Tt,s))}}),Tt}Fi(["pop","push","reverse","shift","sort","splice","unshift"],function(i){var t=ka[i];Tt.prototype[i]=function(){var e=this._wrapped;return e!=null&&(t.apply(e,arguments),(i==="shift"||i==="splice")&&e.length===0&&delete e[0]),Qc(this,e)}});Fi(["concat","join","slice"],function(i){var t=ka[i];Tt.prototype[i]=function(){var e=this._wrapped;return e!=null&&(e=t.apply(e,arguments)),Qc(this,e)}});const Z1=Object.freeze(Object.defineProperty({__proto__:null,VERSION:V0,after:w1,all:Rl,allKeys:gn,any:Ll,assign:_a,before:kf,bind:Ef,bindAll:g1,chain:m1,chunk:X1,clone:Zg,collect:Ls,compact:z1,compose:C1,constant:rf,contains:Oi,countBy:N1,create:Xg,debounce:y1,default:Tt,defaults:gf,defer:x1,delay:Af,detect:oc,difference:$f,drop:ca,each:Fi,escape:s1,every:Rl,extend:mf,extendOwn:_a,filter:dr,find:oc,findIndex:Xc,findKey:Tf,findLastIndex:Rf,findWhere:A1,first:fo,flatten:W1,foldl:uo,foldr:Dl,forEach:Fi,functions:nc,get:bf,groupBy:O1,has:Jg,head:fo,identity:Kc,include:Oi,includes:Oi,indexBy:M1,indexOf:If,initial:Uf,inject:uo,intersection:K1,invert:pf,invoke:T1,isArguments:$c,isArray:Fs,isArrayBuffer:Q0,isBoolean:Y0,isDataView:ma,isDate:Dg,isElement:Tg,isEmpty:$g,isEqual:Hg,isError:Lg,isFinite:Mg,isFunction:xe,isMap:Gg,isMatch:hf,isNaN:sf,isNull:kg,isNumber:X0,isObject:Bs,isRegExp:Rg,isSet:Kg,isString:Fc,isSymbol:Z0,isTypedArray:of,isUndefined:j0,isWeakMap:Vg,isWeakSet:qg,iteratee:jc,keys:ee,last:H1,lastIndexOf:E1,map:Ls,mapObject:t1,matcher:nn,matches:nn,max:Mf,memoize:_1,methods:nc,min:R1,mixin:Hf,negate:Yc,noop:vf,now:an,object:j1,omit:$1,once:S1,pairs:jg,partial:Cr,partition:B1,pick:Ff,pluck:Zc,property:qc,propertyOf:e1,random:ac,range:Y1,reduce:uo,reduceRight:Dl,reject:k1,rest:ca,restArguments:Ae,result:f1,sample:Bf,select:dr,shuffle:P1,size:F1,some:Ll,sortBy:I1,sortedIndex:Lf,tail:ca,take:fo,tap:Qg,template:u1,templateSettings:a1,throttle:b1,times:i1,toArray:Nf,toPath:xf,transpose:hc,unescape:n1,union:V1,uniq:cc,unique:cc,uniqueId:p1,unzip:hc,values:vr,where:D1,without:G1,wrap:v1,zip:q1},Symbol.toStringTag,{value:"Module"}));var qe=Hf(Z1);qe._=qe;var ge="top",Ie="bottom",Oe="right",_e="left",Da="auto",wr=[ge,Ie,Oe,_e],Ps="start",pr="end",zf="clippingParents",Jc="viewport",sr="popper",Wf="reference",lc=wr.reduce(function(i,t){return i.concat([t+"-"+Ps,t+"-"+pr])},[]),th=[].concat(wr,[Da]).reduce(function(i,t){return i.concat([t,t+"-"+Ps,t+"-"+pr])},[]),Gf="beforeRead",Vf="read",Kf="afterRead",qf="beforeMain",jf="main",Yf="afterMain",Xf="beforeWrite",Zf="write",Qf="afterWrite",Jf=[Gf,Vf,Kf,qf,jf,Yf,Xf,Zf,Qf];function wi(i){return i?(i.nodeName||"").toLowerCase():null}function Me(i){if(i==null)return window;if(i.toString()!=="[object Window]"){var t=i.ownerDocument;return t&&t.defaultView||window}return i}function Is(i){var t=Me(i).Element;return i instanceof t||i instanceof Element}function Ke(i){var t=Me(i).HTMLElement;return i instanceof t||i instanceof HTMLElement}function eh(i){if(typeof ShadowRoot>"u")return!1;var t=Me(i).ShadowRoot;return i instanceof t||i instanceof ShadowRoot}function Q1(i){var t=i.state;Object.keys(t.elements).forEach(function(e){var s=t.styles[e]||{},r=t.attributes[e]||{},a=t.elements[e];!Ke(a)||!wi(a)||(Object.assign(a.style,s),Object.keys(r).forEach(function(c){var h=r[c];h===!1?a.removeAttribute(c):a.setAttribute(c,h===!0?"":h)}))})}function J1(i){var t=i.state,e={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,e.popper),t.styles=e,t.elements.arrow&&Object.assign(t.elements.arrow.style,e.arrow),function(){Object.keys(t.elements).forEach(function(s){var r=t.elements[s],a=t.attributes[s]||{},c=Object.keys(t.styles.hasOwnProperty(s)?t.styles[s]:e[s]),h=c.reduce(function(m,d){return m[d]="",m},{});!Ke(r)||!wi(r)||(Object.assign(r.style,h),Object.keys(a).forEach(function(m){r.removeAttribute(m)}))})}}const ih={name:"applyStyles",enabled:!0,phase:"write",fn:Q1,effect:J1,requires:["computeStyles"]};function vi(i){return i.split("-")[0]}var Rs=Math.max,xa=Math.min,mr=Math.round;function uc(){var i=navigator.userAgentData;return i!=null&&i.brands&&Array.isArray(i.brands)?i.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function td(){return!/^((?!chrome|android).)*safari/i.test(uc())}function gr(i,t,e){t===void 0&&(t=!1),e===void 0&&(e=!1);var s=i.getBoundingClientRect(),r=1,a=1;t&&Ke(i)&&(r=i.offsetWidth>0&&mr(s.width)/i.offsetWidth||1,a=i.offsetHeight>0&&mr(s.height)/i.offsetHeight||1);var c=Is(i)?Me(i):window,h=c.visualViewport,m=!td()&&e,d=(s.left+(m&&h?h.offsetLeft:0))/r,p=(s.top+(m&&h?h.offsetTop:0))/a,b=s.width/r,w=s.height/a;return{width:b,height:w,top:p,right:d+b,bottom:p+w,left:d,x:d,y:p}}function sh(i){var t=gr(i),e=i.offsetWidth,s=i.offsetHeight;return Math.abs(t.width-e)<=1&&(e=t.width),Math.abs(t.height-s)<=1&&(s=t.height),{x:i.offsetLeft,y:i.offsetTop,width:e,height:s}}function ed(i,t){var e=t.getRootNode&&t.getRootNode();if(i.contains(t))return!0;if(e&&eh(e)){var s=t;do{if(s&&i.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function Ui(i){return Me(i).getComputedStyle(i)}function t_(i){return["table","td","th"].indexOf(wi(i))>=0}function ls(i){return((Is(i)?i.ownerDocument:i.document)||window.document).documentElement}function Ra(i){return wi(i)==="html"?i:i.assignedSlot||i.parentNode||(eh(i)?i.host:null)||ls(i)}function Pl(i){return!Ke(i)||Ui(i).position==="fixed"?null:i.offsetParent}function e_(i){var t=/firefox/i.test(uc()),e=/Trident/i.test(uc());if(e&&Ke(i)){var s=Ui(i);if(s.position==="fixed")return null}var r=Ra(i);for(eh(r)&&(r=r.host);Ke(r)&&["html","body"].indexOf(wi(r))<0;){var a=Ui(r);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||t&&a.willChange==="filter"||t&&a.filter&&a.filter!=="none")return r;r=r.parentNode}return null}function bn(i){for(var t=Me(i),e=Pl(i);e&&t_(e)&&Ui(e).position==="static";)e=Pl(e);return e&&(wi(e)==="html"||wi(e)==="body"&&Ui(e).position==="static")?t:e||e_(i)||t}function rh(i){return["top","bottom"].indexOf(i)>=0?"x":"y"}function Zr(i,t,e){return Rs(i,xa(t,e))}function i_(i,t,e){var s=Zr(i,t,e);return s>e?e:s}function id(){return{top:0,right:0,bottom:0,left:0}}function sd(i){return Object.assign({},id(),i)}function rd(i,t){return t.reduce(function(e,s){return e[s]=i,e},{})}var s_=function(t,e){return t=typeof t=="function"?t(Object.assign({},e.rects,{placement:e.placement})):t,sd(typeof t!="number"?t:rd(t,wr))};function r_(i){var t,e=i.state,s=i.name,r=i.options,a=e.elements.arrow,c=e.modifiersData.popperOffsets,h=vi(e.placement),m=rh(h),d=[_e,Oe].indexOf(h)>=0,p=d?"height":"width";if(!(!a||!c)){var b=s_(r.padding,e),w=sh(a),C=m==="y"?ge:_e,y=m==="y"?Ie:Oe,R=e.rects.reference[p]+e.rects.reference[m]-c[m]-e.rects.popper[p],U=c[m]-e.rects.reference[m],M=bn(a),X=M?m==="y"?M.clientHeight||0:M.clientWidth||0:0,Y=R/2-U/2,N=b[C],Q=X-w[p]-b[y],rt=X/2-w[p]/2+Y,l=Zr(N,rt,Q),G=m;e.modifiersData[s]=(t={},t[G]=l,t.centerOffset=l-rt,t)}}function n_(i){var t=i.state,e=i.options,s=e.element,r=s===void 0?"[data-popper-arrow]":s;r!=null&&(typeof r=="string"&&(r=t.elements.popper.querySelector(r),!r)||ed(t.elements.popper,r)&&(t.elements.arrow=r))}const nd={name:"arrow",enabled:!0,phase:"main",fn:r_,effect:n_,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function _r(i){return i.split("-")[1]}var a_={top:"auto",right:"auto",bottom:"auto",left:"auto"};function o_(i,t){var e=i.x,s=i.y,r=t.devicePixelRatio||1;return{x:mr(e*r)/r||0,y:mr(s*r)/r||0}}function Il(i){var t,e=i.popper,s=i.popperRect,r=i.placement,a=i.variation,c=i.offsets,h=i.position,m=i.gpuAcceleration,d=i.adaptive,p=i.roundOffsets,b=i.isFixed,w=c.x,C=w===void 0?0:w,y=c.y,R=y===void 0?0:y,U=typeof p=="function"?p({x:C,y:R}):{x:C,y:R};C=U.x,R=U.y;var M=c.hasOwnProperty("x"),X=c.hasOwnProperty("y"),Y=_e,N=ge,Q=window;if(d){var rt=bn(e),l="clientHeight",G="clientWidth";if(rt===Me(e)&&(rt=ls(e),Ui(rt).position!=="static"&&h==="absolute"&&(l="scrollHeight",G="scrollWidth")),rt=rt,r===ge||(r===_e||r===Oe)&&a===pr){N=Ie;var W=b&&rt===Q&&Q.visualViewport?Q.visualViewport.height:rt[l];R-=W-s.height,R*=m?1:-1}if(r===_e||(r===ge||r===Ie)&&a===pr){Y=Oe;var K=b&&rt===Q&&Q.visualViewport?Q.visualViewport.width:rt[G];C-=K-s.width,C*=m?1:-1}}var Z=Object.assign({position:h},d&&a_),dt=p===!0?o_({x:C,y:R},Me(e)):{x:C,y:R};if(C=dt.x,R=dt.y,m){var nt;return Object.assign({},Z,(nt={},nt[N]=X?"0":"",nt[Y]=M?"0":"",nt.transform=(Q.devicePixelRatio||1)<=1?"translate("+C+"px, "+R+"px)":"translate3d("+C+"px, "+R+"px, 0)",nt))}return Object.assign({},Z,(t={},t[N]=X?R+"px":"",t[Y]=M?C+"px":"",t.transform="",t))}function c_(i){var t=i.state,e=i.options,s=e.gpuAcceleration,r=s===void 0?!0:s,a=e.adaptive,c=a===void 0?!0:a,h=e.roundOffsets,m=h===void 0?!0:h,d={placement:vi(t.placement),variation:_r(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Il(Object.assign({},d,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:c,roundOffsets:m})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Il(Object.assign({},d,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:m})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const nh={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:c_,data:{}};var Fn={passive:!0};function h_(i){var t=i.state,e=i.instance,s=i.options,r=s.scroll,a=r===void 0?!0:r,c=s.resize,h=c===void 0?!0:c,m=Me(t.elements.popper),d=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&d.forEach(function(p){p.addEventListener("scroll",e.update,Fn)}),h&&m.addEventListener("resize",e.update,Fn),function(){a&&d.forEach(function(p){p.removeEventListener("scroll",e.update,Fn)}),h&&m.removeEventListener("resize",e.update,Fn)}}const ah={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:h_,data:{}};var l_={left:"right",right:"left",bottom:"top",top:"bottom"};function ha(i){return i.replace(/left|right|bottom|top/g,function(t){return l_[t]})}var u_={start:"end",end:"start"};function Ol(i){return i.replace(/start|end/g,function(t){return u_[t]})}function oh(i){var t=Me(i),e=t.pageXOffset,s=t.pageYOffset;return{scrollLeft:e,scrollTop:s}}function ch(i){return gr(ls(i)).left+oh(i).scrollLeft}function f_(i,t){var e=Me(i),s=ls(i),r=e.visualViewport,a=s.clientWidth,c=s.clientHeight,h=0,m=0;if(r){a=r.width,c=r.height;var d=td();(d||!d&&t==="fixed")&&(h=r.offsetLeft,m=r.offsetTop)}return{width:a,height:c,x:h+ch(i),y:m}}function d_(i){var t,e=ls(i),s=oh(i),r=(t=i.ownerDocument)==null?void 0:t.body,a=Rs(e.scrollWidth,e.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),c=Rs(e.scrollHeight,e.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),h=-s.scrollLeft+ch(i),m=-s.scrollTop;return Ui(r||e).direction==="rtl"&&(h+=Rs(e.clientWidth,r?r.clientWidth:0)-a),{width:a,height:c,x:h,y:m}}function hh(i){var t=Ui(i),e=t.overflow,s=t.overflowX,r=t.overflowY;return/auto|scroll|overlay|hidden/.test(e+r+s)}function ad(i){return["html","body","#document"].indexOf(wi(i))>=0?i.ownerDocument.body:Ke(i)&&hh(i)?i:ad(Ra(i))}function Qr(i,t){var e;t===void 0&&(t=[]);var s=ad(i),r=s===((e=i.ownerDocument)==null?void 0:e.body),a=Me(s),c=r?[a].concat(a.visualViewport||[],hh(s)?s:[]):s,h=t.concat(c);return r?h:h.concat(Qr(Ra(c)))}function fc(i){return Object.assign({},i,{left:i.x,top:i.y,right:i.x+i.width,bottom:i.y+i.height})}function p_(i,t){var e=gr(i,!1,t==="fixed");return e.top=e.top+i.clientTop,e.left=e.left+i.clientLeft,e.bottom=e.top+i.clientHeight,e.right=e.left+i.clientWidth,e.width=i.clientWidth,e.height=i.clientHeight,e.x=e.left,e.y=e.top,e}function Ml(i,t,e){return t===Jc?fc(f_(i,e)):Is(t)?p_(t,e):fc(d_(ls(i)))}function m_(i){var t=Qr(Ra(i)),e=["absolute","fixed"].indexOf(Ui(i).position)>=0,s=e&&Ke(i)?bn(i):i;return Is(s)?t.filter(function(r){return Is(r)&&ed(r,s)&&wi(r)!=="body"}):[]}function g_(i,t,e,s){var r=t==="clippingParents"?m_(i):[].concat(t),a=[].concat(r,[e]),c=a[0],h=a.reduce(function(m,d){var p=Ml(i,d,s);return m.top=Rs(p.top,m.top),m.right=xa(p.right,m.right),m.bottom=xa(p.bottom,m.bottom),m.left=Rs(p.left,m.left),m},Ml(i,c,s));return h.width=h.right-h.left,h.height=h.bottom-h.top,h.x=h.left,h.y=h.top,h}function od(i){var t=i.reference,e=i.element,s=i.placement,r=s?vi(s):null,a=s?_r(s):null,c=t.x+t.width/2-e.width/2,h=t.y+t.height/2-e.height/2,m;switch(r){case ge:m={x:c,y:t.y-e.height};break;case Ie:m={x:c,y:t.y+t.height};break;case Oe:m={x:t.x+t.width,y:h};break;case _e:m={x:t.x-e.width,y:h};break;default:m={x:t.x,y:t.y}}var d=r?rh(r):null;if(d!=null){var p=d==="y"?"height":"width";switch(a){case Ps:m[d]=m[d]-(t[p]/2-e[p]/2);break;case pr:m[d]=m[d]+(t[p]/2-e[p]/2);break}}return m}function xr(i,t){t===void 0&&(t={});var e=t,s=e.placement,r=s===void 0?i.placement:s,a=e.strategy,c=a===void 0?i.strategy:a,h=e.boundary,m=h===void 0?zf:h,d=e.rootBoundary,p=d===void 0?Jc:d,b=e.elementContext,w=b===void 0?sr:b,C=e.altBoundary,y=C===void 0?!1:C,R=e.padding,U=R===void 0?0:R,M=sd(typeof U!="number"?U:rd(U,wr)),X=w===sr?Wf:sr,Y=i.rects.popper,N=i.elements[y?X:w],Q=g_(Is(N)?N:N.contextElement||ls(i.elements.popper),m,p,c),rt=gr(i.elements.reference),l=od({reference:rt,element:Y,placement:r}),G=fc(Object.assign({},Y,l)),W=w===sr?G:rt,K={top:Q.top-W.top+M.top,bottom:W.bottom-Q.bottom+M.bottom,left:Q.left-W.left+M.left,right:W.right-Q.right+M.right},Z=i.modifiersData.offset;if(w===sr&&Z){var dt=Z[r];Object.keys(K).forEach(function(nt){var pt=[Oe,Ie].indexOf(nt)>=0?1:-1,Bt=[ge,Ie].indexOf(nt)>=0?"y":"x";K[nt]+=dt[Bt]*pt})}return K}function __(i,t){t===void 0&&(t={});var e=t,s=e.placement,r=e.boundary,a=e.rootBoundary,c=e.padding,h=e.flipVariations,m=e.allowedAutoPlacements,d=m===void 0?th:m,p=_r(s),b=p?h?lc:lc.filter(function(y){return _r(y)===p}):wr,w=b.filter(function(y){return d.indexOf(y)>=0});w.length===0&&(w=b);var C=w.reduce(function(y,R){return y[R]=xr(i,{placement:R,boundary:r,rootBoundary:a,padding:c})[vi(R)],y},{});return Object.keys(C).sort(function(y,R){return C[y]-C[R]})}function x_(i){if(vi(i)===Da)return[];var t=ha(i);return[Ol(i),t,Ol(t)]}function b_(i){var t=i.state,e=i.options,s=i.name;if(!t.modifiersData[s]._skip){for(var r=e.mainAxis,a=r===void 0?!0:r,c=e.altAxis,h=c===void 0?!0:c,m=e.fallbackPlacements,d=e.padding,p=e.boundary,b=e.rootBoundary,w=e.altBoundary,C=e.flipVariations,y=C===void 0?!0:C,R=e.allowedAutoPlacements,U=t.options.placement,M=vi(U),X=M===U,Y=m||(X||!y?[ha(U)]:x_(U)),N=[U].concat(Y).reduce(function(ue,zt){return ue.concat(vi(zt)===Da?__(t,{placement:zt,boundary:p,rootBoundary:b,padding:d,flipVariations:y,allowedAutoPlacements:R}):zt)},[]),Q=t.rects.reference,rt=t.rects.popper,l=new Map,G=!0,W=N[0],K=0;K<N.length;K++){var Z=N[K],dt=vi(Z),nt=_r(Z)===Ps,pt=[ge,Ie].indexOf(dt)>=0,Bt=pt?"width":"height",It=xr(t,{placement:Z,boundary:p,rootBoundary:b,altBoundary:w,padding:d}),Dt=pt?nt?Oe:_e:nt?Ie:ge;Q[Bt]>rt[Bt]&&(Dt=ha(Dt));var re=ha(Dt),Pt=[];if(a&&Pt.push(It[dt]<=0),h&&Pt.push(It[Dt]<=0,It[re]<=0),Pt.every(function(ue){return ue})){W=Z,G=!1;break}l.set(Z,Pt)}if(G)for(var Be=y?3:1,Je=function(zt){var De=N.find(function(Fe){var ye=l.get(Fe);if(ye)return ye.slice(0,zt).every(function(ti){return ti})});if(De)return W=De,"break"},le=Be;le>0;le--){var Ft=Je(le);if(Ft==="break")break}t.placement!==W&&(t.modifiersData[s]._skip=!0,t.placement=W,t.reset=!0)}}const cd={name:"flip",enabled:!0,phase:"main",fn:b_,requiresIfExists:["offset"],data:{_skip:!1}};function Nl(i,t,e){return e===void 0&&(e={x:0,y:0}),{top:i.top-t.height-e.y,right:i.right-t.width+e.x,bottom:i.bottom-t.height+e.y,left:i.left-t.width-e.x}}function Bl(i){return[ge,Oe,Ie,_e].some(function(t){return i[t]>=0})}function y_(i){var t=i.state,e=i.name,s=t.rects.reference,r=t.rects.popper,a=t.modifiersData.preventOverflow,c=xr(t,{elementContext:"reference"}),h=xr(t,{altBoundary:!0}),m=Nl(c,s),d=Nl(h,r,a),p=Bl(m),b=Bl(d);t.modifiersData[e]={referenceClippingOffsets:m,popperEscapeOffsets:d,isReferenceHidden:p,hasPopperEscaped:b},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":p,"data-popper-escaped":b})}const hd={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:y_};function v_(i,t,e){var s=vi(i),r=[_e,ge].indexOf(s)>=0?-1:1,a=typeof e=="function"?e(Object.assign({},t,{placement:i})):e,c=a[0],h=a[1];return c=c||0,h=(h||0)*r,[_e,Oe].indexOf(s)>=0?{x:h,y:c}:{x:c,y:h}}function C_(i){var t=i.state,e=i.options,s=i.name,r=e.offset,a=r===void 0?[0,0]:r,c=th.reduce(function(p,b){return p[b]=v_(b,t.rects,a),p},{}),h=c[t.placement],m=h.x,d=h.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=m,t.modifiersData.popperOffsets.y+=d),t.modifiersData[s]=c}const ld={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:C_};function w_(i){var t=i.state,e=i.name;t.modifiersData[e]=od({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const lh={name:"popperOffsets",enabled:!0,phase:"read",fn:w_,data:{}};function S_(i){return i==="x"?"y":"x"}function E_(i){var t=i.state,e=i.options,s=i.name,r=e.mainAxis,a=r===void 0?!0:r,c=e.altAxis,h=c===void 0?!1:c,m=e.boundary,d=e.rootBoundary,p=e.altBoundary,b=e.padding,w=e.tether,C=w===void 0?!0:w,y=e.tetherOffset,R=y===void 0?0:y,U=xr(t,{boundary:m,rootBoundary:d,padding:b,altBoundary:p}),M=vi(t.placement),X=_r(t.placement),Y=!X,N=rh(M),Q=S_(N),rt=t.modifiersData.popperOffsets,l=t.rects.reference,G=t.rects.popper,W=typeof R=="function"?R(Object.assign({},t.rects,{placement:t.placement})):R,K=typeof W=="number"?{mainAxis:W,altAxis:W}:Object.assign({mainAxis:0,altAxis:0},W),Z=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,dt={x:0,y:0};if(rt){if(a){var nt,pt=N==="y"?ge:_e,Bt=N==="y"?Ie:Oe,It=N==="y"?"height":"width",Dt=rt[N],re=Dt+U[pt],Pt=Dt-U[Bt],Be=C?-G[It]/2:0,Je=X===Ps?l[It]:G[It],le=X===Ps?-G[It]:-l[It],Ft=t.elements.arrow,ue=C&&Ft?sh(Ft):{width:0,height:0},zt=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:id(),De=zt[pt],Fe=zt[Bt],ye=Zr(0,l[It],ue[It]),ti=Y?l[It]/2-Be-ye-De-K.mainAxis:Je-ye-De-K.mainAxis,Xt=Y?-l[It]/2+Be+ye+Fe+K.mainAxis:le+ye+Fe+K.mainAxis,di=t.elements.arrow&&bn(t.elements.arrow),fe=di?N==="y"?di.clientTop||0:di.clientLeft||0:0,Ue=(nt=Z==null?void 0:Z[N])!=null?nt:0,zi=Dt+ti-Ue-fe,ds=Dt+Xt-Ue,Wi=Zr(C?xa(re,zi):re,Dt,C?Rs(Pt,ds):Pt);rt[N]=Wi,dt[N]=Wi-Dt}if(h){var ei,Mt=N==="x"?ge:_e,ve=N==="x"?Ie:Oe,Zt=rt[Q],Re=Q==="y"?"height":"width",Le=Zt+U[Mt],Gi=Zt-U[ve],Si=[ge,_e].indexOf(M)!==-1,at=(ei=Z==null?void 0:Z[Q])!=null?ei:0,ie=Si?Le:Zt-l[Re]-G[Re]-at+K.altAxis,kn=Si?Zt+l[Re]+G[Re]-at-K.altAxis:Gi,Tn=C&&Si?i_(ie,Zt,kn):Zr(C?ie:Le,Zt,C?kn:Gi);rt[Q]=Tn,dt[Q]=Tn-Zt}t.modifiersData[s]=dt}}const ud={name:"preventOverflow",enabled:!0,phase:"main",fn:E_,requiresIfExists:["offset"]};function A_(i){return{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}}function k_(i){return i===Me(i)||!Ke(i)?oh(i):A_(i)}function T_(i){var t=i.getBoundingClientRect(),e=mr(t.width)/i.offsetWidth||1,s=mr(t.height)/i.offsetHeight||1;return e!==1||s!==1}function D_(i,t,e){e===void 0&&(e=!1);var s=Ke(t),r=Ke(t)&&T_(t),a=ls(t),c=gr(i,r,e),h={scrollLeft:0,scrollTop:0},m={x:0,y:0};return(s||!s&&!e)&&((wi(t)!=="body"||hh(a))&&(h=k_(t)),Ke(t)?(m=gr(t,!0),m.x+=t.clientLeft,m.y+=t.clientTop):a&&(m.x=ch(a))),{x:c.left+h.scrollLeft-m.x,y:c.top+h.scrollTop-m.y,width:c.width,height:c.height}}function R_(i){var t=new Map,e=new Set,s=[];i.forEach(function(a){t.set(a.name,a)});function r(a){e.add(a.name);var c=[].concat(a.requires||[],a.requiresIfExists||[]);c.forEach(function(h){if(!e.has(h)){var m=t.get(h);m&&r(m)}}),s.push(a)}return i.forEach(function(a){e.has(a.name)||r(a)}),s}function L_(i){var t=R_(i);return Jf.reduce(function(e,s){return e.concat(t.filter(function(r){return r.phase===s}))},[])}function P_(i){var t;return function(){return t||(t=new Promise(function(e){Promise.resolve().then(function(){t=void 0,e(i())})})),t}}function I_(i){var t=i.reduce(function(e,s){var r=e[s.name];return e[s.name]=r?Object.assign({},r,s,{options:Object.assign({},r.options,s.options),data:Object.assign({},r.data,s.data)}):s,e},{});return Object.keys(t).map(function(e){return t[e]})}var Fl={placement:"bottom",modifiers:[],strategy:"absolute"};function Ul(){for(var i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];return!t.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function La(i){i===void 0&&(i={});var t=i,e=t.defaultModifiers,s=e===void 0?[]:e,r=t.defaultOptions,a=r===void 0?Fl:r;return function(h,m,d){d===void 0&&(d=a);var p={placement:"bottom",orderedModifiers:[],options:Object.assign({},Fl,a),modifiersData:{},elements:{reference:h,popper:m},attributes:{},styles:{}},b=[],w=!1,C={state:p,setOptions:function(M){var X=typeof M=="function"?M(p.options):M;R(),p.options=Object.assign({},a,p.options,X),p.scrollParents={reference:Is(h)?Qr(h):h.contextElement?Qr(h.contextElement):[],popper:Qr(m)};var Y=L_(I_([].concat(s,p.options.modifiers)));return p.orderedModifiers=Y.filter(function(N){return N.enabled}),y(),C.update()},forceUpdate:function(){if(!w){var M=p.elements,X=M.reference,Y=M.popper;if(Ul(X,Y)){p.rects={reference:D_(X,bn(Y),p.options.strategy==="fixed"),popper:sh(Y)},p.reset=!1,p.placement=p.options.placement,p.orderedModifiers.forEach(function(K){return p.modifiersData[K.name]=Object.assign({},K.data)});for(var N=0;N<p.orderedModifiers.length;N++){if(p.reset===!0){p.reset=!1,N=-1;continue}var Q=p.orderedModifiers[N],rt=Q.fn,l=Q.options,G=l===void 0?{}:l,W=Q.name;typeof rt=="function"&&(p=rt({state:p,options:G,name:W,instance:C})||p)}}}},update:P_(function(){return new Promise(function(U){C.forceUpdate(),U(p)})}),destroy:function(){R(),w=!0}};if(!Ul(h,m))return C;C.setOptions(d).then(function(U){!w&&d.onFirstUpdate&&d.onFirstUpdate(U)});function y(){p.orderedModifiers.forEach(function(U){var M=U.name,X=U.options,Y=X===void 0?{}:X,N=U.effect;if(typeof N=="function"){var Q=N({state:p,name:M,instance:C,options:Y}),rt=function(){};b.push(Q||rt)}})}function R(){b.forEach(function(U){return U()}),b=[]}return C}}var O_=La(),M_=[ah,lh,nh,ih],N_=La({defaultModifiers:M_}),B_=[ah,lh,nh,ih,ld,cd,ud,nd,hd],uh=La({defaultModifiers:B_});const fd=Object.freeze(Object.defineProperty({__proto__:null,afterMain:Yf,afterRead:Kf,afterWrite:Qf,applyStyles:ih,arrow:nd,auto:Da,basePlacements:wr,beforeMain:qf,beforeRead:Gf,beforeWrite:Xf,bottom:Ie,clippingParents:zf,computeStyles:nh,createPopper:uh,createPopperBase:O_,createPopperLite:N_,detectOverflow:xr,end:pr,eventListeners:ah,flip:cd,hide:hd,left:_e,main:jf,modifierPhases:Jf,offset:ld,placements:th,popper:sr,popperGenerator:La,popperOffsets:lh,preventOverflow:ud,read:Vf,reference:Wf,right:Oe,start:Ps,top:ge,variationPlacements:lc,viewport:Jc,write:Zf},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.6 (https://getbootstrap.com/)
  * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const ji=new Map,po={set(i,t,e){ji.has(i)||ji.set(i,new Map);const s=ji.get(i);if(!s.has(t)&&s.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(s.keys())[0]}.`);return}s.set(t,e)},get(i,t){return ji.has(i)&&ji.get(i).get(t)||null},remove(i,t){if(!ji.has(i))return;const e=ji.get(i);e.delete(t),e.size===0&&ji.delete(i)}},F_=1e6,U_=1e3,dc="transitionend",dd=i=>(i&&window.CSS&&window.CSS.escape&&(i=i.replace(/#([^\s"#']+)/g,(t,e)=>`#${CSS.escape(e)}`)),i),$_=i=>i==null?`${i}`:Object.prototype.toString.call(i).match(/\s([a-z]+)/i)[1].toLowerCase(),H_=i=>{do i+=Math.floor(Math.random()*F_);while(document.getElementById(i));return i},z_=i=>{if(!i)return 0;let{transitionDuration:t,transitionDelay:e}=window.getComputedStyle(i);const s=Number.parseFloat(t),r=Number.parseFloat(e);return!s&&!r?0:(t=t.split(",")[0],e=e.split(",")[0],(Number.parseFloat(t)+Number.parseFloat(e))*U_)},pd=i=>{i.dispatchEvent(new Event(dc))},Mi=i=>!i||typeof i!="object"?!1:(typeof i.jquery<"u"&&(i=i[0]),typeof i.nodeType<"u"),rs=i=>Mi(i)?i.jquery?i[0]:i:typeof i=="string"&&i.length>0?document.querySelector(dd(i)):null,Sr=i=>{if(!Mi(i)||i.getClientRects().length===0)return!1;const t=getComputedStyle(i).getPropertyValue("visibility")==="visible",e=i.closest("details:not([open])");if(!e)return t;if(e!==i){const s=i.closest("summary");if(s&&s.parentNode!==e||s===null)return!1}return t},ns=i=>!i||i.nodeType!==Node.ELEMENT_NODE||i.classList.contains("disabled")?!0:typeof i.disabled<"u"?i.disabled:i.hasAttribute("disabled")&&i.getAttribute("disabled")!=="false",md=i=>{if(!document.documentElement.attachShadow)return null;if(typeof i.getRootNode=="function"){const t=i.getRootNode();return t instanceof ShadowRoot?t:null}return i instanceof ShadowRoot?i:i.parentNode?md(i.parentNode):null},ba=()=>{},yn=i=>{i.offsetHeight},gd=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,mo=[],W_=i=>{document.readyState==="loading"?(mo.length||document.addEventListener("DOMContentLoaded",()=>{for(const t of mo)t()}),mo.push(i)):i()},je=()=>document.documentElement.dir==="rtl",Qe=i=>{W_(()=>{const t=gd();if(t){const e=i.NAME,s=t.fn[e];t.fn[e]=i.jQueryInterface,t.fn[e].Constructor=i,t.fn[e].noConflict=()=>(t.fn[e]=s,i.jQueryInterface)}})},Ee=(i,t=[],e=i)=>typeof i=="function"?i.call(...t):e,_d=(i,t,e=!0)=>{if(!e){Ee(i);return}const r=z_(t)+5;let a=!1;const c=({target:h})=>{h===t&&(a=!0,t.removeEventListener(dc,c),Ee(i))};t.addEventListener(dc,c),setTimeout(()=>{a||pd(t)},r)},fh=(i,t,e,s)=>{const r=i.length;let a=i.indexOf(t);return a===-1?!e&&s?i[r-1]:i[0]:(a+=e?1:-1,s&&(a=(a+r)%r),i[Math.max(0,Math.min(a,r-1))])},G_=/[^.]*(?=\..*)\.|.*/,V_=/\..*/,K_=/::\d+$/,go={};let $l=1;const xd={mouseenter:"mouseover",mouseleave:"mouseout"},q_=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function bd(i,t){return t&&`${t}::${$l++}`||i.uidEvent||$l++}function yd(i){const t=bd(i);return i.uidEvent=t,go[t]=go[t]||{},go[t]}function j_(i,t){return function e(s){return dh(s,{delegateTarget:i}),e.oneOff&&V.off(i,s.type,t),t.apply(i,[s])}}function Y_(i,t,e){return function s(r){const a=i.querySelectorAll(t);for(let{target:c}=r;c&&c!==this;c=c.parentNode)for(const h of a)if(h===c)return dh(r,{delegateTarget:c}),s.oneOff&&V.off(i,r.type,t,e),e.apply(c,[r])}}function vd(i,t,e=null){return Object.values(i).find(s=>s.callable===t&&s.delegationSelector===e)}function Cd(i,t,e){const s=typeof t=="string",r=s?e:t||e;let a=wd(i);return q_.has(a)||(a=i),[s,r,a]}function Hl(i,t,e,s,r){if(typeof t!="string"||!i)return;let[a,c,h]=Cd(t,e,s);t in xd&&(c=(y=>function(R){if(!R.relatedTarget||R.relatedTarget!==R.delegateTarget&&!R.delegateTarget.contains(R.relatedTarget))return y.call(this,R)})(c));const m=yd(i),d=m[h]||(m[h]={}),p=vd(d,c,a?e:null);if(p){p.oneOff=p.oneOff&&r;return}const b=bd(c,t.replace(G_,"")),w=a?Y_(i,e,c):j_(i,c);w.delegationSelector=a?e:null,w.callable=c,w.oneOff=r,w.uidEvent=b,d[b]=w,i.addEventListener(h,w,a)}function pc(i,t,e,s,r){const a=vd(t[e],s,r);a&&(i.removeEventListener(e,a,!!r),delete t[e][a.uidEvent])}function X_(i,t,e,s){const r=t[e]||{};for(const[a,c]of Object.entries(r))a.includes(s)&&pc(i,t,e,c.callable,c.delegationSelector)}function wd(i){return i=i.replace(V_,""),xd[i]||i}const V={on(i,t,e,s){Hl(i,t,e,s,!1)},one(i,t,e,s){Hl(i,t,e,s,!0)},off(i,t,e,s){if(typeof t!="string"||!i)return;const[r,a,c]=Cd(t,e,s),h=c!==t,m=yd(i),d=m[c]||{},p=t.startsWith(".");if(typeof a<"u"){if(!Object.keys(d).length)return;pc(i,m,c,a,r?e:null);return}if(p)for(const b of Object.keys(m))X_(i,m,b,t.slice(1));for(const[b,w]of Object.entries(d)){const C=b.replace(K_,"");(!h||t.includes(C))&&pc(i,m,c,w.callable,w.delegationSelector)}},trigger(i,t,e){if(typeof t!="string"||!i)return null;const s=gd(),r=wd(t),a=t!==r;let c=null,h=!0,m=!0,d=!1;a&&s&&(c=s.Event(t,e),s(i).trigger(c),h=!c.isPropagationStopped(),m=!c.isImmediatePropagationStopped(),d=c.isDefaultPrevented());const p=dh(new Event(t,{bubbles:h,cancelable:!0}),e);return d&&p.preventDefault(),m&&i.dispatchEvent(p),p.defaultPrevented&&c&&c.preventDefault(),p}};function dh(i,t={}){for(const[e,s]of Object.entries(t))try{i[e]=s}catch{Object.defineProperty(i,e,{configurable:!0,get(){return s}})}return i}function zl(i){if(i==="true")return!0;if(i==="false")return!1;if(i===Number(i).toString())return Number(i);if(i===""||i==="null")return null;if(typeof i!="string")return i;try{return JSON.parse(decodeURIComponent(i))}catch{return i}}function _o(i){return i.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}const Ni={setDataAttribute(i,t,e){i.setAttribute(`data-bs-${_o(t)}`,e)},removeDataAttribute(i,t){i.removeAttribute(`data-bs-${_o(t)}`)},getDataAttributes(i){if(!i)return{};const t={},e=Object.keys(i.dataset).filter(s=>s.startsWith("bs")&&!s.startsWith("bsConfig"));for(const s of e){let r=s.replace(/^bs/,"");r=r.charAt(0).toLowerCase()+r.slice(1),t[r]=zl(i.dataset[s])}return t},getDataAttribute(i,t){return zl(i.getAttribute(`data-bs-${_o(t)}`))}};let vn=class{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,e){const s=Mi(e)?Ni.getDataAttribute(e,"config"):{};return{...this.constructor.Default,...typeof s=="object"?s:{},...Mi(e)?Ni.getDataAttributes(e):{},...typeof t=="object"?t:{}}}_typeCheckConfig(t,e=this.constructor.DefaultType){for(const[s,r]of Object.entries(e)){const a=t[s],c=Mi(a)?"element":$_(a);if(!new RegExp(r).test(c))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${s}" provided type "${c}" but expected type "${r}".`)}}};const Z_="5.3.6";class ui extends vn{constructor(t,e){super(),t=rs(t),t&&(this._element=t,this._config=this._getConfig(e),po.set(this._element,this.constructor.DATA_KEY,this))}dispose(){po.remove(this._element,this.constructor.DATA_KEY),V.off(this._element,this.constructor.EVENT_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_queueCallback(t,e,s=!0){_d(t,e,s)}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return po.get(rs(t),this.DATA_KEY)}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,typeof e=="object"?e:null)}static get VERSION(){return Z_}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(t){return`${t}${this.EVENT_KEY}`}}const xo=i=>{let t=i.getAttribute("data-bs-target");if(!t||t==="#"){let e=i.getAttribute("href");if(!e||!e.includes("#")&&!e.startsWith("."))return null;e.includes("#")&&!e.startsWith("#")&&(e=`#${e.split("#")[1]}`),t=e&&e!=="#"?e.trim():null}return t?t.split(",").map(e=>dd(e)).join(","):null},lt={find(i,t=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(t,i))},findOne(i,t=document.documentElement){return Element.prototype.querySelector.call(t,i)},children(i,t){return[].concat(...i.children).filter(e=>e.matches(t))},parents(i,t){const e=[];let s=i.parentNode.closest(t);for(;s;)e.push(s),s=s.parentNode.closest(t);return e},prev(i,t){let e=i.previousElementSibling;for(;e;){if(e.matches(t))return[e];e=e.previousElementSibling}return[]},next(i,t){let e=i.nextElementSibling;for(;e;){if(e.matches(t))return[e];e=e.nextElementSibling}return[]},focusableChildren(i){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(e=>`${e}:not([tabindex^="-"])`).join(",");return this.find(t,i).filter(e=>!ns(e)&&Sr(e))},getSelectorFromElement(i){const t=xo(i);return t&&lt.findOne(t)?t:null},getElementFromSelector(i){const t=xo(i);return t?lt.findOne(t):null},getMultipleElementsFromSelector(i){const t=xo(i);return t?lt.find(t):[]}},Pa=(i,t="hide")=>{const e=`click.dismiss${i.EVENT_KEY}`,s=i.NAME;V.on(document,e,`[data-bs-dismiss="${s}"]`,function(r){if(["A","AREA"].includes(this.tagName)&&r.preventDefault(),ns(this))return;const a=lt.getElementFromSelector(this)||this.closest(`.${s}`);i.getOrCreateInstance(a)[t]()})},Q_="alert",J_="bs.alert",Sd=`.${J_}`,tx=`close${Sd}`,ex=`closed${Sd}`,ix="fade",sx="show";class Ia extends ui{static get NAME(){return Q_}close(){if(V.trigger(this._element,tx).defaultPrevented)return;this._element.classList.remove(sx);const e=this._element.classList.contains(ix);this._queueCallback(()=>this._destroyElement(),this._element,e)}_destroyElement(){this._element.remove(),V.trigger(this._element,ex),this.dispose()}static jQueryInterface(t){return this.each(function(){const e=Ia.getOrCreateInstance(this);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t](this)}})}}Pa(Ia,"close");Qe(Ia);const rx="button",nx="bs.button",ax=`.${nx}`,ox=".data-api",cx="active",Wl='[data-bs-toggle="button"]',hx=`click${ax}${ox}`;class Oa extends ui{static get NAME(){return rx}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(cx))}static jQueryInterface(t){return this.each(function(){const e=Oa.getOrCreateInstance(this);t==="toggle"&&e[t]()})}}V.on(document,hx,Wl,i=>{i.preventDefault();const t=i.target.closest(Wl);Oa.getOrCreateInstance(t).toggle()});Qe(Oa);const lx="swipe",Er=".bs.swipe",ux=`touchstart${Er}`,fx=`touchmove${Er}`,dx=`touchend${Er}`,px=`pointerdown${Er}`,mx=`pointerup${Er}`,gx="touch",_x="pen",xx="pointer-event",bx=40,yx={endCallback:null,leftCallback:null,rightCallback:null},vx={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class ya extends vn{constructor(t,e){super(),this._element=t,!(!t||!ya.isSupported())&&(this._config=this._getConfig(e),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return yx}static get DefaultType(){return vx}static get NAME(){return lx}dispose(){V.off(this._element,Er)}_start(t){if(!this._supportPointerEvents){this._deltaX=t.touches[0].clientX;return}this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX)}_end(t){this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX-this._deltaX),this._handleSwipe(),Ee(this._config.endCallback)}_move(t){this._deltaX=t.touches&&t.touches.length>1?0:t.touches[0].clientX-this._deltaX}_handleSwipe(){const t=Math.abs(this._deltaX);if(t<=bx)return;const e=t/this._deltaX;this._deltaX=0,e&&Ee(e>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(V.on(this._element,px,t=>this._start(t)),V.on(this._element,mx,t=>this._end(t)),this._element.classList.add(xx)):(V.on(this._element,ux,t=>this._start(t)),V.on(this._element,fx,t=>this._move(t)),V.on(this._element,dx,t=>this._end(t)))}_eventIsPointerPenTouch(t){return this._supportPointerEvents&&(t.pointerType===_x||t.pointerType===gx)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Cx="carousel",wx="bs.carousel",us=`.${wx}`,Ed=".data-api",Sx="ArrowLeft",Ex="ArrowRight",Ax=500,Wr="next",Zs="prev",rr="left",la="right",kx=`slide${us}`,bo=`slid${us}`,Tx=`keydown${us}`,Dx=`mouseenter${us}`,Rx=`mouseleave${us}`,Lx=`dragstart${us}`,Px=`load${us}${Ed}`,Ix=`click${us}${Ed}`,Ad="carousel",Un="active",Ox="slide",Mx="carousel-item-end",Nx="carousel-item-start",Bx="carousel-item-next",Fx="carousel-item-prev",kd=".active",Td=".carousel-item",Ux=kd+Td,$x=".carousel-item img",Hx=".carousel-indicators",zx="[data-bs-slide], [data-bs-slide-to]",Wx='[data-bs-ride="carousel"]',Gx={[Sx]:la,[Ex]:rr},Vx={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Kx={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Cn extends ui{constructor(t,e){super(t,e),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=lt.findOne(Hx,this._element),this._addEventListeners(),this._config.ride===Ad&&this.cycle()}static get Default(){return Vx}static get DefaultType(){return Kx}static get NAME(){return Cx}next(){this._slide(Wr)}nextWhenVisible(){!document.hidden&&Sr(this._element)&&this.next()}prev(){this._slide(Zs)}pause(){this._isSliding&&pd(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){V.one(this._element,bo,()=>this.cycle());return}this.cycle()}}to(t){const e=this._getItems();if(t>e.length-1||t<0)return;if(this._isSliding){V.one(this._element,bo,()=>this.to(t));return}const s=this._getItemIndex(this._getActive());if(s===t)return;const r=t>s?Wr:Zs;this._slide(r,e[t])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(t){return t.defaultInterval=t.interval,t}_addEventListeners(){this._config.keyboard&&V.on(this._element,Tx,t=>this._keydown(t)),this._config.pause==="hover"&&(V.on(this._element,Dx,()=>this.pause()),V.on(this._element,Rx,()=>this._maybeEnableCycle())),this._config.touch&&ya.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const s of lt.find($x,this._element))V.on(s,Lx,r=>r.preventDefault());const e={leftCallback:()=>this._slide(this._directionToOrder(rr)),rightCallback:()=>this._slide(this._directionToOrder(la)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),Ax+this._config.interval))}};this._swipeHelper=new ya(this._element,e)}_keydown(t){if(/input|textarea/i.test(t.target.tagName))return;const e=Gx[t.key];e&&(t.preventDefault(),this._slide(this._directionToOrder(e)))}_getItemIndex(t){return this._getItems().indexOf(t)}_setActiveIndicatorElement(t){if(!this._indicatorsElement)return;const e=lt.findOne(kd,this._indicatorsElement);e.classList.remove(Un),e.removeAttribute("aria-current");const s=lt.findOne(`[data-bs-slide-to="${t}"]`,this._indicatorsElement);s&&(s.classList.add(Un),s.setAttribute("aria-current","true"))}_updateInterval(){const t=this._activeElement||this._getActive();if(!t)return;const e=Number.parseInt(t.getAttribute("data-bs-interval"),10);this._config.interval=e||this._config.defaultInterval}_slide(t,e=null){if(this._isSliding)return;const s=this._getActive(),r=t===Wr,a=e||fh(this._getItems(),s,r,this._config.wrap);if(a===s)return;const c=this._getItemIndex(a),h=C=>V.trigger(this._element,C,{relatedTarget:a,direction:this._orderToDirection(t),from:this._getItemIndex(s),to:c});if(h(kx).defaultPrevented||!s||!a)return;const d=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(c),this._activeElement=a;const p=r?Nx:Mx,b=r?Bx:Fx;a.classList.add(b),yn(a),s.classList.add(p),a.classList.add(p);const w=()=>{a.classList.remove(p,b),a.classList.add(Un),s.classList.remove(Un,b,p),this._isSliding=!1,h(bo)};this._queueCallback(w,s,this._isAnimated()),d&&this.cycle()}_isAnimated(){return this._element.classList.contains(Ox)}_getActive(){return lt.findOne(Ux,this._element)}_getItems(){return lt.find(Td,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(t){return je()?t===rr?Zs:Wr:t===rr?Wr:Zs}_orderToDirection(t){return je()?t===Zs?rr:la:t===Zs?la:rr}static jQueryInterface(t){return this.each(function(){const e=Cn.getOrCreateInstance(this,t);if(typeof t=="number"){e.to(t);return}if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t]()}})}}V.on(document,Ix,zx,function(i){const t=lt.getElementFromSelector(this);if(!t||!t.classList.contains(Ad))return;i.preventDefault();const e=Cn.getOrCreateInstance(t),s=this.getAttribute("data-bs-slide-to");if(s){e.to(s),e._maybeEnableCycle();return}if(Ni.getDataAttribute(this,"slide")==="next"){e.next(),e._maybeEnableCycle();return}e.prev(),e._maybeEnableCycle()});V.on(window,Px,()=>{const i=lt.find(Wx);for(const t of i)Cn.getOrCreateInstance(t)});Qe(Cn);const qx="collapse",jx="bs.collapse",wn=`.${jx}`,Yx=".data-api",Xx=`show${wn}`,Zx=`shown${wn}`,Qx=`hide${wn}`,Jx=`hidden${wn}`,tb=`click${wn}${Yx}`,yo="show",cr="collapse",$n="collapsing",eb="collapsed",ib=`:scope .${cr} .${cr}`,sb="collapse-horizontal",rb="width",nb="height",ab=".collapse.show, .collapse.collapsing",mc='[data-bs-toggle="collapse"]',ob={parent:null,toggle:!0},cb={parent:"(null|element)",toggle:"boolean"};class on extends ui{constructor(t,e){super(t,e),this._isTransitioning=!1,this._triggerArray=[];const s=lt.find(mc);for(const r of s){const a=lt.getSelectorFromElement(r),c=lt.find(a).filter(h=>h===this._element);a!==null&&c.length&&this._triggerArray.push(r)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return ob}static get DefaultType(){return cb}static get NAME(){return qx}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let t=[];if(this._config.parent&&(t=this._getFirstLevelChildren(ab).filter(h=>h!==this._element).map(h=>on.getOrCreateInstance(h,{toggle:!1}))),t.length&&t[0]._isTransitioning||V.trigger(this._element,Xx).defaultPrevented)return;for(const h of t)h.hide();const s=this._getDimension();this._element.classList.remove(cr),this._element.classList.add($n),this._element.style[s]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const r=()=>{this._isTransitioning=!1,this._element.classList.remove($n),this._element.classList.add(cr,yo),this._element.style[s]="",V.trigger(this._element,Zx)},c=`scroll${s[0].toUpperCase()+s.slice(1)}`;this._queueCallback(r,this._element,!0),this._element.style[s]=`${this._element[c]}px`}hide(){if(this._isTransitioning||!this._isShown()||V.trigger(this._element,Qx).defaultPrevented)return;const e=this._getDimension();this._element.style[e]=`${this._element.getBoundingClientRect()[e]}px`,yn(this._element),this._element.classList.add($n),this._element.classList.remove(cr,yo);for(const r of this._triggerArray){const a=lt.getElementFromSelector(r);a&&!this._isShown(a)&&this._addAriaAndCollapsedClass([r],!1)}this._isTransitioning=!0;const s=()=>{this._isTransitioning=!1,this._element.classList.remove($n),this._element.classList.add(cr),V.trigger(this._element,Jx)};this._element.style[e]="",this._queueCallback(s,this._element,!0)}_isShown(t=this._element){return t.classList.contains(yo)}_configAfterMerge(t){return t.toggle=!!t.toggle,t.parent=rs(t.parent),t}_getDimension(){return this._element.classList.contains(sb)?rb:nb}_initializeChildren(){if(!this._config.parent)return;const t=this._getFirstLevelChildren(mc);for(const e of t){const s=lt.getElementFromSelector(e);s&&this._addAriaAndCollapsedClass([e],this._isShown(s))}}_getFirstLevelChildren(t){const e=lt.find(ib,this._config.parent);return lt.find(t,this._config.parent).filter(s=>!e.includes(s))}_addAriaAndCollapsedClass(t,e){if(t.length)for(const s of t)s.classList.toggle(eb,!e),s.setAttribute("aria-expanded",e)}static jQueryInterface(t){const e={};return typeof t=="string"&&/show|hide/.test(t)&&(e.toggle=!1),this.each(function(){const s=on.getOrCreateInstance(this,e);if(typeof t=="string"){if(typeof s[t]>"u")throw new TypeError(`No method named "${t}"`);s[t]()}})}}V.on(document,tb,mc,function(i){(i.target.tagName==="A"||i.delegateTarget&&i.delegateTarget.tagName==="A")&&i.preventDefault();for(const t of lt.getMultipleElementsFromSelector(this))on.getOrCreateInstance(t,{toggle:!1}).toggle()});Qe(on);const Gl="dropdown",hb="bs.dropdown",$s=`.${hb}`,ph=".data-api",lb="Escape",Vl="Tab",ub="ArrowUp",Kl="ArrowDown",fb=2,db=`hide${$s}`,pb=`hidden${$s}`,mb=`show${$s}`,gb=`shown${$s}`,Dd=`click${$s}${ph}`,Rd=`keydown${$s}${ph}`,_b=`keyup${$s}${ph}`,nr="show",xb="dropup",bb="dropend",yb="dropstart",vb="dropup-center",Cb="dropdown-center",As='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',wb=`${As}.${nr}`,ua=".dropdown-menu",Sb=".navbar",Eb=".navbar-nav",Ab=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",kb=je()?"top-end":"top-start",Tb=je()?"top-start":"top-end",Db=je()?"bottom-end":"bottom-start",Rb=je()?"bottom-start":"bottom-end",Lb=je()?"left-start":"right-start",Pb=je()?"right-start":"left-start",Ib="top",Ob="bottom",Mb={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Nb={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Ci extends ui{constructor(t,e){super(t,e),this._popper=null,this._parent=this._element.parentNode,this._menu=lt.next(this._element,ua)[0]||lt.prev(this._element,ua)[0]||lt.findOne(ua,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Mb}static get DefaultType(){return Nb}static get NAME(){return Gl}toggle(){return this._isShown()?this.hide():this.show()}show(){if(ns(this._element)||this._isShown())return;const t={relatedTarget:this._element};if(!V.trigger(this._element,mb,t).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(Eb))for(const s of[].concat(...document.body.children))V.on(s,"mouseover",ba);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(nr),this._element.classList.add(nr),V.trigger(this._element,gb,t)}}hide(){if(ns(this._element)||!this._isShown())return;const t={relatedTarget:this._element};this._completeHide(t)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(t){if(!V.trigger(this._element,db,t).defaultPrevented){if("ontouchstart"in document.documentElement)for(const s of[].concat(...document.body.children))V.off(s,"mouseover",ba);this._popper&&this._popper.destroy(),this._menu.classList.remove(nr),this._element.classList.remove(nr),this._element.setAttribute("aria-expanded","false"),Ni.removeDataAttribute(this._menu,"popper"),V.trigger(this._element,pb,t),this._element.focus()}}_getConfig(t){if(t=super._getConfig(t),typeof t.reference=="object"&&!Mi(t.reference)&&typeof t.reference.getBoundingClientRect!="function")throw new TypeError(`${Gl.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return t}_createPopper(){if(typeof fd>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let t=this._element;this._config.reference==="parent"?t=this._parent:Mi(this._config.reference)?t=rs(this._config.reference):typeof this._config.reference=="object"&&(t=this._config.reference);const e=this._getPopperConfig();this._popper=uh(t,this._menu,e)}_isShown(){return this._menu.classList.contains(nr)}_getPlacement(){const t=this._parent;if(t.classList.contains(bb))return Lb;if(t.classList.contains(yb))return Pb;if(t.classList.contains(vb))return Ib;if(t.classList.contains(Cb))return Ob;const e=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return t.classList.contains(xb)?e?Tb:kb:e?Rb:Db}_detectNavbar(){return this._element.closest(Sb)!==null}_getOffset(){const{offset:t}=this._config;return typeof t=="string"?t.split(",").map(e=>Number.parseInt(e,10)):typeof t=="function"?e=>t(e,this._element):t}_getPopperConfig(){const t={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Ni.setDataAttribute(this._menu,"popper","static"),t.modifiers=[{name:"applyStyles",enabled:!1}]),{...t,...Ee(this._config.popperConfig,[void 0,t])}}_selectMenuItem({key:t,target:e}){const s=lt.find(Ab,this._menu).filter(r=>Sr(r));s.length&&fh(s,e,t===Kl,!s.includes(e)).focus()}static jQueryInterface(t){return this.each(function(){const e=Ci.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t]()}})}static clearMenus(t){if(t.button===fb||t.type==="keyup"&&t.key!==Vl)return;const e=lt.find(wb);for(const s of e){const r=Ci.getInstance(s);if(!r||r._config.autoClose===!1)continue;const a=t.composedPath(),c=a.includes(r._menu);if(a.includes(r._element)||r._config.autoClose==="inside"&&!c||r._config.autoClose==="outside"&&c||r._menu.contains(t.target)&&(t.type==="keyup"&&t.key===Vl||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;const h={relatedTarget:r._element};t.type==="click"&&(h.clickEvent=t),r._completeHide(h)}}static dataApiKeydownHandler(t){const e=/input|textarea/i.test(t.target.tagName),s=t.key===lb,r=[ub,Kl].includes(t.key);if(!r&&!s||e&&!s)return;t.preventDefault();const a=this.matches(As)?this:lt.prev(this,As)[0]||lt.next(this,As)[0]||lt.findOne(As,t.delegateTarget.parentNode),c=Ci.getOrCreateInstance(a);if(r){t.stopPropagation(),c.show(),c._selectMenuItem(t);return}c._isShown()&&(t.stopPropagation(),c.hide(),a.focus())}}V.on(document,Rd,As,Ci.dataApiKeydownHandler);V.on(document,Rd,ua,Ci.dataApiKeydownHandler);V.on(document,Dd,Ci.clearMenus);V.on(document,_b,Ci.clearMenus);V.on(document,Dd,As,function(i){i.preventDefault(),Ci.getOrCreateInstance(this).toggle()});Qe(Ci);const Ld="backdrop",Bb="fade",ql="show",jl=`mousedown.bs.${Ld}`,Fb={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Ub={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Pd extends vn{constructor(t){super(),this._config=this._getConfig(t),this._isAppended=!1,this._element=null}static get Default(){return Fb}static get DefaultType(){return Ub}static get NAME(){return Ld}show(t){if(!this._config.isVisible){Ee(t);return}this._append();const e=this._getElement();this._config.isAnimated&&yn(e),e.classList.add(ql),this._emulateAnimation(()=>{Ee(t)})}hide(t){if(!this._config.isVisible){Ee(t);return}this._getElement().classList.remove(ql),this._emulateAnimation(()=>{this.dispose(),Ee(t)})}dispose(){this._isAppended&&(V.off(this._element,jl),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add(Bb),this._element=t}return this._element}_configAfterMerge(t){return t.rootElement=rs(t.rootElement),t}_append(){if(this._isAppended)return;const t=this._getElement();this._config.rootElement.append(t),V.on(t,jl,()=>{Ee(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(t){_d(t,this._getElement(),this._config.isAnimated)}}const $b="focustrap",Hb="bs.focustrap",va=`.${Hb}`,zb=`focusin${va}`,Wb=`keydown.tab${va}`,Gb="Tab",Vb="forward",Yl="backward",Kb={autofocus:!0,trapElement:null},qb={autofocus:"boolean",trapElement:"element"};class Id extends vn{constructor(t){super(),this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Kb}static get DefaultType(){return qb}static get NAME(){return $b}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),V.off(document,va),V.on(document,zb,t=>this._handleFocusin(t)),V.on(document,Wb,t=>this._handleKeydown(t)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,V.off(document,va))}_handleFocusin(t){const{trapElement:e}=this._config;if(t.target===document||t.target===e||e.contains(t.target))return;const s=lt.focusableChildren(e);s.length===0?e.focus():this._lastTabNavDirection===Yl?s[s.length-1].focus():s[0].focus()}_handleKeydown(t){t.key===Gb&&(this._lastTabNavDirection=t.shiftKey?Yl:Vb)}}const Xl=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Zl=".sticky-top",Hn="padding-right",Ql="margin-right";class gc{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Hn,e=>e+t),this._setElementAttributes(Xl,Hn,e=>e+t),this._setElementAttributes(Zl,Ql,e=>e-t)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Hn),this._resetElementAttributes(Xl,Hn),this._resetElementAttributes(Zl,Ql)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,e,s){const r=this.getWidth(),a=c=>{if(c!==this._element&&window.innerWidth>c.clientWidth+r)return;this._saveInitialAttribute(c,e);const h=window.getComputedStyle(c).getPropertyValue(e);c.style.setProperty(e,`${s(Number.parseFloat(h))}px`)};this._applyManipulationCallback(t,a)}_saveInitialAttribute(t,e){const s=t.style.getPropertyValue(e);s&&Ni.setDataAttribute(t,e,s)}_resetElementAttributes(t,e){const s=r=>{const a=Ni.getDataAttribute(r,e);if(a===null){r.style.removeProperty(e);return}Ni.removeDataAttribute(r,e),r.style.setProperty(e,a)};this._applyManipulationCallback(t,s)}_applyManipulationCallback(t,e){if(Mi(t)){e(t);return}for(const s of lt.find(t,this._element))e(s)}}const jb="modal",Yb="bs.modal",Ye=`.${Yb}`,Xb=".data-api",Zb="Escape",Qb=`hide${Ye}`,Jb=`hidePrevented${Ye}`,Od=`hidden${Ye}`,Md=`show${Ye}`,ty=`shown${Ye}`,ey=`resize${Ye}`,iy=`click.dismiss${Ye}`,sy=`mousedown.dismiss${Ye}`,ry=`keydown.dismiss${Ye}`,ny=`click${Ye}${Xb}`,Jl="modal-open",ay="fade",tu="show",vo="modal-static",oy=".modal.show",cy=".modal-dialog",hy=".modal-body",ly='[data-bs-toggle="modal"]',uy={backdrop:!0,focus:!0,keyboard:!0},fy={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class be extends ui{constructor(t,e){super(t,e),this._dialog=lt.findOne(cy,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new gc,this._addEventListeners()}static get Default(){return uy}static get DefaultType(){return fy}static get NAME(){return jb}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){this._isShown||this._isTransitioning||V.trigger(this._element,Md,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Jl),this._adjustDialog(),this._backdrop.show(()=>this._showElement(t)))}hide(){!this._isShown||this._isTransitioning||V.trigger(this._element,Qb).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(tu),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){V.off(window,Ye),V.off(this._dialog,Ye),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Pd({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Id({trapElement:this._element})}_showElement(t){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const e=lt.findOne(hy,this._dialog);e&&(e.scrollTop=0),yn(this._element),this._element.classList.add(tu);const s=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,V.trigger(this._element,ty,{relatedTarget:t})};this._queueCallback(s,this._dialog,this._isAnimated())}_addEventListeners(){V.on(this._element,ry,t=>{if(t.key===Zb){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),V.on(window,ey,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),V.on(this._element,sy,t=>{V.one(this._element,iy,e=>{if(!(this._element!==t.target||this._element!==e.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Jl),this._resetAdjustments(),this._scrollBar.reset(),V.trigger(this._element,Od)})}_isAnimated(){return this._element.classList.contains(ay)}_triggerBackdropTransition(){if(V.trigger(this._element,Jb).defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight,s=this._element.style.overflowY;s==="hidden"||this._element.classList.contains(vo)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(vo),this._queueCallback(()=>{this._element.classList.remove(vo),this._queueCallback(()=>{this._element.style.overflowY=s},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._scrollBar.getWidth(),s=e>0;if(s&&!t){const r=je()?"paddingLeft":"paddingRight";this._element.style[r]=`${e}px`}if(!s&&t){const r=je()?"paddingRight":"paddingLeft";this._element.style[r]=`${e}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,e){return this.each(function(){const s=be.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof s[t]>"u")throw new TypeError(`No method named "${t}"`);s[t](e)}})}}V.on(document,ny,ly,function(i){const t=lt.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&i.preventDefault(),V.one(t,Md,r=>{r.defaultPrevented||V.one(t,Od,()=>{Sr(this)&&this.focus()})});const e=lt.findOne(oy);e&&be.getInstance(e).hide(),be.getOrCreateInstance(t).toggle(this)});Pa(be);Qe(be);const dy="offcanvas",py="bs.offcanvas",Hi=`.${py}`,Nd=".data-api",my=`load${Hi}${Nd}`,gy="Escape",eu="show",iu="showing",su="hiding",_y="offcanvas-backdrop",Bd=".offcanvas.show",xy=`show${Hi}`,by=`shown${Hi}`,yy=`hide${Hi}`,ru=`hidePrevented${Hi}`,Fd=`hidden${Hi}`,vy=`resize${Hi}`,Cy=`click${Hi}${Nd}`,wy=`keydown.dismiss${Hi}`,Sy='[data-bs-toggle="offcanvas"]',Ey={backdrop:!0,keyboard:!0,scroll:!1},Ay={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class as extends ui{constructor(t,e){super(t,e),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Ey}static get DefaultType(){return Ay}static get NAME(){return dy}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown||V.trigger(this._element,xy,{relatedTarget:t}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new gc().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(iu);const s=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(eu),this._element.classList.remove(iu),V.trigger(this._element,by,{relatedTarget:t})};this._queueCallback(s,this._element,!0)}hide(){if(!this._isShown||V.trigger(this._element,yy).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(su),this._backdrop.hide();const e=()=>{this._element.classList.remove(eu,su),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new gc().reset(),V.trigger(this._element,Fd)};this._queueCallback(e,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=()=>{if(this._config.backdrop==="static"){V.trigger(this._element,ru);return}this.hide()},e=!!this._config.backdrop;return new Pd({className:_y,isVisible:e,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:e?t:null})}_initializeFocusTrap(){return new Id({trapElement:this._element})}_addEventListeners(){V.on(this._element,wy,t=>{if(t.key===gy){if(this._config.keyboard){this.hide();return}V.trigger(this._element,ru)}})}static jQueryInterface(t){return this.each(function(){const e=as.getOrCreateInstance(this,t);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t](this)}})}}V.on(document,Cy,Sy,function(i){const t=lt.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&i.preventDefault(),ns(this))return;V.one(t,Fd,()=>{Sr(this)&&this.focus()});const e=lt.findOne(Bd);e&&e!==t&&as.getInstance(e).hide(),as.getOrCreateInstance(t).toggle(this)});V.on(window,my,()=>{for(const i of lt.find(Bd))as.getOrCreateInstance(i).show()});V.on(window,vy,()=>{for(const i of lt.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(i).position!=="fixed"&&as.getOrCreateInstance(i).hide()});Pa(as);Qe(as);const ky=/^aria-[\w-]*$/i,Ud={"*":["class","dir","id","lang","role",ky],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Ty=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Dy=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,Ry=(i,t)=>{const e=i.nodeName.toLowerCase();return t.includes(e)?Ty.has(e)?!!Dy.test(i.nodeValue):!0:t.filter(s=>s instanceof RegExp).some(s=>s.test(e))};function Ly(i,t,e){if(!i.length)return i;if(e&&typeof e=="function")return e(i);const r=new window.DOMParser().parseFromString(i,"text/html"),a=[].concat(...r.body.querySelectorAll("*"));for(const c of a){const h=c.nodeName.toLowerCase();if(!Object.keys(t).includes(h)){c.remove();continue}const m=[].concat(...c.attributes),d=[].concat(t["*"]||[],t[h]||[]);for(const p of m)Ry(p,d)||c.removeAttribute(p.nodeName)}return r.body.innerHTML}const Py="TemplateFactory",Iy={allowList:Ud,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Oy={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},My={entry:"(string|element|function|null)",selector:"(string|element)"};class Ny extends vn{constructor(t){super(),this._config=this._getConfig(t)}static get Default(){return Iy}static get DefaultType(){return Oy}static get NAME(){return Py}getContent(){return Object.values(this._config.content).map(t=>this._resolvePossibleFunction(t)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(t){return this._checkContent(t),this._config.content={...this._config.content,...t},this}toHtml(){const t=document.createElement("div");t.innerHTML=this._maybeSanitize(this._config.template);for(const[r,a]of Object.entries(this._config.content))this._setContent(t,a,r);const e=t.children[0],s=this._resolvePossibleFunction(this._config.extraClass);return s&&e.classList.add(...s.split(" ")),e}_typeCheckConfig(t){super._typeCheckConfig(t),this._checkContent(t.content)}_checkContent(t){for(const[e,s]of Object.entries(t))super._typeCheckConfig({selector:e,entry:s},My)}_setContent(t,e,s){const r=lt.findOne(s,t);if(r){if(e=this._resolvePossibleFunction(e),!e){r.remove();return}if(Mi(e)){this._putElementInTemplate(rs(e),r);return}if(this._config.html){r.innerHTML=this._maybeSanitize(e);return}r.textContent=e}}_maybeSanitize(t){return this._config.sanitize?Ly(t,this._config.allowList,this._config.sanitizeFn):t}_resolvePossibleFunction(t){return Ee(t,[void 0,this])}_putElementInTemplate(t,e){if(this._config.html){e.innerHTML="",e.append(t);return}e.textContent=t.textContent}}const By="tooltip",Fy=new Set(["sanitize","allowList","sanitizeFn"]),Co="fade",Uy="modal",zn="show",$y=".tooltip-inner",nu=`.${Uy}`,au="hide.bs.modal",Gr="hover",wo="focus",Hy="click",zy="manual",Wy="hide",Gy="hidden",Vy="show",Ky="shown",qy="inserted",jy="click",Yy="focusin",Xy="focusout",Zy="mouseenter",Qy="mouseleave",Jy={AUTO:"auto",TOP:"top",RIGHT:je()?"left":"right",BOTTOM:"bottom",LEFT:je()?"right":"left"},tv={allowList:Ud,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},ev={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Ar extends ui{constructor(t,e){if(typeof fd>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(t,e),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return tv}static get DefaultType(){return ev}static get NAME(){return By}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),V.off(this._element.closest(nu),au,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const t=V.trigger(this._element,this.constructor.eventName(Vy)),s=(md(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(t.defaultPrevented||!s)return;this._disposePopper();const r=this._getTipElement();this._element.setAttribute("aria-describedby",r.getAttribute("id"));const{container:a}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(a.append(r),V.trigger(this._element,this.constructor.eventName(qy))),this._popper=this._createPopper(r),r.classList.add(zn),"ontouchstart"in document.documentElement)for(const h of[].concat(...document.body.children))V.on(h,"mouseover",ba);const c=()=>{V.trigger(this._element,this.constructor.eventName(Ky)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(c,this.tip,this._isAnimated())}hide(){if(!this._isShown()||V.trigger(this._element,this.constructor.eventName(Wy)).defaultPrevented)return;if(this._getTipElement().classList.remove(zn),"ontouchstart"in document.documentElement)for(const r of[].concat(...document.body.children))V.off(r,"mouseover",ba);this._activeTrigger[Hy]=!1,this._activeTrigger[wo]=!1,this._activeTrigger[Gr]=!1,this._isHovered=null;const s=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),V.trigger(this._element,this.constructor.eventName(Gy)))};this._queueCallback(s,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(t){const e=this._getTemplateFactory(t).toHtml();if(!e)return null;e.classList.remove(Co,zn),e.classList.add(`bs-${this.constructor.NAME}-auto`);const s=H_(this.constructor.NAME).toString();return e.setAttribute("id",s),this._isAnimated()&&e.classList.add(Co),e}setContent(t){this._newContent=t,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(t){return this._templateFactory?this._templateFactory.changeContent(t):this._templateFactory=new Ny({...this._config,content:t,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[$y]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(t){return this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Co)}_isShown(){return this.tip&&this.tip.classList.contains(zn)}_createPopper(t){const e=Ee(this._config.placement,[this,t,this._element]),s=Jy[e.toUpperCase()];return uh(this._element,t,this._getPopperConfig(s))}_getOffset(){const{offset:t}=this._config;return typeof t=="string"?t.split(",").map(e=>Number.parseInt(e,10)):typeof t=="function"?e=>t(e,this._element):t}_resolvePossibleFunction(t){return Ee(t,[this._element,this._element])}_getPopperConfig(t){const e={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:s=>{this._getTipElement().setAttribute("data-popper-placement",s.state.placement)}}]};return{...e,...Ee(this._config.popperConfig,[void 0,e])}}_setListeners(){const t=this._config.trigger.split(" ");for(const e of t)if(e==="click")V.on(this._element,this.constructor.eventName(jy),this._config.selector,s=>{this._initializeOnDelegatedTarget(s).toggle()});else if(e!==zy){const s=e===Gr?this.constructor.eventName(Zy):this.constructor.eventName(Yy),r=e===Gr?this.constructor.eventName(Qy):this.constructor.eventName(Xy);V.on(this._element,s,this._config.selector,a=>{const c=this._initializeOnDelegatedTarget(a);c._activeTrigger[a.type==="focusin"?wo:Gr]=!0,c._enter()}),V.on(this._element,r,this._config.selector,a=>{const c=this._initializeOnDelegatedTarget(a);c._activeTrigger[a.type==="focusout"?wo:Gr]=c._element.contains(a.relatedTarget),c._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},V.on(this._element.closest(nu),au,this._hideModalHandler)}_fixTitle(){const t=this._element.getAttribute("title");t&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",t),this._element.setAttribute("data-bs-original-title",t),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(t,e){clearTimeout(this._timeout),this._timeout=setTimeout(t,e)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(t){const e=Ni.getDataAttributes(this._element);for(const s of Object.keys(e))Fy.has(s)&&delete e[s];return t={...e,...typeof t=="object"&&t?t:{}},t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t.container=t.container===!1?document.body:rs(t.container),typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),typeof t.title=="number"&&(t.title=t.title.toString()),typeof t.content=="number"&&(t.content=t.content.toString()),t}_getDelegateConfig(){const t={};for(const[e,s]of Object.entries(this._config))this.constructor.Default[e]!==s&&(t[e]=s);return t.selector=!1,t.trigger="manual",t}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(t){return this.each(function(){const e=Ar.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t]()}})}}Qe(Ar);const iv="popover",sv=".popover-header",rv=".popover-body",nv={...Ar.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},av={...Ar.DefaultType,content:"(null|string|element|function)"};class mh extends Ar{static get Default(){return nv}static get DefaultType(){return av}static get NAME(){return iv}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[sv]:this._getTitle(),[rv]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(t){return this.each(function(){const e=mh.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t]()}})}}Qe(mh);const ov="scrollspy",cv="bs.scrollspy",gh=`.${cv}`,hv=".data-api",lv=`activate${gh}`,ou=`click${gh}`,uv=`load${gh}${hv}`,fv="dropdown-item",Qs="active",dv='[data-bs-spy="scroll"]',So="[href]",pv=".nav, .list-group",cu=".nav-link",mv=".nav-item",gv=".list-group-item",_v=`${cu}, ${mv} > ${cu}, ${gv}`,xv=".dropdown",bv=".dropdown-toggle",yv={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},vv={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Ma extends ui{constructor(t,e){super(t,e),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return yv}static get DefaultType(){return vv}static get NAME(){return ov}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const t of this._observableSections.values())this._observer.observe(t)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(t){return t.target=rs(t.target)||document.body,t.rootMargin=t.offset?`${t.offset}px 0px -30%`:t.rootMargin,typeof t.threshold=="string"&&(t.threshold=t.threshold.split(",").map(e=>Number.parseFloat(e))),t}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(V.off(this._config.target,ou),V.on(this._config.target,ou,So,t=>{const e=this._observableSections.get(t.target.hash);if(e){t.preventDefault();const s=this._rootElement||window,r=e.offsetTop-this._element.offsetTop;if(s.scrollTo){s.scrollTo({top:r,behavior:"smooth"});return}s.scrollTop=r}}))}_getNewObserver(){const t={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(e=>this._observerCallback(e),t)}_observerCallback(t){const e=c=>this._targetLinks.get(`#${c.target.id}`),s=c=>{this._previousScrollData.visibleEntryTop=c.target.offsetTop,this._process(e(c))},r=(this._rootElement||document.documentElement).scrollTop,a=r>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=r;for(const c of t){if(!c.isIntersecting){this._activeTarget=null,this._clearActiveClass(e(c));continue}const h=c.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(a&&h){if(s(c),!r)return;continue}!a&&!h&&s(c)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const t=lt.find(So,this._config.target);for(const e of t){if(!e.hash||ns(e))continue;const s=lt.findOne(decodeURI(e.hash),this._element);Sr(s)&&(this._targetLinks.set(decodeURI(e.hash),e),this._observableSections.set(e.hash,s))}}_process(t){this._activeTarget!==t&&(this._clearActiveClass(this._config.target),this._activeTarget=t,t.classList.add(Qs),this._activateParents(t),V.trigger(this._element,lv,{relatedTarget:t}))}_activateParents(t){if(t.classList.contains(fv)){lt.findOne(bv,t.closest(xv)).classList.add(Qs);return}for(const e of lt.parents(t,pv))for(const s of lt.prev(e,_v))s.classList.add(Qs)}_clearActiveClass(t){t.classList.remove(Qs);const e=lt.find(`${So}.${Qs}`,t);for(const s of e)s.classList.remove(Qs)}static jQueryInterface(t){return this.each(function(){const e=Ma.getOrCreateInstance(this,t);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t]()}})}}V.on(window,uv,()=>{for(const i of lt.find(dv))Ma.getOrCreateInstance(i)});Qe(Ma);const Cv="tab",wv="bs.tab",Hs=`.${wv}`,Sv=`hide${Hs}`,Ev=`hidden${Hs}`,Av=`show${Hs}`,kv=`shown${Hs}`,Tv=`click${Hs}`,Dv=`keydown${Hs}`,Rv=`load${Hs}`,Lv="ArrowLeft",hu="ArrowRight",Pv="ArrowUp",lu="ArrowDown",Eo="Home",uu="End",ks="active",fu="fade",Ao="show",Iv="dropdown",$d=".dropdown-toggle",Ov=".dropdown-menu",ko=`:not(${$d})`,Mv='.list-group, .nav, [role="tablist"]',Nv=".nav-item, .list-group-item",Bv=`.nav-link${ko}, .list-group-item${ko}, [role="tab"]${ko}`,Hd='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',To=`${Bv}, ${Hd}`,Fv=`.${ks}[data-bs-toggle="tab"], .${ks}[data-bs-toggle="pill"], .${ks}[data-bs-toggle="list"]`;class br extends ui{constructor(t){super(t),this._parent=this._element.closest(Mv),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),V.on(this._element,Dv,e=>this._keydown(e)))}static get NAME(){return Cv}show(){const t=this._element;if(this._elemIsActive(t))return;const e=this._getActiveElem(),s=e?V.trigger(e,Sv,{relatedTarget:t}):null;V.trigger(t,Av,{relatedTarget:e}).defaultPrevented||s&&s.defaultPrevented||(this._deactivate(e,t),this._activate(t,e))}_activate(t,e){if(!t)return;t.classList.add(ks),this._activate(lt.getElementFromSelector(t));const s=()=>{if(t.getAttribute("role")!=="tab"){t.classList.add(Ao);return}t.removeAttribute("tabindex"),t.setAttribute("aria-selected",!0),this._toggleDropDown(t,!0),V.trigger(t,kv,{relatedTarget:e})};this._queueCallback(s,t,t.classList.contains(fu))}_deactivate(t,e){if(!t)return;t.classList.remove(ks),t.blur(),this._deactivate(lt.getElementFromSelector(t));const s=()=>{if(t.getAttribute("role")!=="tab"){t.classList.remove(Ao);return}t.setAttribute("aria-selected",!1),t.setAttribute("tabindex","-1"),this._toggleDropDown(t,!1),V.trigger(t,Ev,{relatedTarget:e})};this._queueCallback(s,t,t.classList.contains(fu))}_keydown(t){if(![Lv,hu,Pv,lu,Eo,uu].includes(t.key))return;t.stopPropagation(),t.preventDefault();const e=this._getChildren().filter(r=>!ns(r));let s;if([Eo,uu].includes(t.key))s=e[t.key===Eo?0:e.length-1];else{const r=[hu,lu].includes(t.key);s=fh(e,t.target,r,!0)}s&&(s.focus({preventScroll:!0}),br.getOrCreateInstance(s).show())}_getChildren(){return lt.find(To,this._parent)}_getActiveElem(){return this._getChildren().find(t=>this._elemIsActive(t))||null}_setInitialAttributes(t,e){this._setAttributeIfNotExists(t,"role","tablist");for(const s of e)this._setInitialAttributesOnChild(s)}_setInitialAttributesOnChild(t){t=this._getInnerElement(t);const e=this._elemIsActive(t),s=this._getOuterElement(t);t.setAttribute("aria-selected",e),s!==t&&this._setAttributeIfNotExists(s,"role","presentation"),e||t.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(t,"role","tab"),this._setInitialAttributesOnTargetPanel(t)}_setInitialAttributesOnTargetPanel(t){const e=lt.getElementFromSelector(t);e&&(this._setAttributeIfNotExists(e,"role","tabpanel"),t.id&&this._setAttributeIfNotExists(e,"aria-labelledby",`${t.id}`))}_toggleDropDown(t,e){const s=this._getOuterElement(t);if(!s.classList.contains(Iv))return;const r=(a,c)=>{const h=lt.findOne(a,s);h&&h.classList.toggle(c,e)};r($d,ks),r(Ov,Ao),s.setAttribute("aria-expanded",e)}_setAttributeIfNotExists(t,e,s){t.hasAttribute(e)||t.setAttribute(e,s)}_elemIsActive(t){return t.classList.contains(ks)}_getInnerElement(t){return t.matches(To)?t:lt.findOne(To,t)}_getOuterElement(t){return t.closest(Nv)||t}static jQueryInterface(t){return this.each(function(){const e=br.getOrCreateInstance(this);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t]()}})}}V.on(document,Tv,Hd,function(i){["A","AREA"].includes(this.tagName)&&i.preventDefault(),!ns(this)&&br.getOrCreateInstance(this).show()});V.on(window,Rv,()=>{for(const i of lt.find(Fv))br.getOrCreateInstance(i)});Qe(br);const Uv="toast",$v="bs.toast",fs=`.${$v}`,Hv=`mouseover${fs}`,zv=`mouseout${fs}`,Wv=`focusin${fs}`,Gv=`focusout${fs}`,Vv=`hide${fs}`,Kv=`hidden${fs}`,qv=`show${fs}`,jv=`shown${fs}`,Yv="fade",du="hide",Wn="show",Gn="showing",Xv={animation:"boolean",autohide:"boolean",delay:"number"},Zv={animation:!0,autohide:!0,delay:5e3};class Na extends ui{constructor(t,e){super(t,e),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Zv}static get DefaultType(){return Xv}static get NAME(){return Uv}show(){if(V.trigger(this._element,qv).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(Yv);const e=()=>{this._element.classList.remove(Gn),V.trigger(this._element,jv),this._maybeScheduleHide()};this._element.classList.remove(du),yn(this._element),this._element.classList.add(Wn,Gn),this._queueCallback(e,this._element,this._config.animation)}hide(){if(!this.isShown()||V.trigger(this._element,Vv).defaultPrevented)return;const e=()=>{this._element.classList.add(du),this._element.classList.remove(Gn,Wn),V.trigger(this._element,Kv)};this._element.classList.add(Gn),this._queueCallback(e,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Wn),super.dispose()}isShown(){return this._element.classList.contains(Wn)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(t,e){switch(t.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=e;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=e;break}}if(e){this._clearTimeout();return}const s=t.relatedTarget;this._element===s||this._element.contains(s)||this._maybeScheduleHide()}_setListeners(){V.on(this._element,Hv,t=>this._onInteraction(t,!0)),V.on(this._element,zv,t=>this._onInteraction(t,!1)),V.on(this._element,Wv,t=>this._onInteraction(t,!0)),V.on(this._element,Gv,t=>this._onInteraction(t,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(t){return this.each(function(){const e=Na.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t](this)}})}}Pa(Na);Qe(Na);const Qv="modulepreload",Jv=function(i){return"/"+i},pu={},tC=function(t,e,s){let r=Promise.resolve();if(e&&e.length>0){let c=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),m=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));r=c(e.map(d=>{if(d=Jv(d),d in pu)return;pu[d]=!0;const p=d.endsWith(".css"),b=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${b}`))return;const w=document.createElement("link");if(w.rel=p?"stylesheet":Qv,p||(w.as="script"),w.crossOrigin="",w.href=d,m&&w.setAttribute("nonce",m),document.head.appendChild(w),p)return new Promise((C,y)=>{w.addEventListener("load",C),w.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(c){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=c,window.dispatchEvent(h),!h.defaultPrevented)throw c}return r.then(c=>{for(const h of c||[])h.status==="rejected"&&a(h.reason);return t().catch(a)})};function kr(i){let t=i.length;for(;--t>=0;)i[t]=0}const eC=3,iC=258,zd=29,sC=256,rC=sC+1+zd,Wd=30,nC=512,aC=new Array((rC+2)*2);kr(aC);const oC=new Array(Wd*2);kr(oC);const cC=new Array(nC);kr(cC);const hC=new Array(iC-eC+1);kr(hC);const lC=new Array(zd);kr(lC);const uC=new Array(Wd);kr(uC);const fC=(i,t,e,s)=>{let r=i&65535|0,a=i>>>16&65535|0,c=0;for(;e!==0;){c=e>2e3?2e3:e,e-=c;do r=r+t[s++]|0,a=a+r|0;while(--c);r%=65521,a%=65521}return r|a<<16|0};var _c=fC;const dC=()=>{let i,t=[];for(var e=0;e<256;e++){i=e;for(var s=0;s<8;s++)i=i&1?3988292384^i>>>1:i>>>1;t[e]=i}return t},pC=new Uint32Array(dC()),mC=(i,t,e,s)=>{const r=pC,a=s+e;i^=-1;for(let c=s;c<a;c++)i=i>>>8^r[(i^t[c])&255];return i^-1};var bi=mC,xc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Gd={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const gC=(i,t)=>Object.prototype.hasOwnProperty.call(i,t);var _C=function(i){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const s in e)gC(e,s)&&(i[s]=e[s])}}return i},xC=i=>{let t=0;for(let s=0,r=i.length;s<r;s++)t+=i[s].length;const e=new Uint8Array(t);for(let s=0,r=0,a=i.length;s<a;s++){let c=i[s];e.set(c,r),r+=c.length}return e},Vd={assign:_C,flattenChunks:xC};let Kd=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Kd=!1}const cn=new Uint8Array(256);for(let i=0;i<256;i++)cn[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;cn[254]=cn[254]=1;var bC=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let t,e,s,r,a,c=i.length,h=0;for(r=0;r<c;r++)e=i.charCodeAt(r),(e&64512)===55296&&r+1<c&&(s=i.charCodeAt(r+1),(s&64512)===56320&&(e=65536+(e-55296<<10)+(s-56320),r++)),h+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(h),a=0,r=0;a<h;r++)e=i.charCodeAt(r),(e&64512)===55296&&r+1<c&&(s=i.charCodeAt(r+1),(s&64512)===56320&&(e=65536+(e-55296<<10)+(s-56320),r++)),e<128?t[a++]=e:e<2048?(t[a++]=192|e>>>6,t[a++]=128|e&63):e<65536?(t[a++]=224|e>>>12,t[a++]=128|e>>>6&63,t[a++]=128|e&63):(t[a++]=240|e>>>18,t[a++]=128|e>>>12&63,t[a++]=128|e>>>6&63,t[a++]=128|e&63);return t};const yC=(i,t)=>{if(t<65534&&i.subarray&&Kd)return String.fromCharCode.apply(null,i.length===t?i:i.subarray(0,t));let e="";for(let s=0;s<t;s++)e+=String.fromCharCode(i[s]);return e};var vC=(i,t)=>{const e=t||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,t));let s,r;const a=new Array(e*2);for(r=0,s=0;s<e;){let c=i[s++];if(c<128){a[r++]=c;continue}let h=cn[c];if(h>4){a[r++]=65533,s+=h-1;continue}for(c&=h===2?31:h===3?15:7;h>1&&s<e;)c=c<<6|i[s++]&63,h--;if(h>1){a[r++]=65533;continue}c<65536?a[r++]=c:(c-=65536,a[r++]=55296|c>>10&1023,a[r++]=56320|c&1023)}return yC(a,r)},CC=(i,t)=>{t=t||i.length,t>i.length&&(t=i.length);let e=t-1;for(;e>=0&&(i[e]&192)===128;)e--;return e<0||e===0?t:e+cn[i[e]]>t?e:t},bc={string2buf:bC,buf2string:vC,utf8border:CC};function wC(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var SC=wC;const Vn=16209,EC=16191;var AC=function(t,e){let s,r,a,c,h,m,d,p,b,w,C,y,R,U,M,X,Y,N,Q,rt,l,G,W,K;const Z=t.state;s=t.next_in,W=t.input,r=s+(t.avail_in-5),a=t.next_out,K=t.output,c=a-(e-t.avail_out),h=a+(t.avail_out-257),m=Z.dmax,d=Z.wsize,p=Z.whave,b=Z.wnext,w=Z.window,C=Z.hold,y=Z.bits,R=Z.lencode,U=Z.distcode,M=(1<<Z.lenbits)-1,X=(1<<Z.distbits)-1;t:do{y<15&&(C+=W[s++]<<y,y+=8,C+=W[s++]<<y,y+=8),Y=R[C&M];e:for(;;){if(N=Y>>>24,C>>>=N,y-=N,N=Y>>>16&255,N===0)K[a++]=Y&65535;else if(N&16){Q=Y&65535,N&=15,N&&(y<N&&(C+=W[s++]<<y,y+=8),Q+=C&(1<<N)-1,C>>>=N,y-=N),y<15&&(C+=W[s++]<<y,y+=8,C+=W[s++]<<y,y+=8),Y=U[C&X];i:for(;;){if(N=Y>>>24,C>>>=N,y-=N,N=Y>>>16&255,N&16){if(rt=Y&65535,N&=15,y<N&&(C+=W[s++]<<y,y+=8,y<N&&(C+=W[s++]<<y,y+=8)),rt+=C&(1<<N)-1,rt>m){t.msg="invalid distance too far back",Z.mode=Vn;break t}if(C>>>=N,y-=N,N=a-c,rt>N){if(N=rt-N,N>p&&Z.sane){t.msg="invalid distance too far back",Z.mode=Vn;break t}if(l=0,G=w,b===0){if(l+=d-N,N<Q){Q-=N;do K[a++]=w[l++];while(--N);l=a-rt,G=K}}else if(b<N){if(l+=d+b-N,N-=b,N<Q){Q-=N;do K[a++]=w[l++];while(--N);if(l=0,b<Q){N=b,Q-=N;do K[a++]=w[l++];while(--N);l=a-rt,G=K}}}else if(l+=b-N,N<Q){Q-=N;do K[a++]=w[l++];while(--N);l=a-rt,G=K}for(;Q>2;)K[a++]=G[l++],K[a++]=G[l++],K[a++]=G[l++],Q-=3;Q&&(K[a++]=G[l++],Q>1&&(K[a++]=G[l++]))}else{l=a-rt;do K[a++]=K[l++],K[a++]=K[l++],K[a++]=K[l++],Q-=3;while(Q>2);Q&&(K[a++]=K[l++],Q>1&&(K[a++]=K[l++]))}}else if((N&64)===0){Y=U[(Y&65535)+(C&(1<<N)-1)];continue i}else{t.msg="invalid distance code",Z.mode=Vn;break t}break}}else if((N&64)===0){Y=R[(Y&65535)+(C&(1<<N)-1)];continue e}else if(N&32){Z.mode=EC;break t}else{t.msg="invalid literal/length code",Z.mode=Vn;break t}break}}while(s<r&&a<h);Q=y>>3,s-=Q,y-=Q<<3,C&=(1<<y)-1,t.next_in=s,t.next_out=a,t.avail_in=s<r?5+(r-s):5-(s-r),t.avail_out=a<h?257+(h-a):257-(a-h),Z.hold=C,Z.bits=y};const Js=15,mu=852,gu=592,_u=0,Do=1,xu=2,kC=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),TC=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),DC=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),RC=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),LC=(i,t,e,s,r,a,c,h)=>{const m=h.bits;let d=0,p=0,b=0,w=0,C=0,y=0,R=0,U=0,M=0,X=0,Y,N,Q,rt,l,G=null,W;const K=new Uint16Array(Js+1),Z=new Uint16Array(Js+1);let dt=null,nt,pt,Bt;for(d=0;d<=Js;d++)K[d]=0;for(p=0;p<s;p++)K[t[e+p]]++;for(C=m,w=Js;w>=1&&K[w]===0;w--);if(C>w&&(C=w),w===0)return r[a++]=1<<24|64<<16|0,r[a++]=1<<24|64<<16|0,h.bits=1,0;for(b=1;b<w&&K[b]===0;b++);for(C<b&&(C=b),U=1,d=1;d<=Js;d++)if(U<<=1,U-=K[d],U<0)return-1;if(U>0&&(i===_u||w!==1))return-1;for(Z[1]=0,d=1;d<Js;d++)Z[d+1]=Z[d]+K[d];for(p=0;p<s;p++)t[e+p]!==0&&(c[Z[t[e+p]]++]=p);if(i===_u?(G=dt=c,W=20):i===Do?(G=kC,dt=TC,W=257):(G=DC,dt=RC,W=0),X=0,p=0,d=b,l=a,y=C,R=0,Q=-1,M=1<<C,rt=M-1,i===Do&&M>mu||i===xu&&M>gu)return 1;for(;;){nt=d-R,c[p]+1<W?(pt=0,Bt=c[p]):c[p]>=W?(pt=dt[c[p]-W],Bt=G[c[p]-W]):(pt=96,Bt=0),Y=1<<d-R,N=1<<y,b=N;do N-=Y,r[l+(X>>R)+N]=nt<<24|pt<<16|Bt|0;while(N!==0);for(Y=1<<d-1;X&Y;)Y>>=1;if(Y!==0?(X&=Y-1,X+=Y):X=0,p++,--K[d]===0){if(d===w)break;d=t[e+c[p]]}if(d>C&&(X&rt)!==Q){for(R===0&&(R=C),l+=b,y=d-R,U=1<<y;y+R<w&&(U-=K[y+R],!(U<=0));)y++,U<<=1;if(M+=1<<y,i===Do&&M>mu||i===xu&&M>gu)return 1;Q=X&rt,r[Q]=C<<24|y<<16|l-a|0}}return X!==0&&(r[l+X]=d-R<<24|64<<16|0),h.bits=C,0};var Jr=LC;const PC=0,qd=1,jd=2,{Z_FINISH:bu,Z_BLOCK:IC,Z_TREES:Kn,Z_OK:Os,Z_STREAM_END:OC,Z_NEED_DICT:MC,Z_STREAM_ERROR:Xe,Z_DATA_ERROR:Yd,Z_MEM_ERROR:Xd,Z_BUF_ERROR:NC,Z_DEFLATED:yu}=Gd,Ba=16180,vu=16181,Cu=16182,wu=16183,Su=16184,Eu=16185,Au=16186,ku=16187,Tu=16188,Du=16189,Ca=16190,Ti=16191,Ro=16192,Ru=16193,Lo=16194,Lu=16195,Pu=16196,Iu=16197,Ou=16198,qn=16199,jn=16200,Mu=16201,Nu=16202,Bu=16203,Fu=16204,Uu=16205,Po=16206,$u=16207,Hu=16208,Ut=16209,Zd=16210,Qd=16211,BC=852,FC=592,UC=15,$C=UC,zu=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function HC(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const zs=i=>{if(!i)return 1;const t=i.state;return!t||t.strm!==i||t.mode<Ba||t.mode>Qd?1:0},Jd=i=>{if(zs(i))return Xe;const t=i.state;return i.total_in=i.total_out=t.total=0,i.msg="",t.wrap&&(i.adler=t.wrap&1),t.mode=Ba,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(BC),t.distcode=t.distdyn=new Int32Array(FC),t.sane=1,t.back=-1,Os},tp=i=>{if(zs(i))return Xe;const t=i.state;return t.wsize=0,t.whave=0,t.wnext=0,Jd(i)},ep=(i,t)=>{let e;if(zs(i))return Xe;const s=i.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Xe:(s.window!==null&&s.wbits!==t&&(s.window=null),s.wrap=e,s.wbits=t,tp(i))},ip=(i,t)=>{if(!i)return Xe;const e=new HC;i.state=e,e.strm=i,e.window=null,e.mode=Ba;const s=ep(i,t);return s!==Os&&(i.state=null),s},zC=i=>ip(i,$C);let Wu=!0,Io,Oo;const WC=i=>{if(Wu){Io=new Int32Array(512),Oo=new Int32Array(32);let t=0;for(;t<144;)i.lens[t++]=8;for(;t<256;)i.lens[t++]=9;for(;t<280;)i.lens[t++]=7;for(;t<288;)i.lens[t++]=8;for(Jr(qd,i.lens,0,288,Io,0,i.work,{bits:9}),t=0;t<32;)i.lens[t++]=5;Jr(jd,i.lens,0,32,Oo,0,i.work,{bits:5}),Wu=!1}i.lencode=Io,i.lenbits=9,i.distcode=Oo,i.distbits=5},sp=(i,t,e,s)=>{let r;const a=i.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),s>=a.wsize?(a.window.set(t.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>s&&(r=s),a.window.set(t.subarray(e-s,e-s+r),a.wnext),s-=r,s?(a.window.set(t.subarray(e-s,e),0),a.wnext=s,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0},GC=(i,t)=>{let e,s,r,a,c,h,m,d,p,b,w,C,y,R,U=0,M,X,Y,N,Q,rt,l,G;const W=new Uint8Array(4);let K,Z;const dt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(zs(i)||!i.output||!i.input&&i.avail_in!==0)return Xe;e=i.state,e.mode===Ti&&(e.mode=Ro),c=i.next_out,r=i.output,m=i.avail_out,a=i.next_in,s=i.input,h=i.avail_in,d=e.hold,p=e.bits,b=h,w=m,G=Os;t:for(;;)switch(e.mode){case Ba:if(e.wrap===0){e.mode=Ro;break}for(;p<16;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}if(e.wrap&2&&d===35615){e.wbits===0&&(e.wbits=15),e.check=0,W[0]=d&255,W[1]=d>>>8&255,e.check=bi(e.check,W,2,0),d=0,p=0,e.mode=vu;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((d&255)<<8)+(d>>8))%31){i.msg="incorrect header check",e.mode=Ut;break}if((d&15)!==yu){i.msg="unknown compression method",e.mode=Ut;break}if(d>>>=4,p-=4,l=(d&15)+8,e.wbits===0&&(e.wbits=l),l>15||l>e.wbits){i.msg="invalid window size",e.mode=Ut;break}e.dmax=1<<e.wbits,e.flags=0,i.adler=e.check=1,e.mode=d&512?Du:Ti,d=0,p=0;break;case vu:for(;p<16;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}if(e.flags=d,(e.flags&255)!==yu){i.msg="unknown compression method",e.mode=Ut;break}if(e.flags&57344){i.msg="unknown header flags set",e.mode=Ut;break}e.head&&(e.head.text=d>>8&1),e.flags&512&&e.wrap&4&&(W[0]=d&255,W[1]=d>>>8&255,e.check=bi(e.check,W,2,0)),d=0,p=0,e.mode=Cu;case Cu:for(;p<32;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}e.head&&(e.head.time=d),e.flags&512&&e.wrap&4&&(W[0]=d&255,W[1]=d>>>8&255,W[2]=d>>>16&255,W[3]=d>>>24&255,e.check=bi(e.check,W,4,0)),d=0,p=0,e.mode=wu;case wu:for(;p<16;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}e.head&&(e.head.xflags=d&255,e.head.os=d>>8),e.flags&512&&e.wrap&4&&(W[0]=d&255,W[1]=d>>>8&255,e.check=bi(e.check,W,2,0)),d=0,p=0,e.mode=Su;case Su:if(e.flags&1024){for(;p<16;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}e.length=d,e.head&&(e.head.extra_len=d),e.flags&512&&e.wrap&4&&(W[0]=d&255,W[1]=d>>>8&255,e.check=bi(e.check,W,2,0)),d=0,p=0}else e.head&&(e.head.extra=null);e.mode=Eu;case Eu:if(e.flags&1024&&(C=e.length,C>h&&(C=h),C&&(e.head&&(l=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(s.subarray(a,a+C),l)),e.flags&512&&e.wrap&4&&(e.check=bi(e.check,s,C,a)),h-=C,a+=C,e.length-=C),e.length))break t;e.length=0,e.mode=Au;case Au:if(e.flags&2048){if(h===0)break t;C=0;do l=s[a+C++],e.head&&l&&e.length<65536&&(e.head.name+=String.fromCharCode(l));while(l&&C<h);if(e.flags&512&&e.wrap&4&&(e.check=bi(e.check,s,C,a)),h-=C,a+=C,l)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=ku;case ku:if(e.flags&4096){if(h===0)break t;C=0;do l=s[a+C++],e.head&&l&&e.length<65536&&(e.head.comment+=String.fromCharCode(l));while(l&&C<h);if(e.flags&512&&e.wrap&4&&(e.check=bi(e.check,s,C,a)),h-=C,a+=C,l)break t}else e.head&&(e.head.comment=null);e.mode=Tu;case Tu:if(e.flags&512){for(;p<16;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}if(e.wrap&4&&d!==(e.check&65535)){i.msg="header crc mismatch",e.mode=Ut;break}d=0,p=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),i.adler=e.check=0,e.mode=Ti;break;case Du:for(;p<32;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}i.adler=e.check=zu(d),d=0,p=0,e.mode=Ca;case Ca:if(e.havedict===0)return i.next_out=c,i.avail_out=m,i.next_in=a,i.avail_in=h,e.hold=d,e.bits=p,MC;i.adler=e.check=1,e.mode=Ti;case Ti:if(t===IC||t===Kn)break t;case Ro:if(e.last){d>>>=p&7,p-=p&7,e.mode=Po;break}for(;p<3;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}switch(e.last=d&1,d>>>=1,p-=1,d&3){case 0:e.mode=Ru;break;case 1:if(WC(e),e.mode=qn,t===Kn){d>>>=2,p-=2;break t}break;case 2:e.mode=Pu;break;case 3:i.msg="invalid block type",e.mode=Ut}d>>>=2,p-=2;break;case Ru:for(d>>>=p&7,p-=p&7;p<32;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}if((d&65535)!==(d>>>16^65535)){i.msg="invalid stored block lengths",e.mode=Ut;break}if(e.length=d&65535,d=0,p=0,e.mode=Lo,t===Kn)break t;case Lo:e.mode=Lu;case Lu:if(C=e.length,C){if(C>h&&(C=h),C>m&&(C=m),C===0)break t;r.set(s.subarray(a,a+C),c),h-=C,a+=C,m-=C,c+=C,e.length-=C;break}e.mode=Ti;break;case Pu:for(;p<14;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}if(e.nlen=(d&31)+257,d>>>=5,p-=5,e.ndist=(d&31)+1,d>>>=5,p-=5,e.ncode=(d&15)+4,d>>>=4,p-=4,e.nlen>286||e.ndist>30){i.msg="too many length or distance symbols",e.mode=Ut;break}e.have=0,e.mode=Iu;case Iu:for(;e.have<e.ncode;){for(;p<3;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}e.lens[dt[e.have++]]=d&7,d>>>=3,p-=3}for(;e.have<19;)e.lens[dt[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,K={bits:e.lenbits},G=Jr(PC,e.lens,0,19,e.lencode,0,e.work,K),e.lenbits=K.bits,G){i.msg="invalid code lengths set",e.mode=Ut;break}e.have=0,e.mode=Ou;case Ou:for(;e.have<e.nlen+e.ndist;){for(;U=e.lencode[d&(1<<e.lenbits)-1],M=U>>>24,X=U>>>16&255,Y=U&65535,!(M<=p);){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}if(Y<16)d>>>=M,p-=M,e.lens[e.have++]=Y;else{if(Y===16){for(Z=M+2;p<Z;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}if(d>>>=M,p-=M,e.have===0){i.msg="invalid bit length repeat",e.mode=Ut;break}l=e.lens[e.have-1],C=3+(d&3),d>>>=2,p-=2}else if(Y===17){for(Z=M+3;p<Z;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}d>>>=M,p-=M,l=0,C=3+(d&7),d>>>=3,p-=3}else{for(Z=M+7;p<Z;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}d>>>=M,p-=M,l=0,C=11+(d&127),d>>>=7,p-=7}if(e.have+C>e.nlen+e.ndist){i.msg="invalid bit length repeat",e.mode=Ut;break}for(;C--;)e.lens[e.have++]=l}}if(e.mode===Ut)break;if(e.lens[256]===0){i.msg="invalid code -- missing end-of-block",e.mode=Ut;break}if(e.lenbits=9,K={bits:e.lenbits},G=Jr(qd,e.lens,0,e.nlen,e.lencode,0,e.work,K),e.lenbits=K.bits,G){i.msg="invalid literal/lengths set",e.mode=Ut;break}if(e.distbits=6,e.distcode=e.distdyn,K={bits:e.distbits},G=Jr(jd,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,K),e.distbits=K.bits,G){i.msg="invalid distances set",e.mode=Ut;break}if(e.mode=qn,t===Kn)break t;case qn:e.mode=jn;case jn:if(h>=6&&m>=258){i.next_out=c,i.avail_out=m,i.next_in=a,i.avail_in=h,e.hold=d,e.bits=p,AC(i,w),c=i.next_out,r=i.output,m=i.avail_out,a=i.next_in,s=i.input,h=i.avail_in,d=e.hold,p=e.bits,e.mode===Ti&&(e.back=-1);break}for(e.back=0;U=e.lencode[d&(1<<e.lenbits)-1],M=U>>>24,X=U>>>16&255,Y=U&65535,!(M<=p);){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}if(X&&(X&240)===0){for(N=M,Q=X,rt=Y;U=e.lencode[rt+((d&(1<<N+Q)-1)>>N)],M=U>>>24,X=U>>>16&255,Y=U&65535,!(N+M<=p);){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}d>>>=N,p-=N,e.back+=N}if(d>>>=M,p-=M,e.back+=M,e.length=Y,X===0){e.mode=Uu;break}if(X&32){e.back=-1,e.mode=Ti;break}if(X&64){i.msg="invalid literal/length code",e.mode=Ut;break}e.extra=X&15,e.mode=Mu;case Mu:if(e.extra){for(Z=e.extra;p<Z;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}e.length+=d&(1<<e.extra)-1,d>>>=e.extra,p-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Nu;case Nu:for(;U=e.distcode[d&(1<<e.distbits)-1],M=U>>>24,X=U>>>16&255,Y=U&65535,!(M<=p);){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}if((X&240)===0){for(N=M,Q=X,rt=Y;U=e.distcode[rt+((d&(1<<N+Q)-1)>>N)],M=U>>>24,X=U>>>16&255,Y=U&65535,!(N+M<=p);){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}d>>>=N,p-=N,e.back+=N}if(d>>>=M,p-=M,e.back+=M,X&64){i.msg="invalid distance code",e.mode=Ut;break}e.offset=Y,e.extra=X&15,e.mode=Bu;case Bu:if(e.extra){for(Z=e.extra;p<Z;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}e.offset+=d&(1<<e.extra)-1,d>>>=e.extra,p-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){i.msg="invalid distance too far back",e.mode=Ut;break}e.mode=Fu;case Fu:if(m===0)break t;if(C=w-m,e.offset>C){if(C=e.offset-C,C>e.whave&&e.sane){i.msg="invalid distance too far back",e.mode=Ut;break}C>e.wnext?(C-=e.wnext,y=e.wsize-C):y=e.wnext-C,C>e.length&&(C=e.length),R=e.window}else R=r,y=c-e.offset,C=e.length;C>m&&(C=m),m-=C,e.length-=C;do r[c++]=R[y++];while(--C);e.length===0&&(e.mode=jn);break;case Uu:if(m===0)break t;r[c++]=e.length,m--,e.mode=jn;break;case Po:if(e.wrap){for(;p<32;){if(h===0)break t;h--,d|=s[a++]<<p,p+=8}if(w-=m,i.total_out+=w,e.total+=w,e.wrap&4&&w&&(i.adler=e.check=e.flags?bi(e.check,r,w,c-w):_c(e.check,r,w,c-w)),w=m,e.wrap&4&&(e.flags?d:zu(d))!==e.check){i.msg="incorrect data check",e.mode=Ut;break}d=0,p=0}e.mode=$u;case $u:if(e.wrap&&e.flags){for(;p<32;){if(h===0)break t;h--,d+=s[a++]<<p,p+=8}if(e.wrap&4&&d!==(e.total&4294967295)){i.msg="incorrect length check",e.mode=Ut;break}d=0,p=0}e.mode=Hu;case Hu:G=OC;break t;case Ut:G=Yd;break t;case Zd:return Xd;case Qd:default:return Xe}return i.next_out=c,i.avail_out=m,i.next_in=a,i.avail_in=h,e.hold=d,e.bits=p,(e.wsize||w!==i.avail_out&&e.mode<Ut&&(e.mode<Po||t!==bu))&&sp(i,i.output,i.next_out,w-i.avail_out),b-=i.avail_in,w-=i.avail_out,i.total_in+=b,i.total_out+=w,e.total+=w,e.wrap&4&&w&&(i.adler=e.check=e.flags?bi(e.check,r,w,i.next_out-w):_c(e.check,r,w,i.next_out-w)),i.data_type=e.bits+(e.last?64:0)+(e.mode===Ti?128:0)+(e.mode===qn||e.mode===Lo?256:0),(b===0&&w===0||t===bu)&&G===Os&&(G=NC),G},VC=i=>{if(zs(i))return Xe;let t=i.state;return t.window&&(t.window=null),i.state=null,Os},KC=(i,t)=>{if(zs(i))return Xe;const e=i.state;return(e.wrap&2)===0?Xe:(e.head=t,t.done=!1,Os)},qC=(i,t)=>{const e=t.length;let s,r,a;return zs(i)||(s=i.state,s.wrap!==0&&s.mode!==Ca)?Xe:s.mode===Ca&&(r=1,r=_c(r,t,e,0),r!==s.check)?Yd:(a=sp(i,t,e,e),a?(s.mode=Zd,Xd):(s.havedict=1,Os))};var jC=tp,YC=ep,XC=Jd,ZC=zC,QC=ip,JC=GC,tw=VC,ew=KC,iw=qC,sw="pako inflate (from Nodeca project)",Pi={inflateReset:jC,inflateReset2:YC,inflateResetKeep:XC,inflateInit:ZC,inflateInit2:QC,inflate:JC,inflateEnd:tw,inflateGetHeader:ew,inflateSetDictionary:iw,inflateInfo:sw};function rw(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var nw=rw;const rp=Object.prototype.toString,{Z_NO_FLUSH:aw,Z_FINISH:ow,Z_OK:hn,Z_STREAM_END:Mo,Z_NEED_DICT:No,Z_STREAM_ERROR:cw,Z_DATA_ERROR:Gu,Z_MEM_ERROR:hw}=Gd;function Fa(i){this.options=Vd.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(i&&i.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new SC,this.strm.avail_out=0;let e=Pi.inflateInit2(this.strm,t.windowBits);if(e!==hn)throw new Error(xc[e]);if(this.header=new nw,Pi.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=bc.string2buf(t.dictionary):rp.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=Pi.inflateSetDictionary(this.strm,t.dictionary),e!==hn)))throw new Error(xc[e])}Fa.prototype.push=function(i,t){const e=this.strm,s=this.options.chunkSize,r=this.options.dictionary;let a,c,h;if(this.ended)return!1;for(t===~~t?c=t:c=t===!0?ow:aw,rp.call(i)==="[object ArrayBuffer]"?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(s),e.next_out=0,e.avail_out=s),a=Pi.inflate(e,c),a===No&&r&&(a=Pi.inflateSetDictionary(e,r),a===hn?a=Pi.inflate(e,c):a===Gu&&(a=No));e.avail_in>0&&a===Mo&&e.state.wrap>0&&i[e.next_in]!==0;)Pi.inflateReset(e),a=Pi.inflate(e,c);switch(a){case cw:case Gu:case No:case hw:return this.onEnd(a),this.ended=!0,!1}if(h=e.avail_out,e.next_out&&(e.avail_out===0||a===Mo))if(this.options.to==="string"){let m=bc.utf8border(e.output,e.next_out),d=e.next_out-m,p=bc.buf2string(e.output,m);e.next_out=d,e.avail_out=s-d,d&&e.output.set(e.output.subarray(m,m+d),0),this.onData(p)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===hn&&h===0)){if(a===Mo)return a=Pi.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Fa.prototype.onData=function(i){this.chunks.push(i)};Fa.prototype.onEnd=function(i){i===hn&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Vd.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function lw(i,t){const e=new Fa(t);if(e.push(i),e.err)throw e.msg||xc[e.err];return e.result}var uw=lw,fw={ungzip:uw};const{ungzip:dw}=fw;var pw=dw,Pe=Uint8Array,hr=Uint16Array,mw=Int32Array,np=new Pe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ap=new Pe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gw=new Pe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),op=function(i,t){for(var e=new hr(31),s=0;s<31;++s)e[s]=t+=1<<i[s-1];for(var r=new mw(e[30]),s=1;s<30;++s)for(var a=e[s];a<e[s+1];++a)r[a]=a-e[s]<<5|s;return{b:e,r}},cp=op(np,2),hp=cp.b,_w=cp.r;hp[28]=258,_w[258]=28;var xw=op(ap,0),bw=xw.b,yc=new hr(32768);for(var Nt=0;Nt<32768;++Nt){var Yi=(Nt&43690)>>1|(Nt&21845)<<1;Yi=(Yi&52428)>>2|(Yi&13107)<<2,Yi=(Yi&61680)>>4|(Yi&3855)<<4,yc[Nt]=((Yi&65280)>>8|(Yi&255)<<8)>>1}var tn=function(i,t,e){for(var s=i.length,r=0,a=new hr(t);r<s;++r)i[r]&&++a[i[r]-1];var c=new hr(t);for(r=1;r<t;++r)c[r]=c[r-1]+a[r-1]<<1;var h;if(e){h=new hr(1<<t);var m=15-t;for(r=0;r<s;++r)if(i[r])for(var d=r<<4|i[r],p=t-i[r],b=c[i[r]-1]++<<p,w=b|(1<<p)-1;b<=w;++b)h[yc[b]>>m]=d}else for(h=new hr(s),r=0;r<s;++r)i[r]&&(h[r]=yc[c[i[r]-1]++]>>15-i[r]);return h},Sn=new Pe(288);for(var Nt=0;Nt<144;++Nt)Sn[Nt]=8;for(var Nt=144;Nt<256;++Nt)Sn[Nt]=9;for(var Nt=256;Nt<280;++Nt)Sn[Nt]=7;for(var Nt=280;Nt<288;++Nt)Sn[Nt]=8;var lp=new Pe(32);for(var Nt=0;Nt<32;++Nt)lp[Nt]=5;var yw=tn(Sn,9,1),vw=tn(lp,5,1),Bo=function(i){for(var t=i[0],e=1;e<i.length;++e)i[e]>t&&(t=i[e]);return t},ri=function(i,t,e){var s=t/8|0;return(i[s]|i[s+1]<<8)>>(t&7)&e},Fo=function(i,t){var e=t/8|0;return(i[e]|i[e+1]<<8|i[e+2]<<16)>>(t&7)},Cw=function(i){return(i+7)/8|0},_h=function(i,t,e){return(t==null||t<0)&&(t=0),(e==null||e>i.length)&&(e=i.length),new Pe(i.subarray(t,e))},ww=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ge=function(i,t,e){var s=new Error(t||ww[i]);if(s.code=i,Error.captureStackTrace&&Error.captureStackTrace(s,Ge),!e)throw s;return s},Sw=function(i,t,e,s){var r=i.length,a=s?s.length:0;if(!r||t.f&&!t.l)return e||new Pe(0);var c=!e,h=c||t.i!=2,m=t.i;c&&(e=new Pe(r*3));var d=function(di){var fe=e.length;if(di>fe){var Ue=new Pe(Math.max(fe*2,di));Ue.set(e),e=Ue}},p=t.f||0,b=t.p||0,w=t.b||0,C=t.l,y=t.d,R=t.m,U=t.n,M=r*8;do{if(!C){p=ri(i,b,1);var X=ri(i,b+1,3);if(b+=3,X)if(X==1)C=yw,y=vw,R=9,U=5;else if(X==2){var rt=ri(i,b,31)+257,l=ri(i,b+10,15)+4,G=rt+ri(i,b+5,31)+1;b+=14;for(var W=new Pe(G),K=new Pe(19),Z=0;Z<l;++Z)K[gw[Z]]=ri(i,b+Z*3,7);b+=l*3;for(var dt=Bo(K),nt=(1<<dt)-1,pt=tn(K,dt,1),Z=0;Z<G;){var Bt=pt[ri(i,b,nt)];b+=Bt&15;var Y=Bt>>4;if(Y<16)W[Z++]=Y;else{var It=0,Dt=0;for(Y==16?(Dt=3+ri(i,b,3),b+=2,It=W[Z-1]):Y==17?(Dt=3+ri(i,b,7),b+=3):Y==18&&(Dt=11+ri(i,b,127),b+=7);Dt--;)W[Z++]=It}}var re=W.subarray(0,rt),Pt=W.subarray(rt);R=Bo(re),U=Bo(Pt),C=tn(re,R,1),y=tn(Pt,U,1)}else Ge(1);else{var Y=Cw(b)+4,N=i[Y-4]|i[Y-3]<<8,Q=Y+N;if(Q>r){m&&Ge(0);break}h&&d(w+N),e.set(i.subarray(Y,Q),w),t.b=w+=N,t.p=b=Q*8,t.f=p;continue}if(b>M){m&&Ge(0);break}}h&&d(w+131072);for(var Be=(1<<R)-1,Je=(1<<U)-1,le=b;;le=b){var It=C[Fo(i,b)&Be],Ft=It>>4;if(b+=It&15,b>M){m&&Ge(0);break}if(It||Ge(2),Ft<256)e[w++]=Ft;else if(Ft==256){le=b,C=null;break}else{var ue=Ft-254;if(Ft>264){var Z=Ft-257,zt=np[Z];ue=ri(i,b,(1<<zt)-1)+hp[Z],b+=zt}var De=y[Fo(i,b)&Je],Fe=De>>4;De||Ge(3),b+=De&15;var Pt=bw[Fe];if(Fe>3){var zt=ap[Fe];Pt+=Fo(i,b)&(1<<zt)-1,b+=zt}if(b>M){m&&Ge(0);break}h&&d(w+131072);var ye=w+ue;if(w<Pt){var ti=a-Pt,Xt=Math.min(Pt,ye);for(ti+w<0&&Ge(3);w<Xt;++w)e[w]=s[ti+w]}for(;w<ye;++w)e[w]=e[w-Pt]}}t.l=C,t.p=le,t.b=w,t.f=p,C&&(p=1,t.m=R,t.d=y,t.n=U)}while(!p);return w!=e.length&&c?_h(e,0,w):e.subarray(0,w)},Ew=new Pe(0),yi=function(i,t){return i[t]|i[t+1]<<8},oi=function(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16|i[t+3]<<24)>>>0},Uo=function(i,t){return oi(i,t)+oi(i,t+4)*4294967296};function Aw(i,t){return Sw(i,{i:2},t&&t.out,t&&t.dictionary)}var vc=typeof TextDecoder<"u"&&new TextDecoder,kw=0;try{vc.decode(Ew,{stream:!0}),kw=1}catch{}var Tw=function(i){for(var t="",e=0;;){var s=i[e++],r=(s>127)+(s>223)+(s>239);if(e+r>i.length)return{s:t,r:_h(i,e-1)};r?r==3?(s=((s&15)<<18|(i[e++]&63)<<12|(i[e++]&63)<<6|i[e++]&63)-65536,t+=String.fromCharCode(55296|s>>10,56320|s&1023)):r&1?t+=String.fromCharCode((s&31)<<6|i[e++]&63):t+=String.fromCharCode((s&15)<<12|(i[e++]&63)<<6|i[e++]&63):t+=String.fromCharCode(s)}};function Dw(i,t){if(t){for(var e="",s=0;s<i.length;s+=16384)e+=String.fromCharCode.apply(null,i.subarray(s,s+16384));return e}else{if(vc)return vc.decode(i);var r=Tw(i),a=r.s,e=r.r;return e.length&&Ge(8),a}}var Rw=function(i,t){return t+30+yi(i,t+26)+yi(i,t+28)},Lw=function(i,t,e){var s=yi(i,t+28),r=Dw(i.subarray(t+46,t+46+s),!(yi(i,t+8)&2048)),a=t+46+s,c=oi(i,t+20),h=e&&c==4294967295?Pw(i,a):[c,oi(i,t+24),oi(i,t+42)],m=h[0],d=h[1],p=h[2];return[yi(i,t+10),m,d,r,a+yi(i,t+30)+yi(i,t+32),p]},Pw=function(i,t){for(;yi(i,t)!=1;t+=4+yi(i,t+2));return[Uo(i,t+12),Uo(i,t+4),Uo(i,t+20)]};function Iw(i,t){for(var e={},s=i.length-22;oi(i,s)!=101010256;--s)(!s||i.length-s>65558)&&Ge(13);var r=yi(i,s+8);if(!r)return{};var a=oi(i,s+16),c=a==4294967295||r==65535;if(c){var h=oi(i,s-12);c=oi(i,h)==101075792,c&&(r=oi(i,h+32),a=oi(i,h+48))}for(var m=0;m<r;++m){var d=Lw(i,a,c),p=d[0],b=d[1],w=d[2],C=d[3],y=d[4],R=d[5],U=Rw(i,R);a=y,p?p==8?e[C]=Aw(i.subarray(U,U+b),{out:new Pe(w)}):Ge(14,"unknown compression type "+p):e[C]=_h(i,U,U+b)}return e}const Ua=typeof window>"u";function up(){return typeof InstallTrigger<"u"}function Ow(i){return i[0]==="$"||i[0]==="&"?parseInt(i.substring(1),16):i.indexOf("0x")===0?parseInt(i.substring(2),16):parseInt(i,16)}const Cc=[],A={SEMICOLON_PLUS:[7,5],MINUS:[7,1],LEFT_SQUARE_BRACKET:[8,3],RIGHT_SQUARE_BRACKET:[8,5],COMMA:[6,6],PERIOD:[7,6],SLASH:[8,6],SHIFTLOCK:[0,5],TAB:[0,6],RETURN:[9,4],DELETE:[9,5],COPY:[9,6],SHIFT:[0,0],ESCAPE:[0,7],CTRL:[1,0],CAPSLOCK:[0,4],LEFT:[9,1],UP:[9,3],RIGHT:[9,7],DOWN:[9,2],K0:[7,2],K1:[0,3],K2:[1,3],K3:[1,1],K4:[2,1],K5:[3,1],K6:[4,3],K7:[4,2],K8:[5,1],K9:[6,2],Q:[0,1],W:[1,2],E:[2,2],R:[3,3],T:[3,2],Y:[4,4],U:[5,3],I:[5,2],O:[6,3],P:[7,3],A:[1,4],S:[1,5],D:[2,3],F:[3,4],G:[3,5],H:[4,5],J:[5,4],K:[6,4],L:[6,5],Z:[1,6],X:[2,4],C:[2,5],V:[3,6],B:[4,6],N:[5,5],M:[5,6],F0:[0,2],F1:[1,7],F2:[2,7],F3:[3,7],F4:[4,1],F5:[4,7],F6:[5,7],F7:[6,1],F8:[6,7],F9:[7,7],SPACE:[2,6],UNDERSCORE_POUND:[8,2],AT:[7,4],COLON_STAR:[8,4],PIPE_BACKSLASH:[8,7],HAT_TILDE:[8,1],NUMPADPLUS:[10,3],NUMPADMINUS:[11,3],NUMPADSLASH:[10,4],NUMPADASTERISK:[11,5],NUMPAD7:[11,1],NUMPAD8:[10,2],NUMPAD9:[11,2],NUMPADHASH:[10,5],NUMPAD4:[10,7],NUMPAD5:[11,7],NUMPAD6:[10,1],NUMPAD_DELETE:[11,4],NUMPAD1:[11,6],NUMPAD2:[12,7],NUMPAD3:[12,6],NUMPADCOMMA:[12,5],NUMPAD0:[10,6],NUMPAD_DECIMAL_POINT:[12,4],NUMPADENTER:[12,3]};function En(i){const t=[];let e=!1,s=!0;for(let r=0;r<i.length;++r){const a=i.charCodeAt(r);let c=i.charAt(r),h=null,m=!1,d=!0;if(a>=65&&a<=90)h=A[c];else if(a>=97&&a<=122)c=String.fromCharCode(a-32),h=A[c],d=!1;else if(a>=48&&a<=57)h=A["K"+c];else if(a>=33&&a<=41)c=String.fromCharCode(a+16),h=A["K"+c],m=!0;else switch(c){case`
`:h=A.RETURN;break;case"	":h=A.TAB;break;case" ":h=A.SPACE;break;case"-":h=A.MINUS;break;case"=":h=A.MINUS,m=!0;break;case"^":h=A.HAT_TILDE;break;case"~":h=A.HAT_TILDE,m=!0;break;case"\\":h=A.PIPE_BACKSLASH;break;case"|":h=A.PIPE_BACKSLASH,m=!0;break;case"@":h=A.AT;break;case"[":h=A.LEFT_SQUARE_BRACKET;break;case"{":h=A.LEFT_SQUARE_BRACKET,m=!0;break;case"_":h=A.UNDERSCORE_POUND;break;case";":h=A.SEMICOLON_PLUS;break;case"+":h=A.SEMICOLON_PLUS,m=!0;break;case":":h=A.COLON_STAR;break;case"*":h=A.COLON_STAR,m=!0;break;case"]":h=A.RIGHT_SQUARE_BRACKET;break;case"}":h=A.RIGHT_SQUARE_BRACKET,m=!0;break;case",":h=A.COMMA;break;case"<":h=A.COMMA,m=!0;break;case".":h=A.PERIOD;break;case">":h=A.PERIOD,m=!0;break;case"/":h=A.SLASH;break;case"?":h=A.SLASH,m=!0;break}h&&((m&&!e||!m&&e)&&(t.push(A.SHIFT),e=!e),(d&&!s||!d&&s)&&(t.push(A.CAPSLOCK),s=!s),t.push(h))}return e&&t.push(A.SHIFT),s||t.push(A.CAPSLOCK),t}const k={UNDEFINED:0,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,BREAK:19,CAPSLOCK:20,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINTSCREEN:44,INSERT:45,DELETE:46,K0:48,K1:49,K2:50,K3:51,K4:52,K5:53,K6:54,K7:55,K8:56,K9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOWS:91,MENU:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPADASTERISK:106,NUMPADPLUS:107,NUMPAD_DECIMAL_COMMA:108,NUMPADMINUS:109,NUMPAD_DECIMAL_POINT:110,NUMPADSLASH:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLL_LOCK:145,VOLUMEUP:174,VOLUMEDOWN:175,FASTFORWARD:176,FASTREWIND:177,PLAYPAUSE:179,COMMA:188,PERIOD:190,SLASH:191,LEFT_SQUARE_BRACKET:219,BACKSLASH:220,RIGHT_SQUARE_BRACKET:221,NUMPADENTER:255,SHIFT_LEFT:256,SHIFT_RIGHT:257,ALT_LEFT:258,ALT_RIGHT:259,CTRL_LEFT:260,CTRL_RIGHT:261};function Mw(){if(Ua)return"UK";if(localStorage.keyboardLayout)return localStorage.keyboardLayout==="US"?"US":"UK";if(navigator.language){if(navigator.language.toLowerCase()==="en-gb")return"UK";if(navigator.language.toLowerCase()==="en-us")return"US"}return"UK"}const ts=Mw()==="UK";up()?(k.SEMICOLON=59,k.HASH=163,k.APOSTROPHE=222,k.BACK_QUOTE=192,k.MUTE=-1,k.MINUS=173,k.EQUALS=61):(k.SEMICOLON=186,k.HASH=ts?222:223,k.APOSTROPHE=ts?192:222,k.MUTE=173,k.MINUS=189,k.EQUALS=187,k.BACK_QUOTE=ts?223:192);!Ua&&window.navigator.userAgent.indexOf("Mac")!==-1&&(k.BACK_QUOTE=192,k.APOSTROPHE=222,k.HASH=223);function Nw(i){const t=[];t[!0]={},t[!1]={};function e(r,a,c){t[c][r]&&t[c][r]!==a&&console.log("Warning: duplicate binding for key",(c?"<SHIFT>":"")+r,a,t[c][r]),t[c][r]=a}function s(r,a,c){(!r&&r!==0||!a)&&console.log("error binding key",r,a),typeof r=="string"&&(r=r.charCodeAt(0)),c===void 0?(e(r,a,!0),e(r,a,!1)):e(r,a,c)}for(s(k.Q,A.Q),s(k.W,A.W),s(k.E,A.E),s(k.R,A.R),s(k.T,A.T),s(k.Y,A.Y),s(k.U,A.U),s(k.I,A.I),s(k.O,A.O),s(k.P,A.P),s(k.A,A.A),s(k.S,A.S),s(k.D,A.D),s(k.F,A.F),s(k.G,A.G),s(k.H,A.H),s(k.J,A.J),s(k.K,A.K),s(k.L,A.L),s(k.Z,A.Z),s(k.X,A.X),s(k.C,A.C),s(k.V,A.V),s(k.B,A.B),s(k.N,A.N),s(k.M,A.M),s(k.F10,A.F0),s(k.F1,A.F1),s(k.F2,A.F2),s(k.F3,A.F3),s(k.F4,A.F4),s(k.F5,A.F5),s(k.F6,A.F6),s(k.F7,A.F7),s(k.F8,A.F8),s(k.F9,A.F9),s(k.COMMA,A.COMMA),s(k.PERIOD,A.PERIOD),s(k.SLASH,A.SLASH),s(k.SPACE,A.SPACE),s(k.TAB,A.TAB),s(k.ENTER,A.RETURN),s(k.SHIFT,A.SHIFT),s(k.SHIFT_RIGHT,A.SHIFT),s(k.LEFT,A.LEFT),s(k.UP,A.UP),s(k.RIGHT,A.RIGHT),s(k.DOWN,A.DOWN),i==="natural"?(s(k.SHIFT_LEFT,A.SHIFT),s(k.BACK_QUOTE,ts?A.UNDERSCORE_POUND:A.HAT_TILDE),s(k.APOSTROPHE,ts?A.AT:A.K2,!0),s(k.K2,ts?A.K2:A.AT,!0),s(k.K3,A.UNDERSCORE_POUND,!0),s(k.K7,A.K6,!0),s(k.K8,A.COLON_STAR,!0),s(k.K9,A.K8,!0),s(k.K0,A.K9,!0),s(k.K2,A.K2,!1),s(k.K3,A.K3,!1),s(k.K7,A.K7,!1),s(k.K8,A.K8,!1),s(k.K9,A.K9,!1),s(k.K0,A.K0,!1),s(k.K1,A.K1),s(k.K4,A.K4),s(k.K5,A.K5),s(k.K6,A.K6),s(k.MINUS,A.MINUS),s(k.LEFT_SQUARE_BRACKET,A.LEFT_SQUARE_BRACKET),s(k.RIGHT_SQUARE_BRACKET,A.RIGHT_SQUARE_BRACKET),s(k.SEMICOLON,A.SEMICOLON_PLUS),s(k.APOSTROPHE,A.COLON_STAR,!1),s(k.HASH,A.HAT_TILDE),s(k.EQUALS,A.SEMICOLON_PLUS),s(k.WINDOWS,A.SHIFTLOCK),s(k.END,A.COPY),s(k.F11,A.COPY),s(k.ESCAPE,A.ESCAPE),s(k.CTRL,A.CTRL),s(k.CTRL_LEFT,A.CTRL),s(k.CTRL_RIGHT,A.CTRL),s(k.CAPSLOCK,A.CAPSLOCK),s(k.DELETE,A.DELETE),s(k.BACKSPACE,A.DELETE),s(k.BACKSLASH,A.PIPE_BACKSLASH)):i==="gaming"?(s(k.ESCAPE,A.F0),s(k.BACK_QUOTE,A.ESCAPE),s(k.K1,A.K1),s(k.K2,A.K2),s(k.K3,A.K3),s(k.K4,A.K4),s(k.K5,A.K5),s(k.K6,A.K6),s(k.K7,A.K7),s(k.K8,A.K8),s(k.K9,A.K9),s(k.K0,A.K0),s(k.MINUS,A.MINUS),s(k.EQUALS,A.HAT_TILDE),s(k.BACKSPACE,A.PIPE_BACKSLASH),s(k.INSERT,A.LEFT),s(k.HOME,A.RIGHT),s(k.LEFT_SQUARE_BRACKET,A.AT),s(k.RIGHT_SQUARE_BRACKET,A.LEFT_SQUARE_BRACKET),s(k.DELETE,A.UP),s(k.END,A.DOWN),s(k.CAPSLOCK,A.CTRL),s(k.SEMICOLON,A.SEMICOLON_PLUS),s(k.APOSTROPHE,A.COLON_STAR),s(k.HASH,A.RIGHT_SQUARE_BRACKET),s(k.SHIFT_LEFT,ts?A.SHIFTLOCK:A.SHIFT),s(k.BACKSLASH,ts?A.SHIFT:A.UNDERSCORE_POUND),s(k.CTRL_LEFT,A.CAPSLOCK),s(k.ALT_LEFT,A.CTRL),s(k.MENU,A.DELETE),s(k.CTRL_RIGHT,A.COPY),s(k.ALT_RIGHT,A.SHIFTLOCK),s(k.WINDOWS,A.SHIFTLOCK)):(s(k.K1,A.K1),s(k.K2,A.K2),s(k.K3,A.K3),s(k.K4,A.K4),s(k.K5,A.K5),s(k.K6,A.K6),s(k.K7,A.K7),s(k.K8,A.K8),s(k.K9,A.K9),s(k.K0,A.K0),s(k.SHIFT_LEFT,A.SHIFT),s(k.EQUALS,A.HAT_TILDE),s(k.SEMICOLON,A.SEMICOLON_PLUS),s(k.MINUS,A.MINUS),s(k.LEFT_SQUARE_BRACKET,A.LEFT_SQUARE_BRACKET),s(k.RIGHT_SQUARE_BRACKET,A.RIGHT_SQUARE_BRACKET),s(k.COMMA,A.COMMA),s(k.PERIOD,A.PERIOD),s(k.SLASH,A.SLASH),s(k.WINDOWS,A.SHIFTLOCK),s(k.TAB,A.TAB),s(k.ENTER,A.RETURN),s(k.DELETE,A.DELETE),s(k.BACKSPACE,A.DELETE),s(k.END,A.COPY),s(k.F11,A.COPY),s(k.SHIFT,A.SHIFT),s(k.ESCAPE,A.ESCAPE),s(k.CTRL,A.CTRL),s(k.CTRL_LEFT,A.CTRL),s(k.CTRL_RIGHT,A.CTRL),s(k.CAPSLOCK,A.CAPSLOCK),s(k.LEFT,A.LEFT),s(k.UP,A.UP),s(k.RIGHT,A.RIGHT),s(k.DOWN,A.DOWN),s(k.APOSTROPHE,A.COLON_STAR),s(k.HASH,A.RIGHT_SQUARE_BRACKET),s(k.BACK_QUOTE,A.AT),s(k.BACKSLASH,A.PIPE_BACKSLASH),s(k.PAGEUP,A.UNDERSCORE_POUND)),s(k.NUMPAD0,A.NUMPAD0),s(k.NUMPAD1,A.NUMPAD1),s(k.NUMPAD2,A.NUMPAD2),s(k.NUMPAD3,A.NUMPAD3),s(k.NUMPAD4,A.NUMPAD4),s(k.NUMPAD5,A.NUMPAD5),s(k.NUMPAD6,A.NUMPAD6),s(k.NUMPAD7,A.NUMPAD7),s(k.NUMPAD8,A.NUMPAD8),s(k.NUMPAD9,A.NUMPAD9),s(k.NUMPAD_DECIMAL_POINT,A.NUMPAD_DECIMAL_POINT),s(k.NUMPADPLUS,A.NUMPADPLUS),s(k.NUMPADMINUS,A.NUMPADMINUS),s(k.NUMPADSLASH,A.NUMPADSLASH),s(k.NUMPADASTERISK,A.NUMPADASTERISK),s(k.NUMPADENTER,A.NUMPADENTER);Cc.length>0;){const r=Cc.pop();s(k[r.native],A[r.bbc])}return t}function ct(i){return(i>>>4&15).toString(16)+(i&15).toString(16)}function te(i){return ct(i>>>8)+ct(i&255)}function fp(i,t,e,s){s=s||{};const r=s.width||16,a=s.gap===void 0?8:s.gap,c=[];let h="",m=0;for(let p=t;p<e;++p)h+=" ",h+=ct(i(p)),++m===a&&(h+=" "),m===r&&(c.push(h),h="",m=0);h&&c.push(h);let d="";for(let p=0;p<c.length;++p)d+=te(t+p*r)+" :"+c[p]+`
`;return d}function dp(i){return i>=128?i-256:i}function wc(){}function Yt(i,t,e){!Ua&&(window.location.host.endsWith(".godbolt.org")||window.location.host.endsWith(".xania.org"))&&gtag("event",i,{type:t,label:e}),console.log("event noted:",i,t,e)}let Bw="";function pp(i){let t="";for(let e=0;e<i.length;++e)t+=String.fromCharCode(i[e]);return t}function An(i){if(i instanceof Uint8Array)return i;const t=i.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=i.charCodeAt(s)&255;return e}function Fw(i){return new Promise(function(t,e){const s=new XMLHttpRequest;s.open("GET",Bw+i,!0),s.overrideMimeType("text/plain; charset=x-user-defined"),s.onload=function(){s.status!==200&&e(new Error("Unable to load "+i+", http code "+s.status)),typeof s.response!="string"?t(s.response):t(An(s.response))},s.onerror=function(){e(new Error("A network error occurred loading "+i))},s.send(null)})}async function Uw(i){if(typeof readbuffer<"u")return new Uint8Array(readbuffer(i));if(typeof read<"u")return read(i,"binary");{const t=await tC(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]);return i[0]==="/"&&(i="."+i),t.existsSync("public/"+i)?t.readFileSync("public/"+i):t.readFileSync(i)}}function Ze(i){return Ua?Uw(i):Fw(i)}function $w(i,t){return i[t+3]<<24|i[t+2]<<16|i[t+1]<<8|i[t+0]}function Hw(i,t){return i[t+1]<<8|i[t+0]}const mp=new ArrayBuffer(4),Yn=new Uint8Array(mp),zw=new Float32Array(mp);function Ww(i,t){return Yn[0]=i[t],Yn[1]=i[t+1],Yn[2]=i[t+2],Yn[3]=i[t+3],zw[0]}function Gw(i){try{return pw(i)}catch(t){throw new Error("Unable to ungzip: "+t.message)}}class xh{constructor(t,e,s){if(this.name=t,this.pos=0,this.data=An(e),!s&&this.data&&this.data.length>4&&this.data[0]===31&&this.data[1]===139&&(console.log("Ungzipping "+t),this.data=Gw(this.data)),!this.data)throw new Error("No data in "+t);this.end=this.data.length}bytesLeft(){return this.end-this.pos}eof(){return this.bytesLeft()===0}advance(t){if(this.bytesLeft()<t)throw new RangeError("EOF in "+this.name);return this.pos+=t,this.pos-t}readFloat32(t){return t===void 0&&(t=this.advance(4)),Ww(this.data,t)}readInt32(t){return t===void 0&&(t=this.advance(4)),$w(this.data,t)}readInt16(t){return t===void 0&&(t=this.advance(2)),Hw(this.data,t)}readByte(t){return t===void 0&&(t=this.advance(1)),this.data[t]}readNulString(t,e){e||(e=1024);let s=t===void 0?this.pos:t,r="",a;for(;(a=this.readByte(s++))!==0&&--e;)r+=String.fromCharCode(a);return e===0?"":(t===void 0&&(this.pos=s),r)}substream(t,e){let s;if(e===void 0)e=t,s=this.advance(e);else if(s=t,s+e>=this.end)throw new RangeError("EOF in "+this.name);return new xh(this.name+".sub",this.data.subarray(s,s+e))}seek(t){if(t>=this.end)throw new RangeError("Seek out of range in "+this.name);this.pos=t}}function Ts(i){return new Int32Array(i.buffer)}const Vw={uef:!0,ssd:!0,dsd:!0,adl:!0},Kw={rom:!0};function gp(i,t){console.log("Attempting to unzip");let e;try{e=Iw(i instanceof Uint8Array?i:new Uint8Array(i))}catch(a){throw new Error("Error unzipping "+a.message)}let s=null,r;for(const[a,c]of Object.entries(e)){const h=a.match(/.*\.([a-z]+)/i);if(!h||!t[h[1].toLowerCase()]){console.log("Skipping file",a);continue}if(s){console.log("Ignoring",a,"as already found a file");continue}r=a,s=c}if(!s)throw new Error("Couldn't find any compatible files in the archive");return console.log("Unzipped '"+r+"'"),{data:s,name:r}}function ln(i){return gp(i,Vw)}function qw(i){return gp(i,Kw)}class jw{constructor(t){this._buffer=new Uint8Array(t),this._size=0,this._wPtr=0,this._rPtr=0}get size(){return this._size}get full(){return this._size===this._buffer.length}get empty(){return this._size===0}clear(){this._size=0,this._wPtr=0,this._rPtr=0}put(t){this.full||(this._buffer[this._wPtr%this._buffer.length]=t,this._wPtr++,this._size++)}get(){if(this.empty)return;const t=this._buffer[this._rPtr%this._buffer.length];return this._rPtr++,this._size--,t}}function Yw(){return new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,1,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,1,0,1,0,0,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,1,1,1,0,0,0,0,1,0,0,0,0,1,1,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,0,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,1,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,1,1,1,1,1,0,0,1,0,1,0,0,1,1,1,1,1,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,0,1,1,1,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,1,0,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0])}class Xw{constructor(){this.prevCol=0,this.col=7,this.bg=0,this.sep=!1,this.dbl=this.oldDbl=this.secondHalfOfDouble=this.wasDbl=!1,this.gfx=!1,this.flash=this.flashOn=!1,this.flashTime=0,this.heldChar=0,this.holdChar=!1,this.dataQueue=[0,0,0,0],this.scanlineCounter=0,this.levelDEW=!1,this.levelDISPTMG=!1,this.levelRA0=!1,this.normalGlyphs=Ts(new Uint32Array(96*20)),this.graphicsGlyphs=Ts(new Uint32Array(96*20)),this.separatedGlyphs=Ts(new Uint32Array(96*20)),this.colour=Ts(new Uint32Array(256)),this.nextGlyphs=this.normalGlyphs,this.curGlyphs=this.normalGlyphs,this.heldGlyphs=this.normalGlyphs,this.init()}init(){const t=Yw(),e=1/2.2;for(let h=0;h<256;++h){const m=(h&3)/3,d=!!(h&4),p=!!(h&8),b=!!(h&16),w=!!(h&32),C=!!(h&64),y=!!(h&128),R=Math.pow(d*m+w*(1-m),e)*240,U=Math.pow(p*m+C*(1-m),e)*240,M=Math.pow(b*m+y*(1-m),e)*240;this.colour[h]=R|U<<8|M<<16|255<<24}function s(h,m){if(m<0||m>=20)return 0;{let d=h*60+(m>>>1)*6,p=0;for(let b=0;b<6;++b)p|=t[d++]*3<<b*2;return p}}function r(h,m){return h|h>>>1&m&~(m>>>1)|h<<1&m&~(m<<1)}function a(h,m){let d=0;for(let p=0;p<96;++p)for(let b=0;b<20;++b){let w;!m||p&32?w=r(s(p,b),s(p,b+(b&1?1:-1))):w=s(p,b),h[d++]=(w&1)*7+(w&2)*20+(w&4)*52+(w&8)*224+(w&16)*640+(w&32)*1664+(w&64)*7168+(w&128)*20480+(w&256)*53248+(w&512)*229376+(w&1024)*655360+(w&2048)*1703936}}a(this.normalGlyphs,!1);function c(h,m,d,p,b,w,C){for(let y=0;y<b;++y)for(let R=0;R<p;++R)t[h*60+(d+y)*6+(m+R)]=w&&(R===0||y===b-1)?0:C}for(let h=0;h<96;++h)h&32||(c(h,0,0,3,3,!1,!!(h&1)),c(h,3,0,3,3,!1,!!(h&2)),c(h,0,3,3,4,!1,!!(h&4)),c(h,3,3,3,4,!1,!!(h&8)),c(h,0,7,3,3,!1,!!(h&16)),c(h,3,7,3,3,!1,!!(h&64)));a(this.graphicsGlyphs,!0);for(let h=0;h<96;++h)h&32||(c(h,0,0,3,3,!0,!!(h&1)),c(h,3,0,3,3,!0,!!(h&2)),c(h,0,3,3,4,!0,!!(h&4)),c(h,3,3,3,4,!0,!!(h&8)),c(h,0,7,3,3,!0,!!(h&16)),c(h,3,7,3,3,!0,!!(h&64)));a(this.separatedGlyphs,!0)}setNextChars(){this.gfx?this.sep?this.nextGlyphs=this.separatedGlyphs:this.nextGlyphs=this.graphicsGlyphs:this.nextGlyphs=this.normalGlyphs}handleControlCode(t){const e=this.gfx,s=this.holdChar;switch(t){case 1:case 2:case 3:case 4:case 5:case 6:case 7:this.gfx=!1,this.col=t,this.setNextChars();break;case 8:this.flash=!0;break;case 9:this.flash=!1;break;case 12:case 13:this.dbl=!!(t&1),this.dbl&&(this.wasDbl=!0);break;case 17:case 18:case 19:case 20:case 21:case 22:case 23:this.gfx=!0,this.col=t&7,this.setNextChars();break;case 24:this.col=this.prevCol=this.bg;break;case 25:this.sep=!1,this.setNextChars();break;case 26:this.sep=!0,this.setNextChars();break;case 28:this.bg=0;break;case 29:this.bg=this.col;break;case 30:this.holdChar=!0;break;case 31:this.holdChar=!1;break}return e&&(s||this.holdChar)&&this.dbl===this.oldDbl?(t=this.heldChar,t>=64&&t<96&&(t=32),this.curGlyphs=this.heldGlyphs):(this.heldChar=32,t=32),t}fetchData(t){this.dataQueue.shift(),this.dataQueue.push(t&127)}setDEW(t){const e=this.levelDEW;this.levelDEW=t,!(!e||t)&&(this.scanlineCounter=0,this.secondHalfOfDouble=!1,++this.flashTime===64&&(this.flashTime=0),this.flashOn=this.flashTime<16)}setDISPTMG(t){const e=this.levelDISPTMG;this.levelDISPTMG=t,!(!e||t)&&(this.col=7,this.bg=0,this.holdChar=!1,this.heldChar=32,this.nextGlyphs=this.heldGlyphs=this.normalGlyphs,this.flash=!1,this.sep=!1,this.gfx=!1,this.dbl=!1,this.scanlineCounter++,this.scanlineCounter===10&&(this.scanlineCounter=0,this.secondHalfOfDouble?this.secondHalfOfDouble=!1:this.secondHalfOfDouble=this.wasDbl),this.wasDbl=!1)}setRA0(t){this.levelRA0=t}render(t,e){let s=this.dataQueue[0],r=this.scanlineCounter<<1;this.levelRA0&&r++,this.oldDbl=this.dbl,this.prevCol=this.col,this.curGlyphs=this.nextGlyphs;const a=this.flash;s<32?s=this.handleControlCode(s):this.gfx?s&32&&(this.heldChar=s,this.heldGlyphs=this.curGlyphs):this.heldChar=32,this.oldDbl&&(r=r>>>1,this.secondHalfOfDouble&&(r+=10));let c=this.curGlyphs[(s-32)*20+r];if(a&&this.flashOn||this.secondHalfOfDouble&&!this.dbl){const h=this.colour[(this.bg&7)<<5];for(let m=0;m<16;++m)t[e++]=h}else{const h=(this.bg&7)<<5|(this.prevCol&7)<<2;for(let m=0;m<16;++m)t[e+m]=this.colour[h+(c&3)],c>>>=2}}}const ws=1,ar=2,Sc=4,fa=8,wa=16,qr=32,Vu=ws|ar|Sc|fa|wa|qr;class Zw{constructor(t){this.video=t}write(t,e){if(t|=0,e|=0,t&1){const s=e>>>4&15;this.video.actualPal[s]=e&15;let r=e&7;e&8&&this.video.ulactrl&1||(r^=7),this.video.ulaPal[s]!==this.video.collook[r]&&(this.video.ulaPal[s]=this.video.collook[r])}else{if((this.video.ulactrl^e)&1){const r=!!(e&1);for(let a=0;a<16;++a){let c=this.video.actualPal[a]&7;r&&this.video.actualPal[a]&8||(c^=7),this.video.ulaPal[a]!==this.video.collook[c]&&(this.video.ulaPal[a]=this.video.collook[c])}}this.video.ulactrl=e,this.video.pixelsPerChar=e&16?8:16,this.video.halfClock=!(e&16);const s=e>>>2&3;s!==this.video.ulaMode&&(this.video.ulaMode=s),this.video.teletextMode=!!(e&2)}}}class Qw{constructor(t){this.video=t,this.curReg=0,this.crtcmask=new Uint8Array([255,255,255,255,127,31,127,127,243,31,127,31,63,255,63,255,63,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}read(t){if(!(t&1))return 0;switch(this.curReg){case 12:case 13:case 14:case 15:case 16:case 17:return this.video.regs[this.curReg]}return 0}write(t,e){if(t&1)switch(this.video.regs[this.curReg]=e&this.crtcmask[this.curReg],this.curReg){case 3:this.video.hpulseWidth=e&15,this.video.vpulseWidth=(e&240)>>>4;break;case 8:{this.video.interlacedSyncAndVideo=(e&3)===3;const s=(e&48)>>>4;s<3?(this.video.displayEnableSkew=s,this.video.dispEnableSet(wa)):this.video.dispEnableClear(wa);break}case 14:case 15:this.video.cursorPos=(this.video.regs[15]|this.video.regs[14]<<8)&16383;break}else this.curReg=e&31}}function Ku(i,t){for(let e=0;e<1024*768;++e)i[e]=t[e]}function $o(i,t,e){let s=(t-i)*e+i;return s<0&&(s=0),s>255&&(s=255),s}function Jw(i,t,e){e<0&&(e=0),e>1&&(e=1);const s=i>>>16&255,r=i>>>8&255,a=i>>>0&255,c=t>>>16&255,h=t>>>8&255,m=t>>>0&255,d=$o(s,c,e),p=$o(r,h,e),b=$o(a,m,e);return d<<16|p<<8|b}function Xi(i,t){return i<<12|t<<4}class tS{constructor(t,e,s){this.isMaster=t,this.fb32=Ts(e),this.collook=Ts(new Uint32Array([4278190080,4278190335,4278255360,4278255615,4294901760,4294902015,4294967040,4294967295])),this.screenAddrAdd=new Uint16Array([16384,12288,24576,22528]),this.cursorTable=new Uint8Array([0,0,0,128,64,32,32]),this.cursorFlashMask=new Uint8Array([0,0,8,16]),this.regs=new Uint8Array(32),this.bitmapX=0,this.bitmapY=0,this.oddClock=!1,this.frameCount=0,this.doEvenFrameLogic=!1,this.isEvenRender=!0,this.lastRenderWasEven=!1,this.firstScanline=!0,this.inHSync=!1,this.inVSync=!1,this.hadVSyncThisRow=!1,this.checkVertAdjust=!1,this.endOfMainLatched=!1,this.endOfVertAdjustLatched=!1,this.endOfFrameLatched=!1,this.inVertAdjust=!1,this.inDummyRaster=!1,this.hpulseWidth=0,this.vpulseWidth=0,this.hpulseCounter=0,this.vpulseCounter=0,this.dispEnabled=qr,this.horizCounter=0,this.vertCounter=0,this.scanlineCounter=0,this.vertAdjustCounter=0,this.addr=0,this.lineStartAddr=0,this.nextLineStartAddr=0,this.ulactrl=0,this.pixelsPerChar=8,this.halfClock=!1,this.ulaMode=0,this.teletextMode=!1,this.displayEnableSkew=0,this.ulaPal=Ts(new Uint32Array(16)),this.actualPal=new Uint8Array(16),this.teletext=new Xw,this.cursorOn=!1,this.cursorOff=!1,this.cursorOnThisFrame=!1,this.cursorDrawIndex=0,this.cursorPos=0,this.interlacedSyncAndVideo=!1,this.doubledScanlines=!0,this.frameSkipCount=0,this.screenAdd=0,this.topBorder=12,this.bottomBorder=13,this.leftBorder=5*16,this.rightBorder=3*16,this.paint_ext=s,this.debugPrevScreen=null,this.table4bpp=(()=>{const r=new Uint8Array(16384);let a,c,h,m;for(c=0;c<256;++c){for(h=c,a=0;a<16;++a)m=0,h&2&&(m|=1),h&8&&(m|=2),h&32&&(m|=4),h&128&&(m|=8),r[Xi(3,c)+a]=m,h<<=1,h|=1;for(a=0;a<16;++a)r[Xi(2,c)+a]=r[Xi(3,c)+(a>>>1)],r[Xi(1,c)+a]=r[Xi(3,c)+(a>>>2)],r[Xi(0,c)+a]=r[Xi(3,c)+(a>>>3)]}return r})(),this.crtc=new Qw(this),this.ula=new Zw(this),this.reset(null),this.clearPaintBuffer(),this.paint()}reset(t,e){this.cpu=t,this.sysvia=e,e&&(e.cb2changecallback=this.cb2changed.bind(this))}paint(){this.paint_ext(this.leftBorder,this.topBorder,1024-this.rightBorder,625-this.bottomBorder)}clearPaintBuffer(){const t=this.fb32;if(this.interlacedSyncAndVideo||!this.doubledScanlines){let e=this.frameCount&1;for(;e<625;){const s=e*1024;t.fill(0,s,s+1024),e+=2}}else t.fill(0)}paintAndClear(){this.dispEnabled&qr&&(this.paint(),this.clearPaintBuffer()),this.dispEnabled&=-33;let t=qr;this.frameSkipCount>1&&this.frameCount%this.frameSkipCount&&(t=0),this.dispEnabled|=t,this.bitmapY=0,this.regs[8]&1&&this.frameCount&1&&(this.bitmapY=-1)}debugOffset(t,e){return t<0||t>=1024||e<0||e>=768?-1:e*1024+t}debugPaint(){this.debugPrevScreen||(this.debugPrevScreen=new Uint32Array(1024*768)),Ku(this.debugPrevScreen,this.fb32);const t=10;for(let e=-10;e<=t;e++)for(let s=-10;s<=t;++s){const r=Math.sqrt(s*s+e*e)/t;if(r>1)continue;const a=this.debugOffset(this.bitmapX+s,this.bitmapY+e);this.fb32[a]=Jw(this.fb32[a],16777215,Math.pow(1-r,2))}this.paint(),Ku(this.fb32,this.debugPrevScreen)}blitFb(t,e,s){e|=0;const r=Xi(this.ulaMode,t),a=this.fb32,c=this.ulaPal,h=this.table4bpp;if(s===8)for(let m=0;m<8;++m)a[e+m]=c[h[r+m]];else for(let m=0;m<16;++m)a[e+m]=c[h[r+m]]}handleCursor(t){if(this.cursorOnThisFrame&&this.ulactrl&this.cursorTable[this.cursorDrawIndex]){for(let e=0;e<this.pixelsPerChar;++e)this.fb32[t+e]^=16777215;if(this.doubledScanlines&&!this.interlacedSyncAndVideo)for(let e=0;e<this.pixelsPerChar;++e)this.fb32[t+1024+e]^=16777215}++this.cursorDrawIndex===7&&(this.cursorDrawIndex=0)}setScreenAdd(t){this.screenAdd=this.screenAddrAdd[t]}readVideoMem(){if(this.addr&8192){let t=this.addr&1023;return this.addr&2048||this.isMaster?t|=31744:t|=15360,this.cpu.videoRead(t)}else{let t=this.scanlineCounter&7|this.addr<<3;return this.addr&4096&&(t+=this.screenAdd),this.cpu.videoRead(t&32767)}}endOfFrame(){this.vertCounter=0,this.firstScanline=!0,this.nextLineStartAddr=(this.regs[13]|this.regs[12]<<8)&16383,this.lineStartAddr=this.nextLineStartAddr,this.dispEnableSet(ws);const t=(this.regs[10]&96)>>>5;this.cursorOnThisFrame=t===0||!!(this.frameCount&this.cursorFlashMask[t]),this.lastRenderWasEven=this.isEvenRender,this.isEvenRender=!(this.frameCount&1),this.inVSync||(this.doEvenFrameLogic=!1)}endOfCharacterLine(){this.vertCounter=this.vertCounter+1&127,this.scanlineCounter=0,this.hadVSyncThisRow=!1,this.dispEnableSet(fa),this.cursorOn=!1,this.cursorOff=!1}endOfScanline(){this.firstScanline=!1,this.scanlineCounter===this.regs[11]&&(this.cursorOff=!0),this.vpulseCounter=this.vpulseCounter+1&15;const t=this.scanlineCounter===this.regs[9];t&&(this.lineStartAddr=this.nextLineStartAddr),this.interlacedSyncAndVideo?this.scanlineCounter=this.scanlineCounter+2&30:this.scanlineCounter=this.scanlineCounter+1&31,this.teletextMode||(this.scanlineCounter>>>3&1?this.dispEnableClear(fa):this.dispEnableSet(fa)),!this.inVertAdjust&&t&&this.endOfCharacterLine(),this.endOfMainLatched&&!this.endOfVertAdjustLatched&&(this.inVertAdjust=!0);let e=!1;this.endOfFrameLatched&&(e=!0),this.endOfVertAdjustLatched&&(this.inVertAdjust=!1,this.regs[8]&1&&this.doEvenFrameLogic?(this.inDummyRaster=!0,this.endOfFrameLatched=!0):e=!0),e&&(this.endOfMainLatched=!1,this.endOfVertAdjustLatched=!1,this.endOfFrameLatched=!1,this.inDummyRaster=!1,this.endOfCharacterLine(),this.endOfFrame()),this.addr=this.lineStartAddr;const s=this.regs[10]&31;this.scanlineCounter===s&&(this.cursorOn=!0);let r=this.scanlineCounter;this.interlacedSyncAndVideo&&this.frameCount&1&&r++,this.teletext.setRA0(!!(r&1))}handleHSync(){this.hpulseCounter=this.hpulseCounter+1&15,this.hpulseCounter===this.hpulseWidth>>>1?(this.bitmapX=-8,this.hpulseWidth&1&&(this.bitmapX-=4),this.bitmapY+=2,this.bitmapY>=768&&this.paintAndClear()):this.hpulseCounter===(this.regs[3]&15)&&(this.inHSync=!1)}cb2changed(t,e){t&&e&&(this.regs[16]=this.addr>>8&63,this.regs[17]=this.addr&255)}dispEnableChanged(){const t=ar|ws|wa,e=(this.dispEnabled&t)===t;this.teletext.setDISPTMG(e)}dispEnableSet(t){this.dispEnabled|=t,this.dispEnableChanged()}dispEnableClear(t){this.dispEnabled&=~t,this.dispEnableChanged()}polltime(t){for(;t--;){if(this.oddClock=!this.oddClock,this.bitmapX+=8,this.halfClock&&!this.oddClock)continue;this.inHSync&&this.handleHSync();const e=this.displayEnableSkew+(this.teletextMode?2:0);this.horizCounter===e&&this.dispEnableSet(Sc),this.horizCounter===this.regs[1]&&(this.nextLineStartAddr=this.addr),(this.horizCounter===this.regs[1]+e||this.horizCounter===this.regs[0]+e)&&this.dispEnableClear(ar|Sc),this.horizCounter===this.regs[2]&&!this.inHSync&&(this.inHSync=!0,this.hpulseCounter=0);const s=!!(this.regs[8]&1),r=this.horizCounter===this.regs[0]>>>1,a=!s||!this.doEvenFrameLogic||r;let c=!1,h=!1;this.inVSync&&this.vpulseCounter===this.vpulseWidth&&a&&(c=!0,this.inVSync=!1),this.vertCounter===this.regs[7]&&!this.inVSync&&!this.hadVSyncThisRow&&a&&(h=!0,this.inVSync=!0),h&&!c&&(this.hadVSyncThisRow=!0,this.vpulseCounter=0,this.regs[0]&&this.regs[4]&&this.paintAndClear()),(h||c)&&(this.sysvia.setVBlankInt(this.inVSync),this.teletext.setDEW(this.inVSync));const m=(this.dispEnabled&(ar|ws))===(ar|ws);if((m||this.cursorDrawIndex)&&this.dispEnabled&qr){const b=this.readVideoMem();if(m&&(this.teletextMode&&this.teletext.fetchData(b),this.addr===this.cursorPos&&this.cursorOn&&!this.cursorOff&&this.horizCounter<this.regs[1]&&(this.cursorDrawIndex=3-(this.regs[8]>>>6&3))),this.bitmapX>=0&&this.bitmapX<1024&&this.bitmapY<625){let w=!1,C=this.bitmapY;(this.doubledScanlines&&!this.interlacedSyncAndVideo||this.isEvenRender===this.lastRenderWasEven)&&(w=!0,C&=-2),C=C*1024+this.bitmapX,(this.dispEnabled&Vu)===Vu&&(this.teletextMode?this.teletext.render(this.fb32,C):this.blitFb(b,C,this.pixelsPerChar,w),w&&this.fb32.copyWithin(C+1024,C,C+this.pixelsPerChar)),this.cursorDrawIndex&&this.handleCursor(C,w)}}this.addr=this.addr+1&16383,this.checkVertAdjust&&(this.checkVertAdjust=!1,this.endOfMainLatched&&(this.vertAdjustCounter===this.regs[5]&&(this.endOfVertAdjustLatched=!0),this.vertAdjustCounter++,this.vertAdjustCounter&=31)),this.horizCounter===1&&(this.vertCounter===this.regs[4]&&this.scanlineCounter===this.regs[9]&&(this.endOfMainLatched=!0,this.vertAdjustCounter=0),this.checkVertAdjust=!0),this.horizCounter===this.regs[0]?(this.endOfScanline(),this.horizCounter=0,this.dispEnableSet(ar)):this.horizCounter=this.horizCounter+1&255;const d=this.vertCounter===this.regs[6];d&&!this.firstScanline&&this.dispEnabled&ws&&(this.dispEnableClear(ws),this.frameCount++);const p=this.vertCounter===this.regs[7];(d||p)&&(this.doEvenFrameLogic=!!(this.frameCount&1))}}}class _p{constructor(){this.ula=this.crtc={read:function(){return 255},write:wc},this.regs=new Uint8Array(32)}reset(){}polltime(){}setScreenAdd(){}}const jr=16;function xp(i){return'<span class="addr">'+te(i)+"</span>"}class eS{constructor(t,e){this._widget=t,this._peekMem=e,this._addr=0,this._prevSnapshot=new Uint8Array(65536),this._rows=[];const s=this._widget.find(".template");for(let r=0;r<jr;r++)this._rows.push(s.clone().removeClass("template").appendTo(this._widget));s.remove(),t.bind("wheel",r=>{const a=r.originalEvent.deltaY;if(a===0)return;const c=a/20|0;this.update(this._addr+8*c),r.preventDefault()})}update(t){t!==void 0&&(this._addr=t);let e=this._addr-8*Math.floor(this._rows.length/2);e<0&&(e=0);for(const s of this._rows){s.find(".dis_addr").html(xp(e)),s.toggleClass("highlight",e===this._addr);const r=this.dump(e,e+8),a=s.find(".mem_bytes span"),c=s.find(".mem_asc span");for(let h=0;h<8;++h)F(a[h]).text(r.hex[h]).toggleClass("changed",r.changed[h]),F(c[h]).text(r.asc[h]).toggleClass("changed",r.changed[h]);e=e+8&65535}}dump(t,e){const s=[],r=[],a=[];for(let c=t;c<e;++c){const h=this._peekMem(c);s.push(ct(h)),a.push(c<this._prevSnapshot.length&&this._prevSnapshot[c]!==h),h>=32&&h<128?r.push(String.fromCharCode(h)):r.push(".")}return{hex:s,asc:r,changed:a}}snapshot(){for(let t=0;t<65536;++t)this._prevSnapshot[t]=this._peekMem(t)}step(t){this.update(this._addr+t)}}class iS{constructor(){this.patchInstructions=new Map,this._enabled=!1,this.disass=F("#disassembly"),this._memoryView=new eS(F("#memory"),e=>this.cpu?this.cpu.peekmem(e):0),this.debugNode=F("#debug, #hardware_debug, #crtc_debug"),this.disassPc=0,this.disassStack=[],this.uservia=this.sysvia=this.crtc=null,this.breakpoints={};function t(e,s){const r=e.find(".goto-addr");e.on("submit",a=>{s(Ow(r.val())),r.val(""),r.blur(),a.preventDefault()})}t(F("#goto-mem-addr-form"),e=>this._memoryView.update(e)),t(F("#goto-dis-addr-form"),this.updateDisassembly.bind(this)),this.enable(!1);for(let e=0;e<jr;e++)this.disass.find(".template").clone().removeClass("template").appendTo(this.disass);this.disass.find(".bp_gutter").click(this.bpClick.bind(this)),this.disass.bind("wheel",e=>{let s=e.originalEvent.deltaY;if(s===0)return;let r=this.disassPc;const a=s<0?this.prevInstruction.bind(this):this.nextInstruction.bind(this);for(s=Math.abs(s);s>0;)r=a(r),s-=30;this.updateDisassembly(r),e.preventDefault()})}setCpu(t){this.cpu=t,this.sysvia=this.setupVia(F("#sysvia"),t.sysvia),this.uservia=this.setupVia(F("#uservia"),t.uservia),this.crtc=this.setupCrtc(F("#crtc_debug"),t.video)}disassemble(t){return this.cpu.disassembler.disassemble(t)}setupCrtc(t,e){if(!e)return wc;const s=[];t.find("tr:not(.template)").remove();const r=t.find(".crtc_regs");function a(d,p){const b=d.find(".template").clone().removeClass("template").appendTo(d);return b.find(".register").text(p),b.find(".value")}for(let d=0;d<16;++d){const p=a(r,"R"+d);s.push(()=>{this.updateElem(p,ct(e.regs[d]))})}const c=t.find(".crtc_state"),h=["bitmapX","bitmapY","dispEnabled","horizCounter","inHSync","scanlineCounter","vertAdjustCounter","vertCounter","inVSync","endOfMainLatched","endOfVertAdjustLatched","inVertAdjust","inDummyRaster","addr","lineStartAddr","nextLineStartAddr"];for(const d of h){const p=a(c,d);typeof e[d]=="boolean"?s.push(()=>this.updateElem(p,e[d]?"true":"false")):s.push(()=>this.updateElem(p,te(e[d])))}const m=()=>{for(const d of s)d()};return m(),m}setupVia(t,e){const s=[];if(!e)return wc;const r=["ora","orb","ira","irb","ddra","ddrb","acr","pcr","ifr","ier","t1c","t1l","t2c","t2l","portapins","portbpins","IC32"];t.find("tr:not(.template)").remove();for(const c of r){if(e[c]===void 0)continue;const h=t.find(".template").clone().removeClass("template").appendTo(t);h.find(".register").text(c.toUpperCase());const m=h.find(".value");c.match(/t[12][cl]/)?s.push(()=>{const d=e[c];this.updateElem(m,ct(d>>>16&255)+ct(d>>>8&255)+ct(d&255))}):s.push(()=>{this.updateElem(m,ct(e[c]))})}const a=()=>{for(const c of s)c()};return a(),a}updateElem(t,e){const s=t.text();s!==e&&t.text(e),t.toggleClass("changed",s!==e&&s!=="")}updateRegisters(){this.updateElem(F("#cpu6502_a"),ct(this.cpu.a)),this.updateElem(F("#cpu6502_x"),ct(this.cpu.x)),this.updateElem(F("#cpu6502_y"),ct(this.cpu.y)),this.updateElem(F("#cpu6502_s"),ct(this.cpu.s)),this.updateElem(F("#cpu6502_pc"),te(this.cpu.pc));for(const t of["c","z","i","d","v","n"])this.updateElem(F("#cpu6502_flag_"+t),this.cpu.p[t]?t.toUpperCase():t)}execPatch(t){for(const e of t.split(",")){if(!e)continue;const s=e.split(":");let r=parseInt(s[0],16);const a=s[1];for(let c=0;c<a.length;c+=2){const h=parseInt(a.substring(c,c+2),16);this.cpu.writemem(r,h),r++}}}setPatch(t){for(const e of t.split(";"))if(e[0]==="@"){const s=parseInt(e.substring(1,5),16);this.patchInstructions.has(s)||this.patchInstructions.set(s,[]),this.patchInstructions.get(s).push(e.substring(5))}else this.execPatch(e);if(this.patchInstructions.size>0){const e=this.cpu.debugInstruction.add(s=>{if(!this.patchInstructions.has(s))return!1;for(const r of this.patchInstructions.get(s))this.execPatch(r);return this.patchInstructions.delete(s),this.patchInstructions.size===0&&(console.log("All patches done"),e.remove()),!1})}}debug(t){this.enable(!0),this.updateDisassembly(t),this.updateRegisters(),this._memoryView.update(),this.sysvia(),this.uservia(),this.crtc(),this.cpu.video.debugPaint()}enable(t){this._enabled&&!t&&this.updatePrevMem(),this._enabled=t,this.debugNode.toggle(this._enabled)}enabled(){return this._enabled}updateDisassembly(t){this.disassPc=t;const e=this.disass.children().filter(":visible"),s=(r,a)=>{const c=this.disassemble(a),h=this._memoryView.dump(a,c[1]);r.find(".dis_addr").html(xp(a)),r.toggleClass("current",a===this.cpu.pc),r.toggleClass("highlight",a===this.disassPc),r.find(".instr_bytes").text(h.hex.join(" ")),r.find(".instr_asc").text(h.asc.join(""));const m=r.find(".disassembly").html(c[0]);return m.find(".instr_mem_ref").click(d=>this.memClick(d)),m.find(".instr_instr_ref").click(d=>this.instrClick(d)),r.find(".bp_gutter").toggleClass("active",!!this.breakpoints[a]),r.data({addr:a,ref:c[2]}),c[1]};for(let r=0;r<jr/2;++r){const a=F(e[r+jr/2]);t=s(a,t)}t=this.disassPc;for(let r=jr/2-1;r>=0;--r){t=this.prevInstruction(t);const a=F(e[r]);s(a,t)}}prevInstruction(t){const e=/(RTS|B..|JMP|JSR|LD[AXY]|ST[AXY]|TA[XY]|T[XY]A|AD[DC]|SUB|SBC|CLC|SEC|CMP|EOR|ORR|AND|INC|DEC).*/,s=/.*,\s*([XY]|X\))$/;t&=65535;let r=t-1,a=0;for(let c=t-20;c!==t;c++){let h=0,m=c&65535;for(;m<t;){const d=this.disassemble(m);if(d[0]===this.cpu.pc&&(h+=10),d[0].match(e)&&!d[0].match(s)&&h++,d[1]===t&&h>a){a=h,r=m;break}m=d[1]}}return r}updatePrevMem(){this._memoryView.snapshot()}hide(){this.enable(!1)}stepUntil(t){this.cpu.targetCycles=this.cpu.currentCycles;for(let e=0;e<65536&&(this.cpu.execute(1),!t());e++);this.debug(this.cpu.pc)}step(){this.updatePrevMem();const t=this.cpu.pc;this.stepUntil(()=>this.cpu.pc!==t)}isUnconditionalJump(t){return!!this.disassemble(t)[0].match(/^(JMP|RTS|BRA)/)}stepOver(){if(this.updatePrevMem(),this.isUnconditionalJump(this.cpu.pc))return this.step();const t=this.nextInstruction(this.cpu.pc);this.stepUntil(()=>this.cpu.pc===t)}isReturn(t){return this.disassemble(t)[0]==="RTS"}stepOut(){this.updatePrevMem();const t=this.cpu.s;this.stepUntil(()=>{if(this.cpu.s>=t&&this.isReturn(this.cpu.pc)){const e=this.nextInstruction(this.cpu.pc);return this.step(),this.cpu.pc!==e}return!1})}nextInstruction(t){return this.disassemble(t)[1]&65535}instrClick(t){const e=F(t.target).data();this.disassStack.push(this.disassPc),this.updateDisassembly(e.ref)}memClick(t){const e=F(t.target).data();this._memoryView.update(e.ref)}toggleBreakpoint(t){this.breakpoints[t]?(console.log("Removing breakpoint from address "+te(t)),this.breakpoints[t].remove(),this.breakpoints[t]=void 0):(console.log("Adding breakpoint to address "+te(t)),this.breakpoints[t]=this.cpu.debugInstruction.add(e=>e===t))}bpClick(t){const e=F(t.target).closest(".dis_elem").data().addr;this.toggleBreakpoint(e),F(t.target).toggleClass("active",!!this.breakpoints[e])}keyPress(t){if(F(":focus").length>0)return!1;switch(String.fromCharCode(t)){case"b":this.disassStack.length&&this.updateDisassembly(this.disassStack.pop());break;case"k":this.updateDisassembly(this.prevInstruction(this.disassPc));break;case"j":this.updateDisassembly(this.nextInstruction(this.disassPc));break;case"t":this.toggleBreakpoint(this.disassPc),this.updateDisassembly(this.disassPc);break;case"u":this._memoryView.step(8);break;case"i":this._memoryView.step(-8);break;case"U":this._memoryView.step(64);break;case"I":this._memoryView.step(-64);break;case"n":this.step();break;case"N":this.updatePrevMem(),this.cpu.execute(1),self.debug(this.cpu.pc);break;case"m":this.stepOver();break;case"o":this.stepOut();break}return!0}}const qu=0,ju=1,Yu=2,Xu=3,Zu=4,Qu=5,Ju=6,t0=7,e0=8,i0=9,s0=10,r0=11,n0=12,a0=13,o0=14,c0=15,h0=64,Ho=32,sS=2,rS=1,nS=16,aS=8;class bp{constructor(t,e,s){this.cpu=t,this.irq=s,this.scheduler=e,this.ora=0,this.orb=0,this.ira=0,this.irb=0,this.ddra=0,this.ddrb=0,this.sr=0,this.t1l=0,this.t2l=0,this.t1c=0,this.t2c=0,this.acr=0,this.pcr=0,this.ifr=0,this.ier=0,this.t1hit=!1,this.t2hit=!1,this.portapins=0,this.portbpins=0,this.ca1=!1,this.ca2=!1,this.cb1=!1,this.cb2=!1,this.ca2changecallback=null,this.cb2changecallback=null,this.justhit=0,this.t1_pb7=0,this.task=this.scheduler.newTask(()=>this._onTimeout()),this.lastPolltime=0}reset(){this.ora=this.orb=0,this.ddra=this.ddrb=0,this.ifr=this.ier=0,this.t1c=this.t1l=this.t2c=this.t2l=131070,this.t1hit=this.t2hit=!0,this.acr=this.pcr=0,this.t1_pb7=1,this.updateNextTime()}updateNextTime(){let t=this.t1c;this.acr&32||(t=Math.min(this.t2c,t)),this.task.reschedule(Math.max(1,t))}_onTimeout(){this._catchUp()}_catchUp(){const t=this.scheduler.epoch-this.lastPolltime;t&&this._polltime(t),this.lastPolltime=this.scheduler.epoch,this.updateNextTime()}_polltime(t){t|=0,this.justhit=0;const e=this.t1c-t;if(e<-2?this.t1c=this._handleT1c(e):this.t1c=e,!(this.acr&32)){const s=this.t2c-t;s<-2?this.t2c=this._handleT2c(s):this.t2c=s}}_handleT1c(t){for(t<-2&&this.t1c>-3&&(this.t1hit||(this.ifr|=h0,this.updateIFR(),t===-3&&(this.justhit|=1),this.t1_pb7=!this.t1_pb7),this.acr&64||(this.t1hit=!0));t<-3;)t+=this.t1l+4;return t}_handleT2c(t){return this.t2hit||(this.ifr|=Ho,this.updateIFR(),t===-3&&(this.justhit|=2),this.t2hit=!0),t+=131072,t}updateIFR(){this.ifr&this.ier&127?(this.ifr|=128,this.cpu.interrupt|=this.irq):(this.ifr&=-129,this.cpu.interrupt&=~this.irq)}write(t,e){this._catchUp();let s;switch(e|=0,t&15){case ju:this.ifr&=-3,(this.pcr&10)!==2&&(this.ifr&=-2),this.updateIFR(),s=this.pcr&14,s===8?this.setca2(!1):s===10&&(this.setca2(!1),this.setca2(!0));case c0:this.ora=e,this.recalculatePortAPins();break;case qu:this.ifr&=-17,(this.pcr&160)!==32&&(this.ifr&=-9),this.updateIFR(),this.orb=e,this.recalculatePortBPins(),s=(this.pcr&224)>>>4,s===8?this.setcb2(!1):s===10&&(this.setcb2(!1),this.setcb2(!0));break;case Xu:this.ddra=e,this.recalculatePortAPins();break;case Yu:this.ddrb=e,this.recalculatePortBPins();break;case r0:this.acr=e,this.justhit&1&&!(e&64)&&(this.t1hit=!0);break;case n0:this.pcr=e,(e&14)===12?this.setca2(!1):e&8&&this.setca2(!0),(e&224)===192?this.setcb2(!1):e&128&&this.setcb2(!0);break;case s0:this.sr=e;break;case Ju:case Zu:this.t1l&=130560,this.t1l|=e<<1;break;case t0:this.t1l&=510,this.t1l|=e<<9,this.justhit&1||(this.ifr&=-65,this.updateIFR());break;case Qu:this.t1l&=510,this.t1l|=e<<9,this.t1c=this.t1l+1,this.t1hit=!1,this.justhit&1||(this.ifr&=-65,this.updateIFR()),this.t1_pb7=0,this.updateNextTime();break;case e0:this.t2l&=130560,this.t2l|=e<<1;break;case i0:this.t2l&=510,this.t2l|=e<<9,this.t2c=this.t2l+1,this.acr&32&&(this.t2c-=2),this.justhit&2||(this.ifr&=-33,this.updateIFR()),this.t2hit=!1,this.updateNextTime();break;case o0:e&128?this.ier|=e&127:this.ier&=~(e&127),this.updateIFR();break;case a0:this.ifr&=~(e&127),this.justhit&1&&(this.ifr|=h0),this.justhit&2&&(this.ifr|=Ho),this.updateIFR();break}}read(t){switch(this._catchUp(),t&15){case ju:this.ifr&=-3,(this.pcr&10)!==2&&(this.ifr&=-2),this.updateIFR();case c0:return this.acr&1?this.ira:(this.recalculatePortAPins(),this.portapins);case qu:{this.ifr&=-17,(this.pcr&160)!==32&&(this.ifr&=-9),this.updateIFR(),this.recalculatePortBPins();let e=this.orb&this.ddrb;return this.acr&2?e|=this.irb&~this.ddrb:e|=this.portbpins&~this.ddrb,this.acr&128&&(e&=127,e|=this.t1_pb7<<7),e}case Xu:return this.ddra;case Yu:return this.ddrb;case Ju:return(this.t1l&510)>>>1&255;case t0:return this.t1l>>>9&255;case Zu:return this.justhit&1||(this.ifr&=-65,this.updateIFR()),this.t1c+1>>>1&255;case Qu:return this.t1c+1>>>9&255;case e0:return this.justhit&2||(this.ifr&=-33,this.updateIFR()),this.t2c+1>>>1&255;case i0:return this.t2c+1>>>9&255;case s0:return this.sr;case r0:return this.acr;case n0:return this.pcr;case o0:return this.ier|128;case a0:return this.ifr;default:throw"Unknown VIA read"}}drivePortA(){}portAUpdated(){}drivePortB(){}portBUpdated(){}rawPortB(){return 255}recalculatePortAPins(){this.portapins=this.ora&this.ddra,this.portapins|=~this.ddra&255,this.drivePortA(),this.portAUpdated()}recalculatePortBPins(){const t=!!(this.portbpins&64);this.portbpins=this.orb&this.ddrb|~this.ddrb&this.rawPortB(),this.drivePortB(),t&&!(this.portbpins&64)&&this.acr&32&&(this.t2c-=2,this.t2c<0&&(this.t2c=65535,this.ifr|=Ho,this.updateIFR())),this.portBUpdated()}setca1(t){if(t===this.ca1)return;!!(this.pcr&1)===t&&(this.acr&1&&(this.ira=this.portapins),this.ifr|=sS,this.updateIFR(),(this.pcr&12)===8&&this.setca2(!0)),this.ca1=t}setca2(t){if(t===this.ca2)return;this.ca2=t;const e=!!(this.pcr&8);if(this.ca2changecallback&&this.ca2changecallback(t,e),e)return;!!(this.pcr&4)===t&&(this.ifr|=rS,this.updateIFR())}setcb1(t){if(t===this.cb1)return;!!(this.pcr&16)===t&&(this.acr&2&&(this.irb=this.portbpins),this.ifr|=nS,this.updateIFR(),(this.pcr&192)===128&&this.setcb2(!0)),this.cb1=t}setcb2(t){if(t===this.cb2)return;this.cb2=t;const e=!!(this.pcr&128);if(this.cb2changecallback&&this.cb2changecallback(t,e),e)return;!!(this.pcr&64)===t&&(this.ifr|=aS,this.updateIFR())}}class oS extends bp{constructor(t,e,s,r,a,c,h,m){super(t,e,1),this.IC32=0,this.capsLockLight=!1,this.shiftLockLight=!1,this.keys=[];for(let d=0;d<16;++d)this.keys[d]=new Uint8Array(16);this.mouseButton1=!1,this.mouseButton2=!1,this.keyboardEnabled=!0,this.setKeyLayout(h),this.video=s,this.soundChip=r,this.cmos=a,this.isMaster=c,this.getGamepadsFunc=m,this.reset()}setKeyLayout(t){this.keycodeToRowCol=Nw(t)}setVBlankInt(t){this.setca1(t)}clearKeys(){for(let t=0;t<this.keys.length;++t)for(let e=0;e<this.keys[t].length;++e)this.keys[t][e]=!1;this.updateKeys()}disableKeyboard(){this.keyboardEnabled=!1,this.clearKeys()}enableKeyboard(){this.keyboardEnabled=!0,this.clearKeys()}set(t,e,s){if(!this.keyboardEnabled)return;const r=this.keycodeToRowCol[!!s][t];r&&(this.keys[r[0]][r[1]]=e,this.updateKeys())}keyDown(t,e){this.set(t,1,e)}keyUp(t){this.set(t,0,!0),this.set(t,0,!1)}keyDownRaw(t){this.keys[t[0]][t[1]]=1,this.updateKeys()}keyUpRaw(t){this.keys[t[0]][t[1]]=0,this.updateKeys()}keyToggleRaw(t){this.keys[t[0]][t[1]]=1-this.keys[t[0]][t[1]],this.updateKeys()}hasAnyKeyDown(){for(let e=0;e<13;++e)for(let s=0;s<8;++s)if(this.keys[e][s])return!0;return!1}updateKeys(){if(this.IC32&8){for(let e=0;e<13;++e)for(let s=1;s<8;++s)if(this.keys[e][s]){this.setca2(!0);return}}else{const e=this.portapins,s=e>>>4&7,r=e&15;if(this.keys[r][s]?this.ddra&128||(this.portapins|=128):this.portapins&=127,r<13){for(let a=1;a<8;++a)if(this.keys[r][a]){this.setca2(!0);return}}}this.setca2(!1)}portAUpdated(){this.updateKeys(),this.soundChip.updateSlowDataBus(this.portapins,!(this.IC32&1))}rawPortB(){let t=255;const e=this.getJoysticks();return e.button1&&(t&=-17),e.button2&&(t&=-33),t}portBUpdated(){const t=this.portbpins;t&8?this.IC32|=1<<(t&7):this.IC32&=~(1<<(t&7)),this.capsLockLight=!(this.IC32&64),this.shiftLockLight=!(this.IC32&128),this.video.setScreenAdd((this.IC32&16?2:0)|(this.IC32&32?1:0)),this.isMaster&&this.cmos.writeControl(t,this.portapins,this.IC32),this.recalculatePortAPins()}drivePortA(){let t=255;this.isMaster&&(t&=this.cmos.read(this.IC32)),this.portapins&=t,this.updateKeys()}drivePortB(){}getGamepads(){return this.getGamepadsFunc?this.getGamepadsFunc():null}setJoystickButton(t,e){t===0?this.mouseButton1=e:t===1&&(this.mouseButton2=e),this.recalculatePortBPins()}getJoysticks(){let t=this.mouseButton1,e=this.mouseButton2;const s=this.getGamepads();if(s&&s[0]){const r=s[0],a=s[1];t=t||r.buttons[10].pressed,e=e||(a?a.buttons[10].pressed:r.buttons[11].pressed)}return{button1:t,button2:e}}}class cS extends bp{constructor(t,e,s,r){super(t,e,2),this.isMaster=s,this.userPortPeripheral=r,this.reset()}portBUpdated(){this.userPortPeripheral.write(this.portbpins)}drivePortB(){this.portbpins&=this.userPortPeripheral.read()}}class hS{constructor(t,e,s,r){this.cpu=t,this.toneGen=e,this.rs423Handler=r,this.sr=0,this.cr=0,this.dr=0,this.rs423Selected=!1,this.motorOn=!1,this.tapeCarrierCount=0,this.tapeDcdLineLevel=!1,this.hadDcdHigh=!1,this.serialReceiveRate=0,this.serialReceiveCyclesPerByte=0,this.setSerialReceive(19200),this.txCompleteTask=s.newTask(()=>{this.sr|=2}),this.runTapeTask=s.newTask(()=>this.runTape()),this.runRs423Task=s.newTask(()=>this.runRs423())}updateIrq(){this.sr&this.cr&128?this.cpu.interrupt|=4:this.cpu.interrupt&=-5}reset(){this.sr&=12,this.sr|=2,this.hadDcdHigh=!1,this.updateIrq()}tone(t){t?this.toneGen.tone(t):this.toneGen.mute()}setMotor(t){t&&!this.motorOn?this.runTape():!t&&this.motorOn&&(this.toneGen.mute(),this.runTapeTask.cancel(),this.setTapeCarrier(!1)),this.motorOn=t}read(t){if(t&1)return this.sr&=-162,this.hadDcdHigh=!1,this.updateIrq(),this.dr;{let e=this.sr&127|this.sr&this.cr&128;return e&8&&(e&=-3),this.hadDcdHigh&&(e|=4),e}}write(t,e){t&1?(this.sr&=-3,this.txCompleteTask.reschedule(2e3),this.updateIrq(),this.rs423Selected&&this.rs423Handler&&this.rs423Handler.onTransmit(e)):(e&3)===3?this.reset():(this.cr=e,this.setSerialReceive(this.serialReceiveRate))}selectRs423(t){this.rs423Selected=!!t,this.rs423Selected?this.sr|=8:this.sr&=-9,this.dcdLineUpdated(),this.runRs423Task.ensureScheduled(this.rs423Selected,this.serialReceiveCyclesPerByte)}dcdLineUpdated(){const t=this.rs423Selected?!1:this.tapeDcdLineLevel;t&&!(this.sr&4)?(this.sr|=132,this.hadDcdHigh=!0):!t&&this.sr&4&&(this.sr&=-5),this.updateIrq()}setTapeCarrier(t){t?(this.tapeCarrierCount++,this.tapeDcdLineLevel=this.tapeCarrierCount===209):(this.tapeCarrierCount=0,this.tapeDcdLineLevel=!1),this.dcdLineUpdated()}receive(t){t|=0,this.sr&1?(console.log("Serial overrun"),this.sr|=160):(this.dr=t&(this.cr&16?255:127),this.sr|=129),this.updateIrq()}setTape(t){this.tape=t}rewindTape(){this.tape&&(console.log("rewinding tape"),this.tape.rewind())}secondsToCycles(t){return Math.floor(2*1e3*1e3*t)|0}numBitsPerByte(){const t=this.cr&16?8:7;let e,s;switch(this.cr>>>2&7){case 0:e=2,s=1;break;case 1:e=2,s=1;break;case 2:e=1,s=1;break;case 3:e=1,s=1;break;case 4:e=2,s=0;break;case 5:e=1,s=0;break;case 6:e=1,s=1;break;case 7:e=1,s=1;break}return t+e+s}rts(){return(this.cr&64)===0||(this.cr&96)===96}setSerialReceive(t){this.serialReceiveRate=t,this.serialReceiveCyclesPerByte=this.secondsToCycles(this.numBitsPerByte()/t)}runTape(){this.tape&&this.runTapeTask.reschedule(this.tape.poll(this))}runRs423(){if(!this.rs423Handler)return;const t=this.rs423Handler.tryReceive(this.rts());t>=0&&this.receive(t),this.runRs423Task.reschedule(this.serialReceiveCyclesPerByte)}}const lS=[19200,9600,4800,2400,1200,300,150,75];class uS{constructor(t){this.acia=t,this.reset()}reset(){this.reg=0,this.transmitRate=0,this.receiveRate=0}write(t,e){e&=255,this.reg=e,this.transmitRate=e&7,this.receiveRate=e>>>3&7,this.acia.setSerialReceive(lS[this.receiveRate]),this.acia.setMotor(!!(e&128)),this.acia.selectRs423(!!(e&64))}read(){return this.write(0,254),0}}const fS=8,Vt=0,ae=1,Lt=2,Qt=3,zo=0,Xn=1,l0=2,Zn=3,u0=4,Qn=5,f0=6,Jn=7,Jt=128,jt=64,dS=1,pS=2,mS=4,gS=8,_S=16,xS=32,bS=64,yS=128,vS=dS,CS=pS,wS=mS,SS=gS,Wo=_S,Go=xS,ES=bS,AS=yS,Vo=24;class kS{constructor(t,e){this.hostCpu=t,this.parasiteCpu=e,this.internalStatusRegister=0,this.hostStatus=new Uint8Array(4),this.parasiteStatus=new Uint8Array(4),this.parasiteToHostData=[new Uint8Array(Vo),new Uint8Array(1),new Uint8Array(2),new Uint8Array(1)],this.hostToParasiteData=[new Uint8Array(1),new Uint8Array(1),new Uint8Array(2),new Uint8Array(1)],this.parasiteToHostFifoByteCount1=0,this.parasiteToHostFifoByteCount3=0,this.hostToParasiteFifoByteCount3=0,this.debug=!1}reset(t=!0){t&&(this.internalStatusRegister=0);for(let e=0;e<4;e++)this.hostStatus[e]=jt,this.parasiteStatus[e]=jt,e===Lt&&(this.hostStatus[e]|=Jt,this.parasiteToHostData[e][0]=0);this.parasiteToHostFifoByteCount1=0,this.parasiteToHostFifoByteCount3=1,this.hostToParasiteFifoByteCount3=0,this.updateInterrupts()}updateInterrupts(){this.hostStatus[Qt]&Jt&&this.internalStatusRegister&vS?this.hostCpu.interrupt|=fS:this.hostCpu.interrupt&=-9,this.parasiteStatus[Vt]&Jt&&this.internalStatusRegister&CS||this.parasiteStatus[Qt]&Jt&&this.internalStatusRegister&wS?this.parasiteCpu.interrupt=!0:this.parasiteCpu.interrupt=!1;const t=this.internalStatusRegister&Wo?2:1;this.internalStatusRegister&SS&&(this.hostToParasiteFifoByteCount3>=t||this.parasiteToHostFifoByteCount3===0)?this.parasiteCpu.NMI(!0):this.parasiteCpu.NMI(!1),this.parasiteCpu.resetHeldLow=this.internalStatusRegister&Go}hostRead(t){let e=254;switch(t&7){case zo:e=this.hostStatus[Vt]&(Jt|jt)|this.internalStatusRegister&-193;break;case Xn:if(e=this.parasiteToHostData[Vt][0],this.hostStatus[Vt]&Jt){for(let s=1;s<Vo;s++)this.parasiteToHostData[Vt][s-1]=this.parasiteToHostData[Vt][s];this.parasiteStatus[Vt]|=jt,this.parasiteToHostFifoByteCount1--,this.parasiteToHostFifoByteCount1===0&&(this.hostStatus[Vt]&=-129)}break;case l0:e=this.hostStatus[ae];break;case Zn:e=this.parasiteToHostData[ae][0],this.parasiteStatus[ae]|=jt,this.hostStatus[ae]&=-129;break;case u0:e=this.hostStatus[Lt];break;case Qn:e=this.parasiteToHostData[Lt][0],this.hostStatus[Lt]&Jt&&(this.parasiteToHostData[Lt][0]=this.parasiteToHostData[Lt][1],this.parasiteStatus[Lt]|=jt,this.parasiteToHostFifoByteCount3--,this.parasiteToHostFifoByteCount3===0&&(this.hostStatus[Lt]&=-129));break;case f0:e=this.hostStatus[Qt];break;case Jn:e=this.parasiteToHostData[Qt][0],this.parasiteStatus[Qt]|=jt,this.hostStatus[Qt]&=-129;break}return this.updateInterrupts(),this.debug&&console.log("TUBE ULA: host read "+te(t)+" = "+ct(e)),e}hostWrite(t,e){switch(this.debug&&console.log("TUBE ULA: host write "+te(t)+" = "+ct(e)),t&7){case zo:e&AS?this.internalStatusRegister|=e&-193:this.internalStatusRegister&=~(e&-193),e&ES&&this.reset(!1),e&Go&&this.internalStatusRegister&Go&&this.parasiteCpu.reset(!0);break;case Xn:this.hostStatus[Vt]&jt&&(this.hostToParasiteData[Vt][0]=e,this.parasiteStatus[Vt]|=Jt,this.hostStatus[Vt]&=-65);break;case Zn:this.hostStatus[ae]&jt&&(this.hostToParasiteData[ae][0]=e,this.parasiteStatus[ae]|=Jt,this.hostStatus[ae]&=-65);break;case Qn:this.hostStatus[Lt]&jt&&(this.internalStatusRegister&Wo?(this.hostToParasiteFifoByteCount3<2&&(this.hostToParasiteData[this.hostToParasiteFifoByteCount3++]=e),this.hostToParasiteFifoByteCount3===2&&(this.parasiteStatus[Lt]|=Jt,this.hostStatus[Lt]&=-65)):(this.hostToParasiteData[Lt][0]=e,this.hostToParasiteFifoByteCount3=1,this.parasiteStatus[Lt]|=Jt,this.hostStatus[Lt]&=-65));break;case Jn:this.hostStatus[Qt]&jt&&(this.hostToParasiteData[Qt][0]=e,this.parasiteStatus[Qt]|=Jt,this.hostStatus[Qt]&=-65);break}this.updateInterrupts()}parasiteRead(t){let e=0;switch(t&7){case zo:e=this.parasiteStatus[Vt];break;case Xn:e=this.hostToParasiteData[Vt][0],this.hostStatus[Vt]|=jt,this.parasiteStatus[Vt]&=-129;break;case l0:e=this.parasiteStatus[ae];break;case Zn:e=this.hostToParasiteData[ae][0],this.hostStatus[ae]|=jt,this.parasiteStatus[ae]&=-129;break;case u0:e=this.parasiteStatus[Lt];break;case Qn:e=this.hostToParasiteData[Lt][0],this.parasiteStatus[Lt]&Jt&&(this.hostToParasiteData[Lt][0]=this.hostToParasiteData[Lt][1],this.hostToParasiteFifoByteCount3--,this.hostToParasiteFifoByteCount3===0&&(this.hostStatus[Lt]|=jt,this.parasiteStatus[Lt]&=-129));break;case f0:e=this.parasiteStatus[Qt];break;case Jn:e=this.hostToParasiteData[Qt][0],this.hostStatus[Qt]|=jt,this.parasiteStatus[Qt]&=-129;break}return this.updateInterrupts(),this.debug&&console.log("TUBE ULA: parasite read "+te(t)+" = "+ct(e)),e}parasiteWrite(t,e){switch(this.debug&&console.log("TUBE ULA: parasite write "+te(t)+" = "+ct(e)),t&7){case Xn:this.parasiteStatus[Vt]&jt&&(this.parasiteToHostData[Vt][this.parasiteToHostFifoByteCount1++]=e,this.hostStatus[Vt]|=Jt,this.parasiteToHostFifoByteCount1===Vo&&(this.parasiteStatus[Vt]&=-65));break;case Zn:this.parasiteStatus[ae]&jt&&(this.parasiteToHostData[ae][0]=e,this.hostStatus[ae]|=Jt,this.parasiteStatus[ae]&=-65);break;case Qn:this.parasiteStatus[Lt]&jt&&(this.internalStatusRegister&Wo?(this.parasiteToHostFifoByteCount3<2&&(this.parasiteToHostData[Lt][this.parasiteToHostFifoByteCount3++]=e),this.parasiteToHostFifoByteCount3===2&&(this.hostStatus[Lt]|=Jt,this.parasiteStatus[Lt]&=-65)):(this.parasiteToHostData[Lt][0]=e,this.parasiteToHostFifoByteCount3=1,this.hostStatus[Lt]|=Jt,this.parasiteStatus[Lt]&=-65));break;case Jn:this.parasiteStatus[Qt]&jt&&(this.parasiteToHostData[Qt][0]=e,this.hostStatus[Qt]|=Jt,this.parasiteStatus[Qt]&=-65);break}this.updateInterrupts()}}class TS{constructor(t,e){this.sysvia=t,this.task=e.newTask(this.onComplete.bind(this)),this.status=64,this.low=0,this.high=0,this.channelSources=[null,null,null,null]}reset(){this.status=64,this.low=0,this.high=0}setChannelSource(t,e){if(t<0||t>3)return console.error(`ADC: Invalid channel number: ${t}`),!1;const s=this.channelSources[t];return s&&s!==e&&s.dispose(),this.channelSources[t]=e,!0}getChannelSource(t){return t<0||t>3?null:this.channelSources[t]}clearChannelSource(t){if(t<0||t>3)return console.error(`ADC: Invalid channel number: ${t}`),!1;const e=this.channelSources[t];return e&&(e.dispose(),this.channelSources[t]=null),!0}clearSources(){for(let t=0;t<4;t++){const e=this.channelSources[t];e&&(e.dispose(),this.channelSources[t]=null)}}read(t){switch(t&3){case 0:return this.status;case 1:return this.high;case 2:return this.low}return 64}write(t,e){(t&3)===0&&(this.task.cancel(),this.task.schedule(e&8?2e4:8e3),this.status=e&15|128,this.sysvia.setcb1(!0))}onComplete(){const t=this.status&3,e=this.channelSources[t],s=e?e.getValue(t):32768;this.status=this.status&15|64|s>>>10&3,this.low=s&255,this.high=s>>>8&255,this.sysvia.setcb1(!1)}}const d0=4294967295;class DS{static get MaxHeadroom(){return d0}constructor(){this.scheduled=null,this.epoch=0}schedule(t,e){if(t.scheduler!==this)throw new Error("Wrong scheduler for task, or non-task");if(t.scheduled())throw new Error("Task is already scheduled");const s=e+this.epoch;t.expireEpoch=s,t._scheduled=!0;let r=this.scheduled,a=null;for(;r&&r.expireEpoch<=s;)a=r,r=r.next;t.next=r,t.prev=a,t.next&&(t.next.prev=t),t.prev?t.prev.next=t:this.scheduled=t}cancel(t){t.scheduled()&&(t.prev?t.prev.next=t.next:this.scheduled=t.next,t.next&&(t.next.prev=t.prev),t.next=t.prev=null,t._scheduled=!1)}polltime(t){const e=this.epoch+t;for(;this.scheduled&&this.scheduled.expireEpoch<=e;){const s=this.scheduled;this.epoch=s.expireEpoch,s.cancel(),s.onExpire()}this.epoch=e}headroom(){return this.scheduled===null?d0:this.scheduled.expireEpoch-this.epoch}newTask(t){return new RS(this,t)}}class RS{constructor(t,e){this.scheduler=t,this.prev=null,this.next=null,this.expireEpoch=0,this.onExpire=e,this._scheduled=!1}scheduled(){return this._scheduled}schedule(t){this.scheduler.schedule(this,t)}reschedule(t){this.scheduler.cancel(this),this.scheduler.schedule(this,t)}cancel(){this.scheduler.cancel(this)}ensureScheduled(t,e){t?this.scheduled()||this.schedule(e):this.cancel()}}const LS=8,p0=2*1e3*1e3/LS;function m0(i,t,e){return i=(i-e)/(1-2*e),i*t}class PS{constructor(t){this.scheduler=t,this.mouse=[],this.outBuffer=new jw(16),this.delay=0,this.mode=0,this.pollTask=this.scheduler.newTask(this.poll)}tryReceive(t){return this.outBuffer.size&&t?this.outBuffer.get():-1}doRead(){const a=m0(this.mouse.x,120,.13),c=m0(1-this.mouse.y,100,.03),h=[79,79,79,79],m=Math.min(255,Math.max(0,a))|0,d=Math.min(255,Math.max(0,c))|0;this.mouse.button&&(h[0]=64|(m&240)>>>4,h[1]=64|m&15,h[2]=64|(d&240)>>>4,h[3]=64|d&15);for(let p=0;p<4;++p)this.store(h[p]);this.store(46)}poll(){this.doRead(),this.pollTask.reschedule(p0)}store(t){this.outBuffer.put(t)}onMouse(t,e,s){this.mouse={x:t,y:e,button:s}}onTransmit(t){switch(String.fromCharCode(t)){case"M":this.mode=0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":this.mode=10*this.mode+t-48;break;case".":break;case"?":this.mode===1&&this.doRead();break}this.pollTask.ensureScheduled(this.mode===129||this.mode===130,p0)}}const g0=5,_0=860,IS=5e4;class OS{constructor(t){this.cpu=t,this.teletextStatus=15,this.teletextInts=!1,this.teletextEnable=!1,this.channel=0,this.currentFrame=0,this.totalFrames=0,this.rowPtr=0,this.colPtr=0,this.frameBuffer=new Array(16).fill(0).map(()=>new Array(64).fill(0)),this.streamData=null,this.pollCount=0}reset(t){t&&(console.log("Teletext adaptor: initialisation"),this.loadChannelStream(this.channel))}loadChannelStream(t){console.log("Teletext adaptor: switching to channel "+t);const e=this;Ze("teletext/txt"+t+".dat").then(function(s){e.streamData=s,e.totalFrames=s.length/_0,e.currentFrame=0})}read(t){let e=0;switch(t){case 0:e=this.teletextStatus;break;case 1:break;case 2:e=this.frameBuffer[this.rowPtr][this.colPtr++];break;case 3:this.teletextStatus&=-209,this.cpu.interrupt&=-33;break}return e}write(t,e){switch(t){case 0:this.teletextInts=(e&8)===8,this.teletextInts&&this.teletextStatus&128?this.cpu.interrupt|=1<<g0:this.cpu.interrupt&=-33,this.teletextEnable=(e&4)===4,(e&3)!==this.channel&&this.teletextEnable&&(this.channel=e&3,this.loadChannelStream(this.channel));break;case 1:this.rowPtr=e,this.colPtr=0;break;case 2:this.frameBuffer[this.rowPtr][this.colPtr++]=e&255;break;case 3:this.teletextStatus&=-209,this.cpu.interrupt&=-33;break}}polltime(t){this.pollCount+=t,this.pollCount>IS&&(this.pollCount=0,this.cpu.resetLine?this.update():this.pollCount=-5e4*10)}update(){this.currentFrame>=this.totalFrames&&(this.currentFrame=0);const t=this.currentFrame*_0+3*43;if(this.teletextStatus&=15,this.teletextStatus|=208,this.teletextEnable)for(let e=0;e<16;++e)if(this.streamData[t+e*43]!==0){this.frameBuffer[e][0]=103;for(let s=1;s<=42;s++)this.frameBuffer[e][s]=this.streamData[t+(e*43+(s-1))]}else this.frameBuffer[e][0]=0;this.currentFrame++,this.rowPtr=0,this.colPtr=0,this.teletextInts&&(this.cpu.interrupt|=1<<g0)}}class x0{constructor(){this.control1=0,this.control2=0,this.control3=0,this.control4=0,this.txfifo=new Uint8Array(3),this.rxfifo=new Uint8Array(3),this.txfptr=0,this.rxfptr=0,this.txftl=0,this.rxffc=0,this.rxap=0,this.status1=0,this.status2=0,this.sr2pse=0,this.cts=0,this.idle=0}}class ai{constructor(...t){this.buffer=new Uint8Array(32*1024),this.pointer=0,this.bytesInBuffer=t.length,this.controlFlag=0,this.port=0;for(let e=0;e<t.length;e++)this.buffer[e]=t[e]}get full(){return this.pointer>=this.buffer.length}}class MS{constructor(t,e,s,r,a){this.id=t,this.controlFlag=e,this.receivePort=s,this.bufferStart=r,this.bufferEnd=a,this.data=new ai,this.stationId=0}}class NS{constructor(t){this.TIME_BETWEEN_BYTES=128,this.SERVER_STATION_ID=254,this.FWH_Idle=0,this.FWH_RX_Scout_Received=1,this.FWH_RX_ScoutAck_Received=2,this.FWH_RX_Body_Received=3,this.FWH_TX_Scout_Sent=4,this.stationId=t,this.ADLC=new x0,this.ADLCprev=new x0,this.beebTx=new ai,this.beebRx=new ai,this.serverTx=new ai,this.pollTotalCycles=0,this.pollNextTrigger=0,this.powers=[1,2,4,8],this.econetNMIEnabled=!0,this.econetStateChanged=!1,this.receiveBlocks=[],this.nextReceiveBlockNumber=1,this.wireState=this.FWH_Idle,this.wireStateEntryTimer=0,this.statusLight=!1,this.txPort=0,this.txControlFlag=0}copyBuffer(t,e){t.bytesInBuffer=e.bytesInBuffer,t.pointer=e.pointer,t.buffer=e.buffer.slice()}sniffBuffer(t){let e=Math.min(30,t.pointer),s="";for(let r=0;r<e;r++)s+=(t.buffer[r]<16?"0":"")+t.buffer[r].toString(16)+" ";return s+="("+t.pointer+" bytes)",s}deleteReceiveBlock(t){let e=this.receiveBlocks.findIndex(s=>s.id===t);e>=0&&this.receiveBlocks.splice(e,1)}activityLight(){return this.statusLight}advanceState(t){this.wireState=t,this.wireStateEntryTimer=this.pollTotalCycles,this.wireState>0&&(this.statusLight=!0)}polltime(t){if(this.pollTotalCycles+=t,this.pollNextTrigger<=this.pollTotalCycles||this.econetStateChanged){if(this.econetStateChanged=!1,this.wireState===this.FWH_Idle&&this.serverTx.bytesInBuffer>0&&(this.beebRx=new ai(this.stationId,0,this.SERVER_STATION_ID,0,this.serverTx.controlFlag,this.serverTx.port),this.advanceState(this.FWH_RX_Scout_Received)),this.wireState===this.FWH_RX_ScoutAck_Received&&(this.copyBuffer(this.beebRx,this.serverTx),this.advanceState(this.FWH_RX_Body_Received)),this.pollTotalCycles>this.wireStateEntryTimer+1e6)if(this.wireState!==this.FWH_Idle)switch(this.wireState){case this.FWH_RX_Scout_Received:this.beebRx=new ai(this.stationId,0,this.SERVER_STATION_ID,0,this.serverTx.controlFlag,this.serverTx.port),this.advanceState(this.FWH_RX_Scout_Received);break;case this.FWH_RX_Body_Received:this.copyBuffer(this.beebRx,this.serverTx),this.advanceState(this.FWH_RX_Body_Received);break;default:this.beebRx=new ai(this.SERVER_STATION_ID,0,this.stationId,0)}else this.statusLight=!1;return this.updateRegisters(),this.pollNextTrigger<=this.pollTotalCycles&&(this.transmit(),this.receive()),this.status(),this.checkForNMI()}return!1}reset(){console.log("Econet: initialisation"),this.ADLC.control1=192,this.ADLC.control4=0,this.ADLC.control2=0,this.ADLC.control3=0,this.ADLC.status1=0,this.ADLC.status2=0,this.ADLC.sr2pse=0,this.ADLC.rxfptr=0,this.ADLC.rxap=0,this.ADLC.rxffc=0,this.ADLC.txfptr=0,this.ADLC.txftl=0,this.ADLC.idle=1,this.ADLC.cts=0,this.irqcause=0,this.sr1b2cause=0,this.pollNextTrigger=this.pollTotalCycles+this.TIME_BETWEEN_BYTES,this.econetStateChanged=!0,this.receiveBlocks=[],this.nextReceiveBlockNumber=1}readRegister(t){return t===0?this.ADLC.status1:t===1?this.ADLC.status2:t>1&&(this.ADLC.control1&64)===0&&this.ADLC.rxfptr&&this.ADLC.rxfptr?(this.econetStateChanged=!0,this.ADLC.rxfifo[--this.ADLC.rxfptr]):0}writeRegister(t,e){t===0?this.ADLC.control1=e:t===1&&!(this.ADLC.control1&1)?this.ADLC.control2=e:t===1&&this.ADLC.control1&1?this.ADLC.control3=e:t===3&&this.ADLC.control1&1?this.ADLC.control4=e:(t===2||t===3)&&(this.ADLC.control1&128)===0&&(this.ADLC.txfifo[2]=this.ADLC.txfifo[1],this.ADLC.txfifo[1]=this.ADLC.txfifo[0],this.ADLC.txfifo[0]=e,this.ADLC.txfptr++,this.ADLC.txftl=this.ADLC.txftl<<1,t===3&&(this.ADLC.control2|=16)),this.econetStateChanged=!0}updateRegisters(){this.ADLCprev.status1=this.ADLC.status1,this.ADLCprev.status2=this.ADLC.status2,this.ADLC.control1&32&&(this.beebRx.pointer=0,this.beebRx.bytesInBuffer=0,this.ADLC.rxfptr=0,this.ADLC.rxap=0,this.ADLC.rxffc=0,this.ADLC.control1&=-33),this.ADLC.control2&16&&(this.ADLC.txftl|=1,this.ADLC.control2&=-17),(this.ADLC.control2&32||this.ADLC.control1&64)&&(this.ADLC.control2&=-33,this.ADLC.status1&=-11,this.ADLC.status2&=-127,this.ADLC.control2&1&&this.ADLC.sr2pse?(this.ADLC.sr2pse++,this.ADLC.sr2pse>4&&(this.ADLC.sr2pse=0)):this.ADLC.sr2pse=0,this.sr1b2cause=0,this.ADLC.control1&64&&(this.beebRx.pointer=0,this.beebRx.bytesInBuffer=0,this.ADLC.rxfptr=0,this.ADLC.rxap=0,this.ADLC.rxffc=0,this.ADLC.sr2pse=0)),(this.ADLC.control2&64||this.ADLC.control1&128)&&(this.ADLC.control2&=-65,this.ADLC.status1&=-113,this.ADLC.cts&&(this.ADLC.status1|=16,this.ADLCprev.status1|=16),this.ADLC.control1&128&&(this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0,this.ADLC.txfptr=0,this.ADLC.txftl=0)),this.ADLC.control4&32&&(this.ADLC.txfptr=0,this.ADLC.txftl=0,this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0,this.ADLC.control4&=-33)}transmit(){if(!(this.ADLC.control1&128)&&this.ADLC.txfptr){let t=!1;if(this.ADLC.txftl&this.powers[this.ADLC.txfptr-1]&&(t=!0),this.beebTx.full||this.ADLC.txfptr>4?(this.ADLC.status1|=32,this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0,this.ADLC.txfptr=0,this.ADLC.txftl=0):(this.beebTx.buffer[this.beebTx.pointer]=this.ADLC.txfifo[--this.ADLC.txfptr],this.beebTx.pointer++),t){if(this.beebTx.bytesInBuffer=this.beebTx.pointer,this.beebTx.bytesInBuffer===10&&this.beebTx.buffer[5]===0&&this.beebTx.buffer[4]>=130&&this.beebTx.buffer[4]<=136&&(this.beebRx=new ai(this.stationId,0,this.SERVER_STATION_ID,0,1,0,96,3)),this.beebTx.bytesInBuffer===4&&(this.wireState===this.FWH_RX_Scout_Received&&this.advanceState(this.FWH_RX_ScoutAck_Received),this.wireState===this.FWH_RX_Body_Received&&(this.serverTx.bytesInBuffer=0,this.advanceState(this.FWH_Idle))),this.beebTx.bytesInBuffer>=6&&this.wireState===this.FWH_TX_Scout_Sent){let e=this.receiveBlocks.find(s=>s.receivePort===this.txPort);e&&(this.copyBuffer(e.data,this.beebTx),e.stationId=this.stationId,e.controlFlag=this.txControlFlag),this.beebRx=new ai(this.stationId,0,this.SERVER_STATION_ID,0),this.advanceState(this.FWH_Idle)}this.beebTx.bytesInBuffer===6&&this.wireState===this.FWH_Idle&&(this.txControlFlag=this.beebTx.buffer[4],this.txPort=this.beebTx.buffer[5],this.receiveBlocks.find(e=>e.receivePort===this.txPort)&&(this.beebRx=new ai(this.stationId,0,this.SERVER_STATION_ID,0),this.advanceState(this.FWH_TX_Scout_Sent))),this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0}}}receive(){this.ADLC.control1&64||(this.beebRx.pointer<this.beebRx.bytesInBuffer&&this.ADLC.rxfptr<3&&(this.ADLC.rxfifo[2]=this.ADLC.rxfifo[1],this.ADLC.rxfifo[1]=this.ADLC.rxfifo[0],this.ADLC.rxfifo[0]=this.beebRx.buffer[this.beebRx.pointer],this.ADLC.rxfptr++,this.ADLC.rxffc=this.ADLC.rxffc<<1&7,this.ADLC.rxap=this.ADLC.rxap<<1&7,this.beebRx.pointer===0&&(this.ADLC.rxap|=1),this.beebRx.pointer++,this.beebRx.pointer>=this.beebRx.bytesInBuffer&&(this.ADLC.rxffc|=1,this.beebRx.pointer=0,this.beebRx.bytesInBuffer=0)),this.ADLC.rxfptr===0&&(this.ADLC.control1&=-33)),!(this.ADLC.control1&64)&&!this.ADLC.rxfptr&&!(this.ADLC.status2&2)&&this.beebRx.bytesInBuffer===0?this.ADLC.idle=!0:this.ADLC.idle=!1,this.pollNextTrigger=this.pollTotalCycles+this.TIME_BETWEEN_BYTES}status(){this.ADLC.control1&64||(this.ADLC.rxfptr&&!(this.ADLC.control2&2)||this.ADLC.rxfptr>1&&this.ADLC.control2&2?(this.ADLC.status1|=1,this.ADLC.status2|=128):(this.ADLC.status1&=-2,this.ADLC.status2&=-129)),this.ADLC.status1&=-9,this.ADLC.control2&128?(this.ADLC.cts=!1,this.ADLC.status1&=-17):this.ADLC.cts=!0,this.ADLC.control1&128&&this.ADLC.cts&&(this.ADLC.status1|=16),this.ADLC.txfptr>4&&(this.ADLC.status1|=32,this.ADLC.txfptr=4),this.ADLC.control1&128||(this.ADLC.control2&8?this.ADLC.txfptr?this.ADLC.status1&=-65:this.ADLC.status1|=64:(this.ADLC.txfptr<3&&!(this.ADLC.control2&2)||this.ADLC.txfptr<2&&this.ADLC.control2&2)&&!(this.ADLC.status1&16)&&!(this.ADLC.status2&32)?this.ADLC.status1|=64:this.ADLC.status1&=-65),this.ADLC.control1&64||(this.ADLC.rxfptr&&this.ADLC.rxap&this.powers[this.ADLC.rxfptr-1]?this.ADLC.status2|=1:this.ADLC.status2&=-2,this.ADLC.rxfptr&&this.ADLC.rxffc&this.powers[this.ADLC.rxfptr-1]&&(this.ADLC.status2|=2),this.ADLC.idle?this.ADLC.status2|=4:this.ADLC.status2&=-5),this.ADLC.status2&=-33,this.ADLC.rxfptr>4&&(this.ADLC.status2|=64,this.ADLC.rxfptr=4),this.ADLC.control2&1?(this.ADLC.sr2pse<=1&&this.ADLC.status2&122?(this.ADLC.sr2pse=1,this.ADLC.status2&=-134):this.ADLC.sr2pse<=2&&this.ADLC.status2&4?(this.ADLC.sr2pse=2,this.ADLC.status2&=-130):this.ADLC.sr2pse<=3&&this.ADLC.status2&1?(this.ADLC.sr2pse=3,this.ADLC.status2&=-129):this.ADLC.status2&128?(this.ADLC.sr2pse=4,this.ADLC.status2&=-3):this.ADLC.sr2pse=0,this.ADLC.status2&128?this.ADLC.status1|=1:this.ADLC.status1&=-2):this.ADLC.sr2pse=0}checkForNMI(){let t=!1;if(this.ADLC.status1!==this.ADLCprev.status1||this.ADLC.status2!==this.ADLCprev.status2){let e,s;e=(this.ADLC.status2^this.ADLCprev.status2)&this.ADLC.status2&-129,this.ADLC.control1&2||(e=0),e?(this.ADLC.status1|=2,this.sr1b2cause=this.sr1b2cause|e):this.ADLC.status2&this.sr1b2cause||(this.ADLC.status1&=-3,this.sr1b2cause=0),e=(this.ADLC.status1^this.ADLCprev.status1)&this.ADLC.status1&-129,this.ADLC.control1&2||(e=e&-12),this.ADLC.control1&4||(e=e&-113),e&&(t=!0,this.irqcause=this.irqcause|e,this.ADLC.status1|=128),s=(this.ADLC.status1^this.ADLCprev.status1)&this.ADLCprev.status1&-129,s&&(this.irqcause=this.irqcause&~s,this.irqcause===0?this.ADLC.status1&=-129:this.ADLC.control2&1&&(t=!0))}return t}}class BS{constructor(t,e){this.cpu=t,this.econet=e,this.scsi=[],this.l3fs=[],this.pollCount=0,this.ram=new Uint8Array(96*1024),this.emulationSpeed=0,this.logTemp="",this.A=this.X=this.Y=this.SP=this.M=0,this.PC=this.XPC=this.L=this.R=0,this.N=this.V=this.Z=this.C=this.F=0}GBYTE(){return this.ram[this.PC++]}GWORD(){return this.ram[this.PC++]|this.ram[this.PC++]<<8}WORD(t){return this.ram[t]|this.ram[t+1]<<8}PUSH(t){this.ram[256+this.SP]=t,this.SP--,this.SP&=255}PULL(){return this.SP++,this.SP&=255,this.ram[256+this.SP]}NZ(t){return t&=255,this.Z=0|t===0,this.N=0|t>=128,t}oswrch(t){this.emulationSpeed===0&&(t>=32&&t<=127&&(this.logTemp+=String.fromCharCode(t)),t===13&&(console.log("Filestore: "+this.logTemp.trim()),this.logTemp.includes("Starting")&&(this.emulationSpeed=20),this.logTemp=""))}osword(){let t=this.Y<<8|this.X;switch(this.A){case 0:{let e=this.ram[t]|this.ram[t+1]<<8;this.ram[e]=49,this.ram[e+1]=13,this.Y=1,this.C=0,this.oswrch(49);break}case 14:{const e=new Date;this.ram[t]=e.getFullYear()-2e3,this.ram[t+1]=e.getMonth()+1,this.ram[t+2]=e.getDate(),this.ram[t+3]=e.getDay()+1,this.ram[t+4]=e.getHours(),this.ram[t+5]=e.getMinutes(),this.ram[t+6]=e.getSeconds();break}case 16:{let e=this.ram[t+2];if(e!==255){let s=(this.ram[t+4]|this.ram[t+5]<<8|this.ram[t+6]<<16|this.ram[t+7]<<24)>>>0,a=((this.ram[t+8]|this.ram[t+9]<<8|this.ram[t+10]<<16|this.ram[t+11]<<24)>>>0)-s;s>=65536&&(s=s&65535|65536),this.econet.serverTx=new ai(e,0,254,0),this.econet.serverTx.controlFlag=this.ram[t],this.econet.serverTx.port=this.ram[t+1];for(let c=0;c<a;c++)this.econet.serverTx.buffer[c+4]=this.ram[s+c];this.econet.serverTx.bytesInBuffer=4+a}break}case 17:{if(this.ram[t+0]===0){let e=new MS(this.econet.nextReceiveBlockNumber,this.ram[t+1],this.ram[t+2],(this.ram[t+5]|this.ram[t+6]<<8|this.ram[t+7]<<16|this.ram[t+8]<<24)>>>0,(this.ram[t+9]|this.ram[t+10]<<8|this.ram[t+11]<<16|this.ram[t+12]<<24)>>>0);this.econet.receiveBlocks.push(e),this.ram[t]=this.econet.nextReceiveBlockNumber,this.econet.nextReceiveBlockNumber++,this.econet.nextReceiveBlockNumber&=255,this.econet.nextReceiveBlockNumber===0&&(this.econet.nextReceiveBlockNumber=1)}else{let e=this.econet.receiveBlocks.find(r=>r.id===this.ram[t+0]);e.bufferStart+e.data.bytesInBuffer-4<e.bufferEnd&&(e.bufferEnd=e.bufferStart+e.data.bytesInBuffer-4),this.ram[t+1]=e.controlFlag,this.ram[t+2]=e.receivePort,this.ram[t+3]=e.stationId,this.ram[t+4]=0,this.ram[t+5]=e.bufferStart&255,this.ram[t+6]=e.bufferStart>>>8&255,this.ram[t+7]=e.bufferStart>>>16&255,this.ram[t+8]=e.bufferStart>>>24&255,this.ram[t+9]=e.bufferEnd&255,this.ram[t+10]=e.bufferEnd>>>8&255,this.ram[t+11]=e.bufferEnd>>>16&255,this.ram[t+12]=e.bufferEnd>>>24&255;let s=e.bufferStart;s>=65536&&(s=s&65535|65536);for(let r=0;r<e.bufferEnd-e.bufferStart;r++)this.ram[s+r]=e.data.buffer[r+4];this.econet.deleteReceiveBlock(this.ram[t])}break}case 19:this.ram[t+1]=254;break;case 114:{let e=(this.ram[t+1]|this.ram[t+2]<<8|this.ram[t+3]<<16|this.ram[t+4]<<24)>>>0;e>=65536&&(e=e&65535|65536);let s=4,r=(this.ram[t+6]&31)<<16|this.ram[t+7]<<8|this.ram[t+8],a=this.ram[t+9]*256;switch(a||(a=this.ram[t+11]|(this.ram[t+12]<<8|this.ram[t+13]<<16|this.ram[t+14]<<24>>>0)),this.ram[t+5]){case 8:case 10:if(this.ram[t+5]===8)for(let c=r*256;c<r*256+a;c++)this.ram[e++]=this.scsi[c];else for(let c=r*256;c<r*256+a;c++)this.scsi[c]=this.ram[e++];s=0;break}this.ram[t]=s;break}case 115:this.ram[t]=0,this.ram[t+1]=0,this.ram[t+2]=0,this.ram[t+3]=0,this.ram[t+4]=0;break;default:console.log("Filestore: unhandled osword 0x"+this.A.toString(16));break}}osbyte(){switch(this.A){case 13:case 14:case 15:break;case 50:this.econet.serverTx.bytesInBuffer>0?this.X=128:this.X=0;break;case 51:{let t=this.econet.receiveBlocks.find(e=>e.id===this.X);this.X=0,t&&(this.X=t.controlFlag,this.X>=128&&(this.X=t.controlFlag));break}case 52:this.econet.deleteReceiveBlock(this.X);break;case 53:break;case 133:this.X=0,this.Y=128;break;case 134:this.X=this.Y=0;break;case 135:case 150:case 151:break;case 180:this.X=0;break;case 229:break;default:console.log("Filestore: unhandled osbyte 0x"+this.A.toString(16));break}}reset(){console.log("Filestore: initialisation");const t=this;Ze("econet/L3FS.dat").then(function(e){t.l3fs=e;for(let s=0;s<e.length;s++)t.ram[1024+s]=e[s];t.PC=1024,t.SP=255,t.A=1}),Ze("econet/scsi.dat").then(function(e){t.scsi=e})}polltime(t){if(this.pollCount+=t,this.pollCount>this.emulationSpeed){this.pollCount=0;let e,s,r,a=0;if(this.XPC=this.PC,this.PC>=63488?e=96:e=this.GBYTE(),s=e&31,r=s&3,a=e>>5,s===0&&a<4)switch(a){case 0:this.PC=this.WORD(514);break;case 1:this.L=this.GWORD(),this.PUSH(--this.PC>>8),this.PUSH(this.PC),this.PC=this.L;break;case 2:break;case 3:this.PC=this.PULL(),this.PC|=this.PULL()<<8,this.PC++;break}else if(s===8)switch(a){case 0:this.M=this.N<<7|this.V<<6|this.Z<<1|this.C,this.PUSH(this.M);break;case 1:this.M=this.PULL(),this.N=(this.M&128)>0,this.V=(this.M&64)>0,this.Z=(this.M&2)>0,this.C=this.M&1;break;case 2:this.PUSH(this.A);break;case 3:this.A=this.NZ(this.PULL());break;case 4:this.Y--,this.Y&=255,this.NZ(this.Y);break;case 5:this.Y=this.NZ(this.A);break;case 6:this.Y++,this.Y&=255,this.NZ(this.Y);break;case 7:this.X++,this.X&=255,this.NZ(this.X);break}else if(s===10&&a>3)switch(a){case 4:this.A=this.NZ(this.X);break;case 5:this.X=this.NZ(this.A);break;case 6:this.X--,this.X&=255,this.NZ(this.X);break}else if(s===16){let c=~a&1;switch(a>>1){case 0:c^=this.N;break;case 1:c^=this.V;break;case 2:c^=this.C;break;case 3:c^=this.Z;break}this.M=this.GBYTE(),c&&(this.M&128&&(this.PC-=256),this.PC+=this.M)}else if(s===24)switch(a){case 0:this.C=0;break;case 1:this.C=1;break;case 2:break;case 3:break;case 4:this.A=this.NZ(this.Y);break;case 5:this.V=0;break}else if(s===26)a&1?this.X=this.NZ(this.SP):this.SP=this.X;else{let c=0,h=0,m=0;if(s===10)c=1;else if(s===1)this.L=this.GBYTE()+this.X,this.L=this.WORD(this.L);else if(s===25||e===190)this.L=this.GWORD()+this.Y;else switch(s>>2){case 0:case 2:h=1;break;case 1:this.L=this.GBYTE();break;case 3:this.L=this.GWORD();break;case 4:this.L=this.GBYTE(),this.L=this.WORD(this.L)+this.Y;break;case 5:e===150?this.L=this.GBYTE()+this.Y:this.L=this.GBYTE()+this.X;break;case 7:this.L=this.GWORD()+this.X;break}switch(c?this.M=this.A:h?this.M=this.GBYTE():this.M=this.ram[this.L],r){case 0:switch(a){case 1:this.NZ(this.A&this.M),this.V=(this.M&64)>0,this.N=(this.M&128)>0;break;case 2:this.PC=this.L;break;case 3:this.PC=this.WORD(this.L);break;case 4:this.M=this.Y,m=1;break;case 5:this.Y=this.NZ(this.M);break;case 6:this.NZ(this.Y-this.M),this.C=this.Y>=this.M;break;case 7:this.NZ(this.X-this.M),this.C=this.X>=this.M;break}break;case 1:switch(a){case 0:this.A=this.NZ(this.A|this.M);break;case 1:this.A=this.NZ(this.A&this.M);break;case 2:this.A=this.NZ(this.A^this.M);break;case 7:this.M=~this.M&255;case 3:this.R=this.A+this.M+this.C,this.C=this.R>=256,this.V=((this.A^this.R)&(this.M^this.R)&128)>0,this.A=this.NZ(this.R);break;case 4:this.M=this.A,m=1;break;case 5:this.A=this.NZ(this.M);break;case 6:this.NZ(this.A-this.M),this.C=this.A>=this.M;break}break;case 2:switch(m=1,a){case 0:this.C=0;case 1:this.F=(this.M&128)>0,this.M=this.NZ(this.M<<1|this.C),this.C=this.F;break;case 2:this.C=0;case 3:this.F=this.M&1,this.M=this.NZ(this.M>>1|this.C<<7),this.C=this.F;break;case 4:this.M=this.X;break;case 5:this.X=this.NZ(this.M),m=0;break;case 6:this.M--,this.M&=255,this.NZ(this.M);break;case 7:this.M++,this.M&=255,this.NZ(this.M);break}break}m&&(c?this.A=this.M:this.ram[this.L]=this.M)}if(this.PC>=63488)switch(this.PC){case 63488:break;case 65504:this.A=83,this.C=0;break;case 65521:this.osword();break;case 65524:this.osbyte();break;case 65511:case 65507:case 65518:this.oswrch(this.A);break}}}}const FS=dp;function tr(i,t,e){return i&~t|(e?t:0)}class US{constructor(){this._byte=48}get c(){return!!(this._byte&1)}set c(t){this._byte=tr(this._byte,1,t)}get z(){return!!(this._byte&2)}set z(t){this._byte=tr(this._byte,2,t)}get i(){return!!(this._byte&4)}set i(t){this._byte=tr(this._byte,4,t)}get d(){return!!(this._byte&8)}set d(t){this._byte=tr(this._byte,8,t)}get v(){return!!(this._byte&64)}set v(t){this._byte=tr(this._byte,64,t)}get n(){return!!(this._byte&128)}set n(t){this._byte=tr(this._byte,128,t)}reset(){this._byte=48}debugString(){return(this.n?"N":"n")+(this.v?"V":"v")+"xx"+(this.d?"D":"d")+(this.i?"I":"i")+(this.z?"Z":"z")+(this.c?"C":"c")}setzn(t){return t&=255,this._byte=this._byte&-131|t&128|(t===0?2:0),t|0}asByte(){return this._byte|48}setFromByte(t){this._byte=t|48}}class yp{constructor(t){this.model=t,this.a=this.x=this.y=this.s=0,this.p=new US,this.pc=0,this.opcodes=t.opcodesFactory(this),this.disassembler=this.opcodes.disassembler,this.forceTracing=!1,this.runner=this.opcodes.runInstruction,this.interrupt=0,this._nmiLevel=!1,this._nmiEdge=!1,t.nmos?(this.adc=function(e){this.p.d?this.adcBCD(e):this.adcNonBCD(e)},this.sbc=function(e){this.p.d?this.sbcBCD(e):this.adcNonBCD(e^255)}):(this.adc=function(e){this.p.d?this.adcBCDcmos(e):this.adcNonBCD(e)},this.sbc=function(e){this.p.d?this.sbcBCDcmos(e):this.adcNonBCD(e^255)})}incpc(){this.pc=this.pc+1&65535}getb(){const t=this.readmem(this.pc);return this.incpc(),t|0}getw(){let t=this.readmem(this.pc)|0;return this.incpc(),t|=(this.readmem(this.pc)|0)<<8,this.incpc(),t|0}checkInt(){this.takeInt=!!(this.interrupt&&!this.p.i),this.takeInt|=this._nmiEdge}writemem(t,e){throw new Error("Must be overridden")}writememZpStack(t,e){this.writemem(t,e)}readmem(t){throw new Error("Must be overridden")}readmemZpStack(t){return this.readmem(t)}push(t){this.writememZpStack(256+this.s,t),this.s=this.s-1&255}pull(){return this.s=this.s+1&255,this.readmemZpStack(256+this.s)}get nmi(){return this._nmiLevel}NMI(t){const e=this._nmiLevel;this._nmiLevel=!!t,this._nmiLevel&&!e&&(this._nmiEdge=!0)}polltime(){throw new Error("Must be overridden")}brk(t){let e=this.pc;t||(e=e+1&65535),this.readmem(e),this.push(e>>>8),this.push(e&255);let s=this.p.asByte();t&&(s&=-17),this.push(s),this.polltime(4);let r=65534;(this.model.nmos||t)&&this._nmiEdge&&(r=65530,this._nmiEdge=!1),this.takeInt=!1,this.pc=this.readmem(r)|this.readmem(r+1)<<8,this.p.i=!0,this.model.nmos?this.polltime(3):(this.p.d=!1,t?this.polltime(3):(this.polltime(2),this.checkInt(),this.polltime(1)))}branch(t){const e=FS(this.getb());if(!t){this.polltime(1),this.checkInt(),this.polltime(1);return}const s=this.pc+e&65535,r=!!(this.pc&65280^s&65280);if(this.pc=s,!this.model.nmos)this.polltime(2+r),this.checkInt(),this.polltime(1);else if(!r)this.polltime(1),this.checkInt(),this.polltime(2);else{this.polltime(1),this.checkInt();const a=this.takeInt;this.polltime(2),this.checkInt(),this.takeInt|=a,this.polltime(1)}}adcNonBCD(t){const e=this.a+t+(this.p.c?1:0);this.p.v=!!((this.a^e)&(t^e)&128),this.p.c=!!(e&256),this.a=this.p.setzn(e)}adcBCD(t){let e=0;const s=this.a+t+(this.p.c?1:0)&255;this.p.z=!s;let r=(this.a&15)+(t&15)+(this.p.c?1:0);r>9&&(r-=10,r&=15,e=1),e+=(this.a>>>4)+(t>>>4),this.p.n=!!(e&8),this.p.v=!((this.a^t)&128)&&!!((this.a^e<<4)&128),this.p.c=!1,e>9&&(this.p.c=!0,e-=10,e&=15),this.a=(r&15|e<<4)&255}sbcBCD(t){const e=this.p.c?0:1;let s=(this.a&15)-(t&15)-e,r=(this.a>>>4)-(t>>>4);s&16&&(s=s-6&15,r--),r&16&&(r=r-6&15);const a=this.a-t-e;this.p.n=!!(a&128),this.p.z=!(a&255),this.p.v=!!((this.a^a)&(t^this.a)&128),this.p.c=!(a&256),this.a=s|r<<4}adcBCDcmos(t){this.polltime(1);const e=this.p.c?1:0;let s=(this.a&15)+(t&15)+e,r=(this.a>>>4)+(t>>>4);s>9&&(s=s-10&15,r++),this.p.v=!((this.a^t)&128)&&!!((this.a^r<<4)&128),this.p.c=!1,r>9&&(r=r-10&15,this.p.c=!0),this.a=this.p.setzn(s|r<<4)}sbcBCDcmos(t){this.polltime(1);const e=this.p.c?0:1,s=(this.a&15)-(t&15)-e;let r=this.a-t-e;r<0&&(r-=96),s<0&&(r-=6),this.adcNonBCD(t^255),this.a=this.p.setzn(r)}arr(t){if(this.p.d){const e=this.a&t,s=e>>>4,r=e&15;this.p.n=this.p.c,this.a=e>>>1|(this.p.c?128:0),this.p.z=!this.a,this.p.v=(e^this.a)&64,r+(r&1)>5&&(this.a=this.a&240|this.a+6&15),this.p.c=s+(s&1)>5,this.p.c&&(this.a=this.a+96&255)}else this.a=this.a&t,this.p.v=!!((this.a>>>7^this.a>>>6)&1),this.a>>>=1,this.p.c&&(this.a|=128),this.p.setzn(this.a),this.p.c=!!(this.a&64)}}class $S extends yp{constructor(t,e){super(t),this.cycles=0,this.romPaged=!0,this.memory=new Uint8Array(65536),this.rom=new Uint8Array(4096),this.tube=new kS(e,this)}reset(t){this.romPaged=!0,this.pc=this.readmem(65532)|this.readmem(65533)<<8,this.p.i=!0,this.tube.reset(t)}readmem(t){return(t&65528)===65272?((t&7)===0&&(this.romPaged=!1),this.tube.parasiteRead(t)):this.romPaged&&(t&61440)===61440?this.rom[t&4095]:this.memory[t&65535]}readmemZpStack(t){return this.memory[t&65535]}writemem(t,e){if((t&65528)===65272)return this.tube.parasiteWrite(t,e);this.memory[t&65535]=e}writememZpStack(t,e){this.memory[t&65535]=e}polltime(t){this.cycles-=t}polltimeAddr(t){this.polltime(t)}read(t){return this.tube.hostRead(t)}write(t,e){this.tube.hostWrite(t,e)}execute(t){if(this.cycles+=t*2,!(this.cycles<3))for(;this.cycles>0;){const e=this.readmem(this.pc);this.incpc(),this.runner.run(e),this.takeInt&&this.brk(!0)}}async loadOs(){console.log("Loading tube rom from roms/"+this.model.os);const t=this.rom,e=await Ze("roms/"+this.model.os),s=e.length;if(s!==2048)throw new Error("Broken ROM file (length="+s+")");for(let r=0;r<s;++r)t[r+2048]=e[r]}}class HS{read(){return 254}write(){}execute(){}reset(){}}class zS{write(){}read(){return 255}}function WS(i){return i===void 0&&(i={}),i.keyLayout||(i.keyLayout="physical"),i.cpuMultiplier||(i.cpuMultiplier=1),i.userPort||(i.userPort=new zS),i.printerPort===void 0&&(i.printerPort=null),i.extraRoms=i.extraRoms||[],i.debugFlags=i.debugFlags||{},i}class Ko{constructor(t,e){this.cpu=t,this.functionName=e,this.handlers=[]}add(t){const e=this;return this.handlers.push(t),this.cpu[this.functionName]||(this.cpu[this.functionName]=function(){for(let s=0;s<e.handlers.length;++s){const r=e.handlers[s];if(r.apply(r,arguments))return e.cpu.stop(),!0}return!1}),t.remove=function(){e.remove(t)},t}remove(t){const e=this.handlers.indexOf(t);if(e<0)throw"Unable to find debug hook handler";this.handlers=this.handlers.slice(0,e).concat(this.handlers.slice(e+1)),this.handlers.length===0&&(this.cpu[this.functionName]=null)}clear(){this.handlers=[],this.cpu[this.functionName]=null}}function GS(i){const t=[!0,!1,!0,!0,!1,!1,!0,!1];return i>=64512&&i<65280&&(i<65024||t[i>>>5&7])}let vp=class extends yp{constructor(t,e,s,r,a,c,h,m,d){super(t),this.config=WS(m),this.debugFlags=this.config.debugFlags,this.cmos=h,this.debugger=e,this.video=s,this.crtc=this.video.crtc,this.ula=this.video.ula,this.soundChip=r,this.music5000=c,this.ddNoise=a,this.memStatOffsetByIFetchBank=0,this.memStatOffset=0,this.memStat=new Uint8Array(512),this.memLook=new Int32Array(512),this.ramRomOs=new Uint8Array(128*1024+17*16*16384),this.romOffset=128*1024,this.osOffset=this.romOffset+16*16*1024,this.romsel=0,this.acccon=0,this.oldPcArray=new Uint16Array(256),this.oldAArray=new Uint8Array(256),this.oldXArray=new Uint8Array(256),this.oldYArray=new Uint8Array(256),this.oldPcIndex=0,this.resetLine=!0,this.cpuMultiplier=this.config.cpuMultiplier,this.videoCyclesBatch=this.config.videoCyclesBatch|0,this.peripheralCyclesPerSecond=2*1e3*1e3,this.tube=t.tube?new $S(t.tube,this):new HS,this.music5000PageSel=0,this.econet=d,this.peripheralCycles=0,this.videoCycles=0,this.cpuMultiplier===1&&this.videoCyclesBatch===0?this.polltime=this.polltimeFast:this.polltime=this.polltimeSlow,this._debugRead=this._debugWrite=this._debugInstruction=null,this.debugInstruction=new Ko(this,"_debugInstruction"),this.debugRead=new Ko(this,"_debugRead"),this.debugWrite=new Ko(this,"_debugWrite"),this.scheduler=new DS,this.sysvia=new oS(this,this.scheduler,this.video,this.soundChip,this.cmos,this.model.isMaster,this.config.keyLayout,this.config.getGamepads),this.uservia=new cS(this,this.scheduler,this.model.isMaster,this.config.userPort),this.acia=new hS(this,this.soundChip.toneGenerator,this.scheduler,this.touchScreen),this.serial=new uS(this.acia),this.adconverter=new TS(this.sysvia,this.scheduler),this.soundChip.setScheduler(this.scheduler),this.fdc=new this.model.Fdc(this,this.ddNoise,this.scheduler,this.debugFlags)}getPrevPc(t){return this.oldPcArray[this.oldPcIndex-t&255]}romSelect(t){this.romsel=t;const s=((t&15)<<14)+this.romOffset-32768;for(let a=128;a<192;++a)this.memLook[a]=this.memLook[256+a]=s;const r=this.model.swram[t&15]?1:2;for(let a=128;a<192;++a)this.memStat[a]=this.memStat[256+a]=r;if(this.model.isMaster&&t&128)for(let a=128;a<144;++a)this.memLook[a]=this.memLook[256+a]=0,this.memStat[a]=this.memStat[256+a]=1}writeAcccon(t){this.acccon=t,this.videoDisplayPage=t&1?32768:0;const e=!!(t&2),s=!!(t&4),r=!!(t&8);for(let h=48;h<128;++h)this.memLook[h]=s?32768:0,r?this.memLook[h+256]=this.memLook[h]:this.memLook[h+256]=e?32768:0;const a=r?1:2,c=r?-12288:this.osOffset-49152;for(let h=192;h<224;++h)this.memLook[h]=this.memLook[h+256]=c,this.memStat[h]=this.memStat[h+256]=a}readmemZpStack(t){t&=65535;const e=this.ramRomOs[t];return this._debugRead&&this._debugRead(t,0,e),e|0}writememZpStack(t,e){t&=65535,e|=0,this._debugWrite&&this._debugWrite(t,e),this.ramRomOs[t]=e}readString(t){let e="";for(;;){const s=this.readmem(t);if(t++,s===0||s===13)break;e+=String.fromCharCode(s)}return e}findString(t,e){for(e=e|0;e<65535;++e){let s;for(s=0;s<t.length&&this.readmem(e+s)===t.charCodeAt(s);++s);if(s===t.length)return e}return null}readArea(t,e){let s="";for(let r=0;r<e;++r)s+=ct(this.readmem(t+r));return s}handleEconetStationId(){return this.econet?(this.econet.econetNMIEnabled=!1,this.econet.stationId):255}handleEconetNMIEnable(){return this.econet&&!this.econet.econetNMIEnabled&&(this.econet.econetNMIEnabled=!0,this.econet.ADLC.status1&128&&this.NMI(!0)),255}readDevice(t){if(this.model.isMaster&&this.acccon&64)return this.ramRomOs[this.osOffset+(t&16383)];switch(t&=65535,t&-4){case 64528:if(this.model.hasTeletextAdaptor)return this.teletextAdaptor.read(t-64528);break;case 64544:case 64548:case 64552:case 64556:case 64560:case 64564:case 64568:case 64572:break;case 64576:case 64580:case 64584:case 64588:case 64592:case 64596:case 64600:case 64604:break;case 64764:if(t===64767&&this.model.hasMusic5000)return this.music5000PageSel;break;case 65024:case 65028:return this.crtc.read(t);case 65032:case 65036:return this.acia.read(t);case 65040:case 65044:return this.serial.read(t);case 65048:return this.model.isMaster?this.adconverter.read(t):this.handleEconetStationId();case 65056:if(!this.model.isMaster)return this.handleEconetNMIEnable();break;case 65060:case 65064:if(this.model.isMaster)return this.fdc.read(t);break;case 65072:if(this.model.isMaster)return this.romsel&143;break;case 65076:if(this.model.isMaster)return this.acccon;break;case 65080:if(this.model.isMaster)return this.handleEconetStationId();break;case 65084:if(this.model.isMaster)return this.handleEconetNMIEnable();break;case 65088:case 65092:case 65096:case 65100:case 65104:case 65108:case 65112:case 65116:return this.sysvia.read(t);case 65120:case 65124:case 65128:case 65132:case 65136:case 65140:case 65144:case 65148:return this.uservia.read(t);case 65152:case 65156:case 65160:case 65164:case 65168:case 65172:case 65176:case 65180:if(!this.model.isMaster)return this.fdc.read(t);break;case 65184:if(this.econet)return this.econet.readRegister(t&3);break;case 65216:case 65220:case 65224:case 65228:case 65232:case 65236:case 65240:case 65244:if(!this.model.isMaster)return this.adconverter.read(t);break;case 65248:case 65252:case 65256:case 65260:case 65264:case 65268:case 65272:case 65276:return this.tube.read(t)}return this.model.hasMusic5000&&(this.music5000PageSel&240)===48&&(t&65280)===64768?this.music5000.read(this.music5000PageSel,t):t>=64512&&t<65024?255:t>>>8}videoRead(t){return this.ramRomOs[t|this.videoDisplayPage]|0}readmem(t){t&=65535;const e=this.memStatOffset+(t>>>8);if(this.memStat[e]){const s=this.memLook[e],r=this.ramRomOs[s+t];return this._debugRead&&this._debugRead(t,r,s),r|0}else{const s=this.readDevice(t);return this._debugRead&&this._debugRead(t,s,0),s|0}}peekmem(t){const e=this.memStatOffset+(t>>>8);if(this.memStat[e]){const s=this.memLook[e];return this.ramRomOs[s+t]}else return 255}writemem(t,e){t&=65535,e|=0,this._debugWrite&&this._debugWrite(t,e);const s=this.memStatOffset+(t>>>8);if(this.memStat[s]===1){const r=this.memLook[s];this.ramRomOs[r+t]=e;return}t<64512||t>=65280||this.writeDevice(t,e)}writeDevice(t,e){if(t&=65535,e|=0,this.model.hasMusic5000&&(t&65280)===64768&&(this.music5000PageSel&240)===48){this.music5000.write(this.music5000PageSel,t,e);return}switch(t&-4){case 64528:if(this.model.hasTeletextAdaptor)return this.teletextAdaptor.write(t-64528,e);break;case 64544:case 64548:case 64552:case 64556:case 64560:case 64564:case 64568:case 64572:break;case 64576:case 64580:case 64584:case 64588:case 64592:case 64596:case 64600:case 64604:break;case 64764:t===64767&&this.model.hasMusic5000&&(this.music5000PageSel=e);break;case 65024:case 65028:return this.crtc.write(t,e);case 65032:case 65036:return this.acia.write(t,e);case 65040:case 65044:return this.serial.write(t,e);case 65048:if(this.model.isMaster)return this.adconverter.write(t,e);!this.model.isMaster&&this.econet&&(this.econet.econetNMIEnabled=!1);break;case 65056:return this.ula.write(t,e);case 65060:case 65064:return this.model.isMaster?this.fdc.write(t,e):this.ula.write(t,e);case 65068:if(!this.model.isMaster)return this.ula.write(t,e);break;case 65072:return this.romSelect(e);case 65076:return this.model.isMaster?this.writeAcccon(e):this.romSelect(e);case 65080:this.model.isMaster&&this.econet&&(this.econet.econetNMIEnabled=!1);break;case 65084:if(!this.model.isMaster)return this.romSelect(e);break;case 65088:case 65092:case 65096:case 65100:case 65104:case 65108:case 65112:case 65116:return this.sysvia.write(t,e);case 65120:case 65124:case 65128:case 65132:case 65136:case 65140:case 65144:case 65148:return this.uservia.write(t,e);case 65152:case 65156:case 65160:case 65164:case 65168:case 65172:case 65176:case 65180:if(!this.model.isMaster)return this.fdc.write(t,e);break;case 65184:case 65188:case 65192:case 65196:case 65200:case 65204:case 65208:case 65212:this.econet&&this.econet.writeRegister(t&3,e);break;case 65216:case 65220:case 65224:case 65228:case 65232:case 65236:case 65240:case 65244:if(!this.model.isMaster)return this.adconverter.write(t,e);break;case 65248:case 65252:case 65256:case 65260:case 65264:case 65268:case 65272:case 65276:return this.tube.write(t,e)}}async loadRom(t,e){t.indexOf("http")!==0&&(t="roms/"+t),console.log("Loading ROM from "+t);const s=this.ramRomOs;let r=await Ze(t);/\.zip/i.test(t)&&(r=qw(r).data),s.set(r,e)}async loadOs(t){const e=Array.prototype.slice.call(arguments,1).concat(this.config.extraRoms);t="roms/"+t,console.log(`Loading OS from ${t}`);const s=this.ramRomOs,r=await Ze(t),a=r.length;if(a<16384||a&16383)throw new Error(`Broken OS ROM file (length=${a})`);s.set(r,this.osOffset);const c=(a-16384)/16384;let h=16-c;for(let d=0;d<c;++d){const p=16384+16384*d,b=this.romOffset+(h+d)*16384;s.set(r.subarray(p,p+16384),b)}const m=[];for(let d=0;d<e.length;++d){for(h--;this.model.swram[h];)h--;m.push(this.loadRom(e[d],this.romOffset+h*16384))}return await Promise.all(m)}setReset(t){this.resetLine=!t}reset(t){if(t){if(this.memStatOffsetByIFetchBank=this.model.isMaster?12288:0,this.model.isTest)for(let e=0;e<256;++e)this.memStat[e]=this.memStat[256+e]=1,this.memLook[e]=this.memLook[256+e]=0;else{for(let e=0;e<128;++e)this.memStat[e]=this.memStat[256+e]=1;for(let e=128;e<256;++e)this.memStat[e]=this.memStat[256+e]=2;for(let e=0;e<128;++e)this.memLook[e]=this.memLook[256+e]=0;for(let e=128;e<192;++e)this.memLook[e]=this.memLook[256+e]=this.romOffset-32768;for(let e=192;e<256;++e)this.memLook[e]=this.memLook[256+e]=this.osOffset-49152;for(let e=252;e<255;++e)this.memStat[e]=this.memStat[256+e]=0}for(let e=0;e<this.romOffset;++e)e<256?this.ramRomOs[e]=0:this.ramRomOs[e]=255;this.videoDisplayPage=0,this.config.printerPort&&(this.uservia.ca2changecallback=this.config.printerPort.outputStrobe),this.sysvia.reset(),this.uservia.reset(),this.acia.reset(),this.serial.reset(),this.ddNoise.spinDown(),this.fdc.powerOnReset(),this.adconverter.reset(),this.touchScreen=new PS(this.scheduler),this.model.hasTeletextAdaptor&&(this.teletextAdaptor=new OS(this)),this.econet&&(this.filestore=new BS(this,this.econet))}else this.fdc.reset();this.tube.reset(t),t&&(this.targetCycles=0,this.currentCycles=0,this.cycleSeconds=0),this.pc=this.readmem(65532)|this.readmem(65533)<<8,this.p.i=!0,this._nmiEdge=!1,this._nmiLevel=!1,this.halted=!1,this.music5000PageSel=0,this.video.reset(this,this.sysvia,t),this.soundChip.reset(t),this.teletextAdaptor&&this.teletextAdaptor.reset(t),this.music5000&&this.music5000.reset(t),t&&this.econet&&(this.econet.reset(),this.filestore.reset())}updateKeyLayout(){this.sysvia.setKeyLayout(this.config.keyLayout)}polltimeAddr(t,e){t=t|0,GS(e)&&(t+=1+((t^this.currentCycles)&1)),this.polltime(t)}polltimeCommon(t){this.scheduler.polltime(t),this.tube.execute(t),this.teletextAdaptor&&this.teletextAdaptor.polltime(t),this.music5000&&this.music5000.polltime(t),this.econet&&(this.econet.polltime(t)&&this.econet.econetNMIEnabled&&this.NMI(!0),this.filestore.polltime(t))}polltimeSlow(t){t|=0,this.currentCycles+=t,this.peripheralCycles+=t,this.videoCycles+=t,t=this.videoCycles/this.cpuMultiplier|0,t>this.videoCyclesBatch&&(this.video.polltime(t),this.videoCycles-=t*this.cpuMultiplier|0),t=this.peripheralCycles/this.cpuMultiplier|0,t&&(this.peripheralCycles-=t*this.cpuMultiplier|0,this.polltimeCommon(t))}polltimeFast(t){t|=0,this.currentCycles+=t,this.video.polltime(t),this.polltimeCommon(t)}execute(t){return this.halted=!1,this.targetCycles+=t,(Math.min(this.targetCycles,this.currentCycles)&4294967294)>=2*1e3*1e3&&(this.targetCycles-=2*1e3*1e3,this.currentCycles-=2*1e3*1e3,this.cycleSeconds++),this.forceTracing||this._debugInstruction||this._debugRead||this._debugWrite?this.executeInternal():this.executeInternalFast()}executeInternal(){let t=!0;for(;!this.halted&&this.currentCycles<this.targetCycles;){this.oldPcIndex=this.oldPcIndex+1&255,this.oldPcArray[this.oldPcIndex]=this.pc,this.memStatOffset=this.memStatOffsetByIFetchBank&1<<(this.pc>>>12)?256:0;const e=this.readmem(this.pc);if(this._debugInstruction&&!t&&this._debugInstruction(this.pc,e))return!1;t=!1,this.incpc(),this.runner.run(e),this.oldAArray[this.oldPcIndex]=this.a,this.oldXArray[this.oldPcIndex]=this.x,this.oldYArray[this.oldPcIndex]=this.y,this.takeInt&&this.brk(!0),this.resetLine||this.reset(!1)}return!this.halted}executeInternalFast(){for(;!this.halted&&this.currentCycles<this.targetCycles;){this.memStatOffset=this.memStatOffsetByIFetchBank&1<<(this.pc>>>12)?256:0;const t=this.readmem(this.pc);this.incpc(),this.runner.run(t),this.takeInt&&this.brk(!0),this.resetLine||this.reset(!1)}return!this.halted}stop(){this.halted=!0}dumpTrace(t,e){t||(t=256),t>256&&(t=256);const s=this.disassembler;e=e||function(r,a,c,h){const m=s.disassemble(r,!0)[0];console.log(te(r),(m+"                       ").substring(0,15),ct(a),ct(c),ct(h))};for(let r=t-2;r>=0;--r){const a=this.oldPcIndex-r&255;e(this.oldPcArray[a],this.oldAArray[a],this.oldXArray[a],this.oldYArray[a])}e(this.pc,this.a,this.x,this.y)}async initialise(){this.model.os.length&&await this.loadOs.apply(this,this.model.os),this.model.tube&&await this.tube.loadOs(),this.reset(!0),this.debugger.setCpu(this)}};const VS=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,254,0,235,0,201,255,255,18,0,23,202,30,5,0,53,166,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let Cp=0;function b0(){const i=new Date(Date.now()+Cp);return i.setMilliseconds(0),i}function bs(i){return parseInt(i.toString(10),16)}function ys(i){return parseInt(i.toString(16),10)}class wp{constructor(t,e,s){this.store=t?t.load():null,this.persistence=t,this.enabled=!1,this.isRead=!1,this.addressSelect=!1,this.dataSelect=!1,this.cmosAddr=0,this.store||(this.store=VS),e&&(this.store=e(this.store)),s&&(this.store[14]=s.stationId,this.store[15]===0&&(this.store[15]=254)),this.save()}save(){this.persistence&&this.persistence.save(this.store)}read(){if(!this.enabled)return 255;if(!this.addressSelect&&this.dataSelect&&this.isRead)if(this.cmosAddr<10){const t=b0();switch(this.cmosAddr){case 0:return bs(t.getSeconds());case 2:return bs(t.getMinutes());case 4:return bs(t.getHours());case 6:return bs(t.getDay()+1);case 7:return bs(t.getDate());case 8:return bs(t.getMonth()+1);case 9:return bs(t.getFullYear())}}else return this.store[this.cmosAddr]&255;return 255}writeControl(t,e,s){if(this.enabled=!!(t&64),!this.enabled)return;const r=this.dataSelect,a=this.addressSelect;if(this.isRead=!!(s&2),this.dataSelect=!!(s&4),this.addressSelect=!!(t&128),a&&!this.addressSelect&&(this.cmosAddr=e&63),r&&!this.dataSelect&&!this.addressSelect&&!this.isRead)if(this.cmosAddr>11)this.store[this.cmosAddr]=e,this.save();else{const c=b0();switch(this.cmosAddr){case 0:c.setSeconds(ys(e));break;case 2:c.setMinutes(ys(e));break;case 4:c.setHours(ys(e));break;case 7:c.setDate(ys(e));break;case 8:c.setMonth(ys(e-1));break;case 9:{const m=ys(e)>80?1900:2e3;c.setFullYear(ys(e)+m);break}}const h=Math.floor(Date.now()/1e3)*1e3;Cp=c.getTime()-h}}}const KS="reclist.php?sort=name&filter=.zip",qS="www.stairwaytohell.com/bbc/archive";async function jS(i){const t=await fetch(i);if(!t.ok)throw new Error("Network response was not ok");const s=new DOMParser().parseFromString(await t.text(),"text/html"),r=[];return s.querySelectorAll("tr td:nth-child(3) a").forEach(a=>{const c=a.getAttribute("href");c.indexOf(".zip")>0&&r.push(c)}),r.sort(),r}class Sp{constructor(t,e,s,r){this._baseUrl=`${document.location.protocol}//${qS}/${r?"tape":"disk"}images/`,this._catalog=[],this._onStart=t,this._onCat=e,this._onError=s}async populate(){if(this._onStart(),this._catalog.length===0)try{this._catalog=await jS(this._baseUrl+KS)}catch(t){console.error("Failed to fetch catalog:",t),this._onError&&this._onError();return}this._onCat&&this._onCat(this._catalog)}async fetch(t){const e=this._baseUrl+t;console.log("Loading ZIP from "+e);const s=await fetch(e);if(!s.ok)throw new Error("Network response was not ok");try{return ln(new Uint8Array(await s.arrayBuffer())).data}catch(r){throw console.error("Failed to fetch file:",r),r}}}const vs=A;class YS{constructor(){this.gamepad0=null,this.gamepadMapping=[],this.gamepadMapping[14]=vs.Z,this.gamepadMapping[15]=vs.X,this.gamepadMapping[13]=vs.SLASH,this.gamepadMapping[12]=vs.COLON_STAR,this.gamepadMapping[0]=vs.RETURN,this.gamepadMapping[9]=vs.SPACE,this.gamepadAxisMapping=[[],[],[],[]]}remap(t,e){"0123456789".indexOf(e)>0&&(e="K"+e);const s=vs[e];if(!s){console.log("unknown BBC key: "+e);return}switch(t){case"LEFT":this.gamepadMapping[3]=s,this.gamepadAxisMapping[0][-1]=s,this.gamepadAxisMapping[2][-1]=s;break;case"RIGHT":this.gamepadMapping[1]=s,this.gamepadAxisMapping[0][1]=s,this.gamepadAxisMapping[2][1]=s;break;case"UP":this.gamepadMapping[0]=s,this.gamepadAxisMapping[1][-1]=s,this.gamepadAxisMapping[3][-1]=s;break;case"DOWN":this.gamepadMapping[2]=s,this.gamepadAxisMapping[1][1]=s,this.gamepadAxisMapping[3][1]=s;break;case"FIRE":for(let r=0;r<16;r++)this.gamepadMapping[r]=s;break;case"UP2":this.gamepadAxisMapping[3][-1]=s;break;case"UP1":this.gamepadAxisMapping[1][-1]=s;break;case"UP3":this.gamepadMapping[0]=s;break;case"DOWN2":this.gamepadAxisMapping[3][1]=s;break;case"DOWN1":this.gamepadAxisMapping[1][1]=s;break;case"DOWN3":this.gamepadMapping[2]=s;break;case"LEFT2":this.gamepadAxisMapping[2][-1]=s;break;case"LEFT1":this.gamepadAxisMapping[0][-1]=s;break;case"LEFT3":this.gamepadMapping[3]=s;break;case"RIGHT2":this.gamepadAxisMapping[2][1]=s;break;case"RIGHT1":this.gamepadAxisMapping[0][1]=s;break;case"RIGHT3":this.gamepadMapping[1]=s;break;case"FIRE2":this.gamepadMapping[11]=s;break;case"FIRE1":this.gamepadMapping[10]=s;break;case"A":this.gamepadMapping[0]=s;break;case"B":this.gamepadMapping[1]=s;break;case"X":this.gamepadMapping[2]=s;break;case"Y":this.gamepadMapping[3]=s;break;case"START":this.gamepadMapping[9]=s;break;case"BACK":this.gamepadMapping[8]=s;break;case"RB":this.gamepadMapping[5]=s;break;case"RT":this.gamepadMapping[7]=s;break;case"LB":this.gamepadMapping[4]=s;break;case"LT":this.gamepadMapping[6]=s;break;default:console.log("unknown gamepad key: "+t)}}update(t){if(navigator.getGamepads&&!this.gamepad0){const e=navigator.getGamepads();this.gamepad0=e[0],this.gamepad0&&(console.log("initing gamepad"),this.gamepadButtons=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],this.gamepadAxes=[0,0,0,0])}if(this.gamepad0){up()||(this.gamepad0=navigator.getGamepads()[0]);for(let e=0;e<4;e++){const s=this.gamepad0.axes[e],r=.15;let a;if(s<-.15?a=-1:s>r?a=1:a=0,a!==this.gamepadAxes[e]){const c=this.gamepadAxisMapping[e][this.gamepadAxes[e]];c&&t.keyUpRaw(c);const h=this.gamepadAxisMapping[e][a];h&&t.keyDownRaw(h)}this.gamepadAxes[e]=a}for(let e=0;e<16;e++)if(this.gamepad0.buttons[e]){const s=this.gamepad0.buttons[e];s.pressed!==this.gamepadButtons[e]&&this.gamepadMapping[e]&&(s.pressed?t.keyDownRaw(this.gamepadMapping[e]):t.keyUpRaw(this.gamepadMapping[e])),this.gamepadButtons[e]=s.pressed}}}}class XS{constructor(t){this._track=t,this._track.length=z.bytesPerTrack,this._index=0,this._pulsesIndex=0,this._lastMfmBit=0,this._crc=0}get track(){return this._track}setTrackLength(){if(this._index>this._track.pulses2Us.length)throw new Error(`Track buffer overflow in ${this._track.description}`);return this._index!==0&&(this._track.length=this._index),this}resetCrc(){return this._crc=z.crcInit(!1),this}appendFmDataAndClocks(t,e){if(this._index>=this._track.pulses2Us.length)throw new Error(`Track buffer overflow in ${this._track.description}`);return this._track.pulses2Us[this._index++]=z.fmTo2usPulses(e,t),this._crc=z.crcAddByte(this._crc,t),this}appendFmByte(t){return this.appendFmDataAndClocks(t,255),this}appendRepeatFmByte(t,e){for(let s=0;s<e;++s)this.appendFmByte(t);return this}fillFmByte(t){if(this._index>=this._track.pulses2Us.length)throw new Error(`Track buffer overflow in ${this._track.description}`);const e=Math.min(z.bytesPerTrack,this._track.pulses2Us.length)-this._index;return this.appendRepeatFmByte(t,e),this}appendRepeatFmByteWithClocks(t,e,s){for(let r=0;r<s;++r)this.appendFmDataAndClocks(t,e);return this}appendFmChunk(t){for(const e of t)this.appendFmByte(e);return this}appendCrc(t){const e=this._crc>>>8&255,s=this._crc&255;return t?(this.appendMfmByte(e),this.appendMfmByte(s)):(this.appendFmByte(e),this.appendFmByte(s)),this}appendMfmPulses(t){if(this._index>=this._track.pulses2Us.length)throw new Error(`Track buffer overflow in ${this._track.description}`);const e=this._track.pulses2Us[this._index],s=65535<<this._pulsesIndex;return this._pulsesIndex=this._pulsesIndex+16&31,this._track.pulses2Us[this._index]=e&s|t<<this._pulsesIndex,this._pulsesIndex===0&&this._index++,this}appendMfmByte(t){const{lastBit:e,pulses:s}=z.mfmTo2usPulses(this._lastMfmBit,t);return this._lastMfmBit=e,this.appendMfmPulses(s),this._crc=z.crcAddByte(this._crc,t),this}appendRepeatMfmByte(t,e){for(let s=0;s<e;++s)this.appendMfmByte(t);return this}appendMfm3xA1Sync(){for(let t=0;t<3;++t)this.appendMfmPulses(z.mfmA1Sync),this._crc=z.crcAddByte(this._crc,161);return this}appendMfmChunk(t){for(const e of t)this.appendMfmByte(e);return this}fillMfmByte(t){if(this._index>=this._track.pulses2Us.length)throw new Error(`Track buffer overflow in ${this._track.description}`);const e=Math.min(z.bytesPerTrack,this._track.pulses2Us.length);for(;this._index<e;)this.appendMfmByte(t);return this}buildFromPulses(t,e){let s=!1;for(const r of t)z.checkPulse(r,e)||console.log(`Found a bad pulse for ${this.track.description}`),!this.appendPulseDelta(r,e)&&!s&&(console.log(`Truncated disc data for ${this.track.description}, ignoring the rest`),s=!0);this.setTrackLength()}appendPulseDelta(t,e){let s=e?Math.round(t/2):2*Math.round(t/4);for(;s--;){if(this._index>=this._track.pulses2Us.length)return!1;s===0&&(this._track.pulses2Us[this._index]|=2147483648>>>this._pulsesIndex),this._pulsesIndex++,this._pulsesIndex===32&&(this._pulsesIndex=0,this._index++)}return!0}}class ZS{constructor(t,e){this._track=t,this._pos=e}readPulses(){let t=this._pos>>>5;const e=this._pos&31;let s=this._track.pulses2Us[t],r=s<<e&68719476735;return t===this._track.length?(t=0,this._pos=e):(t++,this._pos+=32),e>0&&(s=this._track.pulses2Us[t],r|=s>>>32-e),r}}class QS{constructor(t){this._rawReader=t}read(t){const e=new Uint8Array(t);let s=0;for(let r=0;r<t;++r)(r&1)===0?s=this._rawReader.readPulses():s=s<<16&4294967295,e[r]=z._2usPulsesToMfm(s>>>16);return{data:e,clocks:null,iffyPulses:!1}}get initialCrc(){let t=z.crcInit(!1);return t=z.crcAddByte(t,161),t=z.crcAddByte(t,161),t=z.crcAddByte(t,161),t}}class JS{constructor(t){this._rawReader=t}read(t){const e=new Uint8Array(t),s=new Uint8Array(t);let r=!1;for(let a=0;a<t;++a){const c=this._rawReader.readPulses(),{data:h,clock:m,iffyPulses:d}=z._2usPulsesToFm(c);e[a]=h,s[a]=m,r|=d}return{data:e,clocks:s,iffyPulses:r}}get initialCrc(){return z.crcInit(!1)}}class bh{constructor(t,e,s){this.track=t,this.isMfm=e,this.idPosBitOffset=s,this.dataPosBitOffset=null,this.isDeleted=!1,this.sectorData=null,this.hasDataCrcError=!1,this.byteLength=null;const r=this._readerAt(this.idPosBitOffset),{data:a,iffyPulses:c}=r.read(6);c&&console.log(`Iffy pulse in sector header ${this.description}`),this.header=a;let h=r.initialCrc;h=z.crcAddByte(h,z.idMarkDataPattern),h=z.crcAddBytes(h,this.header.slice(0,4));const m=this.header[4]<<8|this.header[5];this.hasHeaderCrcError=h!==m}_readerAt(t){const e=new ZS(this.track,t);return this.isMfm?new QS(e):new JS(e)}get trackNumber(){return this.header?this.header[0]:void 0}get sectorNumber(){return this.header?this.header[2]:void 0}get description(){return`${this.track.description} idpos ${this.idPosBitOffset} idtrack ${this.trackNumber} idsector ${this.sectorNumber} datapos ${this.dataPosBitOffset}`}read(t){const e=this.isMfm?16:32;if(this.dataPosBitOffset===null){console.log(`"Sector header without data ${this.description}"`);return}const s=this.isDeleted?z.deletedDataMarkDataPattern:z.dataMarkDataPattern,r=this.dataPosBitOffset/e|0,a=(t?t.idPosBitOffset/e:this.track.length*32/e)|0;let c=bh.toSectorSize(a-r-5);this.hasDataCrcError=!0;let h=!1;do{const{crcOk:m,sectorData:d,iffyPulses:p}=this._tryLoadSectorData(s,c);if(h=p,m){this.byteLength=c,this.hasDataCrcError=!1,this.sectorData=d;break}c=c>>>1}while(c>=128);h&&console.log(`"Iffy pulse in sector data ${this.description}"`)}_tryLoadSectorData(t,e){const s=this._readerAt(this.dataPosBitOffset);let r=z.crcAddByte(s.initialCrc,t);const{data:a,iffyPulses:c}=s.read(e+2);return r=z.crcAddBytes(r,a.slice(0,e)),{crcOk:(a[e]<<8|a[e+1])===r,sectorData:a.slice(0,e),iffyPulses:c}}static toSectorSize(t){return t<256?128:t<512?256:t<1024?512:t<2048?1024:2048}}class tE{constructor(t,e,s){this.length=z.bytesPerTrack,this.upper=t,this.trackNum=e,this.pulses2Us=new Uint32Array(z.bytesPerTrack*2),this.pulses2Us.fill(s|s<<8|s<<16|s<<24)}get description(){return`Track ${this.trackNum} ${this.upper?"upper":"lower"}`}findSectors(){const t=this.findSectorIds();for(let e=0;e!==t.length;++e){const s=t[e+1];t[e].read(s)}return t}findSectorIds(){const t=[],e=this.length*32;let s=0,r=0,a=!1,c=!1,h=0,m=0n,d=0n;const p=0xffffffffffffffffn,b=0xffffffff00000000n,w=0x8888888800000000n,C=0xaaaa448944894489n;let y=0,R=null;for(let U=0;U<e;++U){if((U&31)===0&&(h=this.pulses2Us[U>>>5]),d=d<<1n&p,d|=m>>63n,m=m<<1n&p,s=s<<1&4294967295,r++,h&2147483648&&(m|=1n,s|=1),h=h<<1&4294967295,(m&b)===w){const{clocks:M,data:X,iffyPulses:Y}=z._2usPulsesToFm(Number(m&0xffffffffn));if(Y||M!==z.markClockPattern)continue;c=!1,a=!1;let N=8;for(let Q=d;(Q&0xfn)===0x8n;Q>>=4n)N++;N<=16&&console.log(`Short zeros sync ${this.description}`),y=X}else if(m===C){c=!0,a=!0,s=0,r=0;continue}else if(a&&r===16)y=z._2usPulsesToMfm(s),a=!1;else continue;switch(y){case z.idMarkDataPattern:{R=new bh(this,c,U+1),t.push(R),s=0,r=0;break}case z.dataMarkDataPattern:case z.deletedDataMarkDataPattern:!R||R.dataPosBitOffset?console.log(`Sector data without header ${this.description}; mark bitpos ${U}; previous good sector ${R?R.description:"none"}`):(R.dataPosBitOffset=U+1,y===z.deletedDataMarkDataPattern&&(R.isDeleted=!0),s=0,r=0);break;default:console.log(`Unknown marker byte ${ct(y)} ${this.description}`)}}return t}}class y0{constructor(t,e){this.tracks=[];for(let s=0;s<z.tracksPerDisc;++s)this.tracks[s]=new tE(t,s,e)}}class Ep{constructor(){this.logProtection=!1,this.logIffyPulses=!1,this.expandTo80=!1,this.isQuantizeFm=!1,this.isSkipOddTracks=!1,this.isSkipUpperSide=!1,this.rev=0,this.revSpec=""}}class Gt{static get sectorSize(){return 256}static get sectorsPerTrack(){return 10}static get tracksPerDisc(){return 80}}function Ap(i,t,e,s){const r=new Uint8Array(Gt.sectorSize),a=e?2:1;if(t.length%Gt.sectorSize!==0)throw new Error("SSD file size is not a multiple of sector size");const c=Gt.sectorSize*Gt.sectorsPerTrack*Gt.tracksPerDisc*a;if(t.length>c)throw new Error("SSD file is too large");let h=0;for(let m=0;m<Gt.tracksPerDisc;++m)for(let d=0;d<a;++d){const p=i.buildTrack(d===1,m);p.appendRepeatFmByte(255,z.stdGap1FFs).appendRepeatFmByte(0,z.stdSync00s);for(let b=0;b<Gt.sectorsPerTrack;++b){p.resetCrc().appendFmDataAndClocks(z.idMarkDataPattern,z.markClockPattern).appendFmByte(m).appendFmByte(0).appendFmByte(b).appendFmByte(1).appendCrc(!1),p.appendRepeatFmByte(255,z.stdGap2FFs).appendRepeatFmByte(0,z.stdSync00s);const w=h<t.length?t.subarray(h,h+Gt.sectorSize):r;h+=Gt.sectorSize,p.resetCrc().appendFmDataAndClocks(z.dataMarkDataPattern,z.markClockPattern).appendFmChunk(w).appendCrc(!1),b!==Gt.sectorsPerTrack-1&&p.appendRepeatFmByte(255,z.std10SectorGap3FFs).appendRepeatFmByte(0,z.stdSync00s)}p.fillFmByte(255)}if(s){const m=new Uint8Array(c);m.set(t),i.setWriteTrackCallback((d,p,b)=>{const w=Gt.sectorSize*Gt.sectorsPerTrack*(p*a+(d?1:0));for(const C of b.findSectors()){const y=C.sectorNumber*Gt.sectorSize;for(let R=0;R<Gt.sectorSize;++R)m[w+y+R]=C.sectorData[R]}s(m)})}return i}class Di{static get sectorSize(){return 256}static get sectorsPerTrack(){return 16}static get tracksPerDisc(){return 80}}function kp(i,t,e){const s=new Uint8Array(Di.sectorSize),r=e?2:1;if(t.length%Di.sectorSize!==0)throw new Error("ADF file size is not a multiple of sector size");const a=Di.sectorSize*Di.sectorsPerTrack*Di.tracksPerDisc*r;if(t.length>a)throw new Error("ADF file is too large");let c=0;for(let h=0;h<Di.tracksPerDisc&&!(c>=t.length);++h)for(let m=0;m<r;++m){const d=i.buildTrack(m===1,h);d.appendRepeatMfmByte(78,60);for(let p=0;p<Di.sectorsPerTrack;++p){d.appendRepeatMfmByte(0,12).resetCrc().appendMfm3xA1Sync().appendMfmByte(z.idMarkDataPattern).appendMfmByte(h).appendMfmByte(0).appendMfmByte(p).appendMfmByte(1).appendCrc(!0),d.appendRepeatMfmByte(78,22).appendRepeatMfmByte(0,12);const b=c<t.length?t.subarray(c,c+Di.sectorSize):s;c+=Di.sectorSize,d.resetCrc().appendMfm3xA1Sync().appendMfmByte(z.dataMarkDataPattern).appendMfmChunk(b).appendCrc(!0),d.appendRepeatMfmByte(78,24)}d.fillMfmByte(78)}return i}function yh(i){const t=i.isDoubleSided?2:1,e=new Uint8Array(t*Gt.tracksPerDisc*Gt.sectorsPerTrack*Gt.sectorSize);let s=0;for(let r=0;r<i.tracksUsed;++r)for(let a=0;a<t;++a){const c=i.getTrack(a===1,r);for(const h of c.findSectors()){const m=s+h.sectorNumber*Gt.sectorSize;if(h.hasDataCrcError||h.hasHeaderCrcError){console.log(`Skipping sector ${h.description} with bad CRC`);continue}for(let d=0;d<Gt.sectorSize;++d)e[m+d]=h.sectorData[d]}s+=Gt.sectorsPerTrack*Gt.sectorSize}return e.slice(0,s)}class vh{static createBlank(){return new vh(!0,new Ep)}constructor(t,e,s){this.config=e,this.name=s,this.isDirty=!1,this.dirtySide=-1,this.dirtyTrack=-1,this.tracksUsed=0,this.isDoubleSided=!1,this.writeTrackCallback=void 0,this.isWriteable=t,this.initSurface(0)}setWriteTrackCallback(t){this.writeTrackCallback=t}get writeProtected(){return!this.isWriteable}getTrack(t,e){return t?this.upperSide.tracks[e]:this.lowerSide.tracks[e]}buildTrack(t,e){return this.setTrackUsed(t,e),new XS(this.getTrack(t,e))}setTrackUsed(t,e){t&&(this.isDoubleSided=!0),this.tracksUsed=Math.max(this.tracksUsed,e+1)}initSurface(t){this.lowerSide=new y0(!1,t),this.upperSide=new y0(!0,t),this.tracksUsed=0,this.isDoubleSided=!1}readPulses(t,e,s){return this.getTrack(t,e).pulses2Us[s]}writePulses(t,e,s,r){const a=this.getTrack(t,e);if(s>=a.length)throw new Error(`Attempt to write off end of track ${s} > ${e.length}`);if(this.isDirty&&(t!==this.dirtySide||e!==this.dirtyTrack))throw new Error("Switched dirty track or side");this.isDirty=!0,this.dirtySide=t,this.dirtyTrack=e,a.pulses2Us[s]=r}flushWrites(){if(!this.isDirty){if(this.dirtySide!==-1||this.dirtyTrack!==-1)throw new Error("Bad state in disc dirty tracking");return}const t=this.dirtySide,e=this.dirtyTrack;if(this.isDirty=!1,this.dirtySide=-1,this.dirtyTrack=-1,!this.writeTrackCallback)return;const s=this.getTrack(t,e);this.writeTrackCallback(t,e,s),this.setTrackUsed(t,e)}logSummary(){const t=this.tracksUsed,e=this.isDoubleSided?2:1;for(let s=0;s<e;++s)for(let r=0;r<t;++r){const a=this.getTrack(s===1,r),c=a.findSectors();if(c.length){a.length>=z.bytesPerTrack*1.015?console.log(`Long track ${a.description}, ${a.length} bytes`):a.length<=z.bytesPerTrack*.985&&console.log(`Short track ${a.description}, ${a.length} bytes`),c[0].isMfm?c.length!==16&&c.length!==18&&console.log(`Non-standard MFM sector count ${a.description} count ${c.length}`):c.length!==10&&console.log(`Non-standard FM sector count ${a.description} count ${c.length}`);for(const h of c)h.hasHeaderCrcError&&console.log(`${h.description} has bad header crc`),h.trackNumber!==r&&console.log(`${h.description} has bad track id`),h.hasDataCrcError&&console.log(`${h.description} has bad data crc`)}else console.log(`"Unformatted track ${a.description}"`)}}}class z{static get bytesPerTrack(){return 3125}static get tracksPerDisc(){return 84}static get markClockPattern(){return 199}static get idMarkDataPattern(){return 254}static get dataMarkDataPattern(){return 251}static get deletedDataMarkDataPattern(){return 248}static get mfmA1Sync(){return 17545}static get mfmC2Sync(){return 21028}static get stdSync00s(){return 6}static get stdGap1FFs(){return 16}static get stdGap2FFs(){return 11}static get std10SectorGap3FFs(){return 21}static crcInit(t){return t?52660:65535}static crcAddByte(t,e){for(let s=0;s<8;++s){const r=e&128,a=t&32768^r<<8;t=t<<1&65535,a&&(t^=4129),e<<=1}return t}static crcAddBytes(t,e){for(const s of e)t=z.crcAddByte(t,s);return t}static fmTo2usPulses(t,e){let s=0;for(let r=0;r<8;++r)s<<=4,t&128&&(s|=4),e&128&&(s|=1),t=t<<1&255,e=e<<1&255;return s}static _2usPulsesToFm(t){let e=0,s=0,r=!1;for(let a=0;a<8;++a)e<<=1,s<<=1,t&2147483648&&(e|=1),t&536870912&&(s|=1),t&1342177280&&(r=!0),t=t<<4&4294967295;return{clocks:e,data:s,iffyPulses:r}}static mfmTo2usPulses(t,e){let s=0;for(let r=0;r<8;++r){const a=!!(e&128);s=s<<2&65535,e<<=1,a?s|=1:t||(s|=2),t=a}return{lastBit:t,pulses:s}}static _2usPulsesToMfm(t){let e=0;for(let s=0;s<8;++s)e<<=1,(t&49152)===16384&&(e|=1),t=t<<2&65535;return e}static checkPulse(t,e){return t<3.5||t>8.5?!1:e&&t>5.5&&t<6.5?!0:!(t>4.5&&t<7.5)}}const eE="HXCPICFE",iE="HXCHFEV3",v0=240,sE=240,Tp=241,Dp=242,rE=243,Ch=244,da=256,ci=da*2,nE=7,aE=2,oE=72;function Ds(i){let t=0;return i&128&&(t|=1),i&64&&(t|=2),i&32&&(t|=4),i&16&&(t|=8),i&8&&(t|=16),i&4&&(t|=32),i&2&&(t|=64),i&1&&(t|=128),t}function cE(i,t){const e=t<<2,s=ci*(i[e]+(i[e+1]<<8)),r=i[e+2]+(i[e+3]<<8);return{offset:s,length:r}}function hE(i,t,e){if(t.length<ci)throw new Error("HFE file missing header");const s=new TextDecoder("ascii").decode(t.slice(0,8));let r=!1,a=1;if(s!==eE)if(s===iE)a=3,r=!0;else throw new Error(`HFE file bad header '${s}'`);if(t[8]!==0)throw new Error("HFE file revision not 0");if(t[11]!==2&&t[11]!==0)if(t[11]===255)console.log(`Unknown HFE encoding ${t[11]}, trying anyway`);else throw new Error(`HFE encoding not ISOIBM_(M)FM_ENCODING: ${t[11]}`);const c=t[10];if(c<1||c>2)throw new Error(`Invalid number of sides: ${c}`);const h=t[9];if(h>z.tracksPerDisc)throw new Error(`Too many tracks: ${h}`);let m=0;i.config.expandTo80&&h*2<=z.tracksPerDisc&&(m=1,console.log("Expanding 40 tracks to 80")),console.log(`HFE v${a} loading ${c} sides, ${h} tracks`);const d=ci*(t[18]+(t[19]<<8));if(d+ci>t.length)throw new Error("HFE LUT doesn't fit");const p=t.slice(d,d+ci);for(let b=0;b<h;++b){let w=b;if(i.config.isSkipOddTracks){if(b&1)continue;w=b>>>1}w=w<<m;const{offset:C,length:y}=cE(p,b);if(C+y>t.length)throw new Error(`HFE track ${b} doesn't fit (length ${y} offset ${C} file length ${t.length})`);const R=t.slice(C,C+y);for(let U=0;U<c;++U){const M=y>>1;let X=0;if(i.config.isSkipUpperSide&&U===1)continue;let Y=!1,N=!1,Q=0,rt=0,l=0;const G=i.getTrack(U===1,w);i.setTrackUsed(U===1,w);const W=G.pulses2Us;for(let K=0;K<M;++K){if(X===W.length)throw new Error(`HFE track ${b} truncated`);const Z=(K>>>8<<9)+(U<<8)+(K&255);let dt=Ds(R[Z]),nt=8;if(Y){Y=!1,(dt<64||dt>80)&&console.log(`HFE v3 SETBITRATE wild (72=250kbit) track: ${b} ${dt}`);continue}else if(N){if(N=!1,dt===0||dt>=8)throw new Error(`HFE v3 invalid skipbits ${dt}`);Q=dt;continue}else if(Q)dt=dt<<8-Q&255,nt=Q,Q=0;else if(r&&(dt&v0)===v0)switch(dt){case sE:continue;case Tp:X!==0&&console.log(`HFEv3 SETINDEX not at byte 0, track ${b}: ${X}`);continue;case Dp:Y=!0;continue;case rE:N=!0;continue;case Ch:dt=0;break;default:throw new Error(`Unknown HFE v3 opcode ${dt}`)}for(let pt=0;pt<nt;++pt)rt=rt<<1&4294967295|(dt&128?1:0),dt=dt<<1&255,++l===32&&(W[X]=rt,X++,rt=0,l=0)}G.length=X}}return e&&i.setWriteTrackCallback((b,w,C)=>{const y=wh(i);e(y)}),i}function lE(i){return(i&15)===15}function uE(i){const t=new Uint8Array(4);for(let e=0;e<4;e++){const s=i>>>24&255,r=Ds(s);lE(r)?t[e]=Ds(Ch):t[e]=r,i<<=8}return t}function fE(i){const t=new Uint8Array(i.length*4+3);let e=0;t[e++]=Ds(Tp),t[e++]=Ds(Dp),t[e++]=Ds(oE);for(let s=0;s<i.length;s++){const r=i[s];if(r===0){const a=Ds(Ch);t.fill(a,e,e+4)}else{const a=uE(r);t.set(a,e)}e+=4}return t.slice(0,e)}function wh(i){const t=i.isDoubleSided?2:1,e=i.tracksUsed,s=[],r=[];for(let R=0;R<e;R++){const U=i.getTrack(!1,R),M=t>1?i.getTrack(!0,R):{length:0},Y=(Math.max(U.length,M.length)*4+3)*2,N=Math.floor(Y/ci)+1;s.push(Y),r.push(N)}const a=new Uint8Array(512);a.fill(255);const c=new TextEncoder;a.set(c.encode("HXCHFEV3"),0),a[8]=0,a[9]=e,a[10]=t,a[11]=aE,a[12]=250,a[13]=0,a[14]=0,a[15]=0,a[16]=nE,a[17]=255,a[18]=1,a[19]=0,a[20]=255,a[21]=255,a[22]=255,a[23]=255,a[24]=255,a[25]=255;const h=ci,m=1*ci,d=new Uint8Array(m),p=new DataView(d.buffer);let b=2,w=h+m;for(let R=0;R<e;R++){const U=R*4;p.setUint16(U,b,!0),p.setUint16(U+2,s[R],!0),w+=r[R]*ci,b+=r[R]}const C=new Uint8Array(w);C.set(a,0),C.set(d,h);let y=1024;for(let R=0;R<e;R++){for(let U=0;U<t;U++){const M=i.getTrack(U===1,R),X=M.pulses2Us,Y=fE(X.slice(0,M.length));let N=Y.length,Q=y+(U===1?da:0),rt=0;for(;rt<N;){const l=Math.min(da,N-rt),G=new Uint8Array(da);l>0&&G.set(Y.slice(rt,rt+l)),C.set(G,Q),Q+=ci,rt+=l}}y+=r[R]*ci}return C}function Rp(i){return console.log("Loading disc from "+i),Ze(i)}class Tr{constructor(t,e,s,r,a,c,h){this._extension=t,this._loader=e,this._saver=s,this._nameSetter=r,this._isDoubleSided=a,this._isDoubleDensity=c,this._byteSize=h}get name(){return this._extension}get extension(){return this._extension}get loader(){return this._loader}get saver(){return this._saver}get isDoubleSided(){return this._isDoubleSided}get isDoubleDensity(){return this._isDoubleDensity}get byteSize(){return this._byteSize}get supportsCatalogue(){return this._nameSetter!==null}setDiscName(t,e){if(!this.supportsCatalogue)throw new Error(`Cannot set disc name for ${this._extension} format`);this._nameSetter(t,e)}}const Lp=80*10*256,dE=Lp*2,pE=2*80*16*256,mE=80*16*256;function Pp(i,t){for(let e=0;e<8;++e)i[e]=e<t.length?t.charCodeAt(e)&255:32}const gE=new Tr(".hfe",hE,wh,null,!0,!0,void 0),_E=new Tr(".adl",(i,t,e)=>kp(i,t,!0),i=>{throw new Error("ADL unsupported")},null,!0,!0,pE),xE=new Tr(".adf",(i,t,e)=>kp(i,t,!1),i=>{throw new Error("ADF unsupported")},null,!1,!0,mE),bE=new Tr(".dsd",(i,t,e)=>Ap(i,t,!0,e),yh,Pp,!0,!1,dE),yE=new Tr(".ssd",(i,t,e)=>Ap(i,t,!1,e),yh,Pp,!1,!1,Lp);function un(i){const t=i.toLowerCase();return t.endsWith(".hfe")?gE:t.endsWith(".adl")?_E:t.endsWith(".adf")||t.endsWith(".adm")?xE:t.endsWith(".dsd")?bE:yE}function Ii(i,t,e,s){const r=typeof e!="string"?e:An(e);return un(t).loader(new vh(!0,new Ep,t),r,s)}function Ip(i,t){const e="disc_"+t;let s;const r=window.localStorage[e];if(r)console.log("Loading browser-local disc "+t),s=An(r);else{console.log("Creating browser-local disc "+t);const c=un(t);if(!c.byteSize)throw new Error(`Cannot create blank disc of type ${c.extension} - unknown size`);s=new Uint8Array(c.byteSize),c.supportsCatalogue&&c.setDiscName(s,t)}return Ii(i,t,s,c=>{try{const h=pp(c);window.localStorage.setItem(e,h)}catch(h){window.alert("Writing to localStorage failed: "+h)}})}const vE=Object.freeze(Object.defineProperty({__proto__:null,DiscType:Tr,discFor:Ii,guessDiscTypeFromName:un,load:Rp,localDisc:Ip},Symbol.toStringTag,{value:"Module"}));function qo(i){return 2*1e3*1e3*i|0}function CE(i){let t=!1;for(;i;)t=!t,i>>>=1;return t}const jo=78;class wE{constructor(t){this.stream=t,this.baseFrequency=1200,this.rewind(),this.curChunk=this.readChunk()}rewind(){this.dummyData=[!1,!1,!0,!1,!0,!1,!0,!1,!0,!0],this.state=-1,this.count=0,this.curByte=0,this.numDataBits=8,this.parity=jo,this.numParityBits=0,this.numStopBits=1,this.carrierBefore=0,this.carrierAfter=0,this.stream.seek(10);const t=this.stream.readByte(),e=this.stream.readByte();if(e!==0)throw"Unsupported UEF version "+e+"."+t}readChunk(){const t=this.stream.readInt16(),e=this.stream.readInt32();return{id:t,stream:this.stream.substream(e)}}poll(t){if(!this.curChunk)return;if(this.state===-1){if(this.stream.eof()){this.curChunk=null;return}this.curChunk=this.readChunk()}let e;switch(this.curChunk.id){case 0:console.log("Origin: "+this.curChunk.stream.readNulString());break;case 256:return t.setTapeCarrier(!1),this.state===-1?(this.state=0,this.curByte=this.curChunk.stream.readByte(),t.tone(this.baseFrequency)):this.state<9?(this.state===0?t.tone(this.baseFrequency):t.tone(this.curByte&1<<this.state-1?2*this.baseFrequency:this.baseFrequency),this.state++):(t.receive(this.curByte),t.tone(2*this.baseFrequency),this.curChunk.stream.eof()?this.state=-1:(this.state=0,this.curByte=this.curChunk.stream.readByte())),this.cycles(1);case 260:if(t.setTapeCarrier(!1),this.state===-1&&(this.numDataBits=this.curChunk.stream.readByte(),this.parity=this.curChunk.stream.readByte(),this.numStopBits=this.curChunk.stream.readByte(),this.numParityBits=this.parity!==jo?1:0,console.log(`Defined data with ${this.numDataBits}${String.fromCharCode(this.parity)}${this.numStopBits}`),this.state=0),this.state===0)this.curChunk.stream.eof()?this.state=-1:(this.curByte=this.curChunk.stream.readByte()&(1<<this.numDataBits)-1,t.tone(this.baseFrequency),this.state++);else if(this.state<1+this.numDataBits)t.tone(this.curByte&1<<this.state-1?2*this.baseFrequency:this.baseFrequency),this.state++;else if(this.state<1+this.numDataBits+this.numParityBits){let s=CE(this.curByte);this.parity===jo&&(s=!s),t.tone(s?2*this.baseFrequency:this.baseFrequency),this.state++}else if(this.state<1+this.numDataBits+this.numParityBits+this.numStopBits)t.tone(2*this.baseFrequency),this.state++;else return t.receive(this.curByte),this.state=0,0;return this.cycles(1);case 273:return this.state===-1&&(this.state=0,this.carrierBefore=this.curChunk.stream.readInt16(),this.carrierAfter=this.curChunk.stream.readInt16(),console.log("Carrier with",this.carrierBefore,this.carrierAfter)),this.state===0?(t.setTapeCarrier(!0),t.tone(2*this.baseFrequency),this.carrierBefore--,this.carrierBefore<=0&&(this.state=1)):this.state<11?(t.setTapeCarrier(!1),t.tone(this.dummyData[this.state-1]?this.baseFrequency:2*this.baseFrequency),this.state===10&&t.receive(170),this.state++):(t.setTapeCarrier(!0),t.tone(2*this.baseFrequency),this.carrierAfter--,this.carrierAfter<=0&&(this.state=-1)),this.cycles(1);case 276:console.log("Ignoring security cycles");break;case 277:console.log("Ignoring polarity change");break;case 272:return this.state===-1&&(this.state=0,this.count=this.curChunk.stream.readInt16()),t.setTapeCarrier(!0),t.tone(2*this.baseFrequency),this.count--,this.count<=0&&(this.state=-1),this.cycles(1);case 275:this.baseFrequency=this.curChunk.stream.readFloat32(),console.log("Frequency change ",this.baseFrequency);break;case 274:return t.setTapeCarrier(!1),e=1/(2*this.curChunk.stream.readInt16()*this.baseFrequency),console.log("Tape gap of "+e+"s"),t.tone(0),qo(e);case 278:return t.setTapeCarrier(!1),e=this.curChunk.stream.readFloat32(),console.log("Tape gap of "+e+"s"),t.tone(0),qo(e);default:console.log("Skipping unknown chunk "+te(this.curChunk.id)),this.curChunk=this.readChunk();break}return this.cycles(1)}cycles(t){return qo(t/this.baseFrequency)}}const SE=[1,16,64,-1];class EE{constructor(t){this.count=0,this.stream=t}rate(t){let e=9;t.cr&128||e++;const s=SE[t.cr&3],r=2*1e3*1e3/(19200/s);return Math.floor(e*r)}rewind(){this.stream.seek(10)}poll(t){if(this.stream.eof())return 1e5;let e=this.stream.readByte();if(e===255){if(e=this.stream.readByte(),e===0)return t.setTapeCarrier(!1),0;if(e===4)return t.setTapeCarrier(!0),5*2*1e3*1e3;if(e!==255)throw"Got a weird byte in the tape"}return t.receive(e),this.rate(t)}}function en(i,t){const e=new xh(i,t);return e.readByte(0)===255&&e.readByte(1)===4?(console.log("Detected a 'tapefile' tape"),new EE(e)):e.readNulString(0)==="UEF File!"?(console.log("Detected a UEF tape"),new wE(e)):(console.log("Unknown tape format"),null)}async function AE(i){return console.log("Loading tape from "+i),en(i,await Ze(i))}const Yo="application/vnd.jsbeeb.disc-image",kE="356883185894-bhim19837nroivv18p0j25gecora60r5.apps.googleusercontent.com",TE="https://www.googleapis.com/auth/drive.file",DE="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",C0="id,name,capabilities",Xo="jsbeeb disc images",Sh="-------314159265358979323846",w0=`\r
--${Sh}\r
`,RE=`\r
--${Sh}--`,S0="application/vnd.google-apps.folder";class LE{constructor(){this.authorized=!1,this.parentFolderId=void 0,this.driveClient=void 0}async initialise(){return console.log("Creating GAPI"),await this._loadScript("https://apis.google.com/js/api.js"),console.log("Got GAPI, creating token client"),this.gapi=window.gapi,await this._loadScript("https://accounts.google.com/gsi/client"),this.tokenClient=window.google.accounts.oauth2.initTokenClient({client_id:kE,scope:TE,error_callback:"",callback:""}),console.log("Token client created, loading client"),await this.gapi.load("client",async()=>{console.log("Client loaded; initialising GAPI"),await this.gapi.client.init({discoveryDocs:[DE]}),console.log("GAPI initialised"),this.driveClient=this.gapi.client.drive}),console.log("Google Drive: available"),!0}_loadScript(t){return new Promise(e=>{const s=document.createElement("script");s.src=t,s.onload=e,document.body.appendChild(s)})}authorize(t){return this.authorized?!0:t?!1:new Promise((e,s)=>{console.log("Authorizing..."),this.tokenClient.callback=r=>{r.error!==void 0&&s(r),console.log("Authorized OK"),this.authorized=!0,e(!0)},this.tokenClient.error_callback=r=>{console.log(`Token client failure: ${r.type}; failed to authorize`),s(new Error(`Token client failure: ${r.type}; failed to authorize`))},this.tokenClient.requestAccessToken({select_account:!1})})}async listFiles(){let t=await this.driveClient.files.list({q:`mimeType = '${Yo}' and trashed = false`}),e=t.result.files;for(;t.result.nextPageToken;)t=await this.driveClient.files.list({pageToken:t.result.nextPageToken}),e=e.concat(t.result.files);return e}async _findOrCreateParentFolder(){const t=await this.driveClient.files.list({q:`name = '${Xo}' and mimeType = '${S0}' and trashed = false`,corpora:"user"});if(t.result.files.length===1)return console.log("Found existing parent folder"),t.result.files[0].id;console.log(`Creating parent folder ${Xo}`);const e=await this.driveClient.files.create({resource:{name:Xo,mimeType:S0},fields:"id"});return console.log("Folder Id:",e.result.id),e.result.id}async saveFile(t,e,s){this.parentFolderId===void 0&&(this.parentFolderId=await this._findOrCreateParentFolder());const r={name:t,mimeType:Yo};s||(r.parents=[this.parentFolderId]);const a=btoa(pp(e)),c=`${w0}Content-Type: application/json\r
\r
${JSON.stringify(r)}${w0}Content-Type: ${Yo}\r
Content-Transfer-Encoding: base64\r
\r
${a}${RE}`;return this.gapi.client.request({path:`/upload/drive/v3/files${s?`/${s}`:""}`,method:s?"PATCH":"POST",params:{uploadType:"multipart",newRevision:!1,fields:C0},headers:{"Content-Type":`multipart/mixed; boundary="${Sh}"`},body:c})}async create(t,e,s){console.log(`Google Drive: creating disc image: '${e}'`);const a=(await this.saveFile(e,s)).result;return{fileId:a.id,disc:this.makeDisc(t,s,a)}}makeDisc(t,e,s){let r=null;const a=s.name,c=s.id;return s.capabilities.canEdit?(console.log("Making editable disc"),r=qe.debounce(async h=>{console.log("Data changed..."),await this.saveFile(a,h,c),console.log("Saved ok")},200)):console.log("Making read-only disc"),Ii(t,a,e,r)}async load(t,e){const s=(await this.driveClient.files.get({fileId:e,fields:C0})).result,r=(await this.driveClient.files.get({fileId:e,alt:"media"})).body;return this.makeDisc(t,r,s)}}class PE extends Event{constructor(t){super("step"),this.stepAmount=t}}class IE extends EventTarget{get disc(){throw new Error("Not implemented: disc getter")}get track(){throw new Error("Not implemented: track getter")}get headPosition(){throw new Error("Not implemented: headPosition getter")}get indexPulse(){throw new Error("Not implemented: indexPulse getter")}get spinning(){throw new Error("Not implemented: spinning getter")}get writeProtect(){throw new Error("Not implemented: writeProtect getter")}get trackLength(){throw new Error("Not implemented: trackLength getter")}get positionFraction(){throw new Error("Not implemented: positionFraction getter")}get positionTime(){throw new Error("Not implemented: positionTime getter")}setDisc(t){throw new Error("Not implemented: setDisc")}setPulsesCallback(t){throw new Error("Not implemented: setPulsesCallback")}startSpinning(){throw new Error("Not implemented: startSpinning")}stopSpinning(){throw new Error("Not implemented: stopSpinning")}selectSide(t){throw new Error("Not implemented: selectSide")}seekOneTrack(t){throw new Error("Not implemented: seekOneTrack")}notifySeek(t){throw new Error("Not implemented: notifySeek")}notifySeekAmount(t){throw new Error("Not implemented: notifySeekAmount")}set32usMode(t){throw new Error("Not implemented: set32usMode")}writePulses(t){throw new Error("Not implemented: writePulses")}getQuasiRandomPulses(){throw new Error("Not implemented: getQuasiRandomPulses")}}class Ms extends IE{static get TicksPerRevolution(){return 4e5}static get DiscIndexMs(){return 4}constructor(t,e){super(),this._scheduler=e,this._disc=void 0,this._is40Track=!1,this._track=0,this._isSideUpper=!1,this._headPosition=0,this._pulsePosition=0,this._in32usMode=!1,this._pulsesCallback=null,this._timer=this._scheduler.newTask(this._onTimer.bind(this)),this._spinning=!1}get disc(){return this._disc}getQuasiRandomPulses(){const t=this._scheduler.epoch,e=(t^t>>>8^t>>>16^t>>>24)&255;return z.fmTo2usPulses(255,e)}get trackLength(){const t=this.disc;return t?t.getTrack(this._isSideUpper,this._track).length:z.bytesPerTrack}_onTimer(){let t=this.disc?this.disc.readPulses(this._isSideUpper,this._track,this._headPosition):0,e=32;(this._pulsePosition===16||this._in32usMode)&&(e=16,this._pulsePosition===0&&(t>>>=16),t&=65535),t===0&&(t=this.getQuasiRandomPulses()),this._pulsesCallback&&this._pulsesCallback(t,e);const s=this.positionTime;e===16?this._pulsePosition===0?this._pulsePosition=16:(this._pulsePosition=0,this._headPosition++):this._headPosition++;const r=this.positionTime;this._headPosition===this.trackLength&&(this._headPosition=0,this._checkTrackNeedsWrite()),this._spinning&&this._timer.reschedule(r-s)}get headPosition(){return this._headPosition}get track(){return this._track}get positionFraction(){return(this._headPosition+this._pulsePosition/32)/this.trackLength}set positionFraction(t){this._headPosition=this.trackLength*t|0,this._pulsePosition=0}get positionTime(){return this.positionFraction*Ms.TicksPerRevolution|0}setPulsesCallback(t){this._pulsesCallback=t}get spinning(){return this._spinning}startSpinning(){this._spinning||(this.dispatchEvent(new Event("startSpinning")),this._timer.schedule(1)),this._spinning=!0}stopSpinning(){this._spinning&&this.dispatchEvent(new Event("stopSpinning")),this._timer.cancel(),this._spinning=!1}selectSide(t){const e=this.positionFraction;this._checkTrackNeedsWrite(),this._isSideUpper=t,this.positionFraction=e}setDisc(t){this._disc=t}get indexPulse(){return this.disc?this._headPosition<this.trackLength*Ms.DiscIndexMs/200:!0}writePulses(t){if(this.disc&&!this.disc.writeProtected){if(this._in32usMode){if(t&4294901760)throw new Error(`Unable to write 32us pulses for ${t}`);const e=this.disc.readPulses(this._isSideUpper,this.track,this.headPosition);this._pulsePosition===0?t=e&65535|t<<16:t=e&4294901760|t}this.disc.writePulses(this._isSideUpper,this.track,this.headPosition,t)}}get writeProtect(){return this.disc?this.disc.writeProtected:!1}set32usMode(t){this._in32usMode=t}seekOneTrack(t){this._is40Track&&(t*=2),this._selectTrack(this._track+t)}notifySeek(t){this.notifySeekAmount(t-this._track)}notifySeekAmount(t){this.dispatchEvent(new PE(t))}_selectTrack(t){this._checkTrackNeedsWrite(),t<0?(t=0,console.log("Clang! disc head stopped at track 0")):t>=z.tracksPerDisc&&(t=z.tracksPerDisc-1,console.log("Clang! disc head stopper at track max"));const e=this.positionFraction;this._track=t,this.positionFraction=e}_checkTrackNeedsWrite(){this.disc&&this.disc.flushWrites()}}const wt=Object.freeze({restore:0,seek:16,stepInNoUpdate:64,stepInWithUpdate:80,stepOutNoUpdate:96,stepOutWithUpdate:112,readSector:128,readSectorMulti:144,writeSector:160,writeSectorMulti:176,readAddress:192,forceInterrupt:208,readTrack:224,writeTrack:240}),Vr=Object.freeze({typeIIMulti:16,disableSpinUp:8,typeIVerify:4,typeIIorIIISettle:4,typeIIDeleted:1}),oe=Object.freeze({reset:32,density:8,side:4,drive1:2,drive0:1}),_t=Object.freeze({motorOn:128,writeProtected:64,typeISpinUpDone:32,typeIIorIIIDeletedMark:32,recordNotFound:16,crcError:8,typeITrack0:4,typeIIorIIILostByte:4,typeIIndex:2,typeIIorIIIDrq:2,busy:1}),ht=Object.freeze({null:0,idle:1,timerWait:2,spinUpWait:3,waitIndex:4,searchId:5,inId:6,searchData:7,inData:8,inReadTrack:8,writeSectorDelay:9,writeSectorLeadInFm:10,writeSectorLeadInMfm:11,writeSectorMarkerFm:12,writeSectorMarkerMfm:13,writeSectorBody:14,writeTrackSetup:15,inWriteTrack:16,checkMulti:17,done:18}),ni=Object.freeze({none:1,settle:2,seek:3,done:4});class OE{constructor(t,e,s,r){this._cpu=t,s?this._drives=s:this._drives=[new Ms(0,e),new Ms(1,e)],this._isMaster=t.model.isMaster,this._is1772=!1,this._isOpus=!1,this._controlRegister=0,this._statusRegister=0,this._trackRegister=0,this._sectorRegister=0,this._dataRegister=0,this._isIntRq=!1,this._isDrq=!1,this._doRaiseIntRq=!1,this._currentDrive=null,this._isIndexPulse=!1,this._isInterruptOnIndexPulse=!1,this._isWriteTrackCrcSecondByte=!1,this._command=0,this._commandType=0,this._isCommandSettle=!1,this._isCommandWrite=!1,this._isCommandVerify=!1,this._isCommandMulti=!1,this._isCommandDeleted=!1,this._commandStepRateMs=0,this._state=ht.idle,this._timerState=ni.none,this._timerTask=e.newTask(()=>this._timerFired()),this._stateCount=0,this._indexPulseCount=0,this._markDetector=0n,this._dataShifter=0,this._dataShiftCount=0,this._deliverData=0,this._deliverIsMarker=!1,this._crc=0,this._onDiscTrack=0,this._onDiscSector=0,this._onDiscLength=0,this._onDiscCrc=0,this._lastMfmBit=!1,this._logCommands=r?!!r.logFdcCommands:!1,this._logStateChanges=r?!!r.logFdcStateChanges:!1;const a=(c,h)=>this._pulsesCallback(c,h);for(const c of this._drives)c.setPulsesCallback(a);this.powerOnReset()}reset(){this._writeControl(0)}powerOnReset(){this.reset(),this._trackRegister=0,this._dataRegister=0}_updateNmi(){const t=this._isDrq|(this._isOpus?!1:this._isIntRq);this._cpu.NMI(t)}_setIntRq(t){this._isIntRq=t,this._updateNmi()}_setDrq(t){this._isDrq=t,t?(this._statusRegister&_t.typeIIorIIIDrq&&(this._statusRegister|=_t.typeIIorIIILostByte),this._statusRegister|=_t.typeIIorIIIDrq):this._statusRegister&=~_t.typeIIorIIIDrq,this._updateNmi()}_log(t){console.log(`WD1770: ${t}`)}_logCommand(t){this._logCommands&&this._log(t)}_opusRemapAddr(t){return t^4}_opusRemapVal(t,e){if(t>=4)return e;let s=oe.reset;return e&1?s|=oe.drive0:s|=oe.drive1,e&2&&(s|=oe.side),e&64&&(s|=oe.density),s}_masterRemapVal(t,e){if(t>=4)return e;let s=0;return e&4&&(s|=oe.reset),e&1&&(s|=oe.drive0),e&2&&(s|=oe.drive1),e&16&&(s|=oe.side),e&32&&(s|=oe.density),s}_remapVal(t,e){return this._isMaster?this._masterRemapVal(t,e):this._isOpus?this._opusRemapVal(t,e):e}_remapAddr(t){return t&=7,this._isMaster?t^4:this._isOpus?this._opusRemapAddr(t):t}read(t){switch(this._remapAddr(t)){case 4:return this._setIntRq(!1),this._statusRegister;case 5:return this._trackRegister;case 6:return this._sectorRegister;case 7:return(this._commandType===2||this._commandType===3)&&this._setDrq(!1),this._dataRegister}return 254}write(t,e){switch(t=this._remapAddr(t),e=this._remapVal(t,e),t){case 0:case 1:case 2:case 3:if(this._logCommand(`control register now ${ct(e)}`),this._statusRegister&_t.busy&&!this._isReset(e))throw new Error("Control register updated while busy; without reset");this._writeControl(e);break;case 4:this._isReset(this._controlRegister)||this._doCommand(e);break;case 5:this._logCommand(`track register now ${e}`),this._trackRegister=e;break;case 6:this._isReset(this._controlRegister)?this._logCommand(`ignoring sector write of ${e}`):(this._logCommand(`sector register now ${e}`),this._sectorRegister=e);break;case 7:(this._commandType===2||this._commandType===3)&&this._setDrq(!1),this._dataRegister=e;break}}_doCommand(t){if(!this._currentDrive)throw new Error("Command while no selected drive");this._logCommand(`command ${ct(t)} tr ${this._trackRegister} sr ${this._sectorRegister} dr ${this._dataRegister} cr ${ct(this._controlRegister)} ptrk ${this._currentDrive.track} hpos ${this._currentDrive.headPosition}`);const e=t&240;if(e===wt.forceInterrupt){this._handleForceInterrupt(t);return}if(this._statusRegister&_t.busy){this._log(`command ${ct(t)} while busy with ${ct(this._command)} - ignoring`);return}switch(this._command=e,this._isCommandSettle=!1,this._isCommandWrite=!1,this._isCommandVerify=!1,this._isCommandMulti=!1,this._isCommandDeleted=!1,this._isInterruptOnIndexPulse=!1,this._isWriteTrackCrcSecondByte=!1,e){case wt.restore:case wt.seek:case wt.stepInNoUpdate:case wt.stepInWithUpdate:case wt.stepOutNoUpdate:case wt.stepOutWithUpdate:this._commandType=1,this._isCommandVerify=!!(t&Vr.typeIVerify),this._commandStepRateMs=this._stepRateMsFor(t);break;case wt.readSector:case wt.readSectorMulti:case wt.writeSector:case wt.writeSectorMulti:this._commandType=2,this._isCommandMulti=!!(t&Vr.typeIIMulti);break;case wt.readAddress:case wt.readTrack:case wt.writeTrack:this._commandType=3;break;default:throw new Error(`unimplemented command ${ct(t)}`)}(this._commandType===2||this._commandType===3&&t&Vr.typeIIorIIISettle)&&(this._isCommandSettle=!0),(this._command===wt.writeSector||this._command===wt.writeSectorMulti||this._command===wt.writeTrack)&&(this._isCommandWrite=!0,this._isCommandDeleted=!!(t&Vr.typeIIDeleted)),this._setDrq(!1),this._setIntRq(!1),this._statusRegister=this._statusRegister&_t.motorOn|_t.busy,this._indexPulseCount=0,this._statusRegister&_t.motorOn?this._dispatchCommand():(this._statusRegister|=_t.motorOn,this._currentDrive.startSpinning(),t&Vr.disableSpinUp?(this._indexPulseCount=6,this._log(`command ${ct(t)} spin up wait disabled, motor was off`),this._dispatchCommand()):this._setState(ht.spinUpWait))}_setState(t){this._logStateChanges&&t!==this._state&&this._log(`State ${this._state} -> ${t} @ tr ${this._trackRegister} sr ${this._sectorRegister} dr ${this._dataRegister} cr ${ct(this._controlRegister)} ptrk ${this._currentDrive.track} hpos ${this._currentDrive.headPosition}`),this._state=t,this._stateCount=0}_clearTimer(){this._timerState!==ni.none&&(this._timerTask.cancel(),this._timerState=ni.none)}_clearState(){this._setState(ht.idle),this._clearTimer(),this._indexPulseCount=0}_stepRateMsFor(t){switch(t&3){case 0:return 6;case 1:return 12;case 2:return this._is1772?2:20;case 3:return this._is1772?3:30}}_handleForceInterrupt(t){const e=t&15;if(this._statusRegister&_t.busy)this._commandDone(!1);else{if(this._state!==ht.idle)throw new Error(`Unexpected state when force interrupt: ${this._state}`);this._indexPulseCount=0,this._commandType=1,this._statusRegister&=_t.motorOn,this._statusRegister&_t.motorOn||(this._statusRegister|=_t.motorOn,this._currentDrive.startSpinning())}if(e===0)this._isInterruptOnIndexPulse=!1;else if(e===4)this._isInterruptOnIndexPulse=!0;else throw new Error(`1700 force interrupt flags not handled: ${e}`)}_timerFired(){if(!(this._statusRegister&_t.busy))throw new Error("Should be busy");const t=this._timerState;switch(this._timerState=ni.none,t){case ni.settle:this._dispatchCommand();break;case ni.seek:this._command===wt.stepInNoUpdate||this._command===wt.stepInWithUpdate||this._command===wt.stepOutNoUpdate||this._command===wt.stepOutWithUpdate?this._checkVerify():this._doSeekStepOrVerify();break;case ni.done:this._doneTimer();break;default:throw new Error(`Unexpected timer state ${t}`)}}_isSide(t){return!!(t&oe.side)}_isDoubleDensity(t){return!(t&oe.density)}_isReset(t){return!(t&oe.reset)}_writeControl(t){const e=!!(this._statusRegister&_t.motorOn);if(this._currentDrive&&this._currentDrive.spinning){if(!e)throw new Error(`Unexpected motor control bit off when setting the control register to ${ct(t)}`);this._currentDrive.stopSpinning()}t&oe.drive0||t&oe.drive1?this._currentDrive=this._drives[t&oe.drive0?0:1]:this._currentDrive=null,this._currentDrive&&(e&&this._currentDrive.startSpinning(),this._currentDrive.selectSide(this._isSide(t)));for(const s of this._drives)s.set32usMode(this._isDoubleDensity(t));this._controlRegister=t,this._isReset(t)&&(this._clearState(),this._currentDrive&&e&&this._currentDrive.stopSpinning(),this._statusRegister=0,this._sectorRegister=1,this._isIntRq=!1,this._isDrq=!1,this._updateNmi(),this._markDetector=0n,this._dataShifter=0,this._dataShiftCount=0,this._isIndexPulse=!1,this._lastMfmBit=!1,this._deliverData=0,this._deliverIsMarker=!1)}_makeSeekNoise(t){this._currentDrive&&this._currentDrive.notifySeekAmount(t)}_dispatchCommand(){if(!this._currentDrive)throw new Error("Unexpectedly dispatching a command with no drive set");if(this._isCommandWrite&&this._currentDrive.writeProtect){this._statusRegister|=_t.writeProtected,this._commandDone(!0);return}switch(this._command){case wt.restore:this._trackRegister=255,this._logCommand(`track register now ${this._trackRegister}`),this._dataRegister=0;case wt.seek:this._doSeekStepOrVerify(),this._makeSeekNoise(this._dataRegister-this._trackRegister);break;case wt.stepInNoUpdate:this._doSeekStep(1,!1),this._makeSeekNoise(1);break;case wt.stepInWithUpdate:this._doSeekStep(1,!0),this._makeSeekNoise(1);break;case wt.stepOutNoUpdate:this._doSeekStep(-1,!1),this._makeSeekNoise(-1);break;case wt.stepOutWithUpdate:this._doSeekStep(-1,!0),this._makeSeekNoise(-1);break;case wt.readSector:case wt.readSectorMulti:case wt.writeSector:case wt.writeSectorMulti:case wt.readAddress:this._setState(ht.searchId),this._indexPulseCount=0;break;case wt.readTrack:this._setState(ht.waitIndex),this._indexPulseCount=0;break;case wt.writeTrack:this._setState(ht.writeTrackSetup),this._indexPulseCount=0;break;default:throw new Error(`Invalid command ${this._command} in dispatch`)}}_pulsesCallback(t,e){if(!this._currentDrive||!this._currentDrive.spinning||!(this._statusRegister&_t.motorOn))throw new Error("Something unfortunate happened in the 1770 pulses callback");const s=this._isIndexPulse;this._isIndexPulse=this._currentDrive.indexPulse;const r=this._isIndexPulse&&!s,a=e===16;switch(this._isInterruptOnIndexPulse&&r&&this._setIntRq(!0),this._updateTypeIStatusBits(),this._state){case ht.idle:this._pulsesCallbackIdle();break;case ht.timerWait:break;case ht.spinUpWait:this._pulsesCallbackSpinUpWait();break;case ht.waitIndex:r&&(this._setState(ht.inReadTrack),this._bitstreamReceived(t,e,!1));break;case ht.searchId:case ht.inId:case ht.searchData:case ht.inData:case ht.readTrack:this._bitstreamReceived(t,e,r),this._indexPulseCount>=6&&(this._statusRegister|=_t.recordNotFound,this._commandDone(!0));break;case ht.writeSectorDelay:this._pulsesCallbackSectorDelay(a);break;case ht.writeSectorLeadInFm:this._writeByte(a,0,!1),++this._stateCount===6&&this._setState(ht.writeSectorMarkerFm);break;case ht.writeSectorLeadInMfm:this._stateCount>=11&&this._writeByte(a,0,!1),++this._stateCount===23&&this._setState(ht.writeSectorMarkerMfm);break;case ht.writeSectorMarkerFm:{const c=this._isCommandDeleted?z.deletedDataMarkDataPattern:z.dataMarkDataPattern;this._crc=z.crcAddByte(z.crcInit(!1),c),this._writeByte(!1,c,!0),this._setState(ht.writeSectorBody);break}case ht.writeSectorMarkerMfm:this._pulsesCallbackWriteSectorMarkerMfm();break;case ht.writeSectorBody:this._pulsesCallbackWriteSectorBody(a);break;case ht.checkMulti:this._isCommandMulti?(this._sectorRegister++,this._indexPulseCount=0,this._setState(ht.searchId)):this._commandDone(!0);break;case ht.writeTrackSetup:this._pulsesCallbackWriteTrackSetup();break;case ht.inWriteTrack:this._pulsesCallbackInWriteTrack(a,r);break;case ht.done:this._commandDone(!0);break;default:throw new Error(`Unexpected state ${this._state}`)}r&&this._indexPulseCount++}_pulsesCallbackIdle(){if(this._statusRegister&_t.busy)throw new Error("Unexpectedly busy in idle state");this._indexPulseCount<9||(this._logCommand("automatic motor off"),this._currentDrive.stopSpinning(),this._statusRegister&=~_t.motorOn,this._commandType===1&&(this._statusRegister&=~(_t.typeITrack0|_t.typeIIndex)))}_pulsesCallbackSpinUpWait(){if(!(this._indexPulseCount<6))if(this._commandType===1&&(this._statusRegister|=_t.typeISpinUpDone),this._isCommandSettle){const t=this._is1772?15:30;this._startTimer(ni.settle,t*1e3)}else this._dispatchCommand()}_pulsesCallbackSectorDelay(t){this._stateCount===0?this._indexPulseCount=0:this._stateCount===1?this._setDrq(!0):this._stateCount===10&&this._statusRegister&_t.typeIIorIIIDrq&&(this._statusRegister|=_t.typeIIorIIILostByte,this._commandDone(!0)),this._stateCount++,this._stateCount===12&&this._setState(t?ht.writeSectorLeadInMfm:ht.writeSectorLeadInFm)}_pulsesCallbackWriteSectorMarkerMfm(){if(this._stateCount<3&&this._writeByte(!0,161,!0),++this._stateCount===4){const t=this._isCommandDeleted?z.deletedDataMarkDataPattern:z.dataMarkDataPattern;this._crc=z.crcAddByte(z.crcInit(!0),t),this._writeByte(!0,t,!1),this._setState(ht.writeSectorBody)}}_pulsesCallbackWriteSectorBody(t){if(this._stateCount<this._onDiscLength){let e=this._dataRegister;this._statusRegister&_t.typeIIorIIIDrq&&(e=0,this._statusRegister|=_t.typeIIorIIILostByte),this._crc=z.crcAddByte(this._crc,e),this._writeByte(t,e,!1),this._stateCount!==this._onDiscLength-1&&this._setDrq(!0)}else this._stateCount<this._onDiscLength+2?(this._writeByte(t,this._crc>>>8&255,!1),this._crc=this._crc<<8&65535):(this._writeByte(t,255,!1),this._setState(ht.checkMulti));this._stateCount++}_pulsesCallbackWriteTrackSetup(){if(this._stateCount===0)this._indexPulseCount=0,this._setDrq(!0);else if(this._stateCount===3)if(this._statusRegister&_t.typeIIorIIIDrq)this._statusRegister|=_t.typeIIorIIILostByte,this._commandDone(!0);else{this._setState(ht.inWriteTrack);return}this._stateCount++}_pulsesCallbackInWriteTrack(t,e){if(this._stateCount===0&&!e)return;if(this._stateCount>0&&e){this._commandDone(!0);return}if(this._isWriteTrackCrcSecondByte){this._writeByte(t,this._crc&255,!1),this._isWriteTrackCrcSecondByte=!1,this._setDrq(!0);return}let s=this._dataRegister;this._statusRegister&_t.typeIIorIIIDrq&&(s=0,this._statusRegister|=_t.typeIIorIIILostByte);let r=!1,a=!1;switch(s){case 245:if(!t)throw new Error("Unhandled 0xf5 in FM");r=!0,a=!0,s=161;break;case 246:if(!t)throw new Error("Unhandled 0xf6 in FM");r=!0,s=194;break;case 248:case 249:case 250:case 251:case 254:t||(r=!0,a=!0);break;case 252:t||(r=!0);break}a&&(this._crc=z.crcInit(t)),s===247?(this._writeByte(t,this._crc>>>8&255,!1),this._isWriteTrackCrcSecondByte=!0):(this._writeByte(t,s,r),t&&a||(this._crc=z.crcAddByte(this._crc,s)),this._setDrq(!0)),this._stateCount++}_markDetectorTriggered(){if(this._isDoubleDensity(this._controlRegister)){if((this._markDetector&0xffffffffn)===0xaaaa4489n)return this._deliverData=161,!0;(this._markDetector&0xffffffffffff0000n)===0x4489448944890000n&&(this._deliverIsMarker=!0)}else if((this._markDetector&0x0000ffff00000000n)===0x0000888800000000n){const{clocks:t,data:e,iffyPulses:s}=z._2usPulsesToFm(Number(this._markDetector&0xffffffffn));if(!s&&t===199&&(e===248||e===251||e===254))return this._deliverData=e,this._deliverIsMarker=!0,!0}return!1}_bitReceived(t){if(this._markDetector=this._markDetector<<1n&0xffffffffffffffffn|(t?1n:0n),this._markDetectorTriggered()){this._dataShifter=0,this._dataShiftCount=0;return}if(this._dataShifter=(this._dataShifter<<1|(t?1:0))&4294967295,this._dataShiftCount++,this._isDoubleDensity(this._controlRegister))this._dataShiftCount===16&&(this._deliverData=z._2usPulsesToMfm(this._dataShifter),this._dataShifter=0,this._dataShiftCount=0);else if(this._dataShiftCount===32){const{data:e,iffyPulses:s}=z._2usPulsesToFm(this._dataShifter);if(s){const{data:r}=z._2usPulsesToFm(this._currentDrive.getQuasiRandomPulses());this._deliverData=r}else this._deliverData=e;this._dataShifter=0,this._dataShiftCount=0}}_bitstreamReceived(t,e,s){t=t<<32-e&4294967295;for(let r=0;r<e;++r)this._bitReceived(!!(t&2147483648)),t=t<<1&4294967295;this._byteReceived(s)}_writeByte(t,e,s){let r;if(t)if(s)r=this._mfmMarkerFor(e);else{const a=z.mfmTo2usPulses(this._lastMfmBit,e);this._lastMfmBit=a.lastBit,r=a.pulses}else{const a=s?this._fmMarkerClocksFor(e):255;r=z.fmTo2usPulses(a,e)}this._currentDrive.writePulses(r)}_fmMarkerClocksFor(t){switch(t){case 252:return 215;case 248:case 249:case 250:case 251:case 254:return z.markClockPattern}}_mfmMarkerFor(t){switch(t){case 161:return z.mfmA1Sync;case 194:return z.mfmC2Sync;default:throw new Error(`Bad marker byte ${ct(t)}`)}}_updateTypeIStatusBits(){this._commandType===1&&(this._statusRegister&=~(_t.typeITrack0|_t.typeIIndex),this._currentDrive.track===0&&(this._statusRegister|=_t.typeITrack0),this._currentDrive.indexPulse&&(this._statusRegister|=_t.typeIIndex))}_startTimer(t,e){if(!(this._statusRegister&_t.busy))throw new Error("Should be busy");if(this._timerState!==ni.none)throw new Error("Timer started but still running");this._timerTask.cancel(),this._timerState=t,this._setState(ht.timerWait),this._timerTask.schedule(e*2)}_commandDone(t){if(!(this._statusRegister&_t.busy))throw new Error("Should be busy");this._doRaiseIntRq=t,this._startTimer(ni.done,32)}_doneTimer(){this._statusRegister&=~_t.busy,this._clearState(),this._updateTypeIStatusBits(),this._doRaiseIntRq&&this._setIntRq(!0),this._logCommand(`result status ${ct(this._statusRegister)}`)}_checkVerify(){this._isCommandVerify?(this._indexPulseCount=0,this._setState(ht.searchId)):this._commandDone(!0)}_doSeekStep(t,e){this._currentDrive.seekOneTrack(t),e&&(this._trackRegister+=t),this._updateTypeIStatusBits(),this._startTimer(ni.seek,this._commandStepRateMs*1e3)}_doSeekStepOrVerify(){if(this._trackRegister===this._dataRegister){this._checkVerify();return}const t=this._trackRegister>this._dataRegister?-1:1;if(this._currentDrive.track===0&&t===-1){this._trackRegister=0,this._checkVerify();return}this._doSeekStep(t,!0)}_byteReceived(t){const e=this._isDoubleDensity(this._controlRegister),s=this._deliverIsMarker,r=this._deliverData;switch(this._deliverIsMarker=!1,this._state){case ht.searchId:if(!s||r!==z.idMarkDataPattern)break;this._setState(ht.inId),this._crc=z.crcAddByte(z.crcInit(e),z.idMarkDataPattern);break;case ht.inId:this._byteReceivedInId(r);break;case ht.searchData:this._byteReceivedSearchData(r,s);break;case ht.inData:this._byteReceivedInData(r);break;case ht.inReadTrack:t?this._commandDone(!0):this._sendDataToHost(r);break;default:throw new Error(`Bad state ${this._state}`)}}_byteReceivedInId(t){const e=this._command===wt.readAddress;switch(this._stateCount){case 0:this._onDiscTrack=t,e&&(this._sectorRegister=t);break;case 2:this._onDiscSector=t;break;case 3:this._onDiscLength=128<<(t&3);break}if(e&&this._sendDataToHost(t),this._stateCount<4?this._crc=z.crcAddByte(this._crc,t):this._onDiscCrc=this._onDiscCrc<<8&65535|t,++this._stateCount!==6)return;const s=this._crc!==this._onDiscCrc;if(e){s&&(this._statusRegister|=_t.crcError),this._setState(ht.done);return}if(this._trackRegister!==this._onDiscTrack){this._setState(ht.searchId);return}if(this._commandType===2&&this._sectorRegister!==this._onDiscSector){this._setState(ht.searchId);return}if(s){this._statusRegister|=_t.crcError,this._setState(ht.searchId);return}this._commandType===1?this._commandDone(!0):this._isCommandWrite?this._setState(ht.writeSectorDelay):this._setState(ht.searchData)}_byteReceivedSearchData(t,e){this._stateCount++;const s=this._isDoubleDensity(this._controlRegister),r=s?2:1;if(!(this._stateCount<14*r)){if(this._stateCount>31*r){this._setState(ht.searchId);return}if(e){if(t!==z.dataMarkDataPattern)if(t===z.deletedDataMarkDataPattern)this._statusRegister|=_t.typeIIorIIIDeletedMark;else return;this._setState(ht.inData),this._statusRegister&=~_t.crcError,this._crc=z.crcAddByte(z.crcInit(s),t)}}}_byteReceivedInData(t){if(this._stateCount++,this._stateCount<=this._onDiscLength){this._crc=z.crcAddByte(this._crc,t),this._sendDataToHost(t);return}else if(this._stateCount<=this._onDiscLength+2){this._onDiscCrc=this._onDiscCrc<<8&65535|t;return}if(this._crc!==this._onDiscCrc){this._statusRegister|=_t.crcError,this._commandDone(!0);return}this._setState(ht.checkMulti)}_sendDataToHost(t){if(this._commandType!==2&&this._commandType!==3)throw new Error("Bad command type");this._setDrq(!0),this._dataRegister=t}loadDisc(t,e){this._drives[t].setDisc(e)}get motorOn(){return[this._drives[0]?this._drives[0].spinning:!1,this._drives[0]?this._drives[1].spinning:!1]}get drives(){return this._drives}}class or extends OE{constructor(t,e,s,r){super(t,s,void 0,r);let a=0,c=0;const h=()=>{c?e.spinUp():e.spinDown()};for(const m of this.drives)m.addEventListener("startSpinning",()=>{c++,setTimeout(h,2)}),m.addEventListener("stopSpinning",()=>{--c,setTimeout(h,2)}),m.addEventListener("step",d=>{const p=Date.now();p>a&&(a=p+e.seek(d.stepAmount)*1e3)})}}const O=Object.freeze({internalPointer:0,internalCountMsbCopy:0,internalParamCount:1,internalSeekRetryCount:1,internalParamDataMarker:2,internalParam_5:3,internalParam_4:4,internalParam_3:5,currentSector:6,internalParam_2:6,internalParam_1:7,internalHeaderPointer:8,internalMsCountHi:8,internalMsCountLo:9,internalSeekCount:10,internalIdSector:10,internalSeekTarget_1:11,internalDynamicDispatch:11,internalSeekTarget_2:12,internalIdTrack:12,headStepRate:13,headSettleTime:14,headLoadUnload:15,badTrack_1Drive_0:16,badTrack_2Drive_0:17,trackDrive_0:18,internalCountLsb:19,internalCountMsb:20,internalDriveInCopy:21,internalWriteRunData:21,internalGap2Skip:21,internalResult:22,mode:23,internalStatus:23,badTrack_1Drive_1:24,badTrack_2Drive_1:25,trackDrive_1:26,internalDriveInLatched:27,internalIndexPulseCount:28,internalData:29,internalParameter:30,internalCommand:31,mmioDriveIn:34,mmioDriveOut:35,mmioClocks:36,mmioData:37}),At=Object.freeze({select_1:128,select_0:64,side:32,lowHeadCurrent:16,loadHead:8,direction:4,step:2,writeEnable:1,selectFlags:192}),E0=Object.freeze({singleActuator:2,noDma:1}),pe=Object.freeze({status:0,result:1,unknown_read_2:2,unknown_read_3:3,command:0,parameter:1,reset:2,data:4}),We=Object.freeze({ok:0,clockError:8,lateDma:10,idCrcError:12,dataCrcError:14,driveNotReady:16,writeProtected:18,sectorNotFound:24,flagDeletedData:32}),Wt=Object.freeze({scanData:0,scanDataAndDeleted:1,writeData:2,writeDeletedData:3,readData:4,readDataAndDeleted:5,readId:6,verify:7,format:8,unused_9:9,seek:10,readDriveStatus:11,unused_12:12,specify:13,writeSpecialRegister:14,readSpecialRegister:15}),Kt=Object.freeze({busy:128,commandFull:64,paramFull:32,resultReady:16,nmi:8,needData:4}),Zi=Object.freeze({none:0,command:1,specify:2}),me=Object.freeze({none:1,timeout:2,spindown:3,startReadId:4,startFormat:5,stopFormat:6}),Qi=Object.freeze({none:0,seekStep:1,postSeek:2}),j=Object.freeze({null:0,idle:1,syncingForIdWait:2,syncingForId:3,checkIdMarker:4,inId:5,inIdCrc:6,syncingForData:7,checkDataMarker:8,inData:9,inDataCrc:10,skipGap_2:11,writeRun:12,writeDataMark:13,writeSectorData:14,writeCrc_2:15,writeCrc_3:16,dynamicDispatch:17,formatWriteIdMarker:18,formatIdCrc_2:19,formatIdCrc_3:20,formatWriteDataMarker:21,formatDataCrc_2:22,formatDataCrc_3:23,formatGap_4:24}),kt=Object.freeze({uninitialised:0,unchanged:1,seek:2,readId:3,read:4,write:5,format:6,formatGap1OrGap3FFs:7,formatGap1orGap300s:8,formatGap2_FFs:9,formatGap2_00s:10,formatData:11});class Ss{static get NumRegisters(){return 32}constructor(t,e,s,r){this._cpu=t,s?this._drives=s:this._drives=[new Ms(0,e),new Ms(1,e)],this._currentDrive=null,this._paramCallback=Zi.none,this._indexPulseCallback=me.none,this._timerState=Qi.none,this._callContext=kt.uninitialised,this._didSeekStep=!1,this._regs=new Uint8Array(Ss.NumRegisters),this._isResultReady=!1,this._status=0,this._mmioData=0,this._mmioClocks=0,this._driveOut=0,this._shiftRegister=0,this._numShifts=0,this._state=j.null,this._stateCount=0,this._stateIsIndexPulse=!1,this._crc=0,this._onDiscCrc=0,this._logCommands=r?!!r.logFdcCommands:!1,this._logStateChanges=r?!!r.logFdcStateChanges:!1,this._timerTask=e.newTask(()=>this._timerFired());const a=(c,h)=>this._pulsesCallback(c,h);for(const c of this._drives)c.setPulsesCallback(a);this.powerOnReset()}_commandAbort(){this._driveOut&At.writeEnable&&this._currentDrive.writePulses(z.fmTo2usPulses(255,255)),this._cpu.NMI(!1)}powerOnReset(){this.reset(),this._regs.fill(0),this._isResultReady=!1,this._mmioData=0,this._mmioClocks=0,this._stateCount=0,this._stateIsIndexPulse=!1}reset(){this._commandAbort(),this._clearCallbacks(),this._setDriveOut(0),this._statusLower(this.internalStatus)}get internalStatus(){return this._regs[O.internalStatus]}read(t){switch(t&7){case pe.status:return this._status;case pe.result:{const e=this._result;return this._resultConsumed(),this._statusLower(Kt.nmi),e}case pe.data:case pe.data+1:case pe.data+2:case pe.data+3:return this._statusLower(Kt.needData|Kt.nmi),this._regs[O.internalData];case pe.unknown_read_2:return this._regs[O.internalCountMsb];case pe.unknown_read_3:return this._regs[O.internalCountLsb];default:throw new Error(`"Unexpected read of addr ${te(t)}"`)}}_log(t){console.log(`8271: ${t}`)}_logCommand(t){this._logCommands&&this._log(t)}write(t,e){switch(t&7){case pe.command:this._commandWritten(e);break;case pe.parameter:this._paramWritten(e);break;case pe.data:case pe.data+1:case pe.data+2:case pe.data+3:this._statusLower(Kt.needData|Kt.nmi),this._regs[O.internalData]=e;break;case pe.reset:e!==0&&e!==1&&this._log("funky reset"),e===1&&(this._logCommand("reset"),this.reset());break;case 3:default:this._log(`Not supported: ${te(t)}=${ct(e)}`)}}_checkIndexPulse(){const t=this._stateIsIndexPulse;if(this._stateIsIndexPulse=this._index,!(!this._stateIsIndexPulse||t))switch(this._indexPulseCallback){case me.none:break;case me.timeout:--this._regs[O.internalIndexPulseCount]===0&&this._finishCommand(We.sectorNotFound);break;case me.spindown:--this._regs[O.internalIndexPulseCount]===0&&(this._logCommand("automatic head unload"),this._spinDown(),this._indexPulseCallback=me.none);break;case me.startFormat:if(this._regs[O.internalParam_4]!==0)throw new Error("format GAP5 not supported");this._regs[O.internalParam_2]--,this._regs[O.internalDynamicDispatch]=4,this._indexPulseCallback=me.none,this._writeFFsAnd00s(kt.formatGap1OrGap3FFs,this._regs[O.internalParam_5]);break;case me.stopFormat:this._checkCompletion();break;case me.startReadId:this._startIndexPulseTimeout(),this._startSyncingForHeader();break;default:throw new Error(`Unexpected index pulse callback ${this._indexPulseCallback}`)}}_pulsesCallback(t,e){if(e!==32)throw new Error("Expected FM pulses only");if(this._checkIndexPulse(),this._driveOut&At.writeEnable){const s=this._mmioClocks,r=this._mmioData,a=z.fmTo2usPulses(s,r);s!==255&&s!==z.markClockPattern&&this._log(`writing unusual clocks=${ct(s)} data=${ct(r)}`),this._currentDrive.writePulses(a)}switch(this._mmioData=this._regs[O.internalData],this._state){case j.idle:break;case j.syncingForIdWait:case j.syncingForId:case j.checkIdMarker:case j.inId:case j.inIdCrc:case j.skipGap_2:case j.syncingForData:case j.checkDataMarker:case j.inData:case j.inDataCrc:{for(let s=0;s<16;++s){const r=!!(t&3221225472);t=t<<2&4294967295,this._shiftDataBit(r)}break}case j.writeRun:case j.writeDataMark:case j.dynamicDispatch:case j.writeSectorData:case j.writeCrc_2:case j.writeCrc_3:case j.formatWriteIdMarker:case j.formatIdCrc_2:case j.formatIdCrc_3:case j.formatWriteDataMarker:case j.formatDataCrc_2:case j.formatDataCrc_3:case j.formatGap_4:this._byteCallbackWriting();break;default:throw new Error(`Unknown state ${this._state}`)}}_shiftDataBit(t){const e=this._state;switch(e){case j.syncingForIdWait:this._stateCount++,this._stateCount===4*8*2&&this._startSyncingForHeader();break;case j.syncingForId:case j.syncingForData:{const s=this._stateCount;if(t===!(s&1))this._stateCount++;else if(s>=32&&s&1){if(!t)throw new Error("Assertion failed; was expecting a one bit");this._setState(e===j.syncingForId?j.checkIdMarker:j.checkDataMarker),this._shiftRegister=3,this._numShifts=2}else this._stateCount=t?1:0;break}case j.checkIdMarker:case j.inId:case j.inIdCrc:case j.checkDataMarker:case j.inData:case j.inDataCrc:case j.skipGap_2:{const s=this._shiftRegister<<1&4294967295|(t?1:0);if(this._shiftRegister=s,this._numShifts++,this._numShifts!==16)break;const r=Ss.extractBits(s),a=Ss.extractBits(s<<1);r!==255&&e!==j.checkIdMarker&&e!==j.checkDataMarker&&e!==j.skipGap_2||this._byteCallbackReading(a,r),this._shiftRegister=0,this._numShifts=0;break}case j.idle:case j.writeRun:break;default:throw new Error(`"Unexpected state ${e}"`)}}static extractBits(t){let e=0;return t&32768&&(e|=128),t&8192&&(e|=64),t&2048&&(e|=32),t&512&&(e|=16),t&128&&(e|=8),t&32&&(e|=4),t&8&&(e|=2),t&2&&(e|=1),e}_checkDataLossOk(){let t=!0;this._regs[O.mode]&E0.noDma||(t=!1);const e=this._internalCommand;return(e===Wt.scanData||e===Wt.scanDataAndDeleted)&&(t=!1),this.internalStatus&Kt.needData&&(t=!1),t?!0:(this._commandAbort(),this._finishCommand(We.lateDma),!1)}_byteCallbackReading(t,e){const s=this._internalCommand;if(this._irqCallbacks){if(!this._checkDataLossOk())return;this._regs[O.internalData]=t,this._statusRaise(Kt.nmi|Kt.needData)}switch(this._state){case j.skipGap_2:if(--this._regs[O.internalGap2Skip])break;if(this._callContext===kt.read)this._setState(j.syncingForData);else if(this._callContext===kt.write)this._doWriteRun(kt.write,0);else throw new Error(`Unexpected call context ${this._callContext}`);break;case j.checkIdMarker:e===z.markClockPattern&&t===z.idMarkDataPattern?(this._crc=z.crcAddByte(z.crcInit(!1),t),s===Wt.readId&&this._startIrqCallbacks(),this._setState(j.inId)):this._startSyncingForHeader();break;case j.inId:this._crc=z.crcAddByte(this._crc,t),this._writeRegister(this._regs[O.internalHeaderPointer],t),this._regs[O.internalHeaderPointer]--,(this._regs[O.internalHeaderPointer]&7)===0&&(this._onDiscCrc=0,this._stopIrqCallbacks(),this._setState(j.inIdCrc));break;case j.inIdCrc:if(this._onDiscCrc=(this._onDiscCrc<<8|t)&4294967295,++this._stateCount===2){if(!this._checkCrc(We.idCrcError))break;this._regs[O.internalCommand]===24?this._checkCompletion():this._regs[O.internalIdTrack]!==this._regs[O.internalParam_1]?++this._regs[O.internalSeekRetryCount]===3?this._finishCommand(We.sectorNotFound):(this._logCommand("stepping due to track mismatch"),this._doSeek(kt.unchanged)):this._regs[O.internalIdSector]===this._regs[O.internalParam_2]?(this._regs[O.internalGap2Skip]=11,this._callContext===kt.write&&(this._regs[O.internalCountMsb]=0,this._regs[O.internalCountLsb]=5),this._setState(j.skipGap_2)):this._setState(j.syncingForIdWait)}break;case j.checkDataMarker:if(e===z.markClockPattern&&(t===z.dataMarkDataPattern||t===z.deletedDataMarkDataPattern)){let r=!0;t===z.deletedDataMarkDataPattern&&((this._regs[O.internalCommand]&15)===0&&(r=!1),this._setResult(We.flagDeletedData)),this._regs[O.internalCommand]===28&&(r=!1),r&&this._startIrqCallbacks(),this._crc=z.crcAddByte(z.crcInit(!1),t),this._setState(j.inData)}else this._finishCommand(We.clockError);break;case j.inData:{this._crc=z.crcAddByte(this._crc,t),this._decrementCounter()&&(this._onDiscCrc=0,this._setState(j.inDataCrc));break}case j.inDataCrc:if(this._onDiscCrc=(this._onDiscCrc<<8|t)&4294967295,++this._stateCount===2){if(!this._checkCrc(We.dataCrcError))break;this._checkCompletion()}break;default:throw new Error(`Unexpected state ${this._state}`)}}_callbackWriteRun(){if(!this._decrementCounter()){this._mmioData=this._regs[O.internalWriteRunData],this._crc=z.crcAddByte(this._crc,this._mmioData);return}switch(this._callContext){case kt.write:this._mmioData=0,this._startIrqCallbacks(),this._setState(j.writeDataMark);break;case kt.formatGap1OrGap3FFs:this._regs[O.internalCountLsb]=5,this._doWriteRun(kt.formatGap1orGap300s,0);break;case kt.formatGap1orGap300s:this._mmioData=0,this._startIrqCallbacks(),this._setState(j.formatWriteIdMarker);break;case kt.formatGap2_FFs:this._regs[O.internalCountLsb]=5,this._doWriteRun(kt.formatGap2_00s,0);break;case kt.formatGap2_00s:this._mmioData=0,this._setState(j.formatWriteDataMarker);break;case kt.formatData:this._mmioData=this._crc>>>8&255,this._setState(j.formatDataCrc_2);break;default:throw new Error(`Unexpected call context ${this._callContext}`)}}_callbackDynamicDispatch(){const t=this._regs[O.internalDynamicDispatch]++;switch(t){case 0:this._crc=z.crcAddByte(this._crc,this._mmioData);break;case 1:this._mmioData=this._crc>>>8&255,this._setState(j.writeCrc_2);break;case 2:this._checkCompletion();break;case 4:this._mmioClocks=255;case 5:case 6:case 7:t===6&&this._stopIrqCallbacks(),this._crc=z.crcAddByte(this._crc,this._mmioData);break;case 8:this._mmioData=this._crc>>>8&255,this._setState(j.formatIdCrc_2);break;case 9:this._regs[O.internalCountLsb]=10,this._writeFFsAnd00s(kt.formatGap2_FFs,-1);break;case 10:this._resetSectorByteCount(),this._doWriteRun(kt.formatData,229);break;case 11:this._mmioData=255,(--this._regs[O.internalParam_3]&31)===0?(this._regs[O.internalParam_3]=1,this._indexPulseCallback=me.stopFormat,this._setState(j.formatGap_4)):(this._regs[O.internalDynamicDispatch]=4,this._writeFFsAnd00s(kt.formatGap1OrGap3FFs,this._regs[O.internalParam_2]));break;default:throw new Error(`Dodgy routine number ${t}`)}}_byteCallbackWriting(){if(this._irqCallbacks){if(!this._checkDataLossOk())return;this._statusRaise(Kt.nmi|Kt.needData)}switch(this._state){case j.writeRun:this._callbackWriteRun();break;case j.writeDataMark:this._mmioData=this._regs[O.internalParamDataMarker],this._crc=z.crcAddByte(z.crcInit(!1),this._mmioData),this._mmioClocks=z.markClockPattern,this._resetSectorByteCount(),this._regs[O.internalCountLsb]--,this._setState(j.writeSectorData);break;case j.writeSectorData:this._mmioClocks=255,this._crc=z.crcAddByte(this._crc,this._mmioData),this._decrementCounter()&&(this._regs[O.internalDynamicDispatch]=0,this._setState(j.dynamicDispatch));break;case j.writeCrc_2:this._mmioData=this._crc&255,this._setState(j.writeCrc_3);break;case j.writeCrc_3:this._mmioData=255,this._setState(j.dynamicDispatch);break;case j.dynamicDispatch:this._callbackDynamicDispatch();break;case j.formatWriteIdMarker:this._mmioData=z.idMarkDataPattern,this._mmioClocks=z.markClockPattern,this._crc=z.crcAddByte(z.crcInit(!1),this._mmioData),this._setState(j.dynamicDispatch);break;case j.formatIdCrc_2:this._mmioData=this._crc&255,this._setState(j.formatIdCrc_3);break;case j.formatIdCrc_3:this._mmioData=255,this._setState(j.dynamicDispatch);break;case j.formatWriteDataMarker:this._mmioData=z.dataMarkDataPattern,this._mmioClocks=z.markClockPattern,this._crc=z.crcAddByte(z.crcInit(!1),this._mmioData),this._setState(j.dynamicDispatch);break;case j.formatDataCrc_2:this._mmioData=this._crc&255,this._setState(j.formatDataCrc_3);break;case j.formatDataCrc_3:this._mmioData=255,this._setState(j.dynamicDispatch);break;case j.formatGap_4:this._mmioData=255;break;default:throw new Error(`Bad write state ${this._state}`)}}_resetSectorByteCount(){this._regs[O.internalCountMsb]=this._regs[O.internalCountMsbCopy],this._regs[O.internalCountLsb]=128}_checkCompletion(){this._checkDriveReady()&&(this._driveOutLower(At.writeEnable),this._clearCallbacks(),(--this._regs[O.internalParam_3]&31)===0?this._finishCommand(We.ok):(this._regs[O.internalParam_2]+=this._regs[O.internalParam_4]&63,this._doCommandDispatch()))}_checkCrc(t){return this._crc===this._onDiscCrc?!0:(this._finishCommand(t),!1)}_statusRaise(t){this._regs[O.internalStatus]|=t,t&Kt.nmi&&this._updateNmi(),this._updateExternalStatus()}_statusLower(t){this._regs[O.internalStatus]&=~t,t&Kt.nmi&&this._updateNmi(),this._updateExternalStatus()}_setResult(t){this._regs[O.internalResult]=t,this._isResultReady=!0,this._updateExternalStatus()}get _result(){return this._regs[O.internalResult]}_updateNmi(){const e=!!(this.internalStatus&Kt.nmi);this._cpu.nmi&&e&&this._log("edge triggered NMI already high"),this._cpu.NMI(e)}_updateExternalStatus(){let t=this.internalStatus;t&=-4,t&=~Kt.resultReady,this._isResultReady&&(t|=Kt.resultReady),t&=-97,this._status=t}_commandWritten(t){this.internalStatus&Kt.busy&&this._log(`command ${ct(t)} while busy with ${ct(this._regs[O.internalCommand])}`),this._regs[O.internalCommand]=t,this._statusRaise(Kt.busy),this._statusLower(Kt.commandFull),this._setResult(0),this._regs[O.internalParam_3]=1,this._regs[O.internalParam_4]=1;const s=t&24?t&3:5;this._regs[O.internalParamCount]=s,s?(this._regs[O.internalPointer]=O.internalParam_1,this._paramCallback=Zi.command):this._startCommand()}_resultConsumed(){this._isResultReady=!1,this._updateExternalStatus()}_paramWritten(t){switch(this._regs[O.internalParameter]=t,this._resultConsumed(),this._paramCallback){case Zi.none:break;case Zi.command:{this._writeRegister(this._regs[O.internalPointer],t),--this._regs[O.internalPointer],--this._regs[O.internalParamCount]===0&&this._startCommand();break}case Zi.specify:{this._logCommand(`specify param ${ct(t)}`),this._writeRegister(this._regs[O.internalPointer],t),++this._regs[O.internalPointer],--this._regs[O.internalParamCount]===0&&this._finishSimpleCommand();break}default:throw new Error(`Unexpected param callback ${this._paramCallback}`)}}_readRegister(t){if(t&=63,t<Ss.NumRegisters)return this._regs[t];switch(t&=7,t){case O.mmioDriveIn&7:return this._driveIn;case O.mmioDriveOut&7:return this._driveOut;case O.mmioClocks&7:return this._mmioClocks;case O.mmioData&7:return this._mmioData;default:this._log(`direct read from MMIO register ${ct(t)}`);break}return 0}_writeRegister(t,e){if(t&=63,t<Ss.NumRegisters){this._regs[t]=e;return}switch(t&=7,t){case O.mmioDriveOut&7:this._setDriveOut(e);break;case O.mmioClocks&7:this._mmioClocks=e;break;case O.mmioData&7:this._mmioData=e;break;default:this._log(`direct write to MMIO register ${ct(t)}`);break}}_driveOutRaise(t){this._setDriveOut(t|this._driveOut)}_driveOutLower(t){this._setDriveOut(this._driveOut&~t)}_setDriveOut(t){this._currentDrive&&this._currentDrive.stopSpinning(),this._currentDrive=null;const e=t&At.selectFlags;e===At.select_0?this._currentDrive=this._drives[0]:e===At.select_1&&(this._currentDrive=this._drives[1]),this._currentDrive&&(t&At.loadHead&&this._currentDrive.startSpinning(),this._currentDrive.selectSide(!!(t&At.side))),this._driveOut=t}_setState(t){this._state!==t&&this._logStateChanges&&this._log(`State ${this._state} -> ${t}`),this._state=t,this._stateCount=0,(t===j.syncingForId||t===j.syncingForData)&&(this._shiftRegister=0,this._numShifts=0)}_doSeek(t){t!==kt.unchanged&&(this._callContext=t);let e=this._regs[O.internalParam_1]+this._regs[O.internalSeekRetryCount];const s=this._driveOut&At.select_1?O.badTrack_1Drive_1:O.badTrack_1Drive_0;e>0&&(this._regs[s+0]<=e&&(e=e+1&255),this._regs[s+1]<=e&&(e=e+1&255)),this._regs[O.internalSeekTarget_1]=e,this._regs[O.internalSeekTarget_2]=e,e>=43?this._driveOut|=At.lowHeadCurrent:this._driveOut&=~At.lowHeadCurrent;const r=e===0?255:this._regs[s+2];if(this._didSeekStep=!1,e===r){this._doLoadHead();return}e>r?(this._regs[O.internalSeekCount]=e-r,this._driveOut|=At.direction):(this._regs[O.internalSeekCount]=r-e,this._driveOut&=~At.direction),this._currentDrive&&this._currentDrive.notifySeek(e),this._driveOut&=~At.step,this._regs[s+2]=this._regs[O.internalSeekTarget_2],this._regs[O.mode]&E0.singleActuator&&(this._regs[O.trackDrive_0]=this._regs[O.internalSeekTarget_2],this._regs[O.trackDrive_1]=this._regs[O.internalSeekTarget_2]),this._doSeekStep()}_doSeekStep(){if(this._trk0&&this._regs[O.internalSeekTarget_2]===0||this._regs[O.internalSeekCount]===0){this._doLoadHead();return}this._didSeekStep=!0,this._regs[O.internalSeekCount]--,this._currentDrive&&this._currentDrive.seekOneTrack(this._driveOut&At.direction?1:-1);let t=this._regs[O.headStepRate];t===0?t=3:t*=2,this._setTimerMs(Qi.seekStep,t)}_doLoadHead(){let t=0;this._driveOut&At.loadHead?this._didSeekStep&&(t=2*this._regs[O.headSettleTime]):(this._driveOutRaise(At.loadHead),t=4*(this._regs[O.headLoadUnload]&15)),t?this._setTimerMs(Qi.postSeek,t):this._postSeekDispatch()}_postSeekDispatch(){if(this._timerState=Qi.none,!!this._checkDriveReady())switch(this._callContext){case kt.seek:this._finishCommand(We.ok);break;case kt.readId:this._indexPulseCallback=me.startReadId;break;case kt.format:this._setupSectorSize(),this._indexPulseCallback=me.startFormat,this._checkWriteProtect();break;case kt.read:case kt.write:this._setupSectorSize(),this._startIndexPulseTimeout(),this._startSyncingForHeader(),this._callContext===kt.write&&this._checkWriteProtect();break;default:throw new Error(`Surprising call context post seek ${this._callContext}`)}}get _sectorSize(){return 128<<(this._regs[O.internalParam_3]>>>5)}_setupSectorSize(){const t=(this._sectorSize>>>7)-1;this._regs[O.internalCountLsb]=128,this._regs[O.internalCountMsb]=t,this._regs[O.internalCountMsbCopy]=t}_setTimerMs(t,e){this._timerTask.cancel(),this._timerState=t,this._timerTask.schedule(e*2e3)}_startIndexPulseTimeout(){this._regs[O.internalIndexPulseCount]=3,this._indexPulseCallback=me.timeout}_startSyncingForHeader(){this._regs[O.internalHeaderPointer]=12,this._setState(j.syncingForId)}_checkDriveReady(){this._doReadDriveStatus();const t=this._driveOut&At.select_1?64:4;return this._regs[O.internalDriveInLatched]&t?!0:(this._finishCommand(We.driveNotReady),!1)}_checkWriteProtect(){this._regs[O.internalDriveInLatched]&8&&this._finishCommand(We.writeProtected)}_startCommand(){let t=this._regs[O.internalCommand];const e=t;this._doReadDriveStatus(),this._paramCallback=Zi.none;const s=t&At.selectFlags;if(this._mmioClocks=s,s!==(this._driveOut&At.selectFlags)){const a=s|this._driveOut&At.side;this._setDriveOut(a)}t&=~(At.selectFlags|3),this._regs[O.internalCommand]=t,this._logCommand(`command ${ct(e&63)} sel ${ct(s)} params ${ct(this._regs[O.internalParam_1])} ${ct(this._regs[O.internalParam_2])} ${ct(this._regs[O.internalParam_3])} ${ct(this._regs[O.internalParam_4])} ${ct(this._regs[O.internalParam_5])} ptrk ${this._currentDrive?this._currentDrive.track:-1} hpos ${this._currentDrive?this._currentDrive.headPosition:-1}`);const r=this._internalCommand;(r===Wt.scanData||r===Wt.scanDataAndDeleted)&&this._log("scan sectors doesn't work in a beeb"),this._doCommandDispatch()}get _internalCommand(){return(this._regs[O.internalCommand]&~(At.selectFlags|3))>>>2}get _currentDiscIsSpinning(){return this._currentDrive?this._currentDrive.spinning:!1}get _trk0(){return this._currentDrive?this._currentDrive.track===0:!1}get _index(){return this._currentDrive?this._currentDrive.indexPulse:!1}get _wrProt(){return this._currentDrive?this._currentDrive.writeProtect:!1}get _driveIn(){let t=129;return this._currentDiscIsSpinning&&(this._trk0&&(t|=2),this._driveOut&At.select_0&&(t|=4),this._driveOut&At.select_1&&(t|=64),this._wrProt&&(t|=8),this._index&&(t|=16)),t}_doReadDriveStatus(){let t=this._driveIn;return this._regs[O.internalDriveInCopy]=t,this._regs[O.internalDriveInLatched]|=187,t&=this._regs[O.internalDriveInLatched],this._regs[O.internalDriveInLatched]=t,t}_doCommandDispatch(){const t=this._internalCommand;switch(t){case Wt.unused_9:case Wt.unused_12:throw new Error("Unused 8271 command");case Wt.readDriveStatus:{const e=this._doReadDriveStatus();this._setResult(e),this._regs[O.internalDriveInLatched]=this._regs[O.internalDriveInCopy],this._finishSimpleCommand();break}case Wt.specify:this._regs[O.internalPointer]=this._regs[O.internalParam_1],this._regs[O.internalParamCount]=3,this._paramCallback=Zi.specify;break;case Wt.writeSpecialRegister:this._writeRegister(this._regs[O.internalParam_1],this._regs[O.internalParam_2]),this._lowerBusyAndLog();break;case Wt.readSpecialRegister:this._setResult(this._readRegister(this._regs[O.internalParam_1])),this._finishSimpleCommand();break;case Wt.readId:this._regs[O.internalParam_2]===0?this._doSeek(kt.readId):this._startSyncingForHeader();break;case Wt.seek:this._doSeek(kt.seek);break;case Wt.readData:case Wt.readDataAndDeleted:case Wt.verify:case Wt.scanData:case Wt.scanDataAndDeleted:this._doSeek(kt.read);break;case Wt.writeData:this._regs[O.internalParamDataMarker]=z.dataMarkDataPattern,this._doSeek(kt.write);break;case Wt.writeDeletedData:this._regs[O.internalParamDataMarker]=z.deletedDataMarkDataPattern,this._doSeek(kt.write);break;case Wt.format:this._doSeek(kt.format);break;default:throw new Error(`Unexpected command ${t}`)}}_finishSimpleCommand(){this._lowerBusyAndLog(),this._stopIrqCallbacks(),this._clearCallbacks();const t=this._regs[O.headLoadUnload]>>>4;t===0?this._spinDown():t===15||(this._regs[O.internalIndexPulseCount]=t,this._indexPulseCallback=me.spindown)}_finishCommand(t){t!==We.ok&&this._driveOutLower(At.direction|At.step|At.writeEnable),this._setResult(t|this._result),this._statusRaise(Kt.nmi),this._finishSimpleCommand()}get _irqCallbacks(){return(this._regs[O.internalStatus]&48)===48}_startIrqCallbacks(){this._regs[O.internalStatus]|=48}_stopIrqCallbacks(){this._regs[O.internalStatus]&=-49}_decrementCounter(){return--this._regs[O.internalCountLsb]?!1:(--this._regs[O.internalCountMsb],this._regs[O.internalCountMsb]!==255?(this._regs[O.internalCountLsb]=128,!1):(this._regs[O.internalCountMsb]=0,this._stopIrqCallbacks(),!0))}_clearCallbacks(){this._paramCallback=Zi.none,this._indexPulseCallback=me.none,this._timerState!==Qi.none&&(this._timerTask.cancel(),this._timerState=Qi.none),this._setState(j.idle)}_lowerBusyAndLog(){this._statusLower(Kt.busy),this._logCommand(`status ${ct(this._status)} result ${ct(this._result)}`)}_spinDown(){this._driveOutLower(At.selectFlags|At.loadHead)}_timerFired(){switch(this._regs[O.internalMsCountHi]=0,this._regs[O.internalMsCountLo]=0,this._timerState){case Qi.seekStep:this._doSeekStep();break;case Qi.postSeek:this._postSeekDispatch();break}}_doWriteRun(t,e){this._mmioData=e&255,this._mmioClocks=255,this._crc=z.crcAddByte(this._crc,this._mmioData),this._regs[O.internalWriteRunData]=this._mmioData,this._driveOutRaise(At.writeEnable),this._callContext=t,this._setState(j.writeRun)}_writeFFsAnd00s(t,e){e!==-1&&(this._regs[O.internalCountLsb]=e,this._regs[O.internalCountMsb]=0),this._doWriteRun(t,255)}loadDisc(t,e){this._drives[t].setDisc(e)}get motorOn(){return[this._drives[0]?this._drives[0].spinning:!1,this._drives[0]?this._drives[1].spinning:!1]}get drives(){return this._drives}}class fn extends Ss{constructor(t,e,s,r){super(t,s,void 0,r);let a=0,c=0;const h=()=>{c?e.spinUp():e.spinDown()};for(const m of this.drives)m.addEventListener("startSpinning",()=>{c++,setTimeout(h,2)}),m.addEventListener("stopSpinning",()=>{--c,setTimeout(h,2)}),m.addEventListener("step",d=>{const p=Date.now();p>a&&(a=p+e.seek(d.stepAmount)*1e3)})}}const ta=te,ea=ct,ME=dp;function Ri(i,t){const e=[];return i?(t||e.push("const newBotBit = cpu.p.c ? 0x01 : 0x00;"),e.push("cpu.p.c = !!(REG & 0x80);"),t?e.push("REG = (REG << 1) & 0xff;"):e.push("REG = ((REG << 1) & 0xff) | newBotBit;")):(t||e.push("const newTopBit = cpu.p.c ? 0x80 : 0x00;"),e.push("cpu.p.c = !!(REG & 0x01);"),t?e.push("REG >>>= 1;"):e.push("REG = (REG >>> 1) | newTopBit;")),e.push("cpu.p.setzn(REG);"),e}function ia(i){return i==="p"?["cpu.p.setFromByte(cpu.pull());"]:[`cpu.${i} = cpu.p.setzn(cpu.pull());`]}function sa(i){return i==="p"?"cpu.push(cpu.p.asByte());":`cpu.push(cpu.${i});`}class Ec{constructor(t){this.is65c12=t,this.ops={},this.cycle=0}appendOrPrepend(t,e,s,r,a){s===void 0&&(s=e,e=this.cycle),r=r||!1,typeof s=="string"&&(s=[s]),this.ops[e]?(this.ops[e].op=t(this.ops[e].op,s),r&&(this.ops[e].exact=!0),this.ops[e].addr||(this.ops[e].addr=a)):this.ops[e]={op:s,exact:r,addr:a}}append(t,e,s,r){this.appendOrPrepend((a,c)=>a.concat(c),t,e,s,r)}prepend(t,e,s,r){this.appendOrPrepend((a,c)=>c.concat(a),t,e,s,r)}tick(t){this.cycle+=t||1}readOp(t,e,s){this.cycle++;let r;e?r=`${e} = cpu.readmem(${t});`:r=`cpu.readmem(${t});`,s&&(r+=" // spurious"),this.append(this.cycle,r,!0,t)}writeOp(t,e,s){this.cycle++;let r=`cpu.writemem(${t}, ${e});`;s&&(r+=" // spurious"),this.append(this.cycle,r,!0,t)}zpReadOp(t,e){this.cycle++,this.append(this.cycle,`${e} = cpu.readmemZpStack(${t});`,!1)}zpWriteOp(t,e){this.cycle++,this.append(this.cycle,`cpu.writememZpStack(${t}, ${e});`,!0)}render(t){return this.cycle<2&&(this.cycle=2),this.prepend(this.cycle-1,"cpu.checkInt();",!0),this.renderInternal(t)}spuriousOp(t,e){this.is65c12?this.readOp(t,"",!0):this.writeOp(t,e,!0)}renderInternal(t){t=t||0;let e=0,s=[];for(let r=t;r<this.cycle;++r){if(!this.ops[r]){e++;continue}e&&this.ops[r].exact&&(this.ops[r].addr?s.push(`cpu.polltimeAddr(${e}, ${this.ops[r].addr});`):s.push(`cpu.polltime(${e});`),e=0),s=s.concat(this.ops[r].op),e++}return e&&(this.ops[this.cycle]&&this.ops[this.cycle].addr?s.push(`cpu.polltimeAddr(${e}, ${this.ops[this.cycle].addr});`):s.push(`cpu.polltime(${e});`)),this.ops[this.cycle]&&(s=s.concat(this.ops[this.cycle].op)),s.filter(r=>r)}split(t){return new NE(this,t,this.is65c12)}}class NE{constructor(t,e,s){this.preamble=t,this.condition=e,this.ifTrue=new Ec(s),this.ifTrue.tick(t.cycle),this.ifFalse=new Ec(s),this.ifFalse.tick(t.cycle),["append","prepend","readOp","writeOp","spuriousOp"].forEach(r=>{this[r]=(...a)=>{this.ifTrue[r](...a),this.ifFalse[r](...a)}})}indent(t){return t.map(e=>`  ${e}`)}render(){return this.preamble.renderInternal().concat(`if (${this.condition}) {`).concat(this.indent(this.ifTrue.render(this.preamble.cycle))).concat("} else {").concat(this.indent(this.ifFalse.render(this.preamble.cycle))).concat("}")}}function BE(i,t){switch(i){case"NOP":return{op:"",read:t!==void 0};case"BRK":return{op:"cpu.brk(false);"};case"CLC":return{op:"cpu.p.c = false;"};case"SEC":return{op:"cpu.p.c = true;"};case"CLD":return{op:"cpu.p.d = false;"};case"SED":return{op:"cpu.p.d = true;"};case"CLI":return{op:"cpu.p.i = false;"};case"SEI":return{op:"cpu.p.i = true;"};case"CLV":return{op:"cpu.p.v = false;"};case"LDA":return{op:["cpu.a = cpu.p.setzn(REG);"],read:!0};case"LDX":return{op:["cpu.x = cpu.p.setzn(REG);"],read:!0};case"LDY":return{op:["cpu.y = cpu.p.setzn(REG);"],read:!0};case"STA":return{op:"REG = cpu.a;",write:!0};case"STX":return{op:"REG = cpu.x;",write:!0};case"STY":return{op:"REG = cpu.y;",write:!0};case"INC":return{op:["REG = cpu.p.setzn(REG + 1);"],read:!0,write:!0};case"DEC":return{op:["REG = cpu.p.setzn(REG - 1);"],read:!0,write:!0};case"INX":return{op:["cpu.x = cpu.p.setzn(cpu.x + 1);"]};case"INY":return{op:["cpu.y = cpu.p.setzn(cpu.y + 1);"]};case"DEX":return{op:["cpu.x = cpu.p.setzn(cpu.x - 1);"]};case"DEY":return{op:["cpu.y = cpu.p.setzn(cpu.y - 1);"]};case"ADC":return{op:"cpu.adc(REG);",read:!0};case"SBC":return{op:"cpu.sbc(REG);",read:!0};case"BIT":return t==="imm"?{op:"cpu.p.z = !(cpu.a & REG);",read:!0}:{op:["cpu.p.z = !(cpu.a & REG);","cpu.p.v = !!(REG & 0x40);","cpu.p.n = !!(REG & 0x80);"],read:!0};case"ROL":return{op:Ri(!0,!1),read:!0,write:!0,rotate:!0};case"ROR":return{op:Ri(!1,!1),read:!0,write:!0,rotate:!0};case"ASL":return{op:Ri(!0,!0),read:!0,write:!0,rotate:!0};case"LSR":return{op:Ri(!1,!0),read:!0,write:!0,rotate:!0};case"EOR":return{op:["cpu.a = cpu.p.setzn(cpu.a ^ REG);"],read:!0};case"AND":return{op:["cpu.a = cpu.p.setzn(cpu.a & REG);"],read:!0};case"ORA":return{op:["cpu.a = cpu.p.setzn(cpu.a | REG);"],read:!0};case"CMP":return{op:["cpu.p.setzn(cpu.a - REG);","cpu.p.c = cpu.a >= REG;"],read:!0};case"CPX":return{op:["cpu.p.setzn(cpu.x - REG);","cpu.p.c = cpu.x >= REG;"],read:!0};case"CPY":return{op:["cpu.p.setzn(cpu.y - REG);","cpu.p.c = cpu.y >= REG;"],read:!0};case"TXA":return{op:["cpu.a = cpu.p.setzn(cpu.x);"]};case"TAX":return{op:["cpu.x = cpu.p.setzn(cpu.a);"]};case"TXS":return{op:"cpu.s = cpu.x;"};case"TSX":return{op:["cpu.x = cpu.p.setzn(cpu.s);"]};case"TYA":return{op:["cpu.a = cpu.p.setzn(cpu.y);"]};case"TAY":return{op:["cpu.y = cpu.p.setzn(cpu.a);"]};case"BEQ":return{op:"cpu.branch(cpu.p.z);"};case"BNE":return{op:"cpu.branch(!cpu.p.z);"};case"BCS":return{op:"cpu.branch(cpu.p.c);"};case"BCC":return{op:"cpu.branch(!cpu.p.c);"};case"BMI":return{op:"cpu.branch(cpu.p.n);"};case"BPL":return{op:"cpu.branch(!cpu.p.n);"};case"BVS":return{op:"cpu.branch(cpu.p.v);"};case"BVC":return{op:"cpu.branch(!cpu.p.v);"};case"PLA":return{op:ia("a"),extra:3};case"PLP":return{op:ia("p"),extra:3};case"PLX":return{op:ia("x"),extra:3};case"PLY":return{op:ia("y"),extra:3};case"PHA":return{op:sa("a"),extra:2};case"PHP":return{op:sa("p"),extra:2};case"PHX":return{op:sa("x"),extra:2};case"PHY":return{op:sa("y"),extra:2};case"RTS":return{op:["let temp = cpu.pull();","temp |= cpu.pull() << 8;","cpu.pc = (temp + 1) & 0xffff;"],extra:5};case"RTI":return{preop:["let temp = cpu.pull();","cpu.p.c = !!(temp & 0x01);","cpu.p.z = !!(temp & 0x02);","cpu.p.i = !!(temp & 0x04);","cpu.p.d = !!(temp & 0x08);","cpu.p.v = !!(temp & 0x40);","cpu.p.n = !!(temp & 0x80);","temp = cpu.pull();","cpu.pc = temp | (cpu.pull() << 8);"],extra:5};case"JSR":return{op:["const pushAddr = cpu.pc - 1;","cpu.push(pushAddr >>> 8);","cpu.push(pushAddr & 0xff);","cpu.pc = addr;"],extra:3};case"JMP":return{op:"cpu.pc = addr;"};case"TSB":return{op:["cpu.p.z = !(REG & cpu.a);","REG |= cpu.a;"],read:!0,write:!0};case"TRB":return{op:["cpu.p.z = !(REG & cpu.a);","REG &= ~cpu.a;"],read:!0,write:!0};case"BRA":return{op:"cpu.branch(true);"};case"STZ":return{op:"REG = 0;",write:!0};case"SAX":return{op:"REG = cpu.a & cpu.x;",write:!0};case"ASR":return{op:["REG &= cpu.a;"].concat(Ri(!1,!0)).concat(["cpu.a = REG;"])};case"SLO":return{op:Ri(!0,!0).concat(["cpu.a |= REG;","cpu.p.setzn(cpu.a);"]),read:!0,write:!0};case"SHX":return{op:"REG = (cpu.x & ((addr >>> 8)+1)) & 0xff;",write:!0,zpQuirk:!0};case"SHY":return{op:"REG = (cpu.y & ((addr >>> 8)+1)) & 0xff;",write:!0,zpQuirk:!0};case"LAX":return{op:["const magic = 0xff;","cpu.a = cpu.x = cpu.p.setzn((cpu.a|magic) & REG);"],read:!0};case"LXA":return{op:["const magic = 0xee;","cpu.a = cpu.x = cpu.p.setzn((cpu.a|magic) & REG);"],read:!0};case"SRE":return{op:Ri(!1,!0).concat(["cpu.a = cpu.p.setzn(cpu.a ^ REG);"]),read:!0,write:!0};case"RLA":return{op:Ri(!0,!1).concat(["cpu.a = cpu.p.setzn(cpu.a & REG);"]),read:!0,write:!0};case"ANC":return{op:["cpu.a = cpu.p.setzn(cpu.a & REG); cpu.p.c = cpu.p.n;"],read:!0};case"ANE":return{op:["cpu.a = cpu.p.setzn((cpu.a | 0xee) & REG & cpu.x);"],read:!0};case"ARR":return{op:"cpu.arr(REG);",read:!0};case"DCP":return{op:["REG = cpu.p.setzn(REG - 1);","cpu.p.setzn(cpu.a - REG);","cpu.p.c = cpu.a >= REG;"],read:!0,write:!0};case"LAS":return{op:["cpu.a = cpu.x = cpu.s = cpu.p.setzn(cpu.s & REG);"],read:!0};case"RRA":return{op:Ri(!1,!1).concat(["cpu.adc(REG);"]),read:!0,write:!0};case"SBX":return{op:["const temp = cpu.a & cpu.x;","cpu.p.c = temp >= REG;","cpu.x = cpu.p.setzn(temp - REG);"],read:!0};case"SHA":return{op:["REG = cpu.a & cpu.x & ((addr >>> 8) + 1) & 0xff;"],write:!0,zpQuirk:!0};case"SHS":return{op:["cpu.s = cpu.a & cpu.x;","REG = cpu.a & cpu.x & ((addr >>> 8) + 1) & 0xff;"],write:!0,zpQuirk:!0};case"ISB":return{op:["REG = (REG + 1) & 0xff;","cpu.sbc(REG);"],read:!0,write:!0};case"RMB0":case"RMB1":case"RMB2":case"RMB3":case"RMB4":case"RMB5":case"RMB6":case"RMB7":return{op:[`REG = REG & (${~(1<<i[3]-"0")});`],read:!0,write:!0};case"SMB0":case"SMB1":case"SMB2":case"SMB3":case"SMB4":case"SMB5":case"SMB6":case"SMB7":return{op:[`REG = REG | ${1<<i[3]-"0"};`],read:!0,write:!0};case"BBR0":case"BBR1":case"BBR2":case"BBR3":case"BBR4":case"BBR5":case"BBR6":case"BBR7":return{op:`cpu.branch(!(REG & ${1<<i[3]-"0"}));`,read:!0};case"BBS0":case"BBS1":case"BBS2":case"BBS3":case"BBS4":case"BBS5":case"BBS6":case"BBS7":return{op:`cpu.branch(REG & ${1<<i[3]-"0"});`,read:!0}}throw new Error(`Unrecognised operation '${i}'`)}const FE={0:"BRK",1:"ORA (,x)",3:"SLO (,x)",4:"NOP zp",5:"ORA zp",6:"ASL zp",7:"SLO zp",8:"PHP",9:"ORA imm",10:"ASL A",11:"ANC imm",12:"NOP abs",13:"ORA abs",14:"ASL abs",15:"SLO abs",16:"BPL branch",17:"ORA (),y",19:"SLO (),y",20:"NOP zp,x",21:"ORA zp,x",22:"ASL zp,x",23:"SLO zp,x",24:"CLC",25:"ORA abs,y",26:"NOP",27:"SLO abs,y",28:"NOP abs,x",29:"ORA abs,x",30:"ASL abs,x",31:"SLO abs,x",32:"JSR abs",33:"AND (,x)",35:"RLA (,x)",36:"BIT zp",37:"AND zp",38:"ROL zp",39:"RLA zp",40:"PLP",41:"AND imm",42:"ROL A",43:"ANC imm",44:"BIT abs",45:"AND abs",46:"ROL abs",47:"RLA abs",48:"BMI branch",49:"AND (),y",51:"RLA (),y",52:"NOP zp,x",53:"AND zp,x",54:"ROL zp,x",55:"RLA zp,x",56:"SEC",57:"AND abs,y",58:"NOP",59:"RLA abs,y",60:"NOP abs,x",61:"AND abs,x",62:"ROL abs,x",63:"RLA abs,x",64:"RTI",65:"EOR (,x)",67:"SRE (,x)",68:"NOP zp",69:"EOR zp",70:"LSR zp",71:"SRE zp",72:"PHA",73:"EOR imm",74:"LSR A",75:"ASR imm",76:"JMP abs",77:"EOR abs",78:"LSR abs",79:"SRE abs",80:"BVC branch",81:"EOR (),y",83:"SRE (),y",84:"NOP zp,x",85:"EOR zp,x",86:"LSR zp,x",87:"SRE zp,x",88:"CLI",89:"EOR abs,y",90:"NOP",91:"SRE abs,y",92:"NOP abs,x",93:"EOR abs,x",94:"LSR abs,x",95:"SRE abs,x",96:"RTS",97:"ADC (,x)",99:"RRA (,x)",100:"NOP zp",101:"ADC zp",102:"ROR zp",103:"RRA zp",104:"PLA",105:"ADC imm",106:"ROR A",107:"ARR imm",108:"JMP (abs)",109:"ADC abs",110:"ROR abs",111:"RRA abs",112:"BVS branch",113:"ADC (),y",115:"RRA (),y",116:"NOP zp,x",117:"ADC zp,x",118:"ROR zp,x",119:"RRA zp,x",120:"SEI",121:"ADC abs,y",122:"NOP",123:"RRA abs,y",124:"NOP abs,x",125:"ADC abs,x",126:"ROR abs,x",127:"RRA abs,x",128:"NOP imm",129:"STA (,x)",130:"NOP imm",131:"SAX (,x)",132:"STY zp",133:"STA zp",134:"STX zp",135:"SAX zp",136:"DEY",137:"NOP imm",138:"TXA",139:"ANE imm",140:"STY abs",141:"STA abs",142:"STX abs",143:"SAX abs",144:"BCC branch",145:"STA (),y",147:"SHA (),y",148:"STY zp,x",149:"STA zp,x",150:"STX zp,y",151:"SAX zp,y",152:"TYA",153:"STA abs,y",154:"TXS",155:"SHS abs,y",156:"SHY abs,x",157:"STA abs,x",158:"SHX abs,y",159:"SHA abs,y",160:"LDY imm",161:"LDA (,x)",162:"LDX imm",163:"LAX (,x)",164:"LDY zp",165:"LDA zp",166:"LDX zp",167:"LAX zp",168:"TAY",169:"LDA imm",170:"TAX",171:"LXA imm",172:"LDY abs",173:"LDA abs",174:"LDX abs",175:"LAX abs",176:"BCS branch",177:"LDA (),y",179:"LAX (),y",180:"LDY zp,x",181:"LDA zp,x",182:"LDX zp,y",183:"LAX zp,y",184:"CLV",185:"LDA abs,y",186:"TSX",187:"LAS abs,y",188:"LDY abs,x",189:"LDA abs,x",190:"LDX abs,y",191:"LAX abs,y",192:"CPY imm",193:"CMP (,x)",194:"NOP imm",195:"DCP (,x)",196:"CPY zp",197:"CMP zp",198:"DEC zp",199:"DCP zp",200:"INY",201:"CMP imm",202:"DEX",203:"SBX imm",204:"CPY abs",205:"CMP abs",206:"DEC abs",207:"DCP abs",208:"BNE branch",209:"CMP (),y",211:"DCP (),y",212:"NOP zp,x",213:"CMP zp,x",214:"DEC zp,x",215:"DCP zp,x",216:"CLD",217:"CMP abs,y",218:"NOP",219:"DCP abs,y",220:"NOP abs,x",221:"CMP abs,x",222:"DEC abs,x",223:"DCP abs,x",224:"CPX imm",225:"SBC (,x)",226:"NOP imm",227:"ISB (,x)",228:"CPX zp",229:"SBC zp",230:"INC zp",231:"ISB zp",232:"INX",233:"SBC imm",234:"NOP",235:"SBC imm",236:"CPX abs",237:"SBC abs",238:"INC abs",239:"ISB abs",240:"BEQ branch",241:"SBC (),y",243:"ISB (),y",244:"NOP zpx",245:"SBC zp,x",246:"INC zp,x",247:"ISB zp,x",248:"SED",249:"SBC abs,y",250:"NOP",251:"ISB abs,y",252:"NOP abs,x",253:"SBC abs,x",254:"INC abs,x",255:"ISB abs,x"},Op={0:"BRK",1:"ORA (,x)",4:"TSB zp",5:"ORA zp",6:"ASL zp",8:"PHP",9:"ORA imm",10:"ASL A",12:"TSB abs",13:"ORA abs",14:"ASL abs",16:"BPL branch",17:"ORA (),y",18:"ORA ()",20:"TRB zp",21:"ORA zp,x",22:"ASL zp,x",24:"CLC",25:"ORA abs,y",26:"INC A",28:"TRB abs",29:"ORA abs,x",30:"ASL abs,x",32:"JSR abs",33:"AND (,x)",36:"BIT zp",37:"AND zp",38:"ROL zp",40:"PLP",41:"AND imm",42:"ROL A",44:"BIT abs",45:"AND abs",46:"ROL abs",48:"BMI branch",49:"AND (),y",50:"AND ()",52:"BIT zp,x",53:"AND zp,x",54:"ROL zp,x",56:"SEC",57:"AND abs,y",58:"DEC A",60:"BIT abs,x",61:"AND abs,x",62:"ROL abs,x",64:"RTI",65:"EOR (,x)",69:"EOR zp",70:"LSR zp",72:"PHA",73:"EOR imm",74:"LSR A",76:"JMP abs",77:"EOR abs",78:"LSR abs",80:"BVC branch",81:"EOR (),y",82:"EOR ()",85:"EOR zp,x",86:"LSR zp,x",88:"CLI",89:"EOR abs,y",90:"PHY",93:"EOR abs,x",94:"LSR abs,x",96:"RTS",97:"ADC (,x)",100:"STZ zp",101:"ADC zp",102:"ROR zp",104:"PLA",105:"ADC imm",106:"ROR A",108:"JMP (abs)",109:"ADC abs",110:"ROR abs",112:"BVS branch",113:"ADC (),y",114:"ADC ()",116:"STZ zp,x",117:"ADC zp,x",118:"ROR zp,x",120:"SEI",121:"ADC abs,y",122:"PLY",124:"JMP (abs,x)",125:"ADC abs,x",126:"ROR abs,x",128:"BRA branch",129:"STA (,x)",132:"STY zp",133:"STA zp",134:"STX zp",136:"DEY",137:"BIT imm",138:"TXA",140:"STY abs",141:"STA abs",142:"STX abs",144:"BCC branch",145:"STA (),y",146:"STA ()",148:"STY zp,x",149:"STA zp,x",150:"STX zp,y",152:"TYA",153:"STA abs,y",154:"TXS",156:"STZ abs",157:"STA abs,x",158:"STZ abs,x",160:"LDY imm",161:"LDA (,x)",162:"LDX imm",164:"LDY zp",165:"LDA zp",166:"LDX zp",168:"TAY",169:"LDA imm",170:"TAX",172:"LDY abs",173:"LDA abs",174:"LDX abs",176:"BCS branch",177:"LDA (),y",178:"LDA ()",180:"LDY zp,x",181:"LDA zp,x",182:"LDX zp,y",184:"CLV",185:"LDA abs,y",186:"TSX",188:"LDY abs,x",189:"LDA abs,x",190:"LDX abs,y",192:"CPY imm",193:"CMP (,x)",196:"CPY zp",197:"CMP zp",198:"DEC zp",200:"INY",201:"CMP imm",202:"DEX",204:"CPY abs",205:"CMP abs",206:"DEC abs",208:"BNE branch",209:"CMP (),y",210:"CMP ()",213:"CMP zp,x",214:"DEC zp,x",216:"CLD",217:"CMP abs,y",218:"PHX",221:"CMP abs,x",222:"DEC abs,x",224:"CPX imm",225:"SBC (,x)",228:"CPX zp",229:"SBC zp",230:"INC zp",232:"INX",233:"SBC imm",234:"NOP",236:"CPX abs",237:"SBC abs",238:"INC abs",240:"BEQ branch",241:"SBC (),y",242:"SBC ()",245:"SBC zp,x",246:"INC zp,x",248:"SED",249:"SBC abs,y",250:"PLX",253:"SBC abs,x",254:"INC abs,x"},UE={...Op,7:"RMB0 zp",23:"RMB1 zp",39:"RMB2 zp",55:"RMB3 zp",71:"RMB4 zp",87:"RMB5 zp",103:"RMB6 zp",119:"RMB7 zp",135:"SMB0 zp",151:"SMB1 zp",167:"SMB2 zp",183:"SMB3 zp",199:"SMB4 zp",215:"SMB5 zp",231:"SMB6 zp",247:"SMB7 zp",15:"BBR0 zp,branch",31:"BBR1 zp,branch",47:"BBR2 zp,branch",63:"BBR3 zp,branch",79:"BBR4 zp,branch",95:"BBR5 zp,branch",111:"BBR6 zp,branch",127:"BBR7 zp,branch",143:"BBS0 zp,branch",159:"BBS1 zp,branch",175:"BBS2 zp,branch",191:"BBS3 zp,branch",207:"BBS4 zp,branch",223:"BBS5 zp,branch",239:"BBS6 zp,branch",255:"BBS7 zp,branch"};class $E{constructor(t,e){this.cpu=t,this.opcodes=e}disassemble(t,e){let s=b=>`<span class="instr_mem_ref" data-ref="${b}">${ta(b)}</span>`,r=b=>`<span class="instr_instr_ref" data-ref="${b}">${ta(b)}</span>`;e&&(s=ta,r=ta);const a=this.opcodes[this.cpu.peekmem(t)];if(!a)return["???",t+1];const c=a.split(" ");if(!c[1])return[a,t+1];let h=c[1]||"",m="",d="";const p=h.match(/(.*),([xy])$/);switch(p&&(h=p[1],m=`,${p[2].toUpperCase()}`,d=` + ${p[2].toUpperCase()}`),h){case"imm":return[`${c[0]} #$${ea(this.cpu.peekmem(t+1))}${m}`,t+2];case"abs":{const b=c[0]==="JMP"||c[0]==="JSR"?r:s,w=this.cpu.peekmem(t+1)|this.cpu.peekmem(t+2)<<8;return[`${c[0]} $${b(w)}${m}`,t+3,w]}case"branch":{const b=t+ME(this.cpu.peekmem(t+1))+2;return[`${c[0]} $${r(b)}${m}`,t+2,b]}case"zp":return[`${c[0]} $${ea(this.cpu.peekmem(t+1))}${m}`,t+2];case"(,x)":return[`${c[0]} ($${ea(this.cpu.peekmem(t+1))}, X)${m}`,t+2];case"()":{const b=this.cpu.peekmem(t+1),w=this.cpu.peekmem(b)|this.cpu.peekmem(b+1)<<8;return[`${c[0]} ($${ea(b)})${m} ; $${te(w)}${d}`,t+2]}case"(abs)":{const b=this.cpu.peekmem(t+1)|this.cpu.peekmem(t+2)<<8,w=this.cpu.peekmem(b)|this.cpu.peekmem(b+1)<<8;return[`${c[0]} ($${r(b)})${m} ; $${te(w)}${d}`,t+3,w]}case"(abs,x)":{const b=this.cpu.peekmem(t+1)|this.cpu.peekmem(t+2)<<8,w=this.cpu.peekmem(b)|this.cpu.peekmem(b+1)<<8;return[`${c[0]} ($${r(b)},x)${m}`,t+3,w]}}return[a,t+1]}}function Eh(i,t,e){function s(m,d){const p=m.split(" "),b=p[0],w=p[1],C=BE(b,w);if(!C)return null;let y=new Ec(e);switch(d&&y.append("let REG = 0|0;"),w){case void 0:if(C.read||C.write)throw new Error(`Unsupported ${m}`);return y.append(C.preop),y.tick(Math.max(2,1+(C.extra||0))),y.append(C.op),y.render();case"branch":return[C.op];case"zp,branch":return y.tick(2),y.append("const addr = cpu.getb() | 0;"),C.read&&(y.zpReadOp("addr","REG"),C.write&&y.tick(1)),y.append(C.op),C.write&&y.zpWriteOp("addr","REG"),y.render();case"zp":case"zpx":case"zp,x":case"zp,y":return w==="zp"?(y.tick(2),y.append("const addr = cpu.getb() | 0;")):(y.tick(3),y.append(`const addr = (cpu.getb() + cpu.${w[3]}) & 0xff;`)),C.read&&(y.zpReadOp("addr","REG"),C.write&&y.tick(1)),y.append(C.op),C.write&&y.zpWriteOp("addr","REG"),y.render();case"abs":return y.tick(3+(C.extra||0)),y.append("const addr = cpu.getw() | 0;"),C.read&&(y.readOp("addr","REG"),C.write&&y.spuriousOp("addr","REG")),y.append(C.op),C.write&&y.writeOp("addr","REG"),y.render();case"abs,x":case"abs,y":return y.append("const addr = cpu.getw() | 0;"),y.append(`let addrWithCarry = (addr + cpu.${w[4]}) & 0xffff;`),y.append("const addrNonCarry = (addr & 0xff00) | (addrWithCarry & 0xff);"),y.tick(3),y=y.split("addrWithCarry !== addrNonCarry"),C.read&&!C.write?(e?y.ifTrue.tick(1):y.ifTrue.readOp("addrNonCarry"),y.readOp("addrWithCarry","REG")):C.read?e?(y.ifTrue.tick(1),C.rotate||y.ifFalse.readOp("addrNonCarry","REG"),y.readOp("addrWithCarry","REG"),y.writeOp("addrWithCarry","REG")):(y.readOp("addrNonCarry"),y.readOp("addrWithCarry","REG"),y.spuriousOp("addrWithCarry","REG")):C.write&&(e?(y.ifTrue.tick(1),y.ifFalse.readOp("addrNonCarry")):(y.readOp("addrNonCarry"),C.zpQuirk&&y.append("if (addrWithCarry !== addrNonCarry) addrWithCarry &= 0xff;"))),y.append(C.op),C.write&&y.writeOp("addrWithCarry","REG"),y.render();case"imm":if(C.write)throw new Error("This isn't possible");return C.read,y.tick(2),y.append("REG = cpu.getb() | 0;"),y.append(C.op),y.render();case"A":return y.tick(2),y.append("REG = cpu.a;"),y.append(C.op),y.append("cpu.a = REG;"),y.render();case"(,x)":return y.tick(3),y.append("const zpAddr = (cpu.getb() + cpu.x) & 0xff;"),y.append("let lo, hi;"),y.zpReadOp("zpAddr","lo"),y.zpReadOp("(zpAddr + 1) & 0xff","hi"),y.append("const addr = lo | (hi << 8);"),C.read&&(y.readOp("addr","REG"),C.write&&y.spuriousOp("addr","REG")),y.append(C.op),C.write&&y.writeOp("addr","REG"),y.render();case"(),y":return y.tick(2),y.append("const zpAddr = cpu.getb() | 0;"),y.append("let lo, hi;"),y.zpReadOp("zpAddr","lo"),y.zpReadOp("(zpAddr + 1) & 0xff","hi"),y.append("const addr = lo | (hi << 8);"),y.append("let addrWithCarry = (addr + cpu.y) & 0xffff;"),y.append("const addrNonCarry = (addr & 0xff00) | (addrWithCarry & 0xff);"),C.read&&!C.write?(y=y.split("addrWithCarry !== addrNonCarry"),e?y.ifTrue.tick(1):y.ifTrue.readOp("addrNonCarry"),y.readOp("addrWithCarry","REG")):C.read?(y.readOp("addrNonCarry"),y.readOp("addrWithCarry","REG"),y.spuriousOp("addrWithCarry","REG")):C.write&&(y.readOp("addrNonCarry"),C.zpQuirk&&y.append("if (addrWithCarry !== addrNonCarry) addrWithCarry &= 0xff;")),y.append(C.op),C.write&&y.writeOp("addrWithCarry","REG"),y.render();case"(abs)":return y.tick(e?4:3),y.append("const absAddr = cpu.getw() | 0;"),e?y.append("const nextAddr = (absAddr + 1) & 0xffff;"):y.append("const nextAddr = ((absAddr + 1) & 0xff) | (absAddr & 0xff00);"),y.append("let lo, hi;"),y.readOp("absAddr","lo"),y.readOp("nextAddr","hi"),y.append("const addr = lo | (hi << 8);"),y.append(C.op),y.render();case"(abs,x)":return y.tick(4),y.append("const absAddr = (cpu.getw() + cpu.x) | 0;"),y.append("let lo, hi;"),y.readOp("absAddr","lo"),y.readOp("(absAddr + 1) & 0xffff","hi"),y.append("const addr = lo | (hi << 8);"),y.append(C.op),y.render();case"()":return y.tick(2),y.append("const zpAddr = cpu.getb() | 0;"),y.append("let lo, hi;"),y.zpReadOp("zpAddr","lo"),y.zpReadOp("(zpAddr + 1) & 0xff","hi"),y.append("const addr = lo | (hi << 8);"),C.read&&y.readOp("addr","REG"),y.append(C.op),C.write&&y.writeOp("addr","REG"),y.render();default:throw new Error(`Unknown arg type ${w}`)}}function r(m,d,p){const b=t[d];return m+['"use strict";',`// ${ct(d)} - ${b}
`].concat(b?s(b,!0):[`this.invalidOpcode(cpu, 0x${ct(d)});`]).join(`
${m}`)}function a(){}function c(){const m=[];for(let d=0;d<256;++d){const p=new Function("cpu",r("  ",d));let b=`exec_${ct(d)}_`;if(t[d]){const w=t[d].replace("()","ind").replace("(,x)","ind_x").replace("(abs)","ind_abs").replace(/[^A-Za-z0-9]/g,"_").toLowerCase();b+=w}else b+="undef";Object.defineProperty(p,"name",{writable:!0,value:b}),m[d]=p}return function(p){return m[p].call(this,this.cpu)}}function h(m,d){if(e){switch(d){case 2:case 34:case 66:case 98:case 130:case 194:case 226:m.getb(),m.polltime(2);break;case 68:m.getb(),m.polltime(3);break;case 84:case 212:case 244:m.getb(),m.polltime(4);break;case 92:m.getw(),m.polltime(8);break;case 220:case 252:m.polltimeAddr(4,m.getw());break;default:m.polltime(1);break}return}m.pc--,m.polltime(1)}return a.prototype.invalidOpcode=h,a.prototype.cpu=i,a.prototype.run=c(),{disassembler:new $E(i,t),runInstruction:new a,opcodes:t,getInstruction:s}}function HE(i){return Eh(i,FE,!1)}function zE(i){return Eh(i,Op,!0)}function WE(i){return Eh(i,UE,!0)}const ce=Object.freeze({MOS6502:0,CMOS65C02:1,CMOS65C12:2});class Ve{constructor(t,e,s,r,a,c,h,m,d){this.name=t,this.synonyms=e,this.os=s,this._cpuModel=r,this.isMaster=a,this.Fdc=h,this.swram=c,this.isTest=!1,this.tube=m,this.cmosOverride=d,this.hasEconet=!1,this.hasMusic5000=!1}get nmos(){return this._cpuModel===ce.MOS6502}get opcodesFactory(){switch(this._cpuModel){case ce.MOS6502:return HE;case ce.CMOS65C02:return WE;case ce.CMOS65C12:return zE}throw new Error("Unknown CPU model")}}function GE(i){return i[19]=i[19]&240|13,i}function VE(i){return i[19]=i[19]&240|8,i}function KE(i){return i[19]=i[19]&240|9,i}const Yr=[!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1,!1,!1],ur=[!1,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1,!1,!1],A0=[new Ve("BBC B with DFS 1.2",["B-DFS1.2"],["os.rom","BASIC.ROM","b/DFS-1.2.rom"],ce.MOS6502,!1,Yr,fn),new Ve("BBC B with DFS 0.9",["B-DFS0.9","B"],["os.rom","BASIC.ROM","b/DFS-0.9.rom"],ce.MOS6502,!1,Yr,fn),new Ve("BBC B with 1770 (DFS)",["B1770"],["os.rom","BASIC.ROM","b1770/dfs1770.rom","b1770/zADFS.ROM"],ce.MOS6502,!1,Yr,or),new Ve("BBC B with 1770 (ADFS)",["B1770A"],["os.rom","BASIC.ROM","b1770/zADFS.ROM","b1770/dfs1770.rom"],ce.MOS6502,!1,Yr,or),new Ve("BBC Master 128 (DFS)",["Master"],["master/mos3.20"],ce.CMOS65C12,!0,ur,or,null,KE),new Ve("BBC Master 128 (ADFS)",["MasterADFS"],["master/mos3.20"],ce.CMOS65C12,!0,ur,or,null,GE),new Ve("BBC Master 128 (ANFS)",["MasterANFS"],["master/mos3.20"],ce.CMOS65C12,!0,ur,or,null,VE),new Ve("Tube65C02",[],["tube/6502Tube.rom"],ce.CMOS65C02,!1)];function Ac(i){i=i.toLowerCase();for(let t=0;t<A0.length;++t){const e=A0[t];if(e.name.toLowerCase()===i)return e;for(let s=0;s<e.synonyms.length;++s)if(e.synonyms[s].toLowerCase()===i)return e}return null}const Mp=new Ve("TEST",["TEST"],[],ce.MOS6502,!1,Yr,fn);Mp.isTest=!0;const qE=new Ve("TEST",["TEST"],[],ce.CMOS65C02,!1,ur,fn);qE.isTest=!0;const jE=new Ve("TEST",["TEST"],[],ce.CMOS65C12,!1,ur,fn);jE.isTest=!0;const YE=new Ve("Basic only",["Basic only"],["master/mos3.20"],ce.CMOS65C12,!0,ur,or),Ji=new Float32Array(16);(()=>{let i=1;for(let t=0;t<15;++t)Ji[t]=i/4,i*=Math.pow(10,-.1);Ji[15]=0})();function XE(i){const t=new Float32Array(8192);for(let e=0;e<t.length;++e)t[e]=Math.sin(2*Math.PI*e/t.length)*i;return t}class ZE{constructor(t){this._onBuffer=t,this.soundchipFreq=4e6/8;const e=this.soundchipFreq;this.waveDecrementPerSecond=this.soundchipFreq/2,this.sampleDecrement=this.waveDecrementPerSecond/e,this.samplesPerCycle=e/2e6,this.minCyclesWELow=14,this.registers=new Uint16Array(4),this.counter=new Float32Array(4),this.outputBit=[!1,!1,!1,!1],this.volume=new Float32Array(4),this.generators=[this.toneChannel.bind(this),this.toneChannel.bind(this),this.toneChannel.bind(this),this.noiseChannel.bind(this),this.sineChannel.bind(this)],this.sineTable=XE(1/this.generators.length),this.sineStep=0,this.sineOn=!1,this.sineTime=0,this.lfsr=0,this.shiftLfsr=this.shiftLfsrWhiteNoise.bind(this),this.enabled=!0,this.scheduler={epoch:0},this.lastRunEpoch=0,this.activeTask=null,this.residual=0,this.position=0,this.buffer=new Float32Array(512),this.latchedRegister=0,this.slowDataBus=0,this.active=!1,this.toneGenerator={mute:()=>{this.catchUp(),this.sineOn=!1},tone:s=>{this.catchUp(),this.sineOn=!0,this.sineStep=s/e*this.sineTable.length}}}sineChannel(t,e,s,r){if(this.sineOn){for(let a=0;a<r;++a)e[a+s]+=this.sineTable[this.sineTime&this.sineTable.length-1],this.sineTime+=this.sineStep;for(;this.sineTime>this.sineTable.length;)this.sineTime-=this.sineTable.length}}_doChannelStep(t,e){const s=this.counter[t]-this.sampleDecrement;return s<0?(this.counter[t]=Math.max(0,s+e),this.outputBit[t]=!this.outputBit[t],this.outputBit[t]):(this.counter[t]=s,!1)}toneChannel(t,e,s,r){const a=this.registers[t]===0?1024:this.registers[t],c=this.volume[t];for(let h=0;h<r;++h)this._doChannelStep(t,a),e[h+s]+=this.outputBit[t]*c}shiftLfsrWhiteNoise(){const t=this.lfsr&1^(this.lfsr&2)>>>1;this.lfsr=this.lfsr>>>1|t<<14}shiftLfsrPeriodicNoise(){this.lfsr>>=1,this.lfsr===0&&(this.lfsr=16384)}noisePoked(){this.shiftLfsr=this.registers[3]&4?this.shiftLfsrWhiteNoise.bind(this):this.shiftLfsrPeriodicNoise.bind(this),this.lfsr=16384}addFor(t){switch(t=t|0,this.registers[t]&3){case 0:return 16;case 1:return 32;case 2:return 64;case 3:return this.registers[t-1]}}noiseChannel(t,e,s,r){const a=this.addFor(t),c=this.volume[t];for(let h=0;h<r;++h)this._doChannelStep(t,a)&&this.shiftLfsr(),e[h+s]+=(this.lfsr&1)*c}debugPokeAll(t,e,s,r,a,c,h,m){this.catchUp(),this.registers[0]=t&16777215,this.registers[1]=s&16777215,this.registers[2]=a&16777215,this.registers[3]=h&16777215,this.volume[0]=Ji[e],this.volume[1]=Ji[r],this.volume[2]=Ji[c],this.volume[3]=Ji[m],this.noisePoked()}generate(t,e,s){e=e|0,s=s|0;for(let r=0;r<s;++r)t[r+e]=0;if(this.enabled)for(let r=0;r<this.generators.length;++r)this.generators[r](r,t,e,s)}catchUp(){const t=this.scheduler.epoch-this.lastRunEpoch;t>0&&this.advance(t),this.lastRunEpoch=this.scheduler.epoch}setScheduler(t){this.scheduler=t,this.lastRunEpoch=this.scheduler.epoch,this.activeTask=this.scheduler.newTask(()=>{this.active&&this.poke(this.slowDataBus)})}render(t,e,s){this.catchUp();const r=this.position>s?s:this.position;for(let a=0;a<r;++a)t[e+a]=this.buffer[a];e+=r,s-=r;for(let a=r;a<this.position;++a)this.buffer[a-r]=this.buffer[a];this.position-=r,s!==0&&this.generate(t,e,s)}advance(t){const e=t*this.samplesPerCycle+this.residual;let s=e|0;this.residual=e-s;const r=this.buffer.length;for(;s>0;){const a=r-this.position,c=Math.min(s,a);this.generate(this.buffer,this.position,c),this.position+=c,s-=c,this.position===r&&(this._onBuffer(this.buffer),this.buffer=new Float32Array(r),this.position=0)}}poke(t){this.catchUp();let e;t&128?(this.latchedRegister=t&112,e=t&240):e=this.latchedRegister;const s=e>>5&3;if(e&16){const r=t&15;this.volume[s]=Ji[r]}else s===3?(this.registers[s]=t&15,this.noisePoked()):e&128?this.registers[s]=this.registers[s]&-16|t&15:this.registers[s]=this.registers[s]&15|(t&63)<<4}updateSlowDataBus(t,e){this.slowDataBus=t,this.active=e,e&&this.activeTask.ensureScheduled(!0,this.minCyclesWELow)}reset(t){if(t){for(let e=0;e<4;++e)this.counter[e]=0,this.registers[e]=0,this.volume[e]=Ji[8];this.noisePoked(),this.lastRunEpoch=this.scheduler.epoch}}enable(t){this.enabled=t}mute(){this.enabled=!1}unmute(){this.enabled=!0}}class Np{reset(){}enable(){}mute(){}unmute(){}render(){}updateSlowDataBus(){}setScheduler(){}constructor(){this.toneGenerator={mute:()=>{},tone:()=>{}}}}const ra=0,k0=1,T0=2,D0=.25;class QE{constructor(t){this.context=t,this.sounds={},this.state=ra,this.motor=null,this.gain=t.createGain(),this.gain.gain.value=D0,this.gain.connect(t.destination),this.playing=[]}async initialise(){const t=await JE(this.context,{motorOn:"sounds/disc525/motoron.wav",motorOff:"sounds/disc525/motoroff.wav",motor:"sounds/disc525/motor.wav",step:"sounds/disc525/step.wav",seek:"sounds/disc525/seek.wav",seek2:"sounds/disc525/seek2.wav",seek3:"sounds/disc525/seek3.wav"});this.sounds=t}oneShot(t){const e=t.duration,s=this.context;if(s.state!=="running")return e;const r=s.createBufferSource();return r.buffer=t,r.connect(this.gain),r.start(),e}play(t,e){return this.context.state!=="running"?Promise.reject():new Promise(s=>{const r=this.context.createBufferSource();r.loop=!!e,r.buffer=t,r.connect(this.gain),r.onended=()=>{this.playing=qe.without(this.playing,r),r.loop||s()},r.start(),this.playing.push(r),r.loop&&s(r)})}spinUp(){this.state===T0||this.state===k0||(this.state=k0,this.play(this.sounds.motorOn).then(()=>{this.state!==ra&&this.play(this.sounds.motor,!0).then(t=>{this.motor=t,this.state=T0})},()=>{}))}spinDown(){this.state!==ra&&(this.state=ra,this.motor&&(this.motor.stop(),this.motor=null,this.oneShot(this.sounds.motorOff)))}seek(t){return t<0&&(t=-t),t===0?0:t<=2?this.oneShot(this.sounds.step):t<=20?this.oneShot(this.sounds.seek):t<=40?this.oneShot(this.sounds.seek2):this.oneShot(this.sounds.seek3)}mute(){this.gain.gain.value=0}unmute(){this.gain.gain.value=D0}}async function JE(i,t){const e=await Promise.all(qe.map(t,async a=>{const c=await Ze(a);return await new Promise(h=>{i.decodeAudioData(c.buffer,m=>{h(m)})})})),s=qe.keys(t),r={};for(let a=0;a<s.length;++a)r[s[a]]=e[a];return r}class kc{constructor(){}seek(){return 0}initialise(){return Promise.resolve()}spinUp(){}spinDown(){}mute(){}unmute(){}}const R0=256,L0=2048,Bp=128,tA=14,Li=16,er=tA*Bp,ir=128,eA=15,iA=16,sA=32,P0=128,rA=127,nA=1,aA=254,Zo=0,oA=1;class cA{constructor(t){this._onBufferMusic5000=t,this.waveRam=new Uint8Array(L0),this.phaseRam=new Uint32Array(Li),this.cycleCount=0,this.curCh=0,this.activeRegSet=Zo,this.sampleLeft=0,this.sampleRight=0,this.chordBase=[0,8.25,24.75,57.75,123.75,255.75,519.75,1047.75],this.stepInc=[.5,1,2,4,8,16,32,64],this.stereoLeft=[0,0,0,0,0,0,0,0,100,100,100,83,67,50,33,17],this.stereoRight=[100,100,100,100,100,100,100,100,0,0,0,17,33,50,67,83],this.D2ATable=new Uint16Array(128),this.sampleBuffer=new Float64Array(R0),this.position=0,this.cReg_freqLow=function(e,s){return this.waveRam[er+s*ir+0*Li+e]},this.cReg_freqMedium=function(e,s){return this.waveRam[er+s*ir+1*Li+e]},this.cReg_freqHigh=function(e,s){return this.waveRam[er+s*ir+2*Li+e]},this.cReg_waveformReg=function(e,s){return this.waveRam[er+s*ir+5*Li+e]},this.cReg_amplitudeReg=function(e,s){return this.waveRam[er+s*ir+6*Li+e]},this.cReg_controlReg=function(e,s){return this.waveRam[er+s*ir+7*Li+e]},this.waveTableVal=function(e,s){return this.waveRam[e*Bp+s]}}reset(t){if(t){console.log("Music 5000: initialisation");let e=0;for(let s=0;s<8;s++){let r=this.chordBase[s];for(let a=0;a<16;a++)this.D2ATable[e]=Math.floor(r*4),r+=this.stepInc[s],e++}}for(let e=0;e<L0;e++)this.waveRam[e]=0;for(let e=0;e<Li;e++)this.phaseRam[e]=0}read(t,e){const s=((t&14)<<7)+e;return this.waveRam[s]}write(t,e,s){const r=((t&14)<<7)+(e&255);this.waveRam[r]=s}polltime(t){let e,s,r,a,c,h,m,d,p=0;for(this.cycleCount+=t*3;this.cycleCount>=8;){this.cReg_freqLow(this.curCh,this.activeRegSet)&nA?(this.phaseRam[this.curCh]=0,e=0):(s=(this.cReg_freqHigh(this.curCh,this.activeRegSet)<<16)+(this.cReg_freqMedium(this.curCh,this.activeRegSet)<<8)+(this.cReg_freqLow(this.curCh,this.activeRegSet)&aA),this.phaseRam[this.curCh]+=s,e=this.phaseRam[this.curCh]&1<<24,this.phaseRam[this.curCh]&=16777215),r=this.phaseRam[this.curCh]>>17&127,a=this.cReg_waveformReg(this.curCh,this.activeRegSet)>>4,m=this.waveTableVal(a,r),c=this.cReg_amplitudeReg(this.curCh,this.activeRegSet),h=this.cReg_controlReg(this.curCh,this.activeRegSet),d=m&P0,m&=rA,h&sA&&(d||e)?this.activeRegSet=oA:this.activeRegSet=Zo,c>128&&(c=128),m=m*c/128;let b=this.D2ATable[parseInt(m)];h&iA&&(d^=P0),d&&(b=-b),p=h&eA,this.sampleLeft+=b*this.stereoLeft[p]/100,this.sampleRight+=b*this.stereoRight[p]/100,this.curCh++,this.curCh===Li&&(this.curCh=0,this.activeRegSet=Zo,this.sampleLeft<-32768?this.sampleLeft=-32768:this.sampleLeft>32767&&(this.sampleLeft=32767),this.sampleRight<-32768?this.sampleRight=-32768:this.sampleRight>32767&&(this.sampleRight=32767),this.sampleBuffer[this.position++]=this.sampleLeft,this.sampleBuffer[this.position++]=this.sampleRight,this.position===R0&&(this._onBufferMusic5000(this.sampleBuffer),this.position=0),this.sampleLeft=0,this.sampleRight=0),this.cycleCount-=8}}}class Fp{constructor(){this.reset=function(){},this.polltime=function(){},this.read=function(){return 0},this.write=function(){}}}const hA=new _p,lA=new Np,uA={setCpu:()=>{}};function fA(i,t){t=t||{};const e=t.video||hA;return i=i||Mp,t.tube&&(i.tube=Ac("Tube65c02")),new vp(i,uA,e,lA,new kc,new Fp,new wp)}async function dA(){const i=fA(YE),t=function(a){i.pc=36274,i.s=240;let w=4096;i.writemem(59,0),i.writemem(60,0),i.writemem(55,w&255),i.writemem(56,w>>>8&255),i.writemem(65072,12);for(let R=0;R<a.length;++R)i.writemem(w+R,a.charCodeAt(R));i.writemem(w+a.length,13);let C=20*1e3*1e3,y="";for(;i.s<=240&&(i.execute(1),--C!==0);)if(i.pc===36513){let R=i.readmemZpStack(56)<<8|i.readmemZpStack(55);for(;w<R;)y+=String.fromCharCode(i.readmem(w)),w++;y+=String.fromCharCode(i.a),w+=i.y,i.writememZpStack(55,w&255),i.writememZpStack(56,w>>>8&255),++w,i.pc+=3}for(let R=w;i.readmem(R)!==13;++R)y+=String.fromCharCode(i.readmem(R));if(C===0)throw new Error("Unable to tokenize '"+a+"' - got as far as '"+y+"' pc="+te(i.pc));return y},e=/^([0-9]+)?(.*)/,s=function(a,c){const h=a.match(e),m=h[1]?parseInt(h[1]):c,d=t(h[2]);if(d.length>251)throw new Error("Line "+m+" tokenised length "+d.length+" > 251 bytes");return"\r"+String.fromCharCode(m>>>8&255)+String.fromCharCode(m&255)+String.fromCharCode(d.length+4)+d},r=function(a){let c="";return a.split(`
`).forEach(function(h,m){h&&(c+=s(h,10+m*10))}),c+"\rÃ¿"};return await i.initialise(),{tokenise:r}}var pA=function(i){window.console&&window.console.log&&window.console.log(i)},mA=function(i){window.console&&window.console.error?window.console.error(i):pA(i)},gA={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},fr=null,Tc=null;function Up(i){if(fr==null){fr={},Tc={};for(var t in i)typeof i[t]=="number"&&(fr[i[t]]=t,Tc[t]=i[t])}}function $p(){if(fr==null)throw"WebGLDebugUtils.init(ctx) not called"}function _A(i){return $p(),fr[i]!==void 0}function sn(i){$p();var t=fr[i];return t!==void 0?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+i.toString(16)}function Ah(i,t,e,s){var r=gA[i];if(r!==void 0&&(r=r[t],r!==void 0&&r[e]))if(typeof r[e]=="object"&&r[e].enumBitwiseOr!==void 0){for(var a=r[e].enumBitwiseOr,c=0,h=[],m=0;m<a.length;++m){var d=Tc[a[m]];(s&d)!==0&&(c|=d,h.push(sn(d)))}return c===s?h.join(" | "):sn(s)}else return sn(s);return s===null?"null":s===void 0?"undefined":s.toString()}function xA(i,t){for(var e="",s=t.length,r=0;r<s;++r)e+=(r==0?"":", ")+Ah(i,s,r,t[r]);return e}function Hp(i,t,e){i.__defineGetter__(e,function(){return t[e]}),i.__defineSetter__(e,function(s){t[e]=s})}function zp(i,t,e,s){s=s||i,Up(i),t=t||function(d,p,b){for(var w="",C=b.length,y=0;y<C;++y)w+=(y==0?"":", ")+Ah(p,C,y,b[y]);mA("WebGL error "+sn(d)+" in "+p+"("+w+")")};var r={};function a(d,p){return function(){e&&e(p,arguments);var b=d[p].apply(d,arguments),w=s.getError();return w!=0&&(r[w]=!0,t(w,p,arguments)),b}}var c={};for(var h in i)if(typeof i[h]=="function")if(h!="getExtension")c[h]=a(i,h);else{var m=a(i,h);c[h]=function(){var d=m.apply(i,arguments);return zp(d,t,e,s)}}else Hp(c,i,h);return c.getError=function(){for(var d in r)if(Object.prototype.hasOwnProperty.call(r,d)&&r[d])return r[d]=!1,d;return i.NO_ERROR},c}function Wp(i){var t=i.getParameter(i.MAX_VERTEX_ATTRIBS),e=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,e);for(var s=0;s<t;++s)i.disableVertexAttribArray(s),i.vertexAttribPointer(s,4,i.FLOAT,!1,0,0),i.vertexAttrib1f(s,0);i.deleteBuffer(e);var r=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS);for(s=0;s<r;++s)i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_CUBE_MAP,null),i.bindTexture(i.TEXTURE_2D,null);for(i.activeTexture(i.TEXTURE0),i.useProgram(null),i.bindBuffer(i.ARRAY_BUFFER,null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.DITHER),i.disable(i.SCISSOR_TEST),i.blendColor(0,0,0,0),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.clearColor(0,0,0,0),i.clearDepth(1),i.clearStencil(-1),i.colorMask(!0,!0,!0,!0),i.cullFace(i.BACK),i.depthFunc(i.LESS),i.depthMask(!0),i.depthRange(0,1),i.frontFace(i.CCW),i.hint(i.GENERATE_MIPMAP_HINT,i.DONT_CARE),i.lineWidth(1),i.pixelStorei(i.PACK_ALIGNMENT,4),i.pixelStorei(i.UNPACK_ALIGNMENT,4),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.UNPACK_COLORSPACE_CONVERSION_WEBGL&&i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.BROWSER_DEFAULT_WEBGL),i.polygonOffset(0,0),i.sampleCoverage(1,!1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilMask(4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.viewport(0,0,i.canvas.width,i.canvas.height),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT);i.getError(););}function bA(i){var t,e=[],s=[],r={},a=1,c=!1,h=[],m=0,d=0,p=!1,b=0,w={};i.getContext=function(l){return function(){var G=l.apply(i,arguments);if(G instanceof WebGLRenderingContext){if(G!=t){if(t)throw"got different context";t=G,r=rt(t)}return r}return G}}(i.getContext);function C(l){return typeof l=="function"?l:function(G){l.handleEvent(G)}}var y=function(l){e.push(C(l))},R=function(l){s.push(C(l))};function U(l){var G=l.addEventListener;l.addEventListener=function(W,K){switch(W){case"webglcontextlost":y(K);break;case"webglcontextrestored":R(K);break;default:G.apply(l,arguments)}}}U(i),i.loseContext=function(){if(!c){for(c=!0,m=0,++a;t.getError(););M(),w[t.CONTEXT_LOST_WEBGL]=!0;var l=Q("context lost"),G=e.slice();setTimeout(function(){for(var W=0;W<G.length;++W)G[W](l);b>=0&&setTimeout(function(){i.restoreContext()},b)},0)}},i.restoreContext=function(){c&&s.length&&setTimeout(function(){if(!p)throw"can not restore. webglcontestlost listener did not call event.preventDefault";N(),Wp(t),c=!1,d=0,p=!1;for(var l=s.slice(),G=Q("context restored"),W=0;W<l.length;++W)l[W](G)},0)},i.loseContextInNCalls=function(l){if(c)throw"You can not ask a lost contet to be lost";m=d+l},i.getNumCalls=function(){return d},i.setRestoreTimeout=function(l){b=l};function M(){for(var l=Object.keys(w),G=0;G<l.length;++G)delete w[l]}function X(){++d,c||m==d&&i.loseContext()}function Y(l,G){var W=l[G];return function(){if(X(),!c){var K=W.apply(l,arguments);return K}}}function N(){for(var l=0;l<h.length;++l){var G=h[l];G instanceof WebGLBuffer?t.deleteBuffer(G):G instanceof WebGLFramebuffer?t.deleteFramebuffer(G):G instanceof WebGLProgram?t.deleteProgram(G):G instanceof WebGLRenderbuffer?t.deleteRenderbuffer(G):G instanceof WebGLShader?t.deleteShader(G):G instanceof WebGLTexture&&t.deleteTexture(G)}}function Q(l){return{statusMessage:l,preventDefault:function(){p=!0}}}return i;function rt(l){for(var G in l)typeof l[G]=="function"?r[G]=Y(l,G):Hp(r,l,G);r.getError=function(){if(X(),!c)for(var pt;pt=t.getError();)w[pt]=!0;for(pt in w)if(w[pt])return delete w[pt],pt;return r.NO_ERROR};for(var W=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],K=0;K<W.length;++K){var Z=W[K];r[Z]=function(pt){return function(){if(X(),c)return null;var Bt=pt.apply(l,arguments);return Bt.__webglDebugContextLostId__=a,h.push(Bt),Bt}}(l[Z])}var dt=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(K=0;K<dt.length;++K)Z=dt[K],r[Z]=function(pt){return function(){return X(),c?null:pt.apply(l,arguments)}}(r[Z]);var nt=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(K=0;K<nt.length;++K)Z=nt[K],r[Z]=function(pt){return function(){return X(),c?!1:pt.apply(l,arguments)}}(r[Z]);return r.checkFramebufferStatus=function(pt){return function(){return X(),c?r.FRAMEBUFFER_UNSUPPORTED:pt.apply(l,arguments)}}(r.checkFramebufferStatus),r.getAttribLocation=function(pt){return function(){return X(),c?-1:pt.apply(l,arguments)}}(r.getAttribLocation),r.getVertexAttribOffset=function(pt){return function(){return X(),c?0:pt.apply(l,arguments)}}(r.getVertexAttribOffset),r.isContextLost=function(){return c},r}}const I0={init:Up,mightBeEnum:_A,glEnumToString:sn,glFunctionArgToString:Ah,glFunctionArgsToString:xA,makeDebugContext:zp,makeLostContextSimulatingCanvas:bA,resetToInitialState:Wp};class Gp{constructor(t){if(this.ctx=t.getContext("2d"),this.ctx===null)throw new Error("Unable to get a 2D context");this.ctx.fillStyle="black",this.ctx.fillRect(0,0,1024,625),this.backBuffer=window.document.createElement("canvas"),this.backBuffer.width=1024,this.backBuffer.height=625,this.backCtx=this.backBuffer.getContext("2d"),this.imageData=this.backCtx.createImageData(this.backBuffer.width,this.backBuffer.height),this.canvasWidth=t.width,this.canvasHeight=t.height,this.fb32=new Uint32Array(this.imageData.data.buffer)}paint(t,e,s,r){const a=s-t,c=r-e;this.backCtx.putImageData(this.imageData,0,0,t,e,a,c),this.ctx.drawImage(this.backBuffer,t,e,a,c,0,0,this.canvasWidth,this.canvasHeight)}}const Cs=1024,na=1024;class yA{constructor(t){const e={alpha:!1,antialias:!1,depth:!1,preserveDrawingBuffer:!1,stencil:!1,failIfMajorPerformanceCaveat:!0},s=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(this.gl=s,!s)throw new Error("Unable to create a GL context");const r=I0.makeDebugContext(s,function(w,C){throw new Error("Problem creating GL context: "+I0.glEnumToString(w)+" in "+C)});r.depthMask(!1);function a(w,C){const y=r.createShader(w);return r.shaderSource(y,C.join(`
`)),r.compileShader(y),y}const c=a(r.VERTEX_SHADER,["attribute vec2 pos;","attribute vec2 uvIn;","varying vec2 uv;","void main() {","  uv = uvIn;","  gl_Position = vec4(2.0 * pos - 1.0, 0.0, 1.0);","}"]),h=a(r.FRAGMENT_SHADER,["precision mediump float;","uniform sampler2D tex;","varying vec2 uv;","void main() {","  gl_FragColor = texture2D(tex, uv).rgba;","}"]),m=r.createProgram();r.attachShader(m,h),r.attachShader(m,c),r.linkProgram(m),r.useProgram(m),this.fb8=new Uint8Array(Cs*na*4),this.fb32=new Uint32Array(this.fb8.buffer),this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.pixelStorei(r.UNPACK_ALIGNMENT,4),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,Cs,na,0,r.RGBA,r.UNSIGNED_BYTE,this.fb8),r.bindTexture(r.TEXTURE_2D,null),r.uniform1i(r.getUniformLocation(m,"tex"),0);const d=r.getAttribLocation(m,"pos");r.enableVertexAttribArray(d);const p=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,p),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),r.STATIC_DRAW),r.vertexAttribPointer(d,2,r.FLOAT,!1,0,0);const b=r.getAttribLocation(m,"uvIn");r.enableVertexAttribArray(b),this.uvBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),r.vertexAttribPointer(b,2,r.FLOAT,!1,0,0),r.activeTexture(s.TEXTURE0),r.bindTexture(s.TEXTURE_2D,this.texture),this.uvFloatArray=new Float32Array(8),this.lastExtent={},console.log("GL Canvas set up")}paint(t,e,s,r){const a=this.gl;a.texSubImage2D(a.TEXTURE_2D,0,0,e,Cs,r-e,a.RGBA,a.UNSIGNED_BYTE,this.fb8.subarray(e*Cs*4,r*Cs*4));const c={minx:t,miny:e,maxx:s,maxy:r};(c.minx!==this.lastExtent.minx||c.miny!==this.lastExtent.miny||c.maxx!==this.lastExtent.maxx||c.maxy!==this.lastExtent.maxy)&&(this.lastExtent=c,t/=Cs,s/=Cs,e/=na,r/=na,this.uvFloatArray[0]=t,this.uvFloatArray[1]=r,this.uvFloatArray[2]=t,this.uvFloatArray[3]=e,this.uvFloatArray[4]=s,this.uvFloatArray[5]=r,this.uvFloatArray[6]=s,this.uvFloatArray[7]=e,a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvFloatArray,a.DYNAMIC_DRAW)),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}function vA(i){try{return new yA(i)}catch(t){console.log("Unable to use OpenGL: "+t)}return new Gp(i)}class CA{constructor(t){this.changed={},this.model=null,this.coProcessor=null;const e=document.getElementById("configuration");e.addEventListener("show.bs.modal",()=>{this.changed={},this.setDropdownText(this.model.name),this.set65c02(this.model.tube),this.setTeletext(this.model.hasTeletextAdaptor),this.setMusic5000(this.model.hasMusic5000),this.setEconet(this.model.hasEconet)}),e.addEventListener("hide.bs.modal",()=>t(this.changed)),F(".model-menu a").on("click",s=>{this.changed.model=F(s.target).attr("data-target"),this.setDropdownText(F(s.target).text())}),F("#65c02").on("click",()=>{this.changed.coProcessor=F("#65c02").prop("checked")}),F("#hasTeletextAdaptor").on("click",()=>{this.changed.hasTeletextAdaptor=F("#hasTeletextAdaptor").prop("checked")}),F("#hasEconet").on("click",()=>{this.changed.hasEconet=F("#hasEconet").prop("checked")}),F("#hasMusic5000").on("click",()=>{this.changed.hasMusic5000=F("#hasMusic5000").prop("checked")}),F(".keyboard-menu a").on("click",s=>{const r=F(s.target).attr("data-target");this.changed.keyLayout=r,this.setKeyLayout(r)}),F(".mic-channel-option").on("click",s=>{const a=F(s.target).data("channel")===""?void 0:parseInt(F(s.target).data("channel"),10);this.changed.microphoneChannel=a,this.setMicrophoneChannel(a)}),F("#mouseJoystickEnabled").on("click",()=>{this.changed.mouseJoystickEnabled=F("#mouseJoystickEnabled").prop("checked")})}setMicrophoneChannel(t){t!==void 0?F(".mic-channel-text").text(`Channel ${t}`):F(".mic-channel-text").text("Disabled")}setMouseJoystickEnabled(t){F("#mouseJoystickEnabled").prop("checked",!!t)}setModel(t){this.model=Ac(t),F(".bbc-model").text(this.model.name)}setKeyLayout(t){F(".keyboard-layout").text(t[0].toUpperCase()+t.substring(1))}set65c02(t){t=!!t,F("#65c02").prop("checked",t),this.model.tube=t?Ac("Tube65c02"):null}setEconet(t){t=!!t,F("#hasEconet").prop("checked",t),this.model.hasEconet=t,t&&this.model.isMaster&&this.addRemoveROM("master/anfs-4.25.rom",!0)}setMusic5000(t){t=!!t,F("#hasMusic5000").prop("checked",t),this.model.hasMusic5000=t,this.addRemoveROM("ample.rom",t)}setTeletext(t){t=!!t,F("#hasTeletextAdaptor").prop("checked",t),this.model.hasTeletextAdaptor=t,this.addRemoveROM("ats-3.0.rom",t)}setDropdownText(t){F("#bbc-model-dropdown .bbc-model").text(t)}addRemoveROM(t,e){if(e&&!this.model.os.includes(t))this.model.os.push(t);else{let s=this.model.os.indexOf(t);s!==-1&&this.model.os.splice(s,1)}}mapLegacyModels(t){t.model&&(t.model.toLowerCase()==="masterturbo"&&(t.model="Master",t.coProcessor=!0),t.model.toLowerCase()==="bmusic5000"&&(t.model="B-DFS1.2",t.hasMusic5000=!0),t.model.toLowerCase()==="bteletext"&&(t.model="B-DFS1.2",t.hasTeletextAdaptor=!0))}}let Vp=function(){};function wA(i){const{loadDiscImage:t,processor:e}=i;window.nodeRequire("electron").ipcRenderer.on("load",async(r,a)=>{const{drive:c,path:h}=a,m=await t(h);e.fdc.loadDisc(c,m)})}typeof window.nodeRequire<"u"&&(Vp=wA);var Qo={},O0;function SA(){return O0||(O0=1,function(i){(function(t){/**
 * @license
 * MIT License:
 *
 * Copyright (c) 2010-2013, Joe Walnes
 *               2013-2018, Drew Noakes
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */Date.now=Date.now||function(){return new Date().getTime()};var e={extend:function(){arguments[0]=arguments[0]||{};for(var a=1;a<arguments.length;a++)for(var c in arguments[a])arguments[a].hasOwnProperty(c)&&(typeof arguments[a][c]=="object"?arguments[a][c]instanceof Array?arguments[0][c]=arguments[a][c]:arguments[0][c]=e.extend(arguments[0][c],arguments[a][c]):arguments[0][c]=arguments[a][c]);return arguments[0]},binarySearch:function(a,c){for(var h=0,m=a.length;h<m;){var d=h+m>>1;c<a[d][0]?m=d:h=d+1}return h},pixelSnap:function(a,c){return c%2===0?Math.round(a):Math.floor(a)+.5}};function s(a){this.options=e.extend({},s.defaultOptions,a),this.disabled=!1,this.clear()}s.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},s.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},s.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var a=1;a<this.data.length;a++){var c=this.data[a][1];c>this.maxValue&&(this.maxValue=c),c<this.minValue&&(this.minValue=c)}}else this.maxValue=Number.NaN,this.minValue=Number.NaN},s.prototype.append=function(a,c,h){if(!(isNaN(a)||isNaN(c))){var m=this.data.length-1;if(m>=0)for(var d=m;;){var p=this.data[d];if(a>=p[0]){a===p[0]?h?(p[1]+=c,c=p[1]):p[1]=c:this.data.splice(d+1,0,[a,c]);break}if(d--,d<0){this.data.splice(0,0,[a,c]);break}}else this.data.push([a,c]);this.maxValue=isNaN(this.maxValue)?c:Math.max(this.maxValue,c),this.minValue=isNaN(this.minValue)?c:Math.min(this.minValue,c)}},s.prototype.dropOldData=function(a,c){for(var h=0;this.data.length-h>=c&&this.data[h+1][0]<a;)h++;h!==0&&this.data.splice(0,h)};function r(a){this.options=e.extend({},r.defaultChartOptions,a),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0,this.lastChartTimestamp=0,this.mousemove=this.mousemove.bind(this),this.mouseout=this.mouseout.bind(this)}r.tooltipFormatter=function(a,c){var h=this.options.timestampFormatter||r.timeFormatter,m=document.createElement("div"),d;m.appendChild(document.createTextNode(h(new Date(a))));for(var p=0;p<c.length;++p){d=c[p].series.options.tooltipLabel||"",d!==""&&(d=d+" ");var b=document.createElement("span");b.style.color=c[p].series.options.strokeStyle,b.appendChild(document.createTextNode(d+this.options.yMaxFormatter(c[p].value,this.options.labels.precision))),m.appendChild(document.createElement("br")),m.appendChild(b)}return m.innerHTML},r.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(a,c){return parseFloat(a).toFixed(c)},yMaxFormatter:function(a,c){return parseFloat(a).toFixed(c)},yIntermediateFormatter:function(a,c){return parseFloat(a).toFixed(c)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!1,displayDataFromPercentile:1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:2,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2,showIntermediateLabels:!1,intermediateLabelSameAxis:!0},title:{text:"",fillStyle:"#ffffff",fontSize:15,fontFamily:"monospace",verticalAlign:"middle"},horizontalLines:[],tooltip:!1,tooltipLine:{lineWidth:1,strokeStyle:"#BBBBBB"},tooltipFormatter:r.tooltipFormatter,nonRealtimeData:!1,responsive:!1,limitFPS:0},r.AnimateCompatibility=function(){var a=function(h,m){var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(p){return window.setTimeout(function(){p(Date.now())},16)};return d.call(window,h,m)},c=function(h){var m=window.cancelAnimationFrame||function(d){clearTimeout(d)};return m.call(window,h)};return{requestAnimationFrame:a,cancelAnimationFrame:c}}(),r.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"},r.prototype.addTimeSeries=function(a,c){this.seriesSet.push({timeSeries:a,options:e.extend({},r.defaultSeriesPresentationOptions,c)}),a.options.resetBounds&&a.options.resetBoundsInterval>0&&(a.resetBoundsTimerId=setInterval(function(){a.resetBounds()},a.options.resetBoundsInterval))},r.prototype.removeTimeSeries=function(a){for(var c=this.seriesSet.length,h=0;h<c;h++)if(this.seriesSet[h].timeSeries===a){this.seriesSet.splice(h,1);break}a.resetBoundsTimerId&&clearInterval(a.resetBoundsTimerId)},r.prototype.getTimeSeriesOptions=function(a){for(var c=this.seriesSet.length,h=0;h<c;h++)if(this.seriesSet[h].timeSeries===a)return this.seriesSet[h].options},r.prototype.bringToFront=function(a){for(var c=this.seriesSet.length,h=0;h<c;h++)if(this.seriesSet[h].timeSeries===a){var m=this.seriesSet.splice(h,1);this.seriesSet.push(m[0]);break}},r.prototype.streamTo=function(a,c){this.canvas=a,this.clientWidth=parseInt(this.canvas.getAttribute("width")),this.clientHeight=parseInt(this.canvas.getAttribute("height")),this.delay=c,this.start()},r.prototype.getTooltipEl=function(){return this.tooltipEl||(this.tooltipEl=document.createElement("div"),this.tooltipEl.className="smoothie-chart-tooltip",this.tooltipEl.style.pointerEvents="none",this.tooltipEl.style.position="absolute",this.tooltipEl.style.display="none",document.body.appendChild(this.tooltipEl)),this.tooltipEl},r.prototype.updateTooltip=function(){if(this.options.tooltip){var a=this.getTooltipEl();if(!this.mouseover||!this.options.tooltip){a.style.display="none";return}for(var c=this.lastChartTimestamp,h=this.options.scrollBackwards?c-this.mouseX*this.options.millisPerPixel:c-(this.clientWidth-this.mouseX)*this.options.millisPerPixel,m=[],d=0;d<this.seriesSet.length;d++){var p=this.seriesSet[d].timeSeries;if(!p.disabled){var b=e.binarySearch(p.data,h);b>0&&b<p.data.length&&m.push({series:this.seriesSet[d],index:b,value:p.data[b][1]})}}m.length?(a.innerHTML=this.options.tooltipFormatter.call(this,h,m),a.style.display="block"):a.style.display="none"}},r.prototype.mousemove=function(a){if(this.mouseover=!0,this.mouseX=a.offsetX,this.mouseY=a.offsetY,this.mousePageX=a.pageX,this.mousePageY=a.pageY,!!this.options.tooltip){var c=this.getTooltipEl();c.style.top=Math.round(this.mousePageY)+"px",c.style.left=Math.round(this.mousePageX)+"px",this.updateTooltip()}},r.prototype.mouseout=function(){this.mouseover=!1,this.mouseX=this.mouseY=-1,this.tooltipEl&&(this.tooltipEl.style.display="none")},r.prototype.resize=function(){var a=!this.options.enableDpiScaling||!window?1:window.devicePixelRatio,c,h;this.options.responsive?(c=this.canvas.offsetWidth,h=this.canvas.offsetHeight,c!==this.lastWidth&&(this.lastWidth=c,this.canvas.setAttribute("width",Math.floor(c*a).toString()),this.canvas.getContext("2d").scale(a,a)),h!==this.lastHeight&&(this.lastHeight=h,this.canvas.setAttribute("height",Math.floor(h*a).toString()),this.canvas.getContext("2d").scale(a,a)),this.clientWidth=c,this.clientHeight=h):(c=parseInt(this.canvas.getAttribute("width")),h=parseInt(this.canvas.getAttribute("height")),a!==1?(Math.floor(this.clientWidth*a)!==c&&(this.canvas.setAttribute("width",Math.floor(c*a).toString()),this.canvas.style.width=c+"px",this.clientWidth=c,this.canvas.getContext("2d").scale(a,a)),Math.floor(this.clientHeight*a)!==h&&(this.canvas.setAttribute("height",Math.floor(h*a).toString()),this.canvas.style.height=h+"px",this.clientHeight=h,this.canvas.getContext("2d").scale(a,a))):(this.clientWidth=c,this.clientHeight=h))},r.prototype.start=function(){if(!this.frame){this.canvas.addEventListener("mousemove",this.mousemove),this.canvas.addEventListener("mouseout",this.mouseout);var a=(function(){this.frame=r.AnimateCompatibility.requestAnimationFrame((function(){if(this.options.nonRealtimeData){var c=new Date(0),h=this.seriesSet.reduce((function(m,d){var p=d.timeSeries.data,b=Math.round(this.options.displayDataFromPercentile*p.length)-1;if(b=b>=0?b:0,b=b<=p.length-1?b:p.length-1,p&&p.length>0){var w=p[b][0];m=m>w?m:w}return m}).bind(this),c);this.render(this.canvas,h>c?h:null)}else this.render();a()}).bind(this))}).bind(this);a()}},r.prototype.stop=function(){this.frame&&(r.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame,this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseout",this.mouseout))},r.prototype.updateValueRange=function(){for(var a=this.options,c=Number.NaN,h=Number.NaN,m=0;m<this.seriesSet.length;m++){var d=this.seriesSet[m].timeSeries;d.disabled||(isNaN(d.maxValue)||(c=isNaN(c)?d.maxValue:Math.max(c,d.maxValue)),isNaN(d.minValue)||(h=isNaN(h)?d.minValue:Math.min(h,d.minValue)))}if(a.maxValue!=null?c=a.maxValue:c*=a.maxValueScale,a.minValue!=null?h=a.minValue:h-=Math.abs(h*a.minValueScale-h),this.options.yRangeFunction){var p=this.options.yRangeFunction({min:h,max:c});h=p.min,c=p.max}if(!isNaN(c)&&!isNaN(h)){var b=c-h,w=b-this.currentValueRange,C=h-this.currentVisMinValue;this.isAnimatingScale=Math.abs(w)>.1||Math.abs(C)>.1,this.currentValueRange+=a.scaleSmoothing*w,this.currentVisMinValue+=a.scaleSmoothing*C}this.valueRange={min:h,max:c}},r.prototype.render=function(a,c){var h=Date.now();if(!(this.options.limitFPS>0&&h-this.lastRenderTimeMillis<1e3/this.options.limitFPS)){if(c=(c||h)-(this.delay||0),c-=c%this.options.millisPerPixel,!this.isAnimatingScale){var m=this.lastChartTimestamp===c;if(m){var d=h-this.lastRenderTimeMillis>166.66666666666666;if(!d)return}}this.lastRenderTimeMillis=h,this.lastChartTimestamp=c,this.resize(),a=a||this.canvas;var p=a.getContext("2d"),b=this.options,w={top:0,left:0,width:this.clientWidth,height:this.clientHeight},C=c-w.width*b.millisPerPixel,y=(function(Mt,ve){var Zt=Mt-this.currentVisMinValue,Re=this.currentValueRange===0?w.height:w.height*(1-Zt/this.currentValueRange);return e.pixelSnap(Re,ve)}).bind(this),R=function(Mt,ve){var Zt=b.scrollBackwards?(c-Mt)/b.millisPerPixel:w.width-(c-Mt)/b.millisPerPixel;return e.pixelSnap(Zt,ve)};if(this.updateValueRange(),p.font=b.labels.fontSize+"px "+b.labels.fontFamily,p.save(),p.translate(w.left,w.top),p.beginPath(),p.rect(0,0,w.width,w.height),p.clip(),p.save(),p.fillStyle=b.grid.fillStyle,p.clearRect(0,0,w.width,w.height),p.fillRect(0,0,w.width,w.height),p.restore(),p.save(),p.lineWidth=b.grid.lineWidth,p.strokeStyle=b.grid.strokeStyle,b.grid.millisPerLine>0){p.beginPath();for(var U=c-c%b.grid.millisPerLine;U>=C;U-=b.grid.millisPerLine){var M=R(U,b.grid.lineWidth);p.moveTo(M,0),p.lineTo(M,w.height)}p.stroke(),p.closePath()}for(var X=1;X<b.grid.verticalSections;X++){var Y=e.pixelSnap(X*w.height/b.grid.verticalSections,b.grid.lineWidth);p.beginPath(),p.moveTo(0,Y),p.lineTo(w.width,Y),p.stroke(),p.closePath()}if(b.grid.borderVisible&&(p.beginPath(),p.strokeRect(0,0,w.width,w.height),p.closePath()),p.restore(),b.horizontalLines&&b.horizontalLines.length)for(var N=0;N<b.horizontalLines.length;N++){var Q=b.horizontalLines[N],rt=Q.lineWidth||1,l=y(Q.value,rt);p.strokeStyle=Q.color||"#ffffff",p.lineWidth=rt,p.beginPath(),p.moveTo(0,l),p.lineTo(w.width,l),p.stroke(),p.closePath()}for(var G=0;G<this.seriesSet.length;G++){var W=this.seriesSet[G].timeSeries,K=W.data;if(W.dropOldData(C,b.maxDataSetLength),!(K.length<=1||W.disabled)){p.save();var Z=this.seriesSet[G].options,dt=Z.strokeStyle&&Z.strokeStyle!=="none",nt=dt?Z.lineWidth:0;p.beginPath();var pt=R(K[0][0],nt),Bt=y(K[0][1],nt),It=pt,Dt=Bt,re;switch(p.moveTo(pt,Bt),Z.interpolation||b.interpolation){case"linear":case"line":{re=function(Mt,ve,Zt,Re){p.lineTo(Mt,ve)};break}case"bezier":default:{re=function(Mt,ve,Zt,Re){p.bezierCurveTo(Math.round((Zt+Mt)/2),Re,Math.round(Zt+Mt)/2,ve,Mt,ve)};break}case"step":{re=function(Mt,ve,Zt,Re){p.lineTo(Mt,Re),p.lineTo(Mt,ve)};break}}for(var Pt=1;Pt<K.length;Pt++){var Be=K[Pt],Je=R(Be[0],nt),le=y(Be[1],nt);re(Je,le,It,Dt),It=Je,Dt=le}dt&&(p.lineWidth=Z.lineWidth,p.strokeStyle=Z.strokeStyle,p.stroke()),Z.fillStyle&&(p.lineTo(It,w.height+nt+1),p.lineTo(pt,w.height+nt+1),p.fillStyle=Z.fillStyle,p.fill()),p.restore()}}b.tooltip&&this.mouseX>=0&&(p.lineWidth=b.tooltipLine.lineWidth,p.strokeStyle=b.tooltipLine.strokeStyle,p.beginPath(),p.moveTo(this.mouseX,0),p.lineTo(this.mouseX,w.height),p.closePath(),p.stroke()),this.updateTooltip();var Ft=b.labels;if(!Ft.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var ue=b.yMaxFormatter(this.valueRange.max,Ft.precision),zt=b.yMinFormatter(this.valueRange.min,Ft.precision),De=b.scrollBackwards?0:w.width-p.measureText(ue).width-2,Fe=b.scrollBackwards?0:w.width-p.measureText(zt).width-2;p.fillStyle=Ft.fillStyle,p.fillText(ue,De,Ft.fontSize),p.fillText(zt,Fe,w.height-2)}if(Ft.showIntermediateLabels&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)&&b.grid.verticalSections>0)for(var ye=(this.valueRange.max-this.valueRange.min)/b.grid.verticalSections,ti=w.height/b.grid.verticalSections,X=1;X<b.grid.verticalSections;X++){var Y=w.height-Math.round(X*ti),Xt=b.yIntermediateFormatter(this.valueRange.min+X*ye,Ft.precision),di=Ft.intermediateLabelSameAxis?b.scrollBackwards?0:w.width-p.measureText(Xt).width-2:b.scrollBackwards?w.width-p.measureText(Xt).width-2:0;p.fillText(Xt,di,Y-b.grid.lineWidth)}if(b.timestampFormatter&&b.grid.millisPerLine>0)for(var fe=b.scrollBackwards?p.measureText(zt).width:w.width-p.measureText(zt).width+4,U=c-c%b.grid.millisPerLine;U>=C;U-=b.grid.millisPerLine){var M=R(U,0);if(!b.scrollBackwards&&M<fe||b.scrollBackwards&&M>fe){var Ue=new Date(U),zi=b.timestampFormatter(Ue),ds=p.measureText(zi).width;fe=b.scrollBackwards?M+ds+2:M-ds-2,p.fillStyle=b.labels.fillStyle,b.scrollBackwards?p.fillText(zi,M,w.height-2):p.fillText(zi,M-ds,w.height-2)}}if(b.title.text!==""){p.font=b.title.fontSize+"px "+b.title.fontFamily;var Wi=b.scrollBackwards?w.width-p.measureText(b.title.text).width-2:2;if(b.title.verticalAlign=="bottom"){p.textBaseline="bottom";var ei=w.height}else if(b.title.verticalAlign=="middle"){p.textBaseline="middle";var ei=w.height/2}else{p.textBaseline="top";var ei=0}p.fillStyle=b.title.fillStyle,p.fillText(b.title.text,Wi,ei)}p.restore()}},r.timeFormatter=function(a){function c(h){return(h<10?"0":"")+h}return c(a.getHours())+":"+c(a.getMinutes())+":"+c(a.getSeconds())},t.TimeSeries=s,t.SmoothieChart=r})(i)}(Qo)),Qo}var M0=SA();const EA=new URL("/assets/audio-renderer-D1-ZS6nv.js",import.meta.url).href,AA=new URL("/assets/music5000-worklet-LL9i_-_Z.js",import.meta.url).href;class kA{constructor(t,e,s,r,a){if(this.warningNode=t,this.warningNode.toggle(!1),this.chart=new M0.SmoothieChart({tooltip:!0,labels:{precision:0},yRangeFunction:c=>({min:0,max:c.max})}),this.stats={},this._addStat("queueSize",{strokeStyle:"rgb(51,126,108)"}),this._addStat("queueAge",{strokeStyle:"rgb(162,119,22)"}),this.chart.streamTo(e,100),this.audioContext=typeof AudioContext<"u"?new AudioContext:typeof webkitAudioContext<"u"?new webkitAudioContext:null,this._jsAudioNode=null,this.audioContext&&this.audioContext.audioWorklet)this.audioContext.onstatechange=()=>this.checkStatus(),this.soundChip=new ZE((c,h)=>this._onBuffer(c,h)),this.ddNoise=a?new kc:new QE(this.audioContext),this._setup(s,r).then();else{if(this.audioContext&&!this.audioContext.audioWorklet){this.audioContext=null,console.log("Unable to initialise audio: no audio worklet API"),this.warningNode.toggle(!0);const c=new URL(window.location);c.hostname="localhost",this.warningNode.html(`No audio worklet API was found - there will be no audio. 
                    If you are running a local jsbeeb, you must either use a host of
                    <a href="${c}">localhost</a>, 
                    or serve the content over <em>https</em>.`)}this.soundChip=new Np,this.ddNoise=new kc}this.warningNode.on("mousedown",()=>this.tryResume()),this.warningNode.toggle(!1),this.audioContextM5000=typeof AudioContext<"u"?new AudioContext({sampleRate:46875}):typeof webkitAudioContext<"u"?new webkitAudioContext({sampleRate:46875}):null,this.audioContextM5000&&this.audioContextM5000.audioWorklet?(this.audioContextM5000.onstatechange=()=>this.checkStatus(),this.music5000=new cA(c=>this._onBufferMusic5000(c)),this.audioContextM5000.audioWorklet.addModule(AA).then(()=>{this._music5000workletnode=new AudioWorkletNode(this.audioContextM5000,"music5000",{outputChannelCount:[2]}),this._music5000workletnode.connect(this.audioContextM5000.destination)})):this.music5000=new Fp}async _setup(t,e){if(await this.audioContext.audioWorklet.addModule(EA),t!==0){const s=this.audioContext.createBiquadFilter();s.type="lowpass",s.frequency.value=t,s.Q.value=e,this._audioDestination=s,s.connect(this.audioContext.destination)}else this._audioDestination=this.audioContext.destination;this._jsAudioNode=new AudioWorkletNode(this.audioContext,"sound-chip-processor"),this._jsAudioNode.connect(this._audioDestination),this._jsAudioNode.port.onmessage=s=>{const r=Date.now();for(const a of Object.keys(s.data))this.stats[a]&&this.stats[a].append(r,s.data[a])}}_addStat(t,e){const s=new M0.TimeSeries;this.stats[t]=s,e.tooltipLabel=t,this.chart.addTimeSeries(s,e)}_onBuffer(t){this._jsAudioNode&&this._jsAudioNode.port.postMessage({time:Date.now(),buffer:t},[t.buffer])}async tryResume(){this.audioContext&&await this.audioContext.resume(),this.audioContextM5000&&await this.audioContextM5000.resume()}_onBufferMusic5000(t){this._music5000workletnode&&this._music5000workletnode.port.postMessage(t)}checkStatus(){this.audioContext&&(this.audioContext.state==="suspended"&&this.warningNode.fadeIn(),this.audioContext.state==="running"&&this.warningNode.fadeOut())}async initialise(){await this.ddNoise.initialise()}mute(){this.soundChip.mute(),this.ddNoise.mute()}unmute(){this.soundChip.unmute(),this.ddNoise.unmute()}}var Jo,N0;function TA(){if(N0)return Jo;N0=1;var i=function(){function r(a,c){for(var h=0;h<c.length;h++){var m=c[h];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(a,m.key,m)}}return function(a,c,h){return c&&r(a.prototype,c),h&&r(a,h),a}}();function t(r,a){if(!(r instanceof a))throw new TypeError("Cannot call a class as a function")}var e={emitDelay:10,strictMode:!1},s=function(){function r(){var a=arguments.length<=0||arguments[0]===void 0?e:arguments[0];t(this,r);var c=void 0,h=void 0;a.hasOwnProperty("emitDelay")?c=a.emitDelay:c=e.emitDelay,this._emitDelay=c,a.hasOwnProperty("strictMode")?h=a.strictMode:h=e.strictMode,this._strictMode=h,this._listeners={},this.events=[]}return i(r,[{key:"_addListenner",value:function(c,h,m){if(typeof h!="function")throw TypeError("listener must be a function");this.events.indexOf(c)===-1?(this._listeners[c]=[{once:m,fn:h}],this.events.push(c)):this._listeners[c].push({once:m,fn:h})}},{key:"on",value:function(c,h){this._addListenner(c,h,!1)}},{key:"once",value:function(c,h){this._addListenner(c,h,!0)}},{key:"off",value:function(c,h){var m=this,d=this.events.indexOf(c),p=c&&d!==-1;p&&(h?function(){var b=[],w=m._listeners[c];w.forEach(function(C,y){C.fn===h&&b.unshift(y)}),b.forEach(function(C){w.splice(C,1)}),w.length||(m.events.splice(d,1),delete m._listeners[c])}():(delete this._listeners[c],this.events.splice(d,1)))}},{key:"_applyEvents",value:function(c,h){var m=this._listeners[c];if(!m||!m.length){if(this._strictMode)throw"No listeners specified for event: "+c;return}var d=[];m.forEach(function(p,b){p.fn.apply(null,h),p.once&&d.unshift(b)}),d.forEach(function(p){m.splice(p,1)})}},{key:"emit",value:function(c){for(var h=this,m=arguments.length,d=Array(m>1?m-1:0),p=1;p<m;p++)d[p-1]=arguments[p];this._emitDelay?setTimeout(function(){h._applyEvents.call(h,c,d)},this._emitDelay):this._applyEvents(c,d)}},{key:"emitSync",value:function(c){for(var h=arguments.length,m=Array(h>1?h-1:0),d=1;d<h;d++)m[d-1]=arguments[d];this._applyEvents(c,m)}},{key:"destroy",value:function(){this._listeners={},this.events=[]}}]),r}();return Jo=s,Jo}var DA=TA();const RA=G0(DA);var W0;const tc=typeof window<"u"&&/^Mac/i.test(((W0=window.navigator)==null?void 0:W0.platform)||"");class LA extends RA{constructor(t){super();const{processor:e,inputEnabledFunction:s,keyLayout:r="physical",dbgr:a}=t;this.processor=e,this.inputEnabledFunction=s,this.dbgr=a,this.emuKeyHandlers={},this.running=!1,this.pauseEmu=!1,this.stepEmuWhenPaused=!1,this.keyLayout=r,this.lastShiftLocation=1,this.lastCtrlLocation=1,this.lastAltLocation=1}keyCode(t){const e=t.which||t.charCode||t.keyCode,s=k;switch(t.location){default:switch(e){case s.SHIFT:return this.lastShiftLocation===1?s.SHIFT_LEFT:s.SHIFT_RIGHT;case s.ALT:return this.lastAltLocation===1?s.ALT_LEFT:s.ALT_RIGHT;case s.CTRL:return this.lastCtrlLocation===1?s.CTRL_LEFT:s.CTRL_RIGHT}break;case 1:switch(e){case s.SHIFT:return this.lastShiftLocation=1,s.SHIFT_LEFT;case s.ALT:return this.lastAltLocation=1,s.ALT_LEFT;case s.CTRL:return this.lastCtrlLocation=1,s.CTRL_LEFT}break;case 2:switch(e){case s.SHIFT:return this.lastShiftLocation=2,s.SHIFT_RIGHT;case s.ALT:return this.lastAltLocation=2,s.ALT_RIGHT;case s.CTRL:return this.lastCtrlLocation=2,s.CTRL_RIGHT}break;case 3:switch(e){case s.ENTER:return k.NUMPADENTER;case s.DELETE:return k.NUMPAD_DECIMAL_POINT}break}return e}registerKeyHandler(t,e,s={alt:!0,ctrl:!1}){const r=`${s.alt?"alt:":""}${s.ctrl?"ctrl:":""}${t}`;this.emuKeyHandlers[r]={handler:e,alt:!!s.alt,ctrl:!!s.ctrl,keyCode:t}}setKeyLayout(t){this.keyLayout=t,this.processor.sysvia.setKeyLayout(t)}setRunning(t){this.running=t}_findKeyHandler(t,e,s){const r=`${e?"alt:":""}${s?"ctrl:":""}${t}`;return this.emuKeyHandlers[r]?this.emuKeyHandlers[r]:null}keyPress(t){if(this.inputEnabledFunction()||this.running||!this.dbgr.enabled()&&!this.pauseEmu)return;const r=this.keyCode(t);if(this.dbgr.enabled()&&r===103){this.dbgr.hide(),this.emit("resume");return}if(this.pauseEmu){if(r===103){this.resumeEmulation();return}else if(r===110){this.requestStep(),this.emit("resume");return}}this.dbgr.enabled()&&this.dbgr.keyPress(this.keyCode(t))&&t.preventDefault()}keyDown(t){if(this.inputEnabledFunction()||!this.running)return;const e=this.keyCode(t);if(t.preventDefault(),this._handleSpecialKeys(e))return;this.processor.sysvia.keyDown(e,t.shiftKey);const r=this._findKeyHandler(e,t.altKey,t.ctrlKey);r&&r.handler(!0,e)}_handleSpecialKeys(t){return t===k.F12||t===k.BREAK?(this.emit("break",!0),this.processor.setReset(!0),!0):tc&&t===k.CAPSLOCK?(this.handleMacCapsLock(),!0):!1}keyUp(t){if(this.inputEnabledFunction())return;const e=this.keyCode(t);if(this.processor.sysvia.keyUp(e),!this.running)return;if(t.preventDefault(),e===k.F12||e===k.BREAK){this.emit("break",!1),this.processor.setReset(!1);return}else if(tc&&e===k.CAPSLOCK){this.handleMacCapsLock();return}const s=this._findKeyHandler(e,t.altKey,t.ctrlKey);s&&s.handler(!1,e)}handleMacCapsLock(){this.processor.sysvia.keyDown(k.CAPSLOCK),setTimeout(()=>this.processor.sysvia.keyUp(k.CAPSLOCK),100),tc&&window.localStorage&&!window.localStorage.getItem("warnedAboutRubbishMacs")&&(this.emit("showError",{context:"handling caps lock on Mac OS X",error:`Mac OS X does not generate key up events for caps lock presses. 
                jsbeeb can only simulate a 'tap' of the caps lock key. This means it doesn't work well for games 
                that use caps lock for left or fire, as we can't tell if it's being held down. If you need to play 
                such a game, please see the documentation about remapping keys.
                Close this window to continue (you won't see this error again)`}),window.localStorage.setItem("warnedAboutRubbishMacs","true"))}sendRawKeyboardToBBC(t,e){let s,r=0;this.processor.sysvia.disableKeyboard();const a=Math.floor(this.processor.cpuMultiplier*2e6);if(e){let h=null;this.processor.sysvia.capsLockLight?this.processor.sysvia.shiftLockLight&&(h=A.SHIFTLOCK):h=A.CAPSLOCK,h&&(t.unshift(h),t.push(h))}const c=this.processor.debugInstruction.add(()=>{const h=this.processor.cycleSeconds*1e3+this.processor.currentCycles/(a/1e3);if(h<r)return;if(s&&s!==A.SHIFT&&this.processor.sysvia.keyToggleRaw(s),t.length===0){this.processor.sysvia.enableKeyboard(),c.remove();return}const m=t[0],d=s===m;if(s=m,d){s=void 0,r=h+30;return}let p=50;typeof s=="number"?(p=s,s=void 0):this.processor.sysvia.keyToggleRaw(s),t.shift(),r=h+p})}clearKeys(){this.processor.sysvia.clearKeys()}postFrameShouldPause(){return this.stepEmuWhenPaused?(this.stepEmuWhenPaused=!1,!0):!1}requestStep(){this.stepEmuWhenPaused=!0}pauseEmulation(){this.pauseEmu=!0,this.emit("pause")}resumeEmulation(){this.pauseEmu=!1,this.emit("resume")}}class kh{getValue(t){throw new Error("Method not implemented")}dispose(){}}class PA extends kh{constructor(t){super(),this.getGamepads=t}getValue(t){const e=this.getGamepads();if(!e||!e[0])return 32768;const s=e[0],r=e[1];let a=0;switch(t){case 0:a=s.axes[0];break;case 1:a=s.axes[1];break;case 2:r?a=r.axes[0]:a=s.axes[2];break;case 3:r?a=r.axes[1]:a=s.axes[3];break;default:return 32768}return Math.floor((1-a)/2*65535)}}class IA extends kh{constructor(){super(),this.audioContext=null,this.microphoneStream=null,this.microphoneSource=null,this.microphoneAnalyser=null,this.microphoneDataArray=null,this.errorCallback=null,this.errorMessage=null}setErrorCallback(t){this.errorCallback=t}async initialise(){if(console.log("MicrophoneInput: Initialising microphone input"),!this.audioContext)try{console.log("MicrophoneInput: Creating audio context"),this.audioContext=new(window.AudioContext||window.webkitAudioContext),console.log("MicrophoneInput: Audio context created:",this.audioContext.state)}catch(t){return console.error("MicrophoneInput: Error creating audio context:",t),this.errorMessage=`Could not create audio context: ${t.message}`,this.errorCallback&&this.errorCallback(this.errorMessage),!1}try{console.log("MicrophoneInput: Requesting microphone access");const t=await navigator.mediaDevices.getUserMedia({audio:!0});return console.log("MicrophoneInput: Microphone access granted"),this.microphoneStream=t,console.log("MicrophoneInput: Creating audio analyser"),this.microphoneAnalyser=this.audioContext.createAnalyser(),this.microphoneAnalyser.fftSize=1024,this.microphoneAnalyser.smoothingTimeConstant=.2,this.microphoneDataArray=new Uint8Array(this.microphoneAnalyser.frequencyBinCount),console.log("MicrophoneInput: Created data buffer with",this.microphoneDataArray.length,"samples"),console.log("MicrophoneInput: Creating media stream source"),this.microphoneSource=this.audioContext.createMediaStreamSource(t),console.log("MicrophoneInput: Connecting microphone to analyser"),this.microphoneSource.connect(this.microphoneAnalyser),this.errorMessage=null,console.log("MicrophoneInput: Initialisation complete"),!0}catch(t){return console.error("MicrophoneInput: Error accessing microphone:",t),this.errorMessage=`Error accessing microphone: ${t.message}`,this.errorCallback&&this.errorCallback(this.errorMessage),!1}}getErrorMessage(){return this.errorMessage}getValue(t){if(!this.microphoneAnalyser||!this.microphoneDataArray)throw new Error("MicrophoneInput: getValue called but analyser not initialised");this.microphoneAnalyser.getByteTimeDomainData(this.microphoneDataArray);let e=0;for(let c=0;c<this.microphoneDataArray.length;c++)e+=Math.abs(this.microphoneDataArray[c]-128);const a=e/this.microphoneDataArray.length*800;return Math.min(65535,a)|0}dispose(){this.microphoneStream&&(this.microphoneStream.getTracks().forEach(t=>t.stop()),this.microphoneStream=null),this.microphoneSource&&(this.microphoneSource.disconnect(),this.microphoneSource=null),this.microphoneAnalyser=null,this.microphoneDataArray=null,this.audioContext&&this.audioContext.state!=="closed"&&this.audioContext.close().catch(t=>console.error("Error closing audio context:",t)),this.audioContext=null}}class OA extends kh{constructor(t){super(),this.canvas=t,this.mouseX=.5,this.mouseY=.5,this.isActive=!1,this.via=null}setVia(t){this.via=t}onMouseMove(t,e){this.mouseX=Math.max(0,Math.min(1,t)),this.mouseY=Math.max(0,Math.min(1,e)),this.isActive=!0}onMouseDown(t){this.via&&t===0&&this.via.setJoystickButton(0,!0)}onMouseUp(t){this.via&&t===0&&this.via.setJoystickButton(0,!1)}isEnabled(){return!!this.via}getValue(t){switch(t){case 0:return Math.floor((1-this.mouseX)*65535);case 1:return Math.floor((1-this.mouseY)*65535);case 2:case 3:return 32768;default:return 32768}}dispose(){this.via=null,this.isActive=!1}}function lr(i){return i!=null}const xt={STRING:"string",ARRAY:"array",INT:"int",FLOAT:"float",BOOL:"bool"};function MA(i,t={}){if(!i)return{};const e=i.endsWith("/")?i.substring(0,i.length-1):i,s={};return e.split("&").forEach(function(r){if(!r)return;const a=r.split("="),c=decodeURIComponent(a[0]);let h=null;switch(a.length>1&&(h=decodeURIComponent(a[1])),t[c]||xt.STRING){case xt.ARRAY:s[c]||(s[c]=[]),s[c].push(h);break;case xt.INT:if(h!==void 0){const d=parseInt(h,10);s[c]=isNaN(d)?0:d}break;case xt.FLOAT:if(h!==void 0){const d=parseFloat(h);s[c]=isNaN(d)?0:d}break;case xt.BOOL:s[c]=h!=="false";break;case xt.STRING:default:s[c]=h;break}}),s}function ec(i,t,e,s=void 0){return i+=t+encodeURIComponent(e),s!==void 0&&(i+="="+encodeURIComponent(s)),{url:i,sep:"&"}}function NA(i,t,e={}){let s=i,r="?";return Object.entries(t).forEach(([a,c])=>{if(a.length===0)return;switch(e[a]||xt.STRING){case xt.ARRAY:Array.isArray(c)&&c.length>0&&c.forEach(m=>{if(lr(m)){const d=ec(s,r,a,m);s=d.url,r=d.sep}});break;case xt.BOOL:if(c===!0){const m=ec(s,r,a);s=m.url,r=m.sep}break;case xt.INT:case xt.FLOAT:case xt.STRING:default:if(lr(c)&&c!==""){const m=ec(s,r,a,c);s=m.url,r=m.sep}break}}),s}function BA(i,t,e,s,r){return Object.entries(i).forEach(([a,c])=>{if(c)if(a.toUpperCase().indexOf("KEY.")===0){const h=c.toUpperCase();if(t[h]){const m=a.substring(4).toUpperCase();e[m]?(console.log("mapping "+m+" to "+h),s.push({native:m,bbc:h})):console.log("unknown key: "+m)}else console.log("unknown BBC key: "+c)}else if(a.indexOf("GP.")===0){const h=a.substring(3).toUpperCase();r.remap(h,c.toUpperCase())}else switch(a){case"LEFT":case"RIGHT":case"UP":case"DOWN":case"FIRE":r.remap(a,c.toUpperCase());break}}),i}function FA(i){let t=!1,e="";return lr(i.autoboot)?t="boot":lr(i.autochain)?t="chain":lr(i.autorun)?t="run":lr(i.autotype)&&(t="type",e=i.autotype),{needsAutoboot:t,autoType:e}}function UA(i){return i.startsWith("bbc")?"B-DFS1.2":i.startsWith("master")?"Master":"B-DFS1.2"}function $A(i){const{disc:t,disc1:e,disc2:s,tape:r}=i;return{discImage:t||e,secondDiscImage:s,tapeImage:r}}let tt,Dr;const Rr=new iS;let ic=0,ss=0,Kp,Th,Dh,li,Ns;const qp=new YS,jp=[{name:"Elite",desc:"An 8-bit classic. Hit F10 to launch from the space station, then use <, >, S, X and A to fly around.",file:"elite.ssd"},{name:"Welcome",desc:"The disc supplied with BBC Disc systems to demonstrate some of the features of the system.",file:"Welcome.ssd"},{name:"Music 5000",desc:"The Music 5000 system disk and demo songs.",file:"5000mstr36008.ssd"}];let Sa=jp[0].file;const Yp=[],HA=document.location.search.substring(1)+"&"+window.location.hash.substring(1);let Dc=null;const Xp={rom:xt.ARRAY,embed:xt.BOOL,fasttape:xt.BOOL,noseek:xt.BOOL,debug:xt.BOOL,verbose:xt.BOOL,autoboot:xt.BOOL,autochain:xt.BOOL,autorun:xt.BOOL,hasMusic5000:xt.BOOL,hasTeletextAdaptor:xt.BOOL,hasEconet:xt.BOOL,glEnabled:xt.BOOL,fakeVideo:xt.BOOL,logFdcCommands:xt.BOOL,logFdcStateChanges:xt.BOOL,coProcessor:xt.BOOL,mouseJoystickEnabled:xt.BOOL,speed:xt.INT,stationId:xt.INT,frameSkip:xt.INT,audiofilterfreq:xt.FLOAT,audiofilterq:xt.FLOAT,cpuMultiplier:xt.FLOAT,microphoneChannel:xt.INT,model:xt.STRING,disc:xt.STRING,disc1:xt.STRING,disc2:xt.STRING,tape:xt.STRING,keyLayout:xt.STRING,autotype:xt.STRING};let et=MA(HA,Xp),{needsAutoboot:Rc,autoType:zA}=FA(et),$a=window.localStorage.keyLayout||"physical";const WA=A,GA=k;let Ea=1,Lc=!1,Zp=!1,Qp=!1,Jp=7e3,tm=5,em=101,Rh=null;const{discImage:B0,secondDiscImage:F0}=$A(et);B0&&(Sa=B0);F0&&(Dc=F0);et=BA(et,WA,GA,Cc,qp);Array.isArray(et.rom)&&et.rom.forEach(i=>{i&&Yp.push(i)});et.keyLayout&&($a=(et.keyLayout+"").toLowerCase());et.embed&&(F(".embed-hide").hide(),F("body").css("background-color","transparent"));Zp=!!et.fasttape;Qp=!!et.noseek;et.audiofilterfreq!==void 0&&(Jp=et.audiofilterfreq);et.audiofilterq!==void 0&&(tm=et.audiofilterq);et.stationId!==void 0&&(em=et.stationId);et.frameSkip!==void 0&&(ss=et.frameSkip);const VA={outputStrobe:function(i,t){if(!Ic||!t||i)return;const e=tt.uservia;e.setca1(!1),e.setca1(!0);const s=String.fromCharCode(e.ora);Ic.value+=s}};let im=null;{let i=255;im={write:function(){},read:function(){return i}}}const Lh={keyLayout:$a,coProcessor:et.coProcessor,cpuMultiplier:Ea,videoCyclesBatch:et.videoCyclesBatch,extraRoms:Yp,userPort:im,printerPort:VA,getGamepads:function(){return navigator.getGamepads?navigator.getGamepads():[]},debugFlags:{logFdcCommands:et.logFdcCommands!==void 0,logFdcStateChanges:et.logFdcStateChanges!==void 0}},fi=new CA(function(i){et=qe.extend(et,i),(i.model||i.coProcessor!==void 0||i.hasMusic5000!==void 0||i.hasTeletextAdaptor!==void 0||i.hasEconet!==void 0)&&gk("Changing model requires a restart of the emulator. Restart now?","Yes, restart now","No, thanks",function(){os(),window.location.reload()}),i.keyLayout&&(window.localStorage.keyLayout=i.keyLayout,Lh.keyLayout=i.keyLayout,Ht.setKeyLayout(i.keyLayout)),(i.mouseJoystickEnabled!==void 0||i.microphoneChannel!==void 0)&&(lm(et.mouseJoystickEnabled,et.microphoneChannel),i.microphoneChannel!==void 0&&um().then(()=>{})),os()});fi.mapLegacyModels(et);fi.setModel(et.model||UA(window.location.hostname));fi.setKeyLayout($a);fi.set65c02(et.coProcessor);fi.setEconet(et.hasEconet);fi.setMusic5000(et.hasMusic5000);fi.setTeletext(et.hasTeletextAdaptor);fi.setMicrophoneChannel(et.microphoneChannel);fi.setMouseJoystickEnabled(et.mouseJoystickEnabled);Ns=fi.model;function Ph(i,t,e){const s=i.find("img");s.hide(),t&&s.attr("src",t).bind("load",function(){e(i,s),s.show()})}Ph(F(".sidebar.left"),et.sbLeft,function(i,t){i.css({left:-t.width()-5})});Ph(F(".sidebar.right"),et.sbRight,function(i,t){i.css({right:-t.width()-5})});Ph(F(".sidebar.bottom"),et.sbBottom,function(i,t){i.css({bottom:-t.height()})});et.cpuMultiplier!==void 0&&(Ea=et.cpuMultiplier,console.log("CPU multiplier set to "+Ea));const Pc=Ea*2*1e3*1e3|0,KA=Pc/10;let sm=!0;et.glEnabled!==void 0&&(sm=et.glEnabled==="true");const Bi=F("#screen"),U0=sm?vA(Bi[0]):new Gp(Bi[0]);Dr=new tS(Ns.isMaster,U0.fb32,function(t,e,s,r){ic++,!(ic<ss)&&(ic=0,U0.paint(t,e,s,r))});et.fakeVideo!==void 0&&(Dr=new _p);const rm=document.getElementById("audio-stats"),hi=new kA(F("#audio-warning"),rm,Jp,tm,Qp);et.audioDebug||(rm.style.display="none");window.setTimeout(()=>hi.checkStatus(),1e3);F(".initially-hidden").removeClass("initially-hidden");const nm=new be(document.getElementById("discs")),qA=new be(document.getElementById("econetfs"));function Ih(i){return new Promise((t,e)=>{const s=new FileReader;s.onload=r=>{t(r.target.result)},s.onerror=r=>{console.error(`Error reading file ${i.name}:`,r),e(new Error(`Failed to read file ${i.name}`))},s.readAsBinaryString(i)})}function am(i,t){const e=i.lastIndexOf(".");return e===-1?i+t:i.substring(0,e)+t}function Oh(i,t,e){const s=document.createElement("a");document.body.appendChild(s),s.style="display: none";const r=am(t,e),a=new Blob([i],{type:"application/octet-stream"}),c=window.URL.createObjectURL(a);s.href=c,s.download=r,s.click(),window.URL.revokeObjectURL(c)}async function om(i){const t=await Ih(i);tt.fdc.loadDisc(0,Ii(tt.fdc,i.name,t)),delete et.disc,delete et.disc1,os(),nm.hide()}async function jA(i){const t=await Ih(i);tt.filestore.scsi=An(t),tt.filestore.PC=1024,tt.filestore.SP=255,tt.filestore.A=1,tt.filestore.emulationSpeed=0,tt.econet.receiveBlocks=[],tt.econet.nextReceiveBlockNumber=1,qA.hide()}const Mh=F("#paste-text");Mh.on("paste",function(i){const t=i.originalEvent.clipboardData.getData("text/plain");Lr(En(t),!0)});Mh.on("dragover",function(i){i.preventDefault(),i.stopPropagation(),i.originalEvent.dataTransfer.dropEffect="copy"});Mh.on("drop",async function(i){Yt("local","drop");const t=i.originalEvent.dataTransfer.files[0];await om(t)});const $0=F("#cub-monitor");$0.on("mousemove mousedown mouseup",function(i){hi.tryResume().then(()=>{}),document.activeElement!==document.body&&document.activeElement.blur();const t=$0.offset(),e=Bi.offset(),s=(i.offsetX-t.left+e.left)/Bi.width(),r=(i.offsetY-t.top+e.top)/Bi.height();tt.touchScreen&&tt.touchScreen.onMouse(s,r,i.buttons),et.mouseJoystickEnabled&&is.isEnabled()&&(is.onMouseMove(s,r),i.type==="mousedown"&&i.button===0?is.onMouseDown(0):i.type==="mouseup"&&i.button===0&&is.onMouseUp(0)),i.preventDefault()});F(window).blur(function(){Ht.clearKeys()});F("#fs").click(function(i){Bi[0].requestFullscreen(),i.preventDefault()});let Ht;const cm=F("#debug-pause"),hm=F("#debug-play");cm.click(()=>$i(!0));hm.click(()=>{Rr.hide(),Ir()});document.ondragover=function(i){i.preventDefault(),i.dataTransfer.dropEffect="none"};document.ondrop=function(i){i.preventDefault()};window.onbeforeunload=function(){if(li&&tt.sysvia.hasAnyKeyDown())return`It seems like you're still using the emulator. If you're in Chrome, it's impossible for jsbeeb to prevent some shortcuts (like ctrl-W) from performing their default behaviour (e.g. closing the window).
As a workarond, create an 'Application Shortcut' from the Tools menu.  When jsbeeb runs as an application, it *can* prevent ctrl-W from closing the window.`};Ns.hasEconet?Rh=new NS(em):F("#fsmenuitem").hide();const YA=new wp({load:function(){return window.localStorage.cmosRam?JSON.parse(window.localStorage.cmosRam):null},save:function(i){window.localStorage.cmosRam=JSON.stringify(i)}},Ns.cmosOverride,Rh);let Kr=null,Ic=null;function XA(){Kr&&!Kr.closed||(Kr=window.open("","_blank","height=300,width=400"),Kr.document.write('<textarea id="text" rows="15" cols="40" placeholder="Printer outputs here..."></textarea>'),Ic=Kr.document.getElementById("text"),tt.uservia.setca1(!0))}tt=new vp(Ns,Rr,Dr,hi.soundChip,hi.ddNoise,Ns.hasMusic5000?hi.music5000:null,YA,Lh,Rh);const ZA=new PA(Lh.getGamepads),es=new IA;es.setErrorCallback(i=>{Bh("accessing microphone",i)});const QA=document.getElementById("screen"),is=new OA(QA);function lm(i,t){for(let e=0;e<4;e++)tt.adconverter.setChannelSource(e,ZA);i?(tt.adconverter.setChannelSource(0,is),tt.adconverter.setChannelSource(1,is),is.setVia(tt.sysvia)):is.setVia(null),t!==void 0&&tt.adconverter.setChannelSource(t,es)}async function Oc(){if(es.audioContext&&es.audioContext.state!=="running")try{await es.audioContext.resume(),console.log("Microphone: Audio context resumed, new state:",es.audioContext.state)}catch(i){return console.error("Microphone: Error resuming audio context:",i),!1}return!0}async function um(){const i=F("#micPermissionStatus");if(i.text("Requesting microphone access..."),await es.initialise()){i.text("Microphone connected successfully"),await Oc();const e=async()=>{await Oc()&&document.removeEventListener("click",e)};document.addEventListener("click",e)}else i.text(`Error: ${es.getErrorMessage()||"Unknown error"}`),fi.setMicrophoneChannel(void 0),delete et.microphoneChannel,os()}et.microphoneChannel!==void 0&&setTimeout(async()=>{await um()},1e3);lm(et.mouseJoystickEnabled,et.microphoneChannel);Ht=new LA({processor:tt,inputEnabledFunction:()=>et.embed!==void 0?document.activeElement&&(document.activeElement.id==="screen"||document.activeElement.id==="paste-text"||document.activeElement.tagName==="CANVAS"):document.activeElement&&document.activeElement.id==="paste-text",keyLayout:$a,dbgr:Rr});Ht.on("showError",({context:i,error:t})=>Bh(i,t));Ht.on("pause",()=>$i(!1));Ht.on("resume",()=>Ir());Ht.on("break",i=>{i&&Yt("keyboard","press","break")});Ht.registerKeyHandler(k.S,i=>{i&&(Yt("keyboard","press","S"),$i(!0))},{alt:!0,ctrl:!1});Ht.registerKeyHandler(k.R,i=>{i&&window.location.reload()},{alt:!0,ctrl:!1});Ht.registerKeyHandler(k.HOME,i=>{i&&(Yt("keyboard","press","home"),$i(!0))},{alt:!1,ctrl:!0});Ht.registerKeyHandler(k.INSERT,i=>{i&&(Yt("keyboard","press","insert"),Lc=!Lc)},{alt:!1,ctrl:!0});Ht.registerKeyHandler(k.END,i=>{i&&(Yt("keyboard","press","end"),Ht.pauseEmulation())},{alt:!1,ctrl:!0});Ht.registerKeyHandler(k.B,i=>{i&&XA()},{alt:!1,ctrl:!0});document.onkeydown=i=>{hi.tryResume().then(()=>{}),Oc().then(()=>{}),Ht.keyDown(i)};document.onkeypress=i=>Ht.keyPress(i);document.onkeyup=i=>Ht.keyUp(i);function Ha(i){delete et.disc,et.disc1=i,os()}function Nh(){F("#sth-list li:not(.template)").remove()}function fm(){const i=F("#sth .loading");i.text("Loading catalog from STH archive"),i.show(),Nh()}async function JA(i){Yt("sth","click",i),Ha("sth:"+i);const t=et.autoboot!==void 0;t&&tt.reset(!0),pn("Loading "+i);try{const e=await dn(et.disc1);tt.fdc.loadDisc(0,e),cs(),t&&mm(i)}catch(e){console.error("Error loading disc image:",e),cs(e)}}async function tk(i){Yt("sth","clickTape",i),et.tape="sth:"+i,os(),pn("Loading "+i);try{const t=await _m(et.tape);tt.acia.setTape(t),cs()}catch(t){console.error("Error loading tape image:",t),cs(t)}}const ek=new be(document.getElementById("sth"));function dm(i){return function(t){Nh();const e=F("#sth-list");F("#sth .loading").hide();const s=e.find(".template");function r(a){const m=a.slice(0,100),d=a.slice(100),p=F("#sth-filter").val();F.each(m,function(b,w){const C=s.clone().removeClass("template").appendTo(e);C.find(".name").text(w),F(C).on("click",function(){i(w),ek.hide()}),C.toggle(w.toLowerCase().indexOf(p)>=0)}),a.length&&qe.delay(r,30,d)}r(t)}}function pm(){const i=F("#sth .loading");i.text("There was an error accessing the STH archive"),i.show(),Nh()}Th=new Sp(fm,dm(JA),pm,!1);Dh=new Sp(fm,dm(tk),pm,!0);const Aa=F("#sth .autoboot");Aa.click(function(){Aa.prop("checked")?et.autoboot="":delete et.autoboot,os()});F(document).on("click","a.sth",function(){const i=F(this).data("id");i==="discs"?Th.populate():i==="tapes"?Dh.populate():console.log("unknown id",i)});function ik(i){i=i.toLowerCase(),F("#sth-list li:not(.template)").each(function(){const t=F(this);t.toggle(t.text().toLowerCase().indexOf(i)>=0)})}F("#sth-filter").on("change keyup",function(){ik(F("#sth-filter").val())});function Lr(i,t){Ht?Ht.sendRawKeyboardToBBC(i,t):console.warn("Tried to send keys before keyboard was initialised")}function mm(i){const t=A;console.log("Autobooting disc"),Yt("init","autoboot",i),Lr([t.SHIFT,1e3],!1)}function sk(i){console.log("Auto typing '"+i+"'"),Yt("init","autochain");const t=En(i);Lr([1e3].concat(t),!1)}function rk(){console.log("Auto Chaining Tape"),Yt("init","autochain");const i=En(`*TAPE
CH.""
`);Lr([1e3].concat(i),!1)}function nk(){console.log("Auto Running Tape"),Yt("init","autorun");const i=En(`*TAPE
*/
`);Lr([1e3].concat(i),!1)}function ak(){console.log("Auto Running basic"),Yt("init","autorunbasic");const i=En(`RUN
`);Lr([1e3].concat(i),!1)}function os(){const i=window.location.origin+window.location.pathname,t=NA(i,et,Xp);window.history.pushState(null,null,t)}const Mc=F("#error-dialog"),ok=new be(Mc[0]);function Bh(i,t){Mc.find(".context").text(i),Mc.find(".error").text(t),ok.show()}function gm(i){const t=i.match(/(([^:]+):\/?\/?|[!^|])?(.*)/),e=t[2]||t[1]||"";return i=t[3],{image:i,schema:e}}async function dn(i){if(!i)return null;const t=gm(i);i=t.image;const e=t.schema;if(e[0]==="!"||e==="local")return Ip(tt.fdc,i);switch(e){case"|":case"sth":return Ii(tt.fdc,i,await Th.fetch(i));case"gd":{const s=i.match(/([^/]+)\/?(.*)/);let r="(unknown)";return s&&(i=s[1],r=s[2]),Cm({name:r,id:i})}case"b64data":return Ii(tt.fdc,"disk.ssd",atob(i));case"data":{const s=Array.prototype.map.call(atob(i),c=>c.charCodeAt(0)),{name:r,data:a}=ln(s);return Ii(tt.fdc,r,a)}case"http":case"https":case"file":{const s=`${e}://${i}`;i=new URL(s).pathname;let r=await Ze(s);if(/\.zip/i.test(i)){const a=ln(r);r=a.data,i=a.name}return Ii(tt.fdc,i,r)}default:return Ii(tt.fdc,i,await Rp("discs/"+i))}}async function _m(i){const t=gm(i);i=t.image;const e=t.schema;switch(e){case"|":case"sth":return en(i,await Dh.fetch(i));case"data":{const s=Array.prototype.map.call(atob(i),c=>c.charCodeAt(0)),{name:r,data:a}=ln(s);return en(r,a)}case"http":case"https":{const s=`${e}://${i}`;i=new URL(s).pathname;let r=await Ze(s);if(/\.zip/i.test(i)){const a=ln(r);r=a.data,i=a.name}return en(i,r)}default:return await AE("tapes/"+i)}}F("#disc_load").on("change",async function(i){if(i.target.files.length===0)return;Yt("local","click");const t=i.target.files[0];await om(t),i.target.value=""});F("#fs_load").on("change",async function(i){if(i.target.files.length===0)return;Yt("local","click");const t=i.target.files[0];await jA(t),i.target.value=""});F("#tape_load").on("change",async function(i){if(i.target.files.length===0)return;const t=i.target.files[0];Yt("local","clickTape");const e=await Ih(t);tt.acia.setTape(en("local file",e)),delete et.tape,os(),F("#tapes").modal("hide"),i.target.value=""});function xm(){return F(".modal:visible").length!==0}let bm=!1;document.addEventListener("show.bs.modal",function(){xm()||(bm=li),li&&$i(!1)});document.addEventListener("hidden.bs.modal",function(){!xm()&&bm&&Ir()});const Fh=F("#loading-dialog"),pa=new be(Fh[0]);function pn(i){Fh.find(".loading").text(i),F("#google-drive-auth").hide(),pa.show()}function cs(i){F("#google-drive-auth").hide(),i?(pa.show(),Fh.find(".loading").text("Error: "+i),setTimeout(function(){pa.hide()},5e3)):pa.hide()}const yr=new LE;async function za(i){try{return await yr.authorize(i)}catch(t){console.log("Error handling google auth: "+t),Es.find(".loading").text("There was an error accessing your Google Drive account: "+t)}}let ym,vm;F("#google-drive-auth form").on("submit",async function(i){F("#google-drive-auth").hide(),i.preventDefault(),await za(!1)?ym():vm(new Error("Unable to authorize Google Drive"))});async function Cm(i){pn("Loading '"+i.name+"' from Google Drive");try{const t=await yr.initialise();if(console.log("Google Drive available =",t),!t)throw new Error("Google Drive is not available");const e=await za(!0);console.log("Google Drive authed=",e),e||await new Promise(function(r,a){ym=r,vm=a,F("#google-drive-auth").show()});const s=await yr.load(tt.fdc,i.id);return console.log("Google Drive loading finished"),cs(),s}catch(t){console.error("Google Drive loading error:",t),cs(t)}}F(".if-drive-available").hide();(async()=>await yr.initialise()&&(F(".if-drive-available").show(),await za(!0)))();const Es=F("#google-drive"),Uh=new be(Es[0]);F("#open-drive-link").on("click",async function(){return await za(!1)&&Uh.show(),!1});Es[0].addEventListener("show.bs.modal",async function(){Es.find(".loading").text("Loading...").show(),Es.find("li").not(".template").remove();const i=await yr.listFiles(),t=Es.find(".list");Es.find(".loading").hide();const e=t.find(".template");F.each(i,function(s,r){const a=e.clone().removeClass("template").appendTo(t);a.find(".name").text(r.name),F(a).on("click",function(){Yt("google-drive","click",r.name),Ha(`gd:${r.id}/${r.name}`),Cm(r).then(function(c){tt.fdc.loadDisc(0,c)}),Uh.hide()})})});const wm=F("#disc-list"),ck=wm.find(".template");F.each(jp,function(i,t){const e=ck.clone().removeClass("template").appendTo(wm);e.find(".name").text(t.name),e.find(".description").text(t.desc),F(e).on("click",function(){Yt("images","click",t.file),Ha(t.file),dn(et.disc1).then(function(s){tt.fdc.loadDisc(0,s)}),nm.hide()})});F("#google-drive form").on("submit",async function(i){i.preventDefault();let t=F("#google-drive .disc-name").val();if(!t)return;pn("Connecting to Google Drive"),Uh.hide(),pn("Creating '"+t+"' on Google Drive");let e;if(F("#google-drive .create-from-existing").prop("checked")){const s=un(t);e=s.saver(tt.fdc.drives[0].disc),t=am(t,s.extension),console.log(`Saving existing disc: ${t}`)}else{const s=un(t);if(!s.byteSize)throw new Error(`Cannot create blank disc of type ${s.extension} - unknown size`);e=new Uint8Array(s.byteSize),s.supportsCatalogue&&s.setDiscName(e,t),console.log(`Creating blank: ${t}`)}try{const s=await yr.create(tt.fdc,t,e);Ha("gd:"+s.fileId+"/"+t),tt.fdc.loadDisc(0,s.disc),cs()}catch(s){console.error(`Error creating Google Drive disc: ${s}`,s),cs(`Create failed: ${s}`)}});F("#download-drive-link").on("click",function(){const i=tt.fdc.drives[0].disc,t=yh(i),e=i.name,s=i.isDoubleSided?".dsd":".ssd";Oh(t,e,s)});F("#download-drive-hfe-link").on("click",function(){const i=tt.fdc.drives[0].disc,t=wh(i),e=i.name;Oh(t,e,".hfe")});F("#download-filestore-link").on("click",function(){Oh(tt.filestore.scsi,"scsi",".dat")});F("#hard-reset").click(function(i){tt.reset(!0),i.preventDefault()});F("#soft-reset").click(function(i){tt.reset(!1),i.preventDefault()});F("#tape-menu a").on("click",function(i){const t=F(i.target).attr("data-id");t!==void 0&&(t==="rewind"?(console.log("Rewinding tape to the start"),tt.acia.rewindTape()):console.log("unknown type",t))});function Pr(i){const t=F("#"+i);let e=!1;this.update=function(s){s!==e&&(e=s,t.toggleClass("on",e))}}const hk=new Pr("motorlight"),lk=new Pr("capslight"),uk=new Pr("shiftlight"),fk=new Pr("drive0"),dk=new Pr("drive1"),pk=new Pr("networklight");Kp=function(){lk.update(tt.sysvia.capsLockLight),uk.update(tt.sysvia.shiftLockLight),fk.update(tt.fdc.motorOn[0]),dk.update(tt.fdc.motorOn[1]),hk.update(tt.acia.motorOn),Ns.hasEconet&&pk.update(tt.econet.activityLight())};const mk=(async()=>{await Promise.all([hi.initialise(),tt.initialise()]);const i=[];Sa&&i.push((async()=>{const e=await dn(Sa);tt.fdc.loadDisc(0,e)})()),Dc&&i.push((async()=>{const e=await dn(Dc);tt.fdc.loadDisc(1,e)})()),et.tape&&i.push((async()=>{const e=await _m(et.tape);tt.acia.setTape(e)})());async function t(e,s){const r=(async()=>{const a=await e,h=await(await dA()).tokenise(a),m=tt.model.isMaster?59366:58753,d=tt.debugInstruction.add(function(p){if(p!==m)return;const b=tt.readmem(24)<<8;for(let R=0;R<h.length;++R)tt.writemem(b+R,h.charCodeAt(R));const w=b+h.length,C=w&255,y=w>>>8&255;tt.writemem(2,C),tt.writemem(3,y),tt.writemem(18,C),tt.writemem(19,y),d.remove(),s&&ak()});return h})();return i.push(r),r}if(et.loadBasic){const e=Rc==="run";Rc="",await t((async()=>{const s=await Ze(et.loadBasic);return String.fromCharCode.apply(null,s)})(),e)}return et.embedBasic&&await t(Promise.resolve(et.embedBasic),!0),Promise.all(i)})();mk.then(()=>{switch(Rc){case"boot":Aa.prop("checked",!0),mm(Sa);break;case"type":sk(zA);break;case"chain":rk();break;case"run":nk();break;default:Aa.prop("checked",!1);break}et.patch&&Rr.setPatch(et.patch),Ir()}).catch(i=>{console.error("Error initialising emulator:",i),Bh("initialising",i)});const Xr=F("#are-you-sure"),H0=new be(Xr[0]);function gk(i,t,e,s){Xr.find(".context").text(i),Xr.find(".ays-yes").text(t),Xr.find(".ays-no").text(e),Xr.find(".ays-yes").one("click",function(){H0.hide(),s()}),H0.show()}function Sm(i){i=i||10*1e3*1e3;const t=ss;ss=1e6;const e=performance.now();tt.execute(i);const s=performance.now();ss=t;const r=s-e,a=i/r/1e3;console.log("Took "+r+"ms to execute "+i+" cycles"),console.log("Virtual "+a.toFixed(2)+"MHz")}function Em(i){i=i||10*1e3*1e3;const t=ss;ss=1e6;const e=performance.now();Dr.polltime(i);const s=performance.now();ss=t;const r=s-e,a=i/r/1e3;console.log("Took "+r+"ms to execute "+i+" video cycles"),console.log("Virtual "+a.toFixed(2)+"MHz")}function _k(i){console.profile("CPU"),Sm(i),console.profileEnd()}function xk(i){console.profile("Video"),Em(i),console.profileEnd()}let aa=0;function bk(){this.cycles=0,this.time=0,this.v=F(".virtualMHz"),this.header=F("#virtual-mhz-header"),this.speedy=!1,this.update=function(i,t,e){this.cycles+=i,this.time+=t,this.speedy=e},this.display=function(){if(this.cycles){const i=this.cycles/this.time/1e3;this.v.text(i.toFixed(1)),this.cycles>=10*2*1e3*1e3&&(this.cycles=this.time=0),this.header.css("color",this.speedy?"red":"white")}setTimeout(this.display.bind(this),3333)},this.display()}const yk=new bk;function Nc(i){if(!li){aa=0;return}i===void 0&&(i=window.performance.now());const t=tt.acia.motorOn,e=tt.fdc.motorOn[0]||tt.fdc.motorOn[1],s=Lc||Zp&&t,r=s||t||e,a=s?0:1e3/50;if(Dr.frameSkipCount=s?9:0,r?window.setTimeout(Nc,a):window.requestAnimationFrame(Nc),hi.soundChip.catchUp(),qp.update(tt.sysvia),Kp(),aa!==0){let c;s?c=Pc/50:(c=(i-aa)*Pc/1e3,c=Math.min(c,KA)),c|=0;try{tt.execute(c)||$i(!0);const h=performance.now();yk.update(c,h-i,s)}catch(h){throw li=!1,Yt("exception","thrown",h.stack),Rr.debug(tt.pc),h}Ht.postFrameShouldPause()&&$i(!1)}aa=i}function vk(){window.requestAnimationFrame(Nc)}let z0=!1;function Ck(){if(document.visibilityState==="hidden"){z0=li;const i=tt.acia.motorOn||tt.fdc.motorOn[0]||tt.fdc.motorOn[1];li&&!i&&$i(!1)}else z0&&Ir()}document.addEventListener("visibilitychange",Ck,!1);function Am(){hm.attr("disabled",li),cm.attr("disabled",!li)}function Ir(){hi.unmute(),li=!0,Ht.setRunning(!0),Am(),vk()}function $i(i){li=!1,Ht.setRunning(!1),tt.stop(),i&&Rr.debug(tt.pc),hi.mute(),Am()}(function(){const i=F("#cub-monitor"),t=F("#cub-monitor-pic"),e=t.attr("height"),s=t.attr("width"),r=Bi.attr("height")/e,a=Bi.attr("width")/s,c=s/e,h=s/4,m=e/4,d=et.embed!==void 0?0:100,p=et.embed!==void 0?0:68;et.embed!==void 0&&(F("#header-bar").hide(),F("#cub-monitor-pic").hide(),F(".sidebar").hide(),F("#leds").hide(),F("#audio-stats").hide());function b(){let w=F("#header-bar").outerHeight(),C=Math.max(h,window.innerWidth-d*2),y=Math.max(m,window.innerHeight-w-p);C/y<=c?y=C/c:C=y*c,i.height(y).width(C),t.height(y).width(C),Bi.height(y*r).width(C*a)}window.onresize=b,window.setTimeout(b,1),window.setTimeout(b,500)})();const wk=new be(document.getElementById("info")),Sk=new be(document.getElementById("pp-tos"));Object.hasOwn(et,"about")&&wk.show();Object.hasOwn(et,"pp-tos")&&Sk.show();window.benchmarkCpu=qe.debounce(Sm,1);window.profileCpu=qe.debounce(_k,1);window.benchmarkVideo=qe.debounce(Em,1);window.profileVideo=qe.debounce(xk,1);window.go=Ir;window.stop=$i;window.soundChip=hi.soundChip;window.processor=tt;window.video=Dr;window.disc=vE;window.hd=function(i,t){console.log(fp(function(e){return tt.readmem(e)},i,t))};window.m7dump=function(){console.log(fp(function(i){return tt.readmem(i)&127},31744,32744,{width:40,gap:!1}))};Vp({loadDiscImage:dn,processor:tt});
//# sourceMappingURL=index-Ck2lnw7K.js.map
