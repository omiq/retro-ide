{
  "version": 3,
  "sources": ["../src/platform/apple2e.ts"],
  "sourcesContent": ["import { Platform, Preset } from '../common/baseplatform';\nimport { PLATFORMS } from '../common/emu';\n\nconst APPLE2E_PRESETS: Preset[] = [\n  { id: 'hello.bas', name: 'Hello World (BASIC)', category: 'BASIC Tutorial' },\n  { id: 'colors.bas', name: 'Color Demo (BASIC)' },\n  { id: 'graphics.bas', name: 'Graphics Demo (BASIC)' },\n  { id: 'keyboard.bas', name: 'Keyboard Demo (BASIC)' },\n  { id: 'game.bas', name: 'Simple Game (BASIC)' },\n];\n\nexport class Apple2EPlatform implements Platform {\n  private mainElement: HTMLElement;\n  private iframe: HTMLIFrameElement | null = null;\n  private emulatorReady = false;\n  private lastLoadedProgram: string | null = null;\n  private isLoadingProgram = false;\n  private currentDiskBlob: Blob | null = null; // Store the disk image for download\n  private currentBinaryBlob: Blob | null = null; // Store the compiled binary for download\n\n  constructor(mainElement: HTMLElement) {\n    this.mainElement = mainElement;\n    \n    // Listen for messages from iframe\n    window.addEventListener('message', (event) => {\n      if (event.data && event.data.type === 'apple2e_ready') {\n        console.log('Apple2EPlatform: Emulator ready');\n        this.emulatorReady = true;\n        \n        // Small delay to ensure emulator is fully initialized before accepting ROM loads\n        // This helps prevent race conditions when files are switched quickly\n        setTimeout(() => {\n          console.log('Apple2EPlatform: Emulator fully ready, can accept ROM loads');\n        }, 200);\n      } else if (event.data && event.data.type === 'apple2e_error') {\n        console.error('Apple2EPlatform: Emulator error:', event.data.error);\n        this.emulatorReady = false;\n      }\n    });\n  }\n\n  getName(): string {\n    return 'Apple IIe';\n  }\n\n  getDescription(): string {\n    return 'Apple IIe - 6502-based personal computer';\n  }\n\n  async init(): Promise<void> {\n    console.log('Apple2EPlatform init() called');\n  }\n\n  start(): void {\n    console.log('Apple2EPlatform start() called');\n    \n    // Create iframe for Apple IIe emulator\n    this.iframe = document.createElement('iframe');\n    this.iframe.id = 'apple2e-iframe';\n    this.iframe.style.width = '100%';\n    this.iframe.style.height = '600px';\n    this.iframe.style.border = '1px solid #ccc';\n    this.iframe.style.backgroundColor = '#000';\n    this.iframe.setAttribute('tabindex', '0'); // Make iframe focusable\n    // Note: 'pointer-events' is not a valid iframe allow attribute, but we handle events in the iframe itself\n    \n    // Don't add any event listeners to the iframe from parent\n    // The iframe should handle all its own events\n    // Cross-origin restrictions might prevent access anyway\n    console.log('Apple2EPlatform: Iframe will handle its own events');\n    \n    // Prevent the IDE from pausing when clicking on the iframe\n    // The iframe should handle its own focus without triggering IDE pause/resume\n    this.iframe.addEventListener('focus', (e) => {\n      // Don't let iframe focus trigger IDE pause\n      e.stopPropagation();\n    }, true);\n    \n    this.iframe.addEventListener('click', (e) => {\n      // Don't let iframe clicks trigger IDE pause\n      e.stopPropagation();\n    }, true);\n    \n    // Add iframe to the main element\n    this.mainElement.innerHTML = '';\n    this.mainElement.appendChild(this.iframe);\n    \n    // Load iframe with cache busting\n    const cacheBuster = `?t=${Date.now()}`;\n    this.iframe.src = `apple2e-iframe.html${cacheBuster}`;\n    \n    // CRITICAL: Don't intercept clicks on the iframe at all\n    // Remove any event listeners that might block clicks\n    // The iframe needs to handle its own clicks completely\n    \n    // Ensure iframe container doesn't block pointer events\n    this.mainElement.style.pointerEvents = 'auto';\n    this.mainElement.style.userSelect = 'none';\n    \n    // Ensure iframe itself can receive clicks\n    this.iframe.style.pointerEvents = 'auto';\n    this.iframe.style.border = '1px solid #ccc';\n    \n    // Don't add any click handlers on the parent - let iframe handle everything\n    console.log('Apple2EPlatform: Iframe created, clicks should pass through to iframe');\n    \n    // Load the iframe\n    this.iframe.src = 'apple2e-iframe.html';\n    \n    console.log('Apple2EPlatform: iframe created and loading');\n    \n    // Reset emulator when it becomes ready (ensures clean BASIC prompt on page load)\n    const checkReady = setInterval(() => {\n      if (this.emulatorReady && this.iframe && this.iframe.contentWindow) {\n        clearInterval(checkReady);\n        // Auto-reset when platform starts to ensure clean state\n        console.log('Apple2EPlatform: Auto-resetting emulator on start for clean BASIC prompt');\n        this.reset();\n      }\n    }, 100);\n    \n    // Timeout after 10 seconds\n    setTimeout(() => clearInterval(checkReady), 10000);\n  }\n\n  stop(): void {\n    console.log('Apple2EPlatform stop() called');\n    if (this.iframe && this.iframe.contentWindow) {\n      this.iframe.contentWindow.postMessage({ type: 'stop' }, '*');\n    }\n  }\n\n  reset(): void {\n    console.log('Apple2EPlatform reset() called');\n    if (this.iframe && this.iframe.contentWindow) {\n      this.iframe.contentWindow.postMessage({ type: 'reset' }, '*');\n    }\n  }\n\n  isRunning(): boolean {\n    return this.emulatorReady;\n  }\n\n  getToolForFilename(filename: string): string {\n    const lowerFilename = filename.toLowerCase();\n    if (lowerFilename.endsWith('.bas')) {\n      return 'applesoftbasic'; // Use AppleSoft BASIC compiler\n    }\n    if (lowerFilename.endsWith('.c') || lowerFilename.endsWith('.h')) {\n      return 'cc65'; // Use cc65 for C programs\n    }\n    return 'applesoftbasic'; // Default to BASIC\n  }\n\n  getDefaultExtension(): string {\n    return '.bas';\n  }\n\n  getPresets(): Preset[] {\n    return APPLE2E_PRESETS;\n  }\n  \n  getDownloadFile(): { extension: string, blob: Blob } | undefined {\n    // Return the binary file (for \"Download Program\")\n    console.log(`Apple2EPlatform: getDownloadFile() called, currentBinaryBlob:`, this.currentBinaryBlob ? `${this.currentBinaryBlob.size} bytes` : 'null');\n    if (this.currentBinaryBlob) {\n      return {\n        extension: '.bin',\n        blob: this.currentBinaryBlob\n      };\n    }\n    console.log('Apple2EPlatform: No binary blob available for download');\n    return undefined;\n  }\n\n  getDownloadDiskFile(): { extension: string, blob: Blob } | undefined {\n    // Return the disk image (for \"Download Disk\")\n    console.log(`Apple2EPlatform: getDownloadDiskFile() called, currentDiskBlob:`, this.currentDiskBlob ? `${this.currentDiskBlob.size} bytes` : 'null');\n    if (this.currentDiskBlob) {\n      return {\n        extension: '.dsk',\n        blob: this.currentDiskBlob\n      };\n    }\n    console.log('Apple2EPlatform: No disk blob available for download');\n    return undefined;\n  }\n\n  pause(): void {\n    console.log('Apple2EPlatform pause() called');\n    // Don't pause when clicking on the iframe - it handles its own events\n    // Only pause if explicitly requested (not from focus/click events)\n    if (this.iframe && this.iframe.contentWindow) {\n      // Don't send stop message - let iframe handle its own pause/resume\n      // this.iframe.contentWindow.postMessage({ type: 'stop' }, '*');\n    }\n  }\n  \n  break(): void {\n    console.log('Apple2EPlatform break() called (Ctrl+C / BRK)');\n    if (this.iframe && this.iframe.contentWindow) {\n      this.iframe.contentWindow.postMessage({ type: 'break' }, '*');\n    }\n  }\n\n  resume(): void {\n    console.log('Apple2EPlatform resume() called');\n    if (this.iframe && this.iframe.contentWindow) {\n      this.iframe.contentWindow.postMessage({ type: 'run' }, '*');\n    }\n    // Also ensure emulator is running via API if available\n    const api = this.getApple2API();\n    if (api && api.apple2 && !api.apple2.isRunning()) {\n      api.apple2.run();\n    }\n  }\n  \n  /**\n   * Get access to the apple2 API object from the iframe\n   * This allows you to use the API reference functions\n   * \n   * Usage:\n   * const api = platform.getApple2API();\n   * const apple2 = api.apple2;\n   * const io = api.getIO();\n   * io.setKeyBuffer(\"PRINT \\\"HELLO\\\"\\r\");\n   */\n  getApple2API(): any {\n    if (!this.iframe || !this.iframe.contentWindow) {\n      console.warn('Apple2EPlatform: iframe not available');\n      return null;\n    }\n    \n    try {\n      // Access the iframe's window object\n      const iframeWindow = this.iframe.contentWindow as any;\n      const platform = this; // Capture platform reference for closures\n      \n      if (!iframeWindow.apple2 && !iframeWindow.APPLE2_API) {\n        console.warn('Apple2EPlatform: apple2 API not available in iframe yet');\n        return null;\n      }\n      \n      // Return API wrapper that proxies to iframe\n      return {\n        // Direct access to apple2 instance\n        get apple2() {\n          return iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n        },\n        \n        // Direct access to Apple2 namespace object\n        get Apple2() {\n          return iframeWindow.Apple2 || iframeWindow.APPLE2_API?.Apple2;\n        },\n        \n        // Convenience methods\n        getIO: () => {\n          const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n          if (!apple2) {\n            console.error('Apple2EPlatform: Cannot getIO - emulator not available');\n            return null;\n          }\n          const io = apple2.getIO();\n          if (!io) {\n            console.error('Apple2EPlatform: getIO() returned null');\n            return null;\n          }\n          console.log('Apple2EPlatform: getIO() returned:', {\n            hasSetKeyBuffer: typeof io.setKeyBuffer === 'function',\n            hasKeyDown: typeof io.keyDown === 'function',\n            methods: Object.keys(io).filter(k => typeof io[k] === 'function')\n          });\n          return io;\n        },\n        \n        getCPU: () => {\n          const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n          return apple2 ? apple2.getCPU() : null;\n        },\n        \n        loadAjax: (drive: number, url: string) => {\n          const api = iframeWindow.APPLE2_API;\n          if (api && api.loadAjax) {\n            return api.loadAjax(drive, url);\n          } else if (iframeWindow.loadAjax) {\n            return iframeWindow.loadAjax(drive, url);\n          } else if (iframeWindow.Apple2 && typeof iframeWindow.Apple2.loadAjax === 'function') {\n            return iframeWindow.Apple2.loadAjax(drive, url);\n          } else {\n            console.error('Apple2EPlatform: loadAjax not available');\n            throw new Error('loadAjax not available');\n          }\n        },\n        \n        defaultLoadHttp: (url: string) => {\n          const api = iframeWindow.APPLE2_API;\n          if (api && api.defaultLoadHttp) {\n            return api.defaultLoadHttp(url);\n          } else if (iframeWindow.Apple2 && typeof iframeWindow.Apple2.defaultLoadHttp === 'function') {\n            return iframeWindow.Apple2.defaultLoadHttp(url);\n          } else if (typeof iframeWindow.defaultLoadHttp === 'function') {\n            return iframeWindow.defaultLoadHttp(url);\n          } else {\n            console.error('Apple2EPlatform: defaultLoadHttp not available');\n            throw new Error('defaultLoadHttp not available');\n          }\n        },\n        \n        // Helper to create a blob URL from disk data\n        createDiskBlobUrl: async (diskData?: Uint8Array | ArrayBuffer | number[], filename?: string): Promise<string> => {\n          // Get disk data from stored blob if not provided\n          if (!diskData && platform.currentDiskBlob) {\n            const blob = platform.currentDiskBlob;\n            const arrayBuffer = await blob.arrayBuffer();\n            diskData = new Uint8Array(arrayBuffer);\n          }\n          \n          if (!diskData) {\n            throw new Error('No disk data provided and no stored disk blob available. Provide diskData or load a program first.');\n          }\n          \n          let data: Uint8Array;\n          if (diskData instanceof Uint8Array) {\n            data = diskData;\n          } else if (diskData instanceof ArrayBuffer) {\n            data = new Uint8Array(diskData);\n          } else if (Array.isArray(diskData)) {\n            data = new Uint8Array(diskData);\n          } else {\n            throw new Error('Invalid disk data type. Expected Uint8Array, ArrayBuffer, or number[]');\n          }\n          \n          // Convert to base64 - build string in chunks to avoid stack overflow\n          // String.fromCharCode(...data) fails for large arrays, so we process in chunks\n          let binaryString = '';\n          const chunkSize = 8192; // Process 8KB at a time\n          for (let i = 0; i < data.length; i += chunkSize) {\n            const chunk = data.slice(i, i + chunkSize);\n            // Build string from chunk without spread operator\n            for (let j = 0; j < chunk.length; j++) {\n              binaryString += String.fromCharCode(chunk[j]);\n            }\n          }\n          const base64 = btoa(binaryString);\n          \n          // Get URL from serve_disk.php (has .dsk extension for doLoadHTTP)\n          const API_BASE_URL = 'https://ide.retrogamecoders.com';\n          const serveFilename = filename || 'disk.dsk';\n          \n          console.log(`Creating server URL for disk (${data.length} bytes)...`);\n          const response = await fetch(`${API_BASE_URL}/api/apple2/serve_disk.php`, {\n            method: 'POST',\n            mode: 'cors',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              disk: base64,\n              filename: serveFilename\n            })\n          });\n          \n          if (!response.ok) {\n            throw new Error(`Failed to create disk URL: ${response.status} ${response.statusText}`);\n          }\n          \n          const result = await response.json();\n          if (result.error) {\n            throw new Error(result.error);\n          }\n          \n          console.log(`Created server URL: ${result.url} (${data.length} bytes)`);\n          return result.url;\n        },\n        \n        // Get the current disk data as Uint8Array (from stored blob)\n        getCurrentDiskData: async (): Promise<Uint8Array | null> => {\n          // First, try to get from stored blob\n          if (platform.currentDiskBlob) {\n            const blob = platform.currentDiskBlob;\n            const arrayBuffer = await blob.arrayBuffer();\n            return new Uint8Array(arrayBuffer);\n          }\n          \n          // If no stored blob, try to get from iframe's drive state\n          try {\n            const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n            if (apple2) {\n              const io = apple2.getIO();\n              if (io) {\n                const disk2 = io.getSlot(6); // Slot 6 is Disk2\n                if (disk2 && disk2.drives && disk2.drives[1]) {\n                  const drive = disk2.drives[1];\n                  const disk = drive.disk;\n                  \n                  // Check if a disk is actually present (has encoding)\n                  if (disk && disk.encoding && disk.encoding !== 'empty') {\n                    // Try to get data as ArrayBuffer or Uint8Array\n                    let data: Uint8Array | null = null;\n                    \n                    // Check disk.data first\n                    if (disk.data instanceof ArrayBuffer) {\n                      data = new Uint8Array(disk.data);\n                    } else if (disk.data instanceof Uint8Array) {\n                      data = disk.data;\n                    } else if (disk._rawData instanceof ArrayBuffer) {\n                      data = new Uint8Array(disk._rawData);\n                    } else if (disk._rawData instanceof Uint8Array) {\n                      data = disk._rawData;\n                    } else if (disk._rawData && typeof disk._rawData === 'object') {\n                      // If _rawData is an object with numeric keys, convert it\n                      const keys = Object.keys(disk._rawData).map(k => parseInt(k)).filter(k => !isNaN(k));\n                      if (keys.length > 0) {\n                        const maxKey = Math.max(...keys);\n                        data = new Uint8Array(maxKey + 1);\n                        for (const key of keys) {\n                          data[key] = disk._rawData[key];\n                        }\n                      }\n                    }\n                    \n                    if (data && data.length > 0) {\n                      console.log(`Apple2EPlatform: Retrieved disk data from iframe drive (${data.length} bytes, encoding: ${disk.encoding})`);\n                      return data;\n                    } else {\n                      console.warn(`Apple2EPlatform: Disk found in drive (encoding: ${disk.encoding}) but no readable data available`);\n                    }\n                  }\n                }\n              }\n            }\n          } catch (error) {\n            console.warn('Apple2EPlatform: Could not get disk data from iframe:', error);\n          }\n          \n          // Provide helpful error message\n          console.warn('No disk blob stored and no disk found in iframe drive. Load a program (BASIC or compiled) to create a disk, or manually load a disk image.');\n          return null;\n        },\n        \n        setAcceleration: (enabled: boolean) => {\n          const api = iframeWindow.APPLE2_API;\n          if (api && api.setAcceleration) {\n            api.setAcceleration(enabled);\n          } else {\n            console.error('Apple2EPlatform: setAcceleration not available');\n          }\n        },\n        \n        getAcceleration: () => {\n          const api = iframeWindow.APPLE2_API;\n          if (api && api.getAcceleration) {\n            return api.getAcceleration();\n          }\n          return false;\n        },\n        \n        reset: () => {\n          const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n          if (!apple2) {\n            console.error('Apple2EPlatform: Cannot reset - emulator not available');\n            return false;\n          }\n          console.log('Apple2EPlatform: Resetting emulator (enters BASIC)...');\n          apple2.reset();\n          // Ensure it's running after reset\n          setTimeout(() => {\n            if (!apple2.isRunning()) {\n              console.log('Apple2EPlatform: Starting emulator after reset');\n              apple2.run();\n            }\n            console.log('Apple2EPlatform: Reset complete, BASIC prompt should be ready');\n          }, 100);\n          return true;\n        },\n        \n        run: () => {\n          const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n          if (apple2) apple2.run();\n        },\n        \n        stop: () => {\n          const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n          if (apple2) apple2.stop();\n        },\n        \n        isRunning: () => {\n          const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n          return apple2 ? apple2.isRunning() : false;\n        },\n        \n        // Type text into emulator\n        type: (text: string) => {\n          const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n          if (!apple2) {\n            console.error('Apple2EPlatform: Cannot type - emulator not available');\n            console.log('Available in iframe:', {\n              apple2: !!iframeWindow.apple2,\n              APPLE2_API: !!iframeWindow.APPLE2_API\n            });\n            return false;\n          }\n          \n          console.log('Apple2EPlatform: Typing text:', text.substring(0, 50));\n          console.log('Apple2EPlatform: Emulator running?', apple2.isRunning());\n          \n          const io = apple2.getIO();\n          if (!io) {\n            console.error('Apple2EPlatform: Cannot type - getIO() returned null');\n            return false;\n          }\n          \n          if (!io.setKeyBuffer) {\n            console.error('Apple2EPlatform: Cannot type - io.setKeyBuffer is not a function');\n            console.log('IO object:', Object.keys(io));\n            return false;\n          }\n          \n          // CRITICAL: Reset first to get to BASIC prompt\n          // The emulator must be reset before typing, which puts it into BASIC\n          // This is especially important if a previous program is still running\n          console.log('Apple2EPlatform: Resetting emulator to enter BASIC...');\n          apple2.reset();\n          \n          // Ensure emulator is running after reset\n          if (!apple2.isRunning()) {\n            console.log('Apple2EPlatform: Starting emulator after reset...');\n            apple2.run();\n          }\n          \n          // Wait for reset to complete and BASIC prompt to be ready\n          // Apple II needs time to boot into BASIC after reset\n          console.log('Apple2EPlatform: Waiting for BASIC prompt...');\n          setTimeout(() => {\n            sendTextToEmulator(io, text);\n          }, 1200);\n          \n          // Helper function to send text using setKeyBuffer (the working method)\n          function sendTextToEmulator(io: any, text: string) {\n            console.log('Apple2EPlatform: Sending text:', JSON.stringify(text.substring(0, 80)));\n            \n            // CRITICAL: Focus the canvas in the iframe for keyboard input\n            // This is essential for iframe-based emulators - keyboard input requires focus\n            try {\n              const iframeDoc = iframeWindow.document;\n              const canvas = iframeDoc.querySelector('#screen');\n              if (canvas && (canvas as HTMLElement).focus) {\n                (canvas as HTMLElement).focus();\n                console.log('Apple2EPlatform: Focused canvas in iframe for keyboard input');\n              }\n            } catch (e) {\n              console.warn('Apple2EPlatform: Could not focus canvas (cross-origin?):', e);\n            }\n            \n            // Format text correctly: ensure it starts with \\r and ends with RUN\\r if it's a program\n            let formattedText = text;\n            \n            // If text contains line numbers (BASIC program), format it properly\n            if (/^\\d+\\s/.test(text.trim())) {\n              // It's a BASIC program - format it correctly\n              formattedText = text.replace(/\\r\\n/g, '\\r').replace(/\\n/g, '\\r');\n              \n              // Add leading \\r to ensure fresh prompt\n              if (!formattedText.startsWith('\\r')) {\n                formattedText = '\\r' + formattedText;\n              }\n              \n              // Ensure it ends with \\r\n              if (!formattedText.endsWith('\\r')) {\n                formattedText += '\\r';\n              }\n              \n              // Add RUN\\r at the end to execute\n              formattedText += 'RUN\\r';\n              \n              console.log('Apple2EPlatform: Formatted BASIC program:', JSON.stringify(formattedText.substring(0, 100)));\n            }\n            \n            // Use setKeyBuffer (this is the method that works!)\n            // Small delay to ensure focus is set\n            setTimeout(() => {\n              try {\n                io.setKeyBuffer(formattedText);\n                console.log('Apple2EPlatform: \u2705 setKeyBuffer called with formatted text');\n                console.log('Apple2EPlatform: Program sent to emulator');\n                \n                // Reset after sending program to ensure clean state for next load\n                // This helps with race conditions when switching files quickly\n                setTimeout(() => {\n                  const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n                  if (apple2) {\n                    console.log('Apple2EPlatform: Resetting emulator after program sent (for clean state)...');\n                    apple2.reset();\n                    if (!apple2.isRunning()) {\n                      apple2.run();\n                    }\n                    console.log('Apple2EPlatform: Reset complete, ready for next program');\n                    \n                    // Clear the last loaded program hash so we can load the same program again if needed\n                    // (but only after reset completes)\n                    setTimeout(() => {\n                      this.lastLoadedProgram = null;\n                    }, 500);\n                  }\n                }, 500);\n              } catch (e) {\n                console.error('Apple2EPlatform: setKeyBuffer failed:', e);\n              }\n            }, 100);\n          }\n          \n          \n          return true;\n        },\n        \n        // Get video modes\n        getVideoModes: () => {\n          const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n          return apple2 ? apple2.getVideoModes() : null;\n        },\n        \n        // Get stats\n        getStats: () => {\n          const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n          return apple2 ? apple2.getStats() : null;\n        },\n        \n        // Break/interrupt a running BASIC program (Ctrl+C / BRK)\n        // On Apple II, Ctrl+C sends BRK (0x03) which interrupts running programs\n        break: () => {\n          const apple2 = iframeWindow.apple2 || iframeWindow.APPLE2_API?.apple2;\n          if (!apple2) {\n            console.error('Apple2EPlatform: Cannot break - emulator not available');\n            return false;\n          }\n          \n          // Send break command via postMessage so iframe can handle focus\n          if (this.iframe && this.iframe.contentWindow) {\n            console.log('Apple2EPlatform: Sending break command to iframe (will handle focus)');\n            this.iframe.contentWindow.postMessage({ type: 'break' }, '*');\n            return true;\n          }\n          \n          // Fallback: try direct access (but focus might not work)\n          const io = apple2.getIO();\n          if (!io) {\n            console.error('Apple2EPlatform: Cannot break - getIO() returned null');\n            return false;\n          }\n          \n          console.log('Apple2EPlatform: Sending BRK (Ctrl+C) to interrupt program...');\n          // Send BRK character (0x03) - this is Ctrl+C on Apple II\n          // This will interrupt/break out of a running BASIC program\n          try {\n            io.keyDown(0x03); // BRK character (Ctrl+C)\n            setTimeout(() => {\n              if (io.keyUp) io.keyUp();\n            }, 50);\n            console.log('Apple2EPlatform: \u2705 BRK sent');\n            return true;\n          } catch (e) {\n            console.error('Apple2EPlatform: Error sending BRK:', e);\n            return false;\n          }\n        }\n      };\n    } catch (e) {\n      console.error('Apple2EPlatform: Error accessing iframe API:', e);\n      return null;\n    }\n  }\n\n  loadROM(title: string, rom: Uint8Array): void {\n    console.log('Apple2EPlatform loadROM() called', { title, romLength: rom?.length });\n    if (!rom || rom.length === 0) {\n      console.warn('Apple2EPlatform: No ROM data provided');\n      return;\n    }\n    \n    // Store the binary blob for download\n    // Create a copy of the Uint8Array to ensure it's a proper ArrayBuffer\n    const romCopy = new Uint8Array(rom);\n    this.currentBinaryBlob = new Blob([romCopy], { type: 'application/octet-stream' });\n    console.log(`Apple2EPlatform: Binary blob stored for download: ${this.currentBinaryBlob.size} bytes`);\n    \n    // Detect if this is a compiled binary (C program) or BASIC text\n    // Compiled binaries are typically > 100 bytes and don't decode to valid ASCII BASIC\n    const isBinary = this.isCompiledBinary(rom);\n    \n    if (isBinary) {\n      console.log('Apple2EPlatform: Detected compiled binary, creating bootable disk image');\n      // For compiled binaries, create a bootable disk image and load via doLoadHTTP\n      // This ensures the program loads reliably and can be reloaded when code changes\n      this.loadCompiledProgram(title, rom).catch(err => {\n        console.error('Apple2EPlatform: Error loading compiled program:', err);\n      });\n    } else {\n      console.log('Apple2EPlatform: Detected BASIC program, creating disk image');\n      // For BASIC programs, create a disk with the BASIC program using AppleCommander\n      this.loadBasicProgram(title, rom).catch(err => {\n        console.error('Apple2EPlatform: Error loading BASIC program:', err);\n      });\n    }\n  }\n  \n  private isCompiledBinary(data: Uint8Array): boolean {\n    // Check if data is likely a compiled binary:\n    // 1. Size > 100 bytes (BASIC programs are usually smaller when encoded)\n    // 2. Contains null bytes or non-printable characters\n    // 3. Doesn't start with line numbers (BASIC programs start with \"10 \", \"20 \", etc.)\n    if (data.length < 100) {\n      // Small files are likely BASIC\n      return false;\n    }\n    \n    // Try to decode as text\n    let text: string;\n    try {\n      text = new TextDecoder('utf-8', { fatal: false }).decode(data);\n    } catch (e) {\n      // If decoding fails, it's likely binary\n      return true;\n    }\n    \n    // Check if it looks like BASIC (starts with line numbers)\n    const trimmed = text.trim();\n    if (/^\\d+\\s/.test(trimmed)) {\n      // Starts with a line number, likely BASIC\n      return false;\n    }\n    \n    // Check for high percentage of non-printable characters\n    let nonPrintable = 0;\n    for (let i = 0; i < Math.min(data.length, 1000); i++) {\n      if (data[i] < 0x20 && data[i] !== 0x0A && data[i] !== 0x0D && data[i] !== 0x09) {\n        nonPrintable++;\n      }\n    }\n    \n    // If more than 10% are non-printable (excluding common whitespace), it's likely binary\n    return nonPrintable > (Math.min(data.length, 1000) * 0.1);\n  }\n  \n  private createAppleIIDiskImage(programData: Uint8Array, filename: string, loadAddress: number, runAddress: number): Uint8Array {\n    // Apple II DOS 3.3 disk format:\n    // - 35 tracks\n    // - 16 sectors per track\n    // - 256 bytes per sector\n    // - Total: 35 * 16 * 256 = 143,360 bytes\n    \n    const TRACKS = 35;\n    const SECTORS_PER_TRACK = 16;\n    const BYTES_PER_SECTOR = 256;\n    const DISK_SIZE = TRACKS * SECTORS_PER_TRACK * BYTES_PER_SECTOR;\n    \n    const disk = new Uint8Array(DISK_SIZE);\n    disk.fill(0);\n    \n    // Helper to write data at a specific address\n    const write = (address: number, data: string | number | Uint8Array, length?: number) => {\n      if (typeof data === 'string') {\n        for (let i = 0; i < data.length && (address + i) < disk.length; i++) {\n          disk[address + i] = data.charCodeAt(i) & 0xff;\n        }\n      } else if (typeof data === 'number') {\n        const len = length || 1;\n        for (let b = 0; b < len && (address + b) < disk.length; b++) {\n          disk[address + b] = (data >> (b * 8)) & 0xff;\n        }\n      } else if (data instanceof Uint8Array) {\n        for (let i = 0; i < data.length && (address + i) < disk.length; i++) {\n          disk[address + i] = data[i];\n        }\n      }\n    };\n    \n    // Track 0, Sector 0: Volume Table of Contents (VTOC)\n    // Byte 0x00: Unused\n    // Byte 0x01: Track of first catalog sector (usually 0x11 = track 17)\n    // Byte 0x02: Sector of first catalog sector (usually 0x0F = sector 15)\n    // Byte 0x03: DOS version (0x03 = DOS 3.3)\n    // Byte 0x04-0x26: Volume bitmap (tracks 0-34, each bit = 1 sector)\n    // Byte 0x27: Number of tracks per disk (0x23 = 35)\n    // Byte 0x28-0x2F: Unused\n    // Byte 0x30-0x33: Maximum number of tracks (0x23 = 35)\n    // Byte 0x34-0x35: Last allocated track/sector\n    // Byte 0x36-0x3F: Unused\n    \n    write(0x0000, 0x00); // Unused\n    write(0x0001, 0x11); // First catalog track (17)\n    write(0x0002, 0x0F); // First catalog sector (15)\n    write(0x0003, 0x03); // DOS version 3.3\n    write(0x0027, 0x23); // 35 tracks\n    write(0x0030, 0x23); // Max tracks\n    write(0x0031, 0x23); // Max tracks (high byte)\n    \n    // Mark sectors as used in bitmap (tracks 0-2 are used for DOS)\n    // Track 0: sectors 0-15 used\n    for (let i = 0; i < 16; i++) {\n      const byteIndex = 0x04 + Math.floor(i / 8);\n      const bitIndex = i % 8;\n      disk[byteIndex] |= (1 << (7 - bitIndex));\n    }\n    \n    // Track 1: sectors 0-15 used\n    for (let i = 0; i < 16; i++) {\n      const byteIndex = 0x06 + Math.floor(i / 8);\n      const bitIndex = i % 8;\n      disk[byteIndex] |= (1 << (7 - bitIndex));\n    }\n    \n    // Track 2: sectors 0-15 used\n    for (let i = 0; i < 16; i++) {\n      const byteIndex = 0x08 + Math.floor(i / 8);\n      const bitIndex = i % 8;\n      disk[byteIndex] |= (1 << (7 - bitIndex));\n    }\n    \n    // Calculate sectors needed for program\n    const programSectors = Math.ceil(programData.length / BYTES_PER_SECTOR);\n    const startTrack = 3;\n    const startSector = 0;\n    \n    // Mark program sectors as used\n    let currentTrack = startTrack;\n    let currentSector = startSector;\n    for (let i = 0; i < programSectors; i++) {\n      const byteIndex = 0x04 + Math.floor((currentTrack * 16 + currentSector) / 8);\n      const bitIndex = (currentTrack * 16 + currentSector) % 8;\n      disk[byteIndex] |= (1 << (7 - bitIndex));\n      \n      currentSector++;\n      if (currentSector >= 16) {\n        currentSector = 0;\n        currentTrack++;\n      }\n    }\n    \n    // Track 17, Sector 15: Catalog sector\n    // Each file entry is 35 bytes\n    const CATALOG_TRACK = 17;\n    const CATALOG_SECTOR = 15;\n    const CATALOG_OFFSET = (CATALOG_TRACK * SECTORS_PER_TRACK + CATALOG_SECTOR) * BYTES_PER_SECTOR;\n    \n    // Catalog header\n    write(CATALOG_OFFSET + 0x00, 0x11); // Next catalog track (17)\n    write(CATALOG_OFFSET + 0x01, 0x0E); // Next catalog sector (14)\n    write(CATALOG_OFFSET + 0x02, 0x00); // Unused\n    write(CATALOG_OFFSET + 0x03, 0x01); // Number of files (1)\n    write(CATALOG_OFFSET + 0x04, 0x00); // Unused\n    \n    // File entry (starts at offset 0x0B)\n    // DOS 3.3 catalog entry format:\n    // Bytes 0x00-0x1D: Filename (30 chars, space-padded)\n    // Byte 0x1E: Track of first sector\n    // Byte 0x1F: Sector of first sector\n    // Byte 0x20: File type and flags (bit 7 = locked, bits 0-2 = type)\n    // Byte 0x21-0x22: Length in sectors (low, high)\n    // For binary files, we also need load/run addresses in the file itself\n    const FILE_ENTRY_OFFSET = CATALOG_OFFSET + 0x0B;\n    const filenamePadded = (filename.substring(0, 30).toUpperCase() + '                    ').substring(0, 30);\n    write(FILE_ENTRY_OFFSET + 0x00, filenamePadded.substring(0, 30)); // Filename (30 chars)\n    write(FILE_ENTRY_OFFSET + 0x1E, startTrack); // Track of first sector\n    write(FILE_ENTRY_OFFSET + 0x1F, startSector); // Sector of first sector\n    write(FILE_ENTRY_OFFSET + 0x20, 0x80); // File type: 0x80 = binary (type 0) + locked bit\n    write(FILE_ENTRY_OFFSET + 0x21, programSectors & 0xFF); // Length in sectors (low byte)\n    write(FILE_ENTRY_OFFSET + 0x22, (programSectors >> 8) & 0xFF); // Length in sectors (high byte)\n    \n    // Write program data with DOS 3.3 binary file header\n    // Binary files on DOS 3.3 have a 2-byte header: load address (low, high)\n    // Then the program data, then a 2-byte run address (low, high) at the end\n    const programOffset = (startTrack * SECTORS_PER_TRACK + startSector) * BYTES_PER_SECTOR;\n    \n    // Write load address (2 bytes, little-endian)\n    write(programOffset + 0, loadAddress & 0xFF);\n    write(programOffset + 1, (loadAddress >> 8) & 0xFF);\n    \n    // Write program data\n    write(programOffset + 2, programData);\n    \n    // Write run address at the end (2 bytes, little-endian)\n    const runAddressOffset = programOffset + 2 + programData.length;\n    write(runAddressOffset + 0, runAddress & 0xFF);\n    write(runAddressOffset + 1, (runAddress >> 8) & 0xFF);\n    \n    console.log(`Apple2EPlatform: Created disk image: ${filename}.BIN, ${programSectors} sectors, ${programData.length} bytes, Load: $${loadAddress.toString(16)}, Run: $${runAddress.toString(16)}`);\n    \n    return disk;\n  }\n  \n  private parseBinaryHeader(data: Uint8Array): { loadAddress: number, runAddress: number, headerSize: number, programData: Uint8Array } {\n    // Check for AppleSingle header: https://github.com/cc65/cc65/blob/master/libsrc/apple2/exehdr.s\n    // Magic: 0x00, 0x05, 0x16, 0x00\n    if (data.length >= 58 && \n        data[0] === 0x00 && data[1] === 0x05 && data[2] === 0x16 && data[3] === 0x00) {\n      // AppleSingle format - load address is at offset 0x38-0x39 (big endian)\n      const loadAddress = (data[0x38] << 8) | data[0x39];\n      // Run address is typically the same as load address for cc65 programs\n      const runAddress = loadAddress;\n      const headerSize = 58;\n      const programData = data.slice(headerSize);\n      console.log(`Apple2EPlatform: Detected AppleSingle header - Load: $${loadAddress.toString(16)}, Size: ${programData.length} bytes`);\n      return { loadAddress, runAddress, headerSize, programData };\n    }\n    \n    // Check for 4-byte DOS header\n    if (data.length >= 4) {\n      const origin = data[0] | (data[1] << 8);\n      const size = data[2] | (data[3] << 8);\n      const isPlausible = origin < 0xc000 && \n                         origin + size < 0x13000 && \n                         (origin === 0x803 || (origin & 0xff) === 0);\n      \n      if (size === data.length - 4 && isPlausible) {\n        const loadAddress = origin;\n        const runAddress = origin; // Default run address same as load\n        const headerSize = 4;\n        const programData = data.slice(headerSize);\n        console.log(`Apple2EPlatform: Detected DOS header - Load: $${loadAddress.toString(16)}, Size: ${programData.length} bytes`);\n        return { loadAddress, runAddress, headerSize, programData };\n      }\n    }\n    \n    // Default: raw binary @ $803 (standard cc65 load address)\n    const loadAddress = 0x803;\n    const runAddress = 0x803;\n    const headerSize = 0;\n    const programData = data;\n    console.log(`Apple2EPlatform: No header detected, using default - Load: $${loadAddress.toString(16)}, Size: ${programData.length} bytes`);\n    return { loadAddress, runAddress, headerSize, programData };\n  }\n  \n  private async loadBasicProgram(title: string, programData: Uint8Array): Promise<void> {\n    if (!this.iframe || !this.iframe.contentWindow) {\n      console.error('Apple2EPlatform: Cannot load program - iframe not available');\n      this.isLoadingProgram = false;\n      return;\n    }\n    \n    // Extract filename from title\n    const filename = title.replace(/\\.[^.]*$/, '').toUpperCase().substring(0, 8) || 'PROGRAM';\n    \n    // Decode BASIC program text\n    const basicText = new TextDecoder().decode(programData);\n    \n    console.log(`Apple2EPlatform: Creating bootable disk for BASIC program ${filename}, ${basicText.length} bytes`);\n    console.log(`Apple2EPlatform: BASIC program preview:`, basicText.substring(0, 200));\n    \n    try {\n      // Call PHP API to create bootable disk with BASIC program\n      const API_BASE_URL = 'https://ide.retrogamecoders.com';\n      \n      console.log(`Apple2EPlatform: Calling PHP API to create disk with BASIC program...`);\n      const response = await fetch(`${API_BASE_URL}/api/apple2/create_disk.php`, {\n        method: 'POST',\n        mode: 'cors',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          basic: basicText,\n          filename: filename,\n          loadAddress: 0,\n          runAddress: 0,\n          sessionID: `apple2_${Date.now()}`\n        })\n      });\n      \n      console.log(`Apple2EPlatform: API response status: ${response.status}`);\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error(`Apple2EPlatform: API error response:`, errorText);\n        throw new Error(`API error: ${response.status} ${response.statusText} - ${errorText}`);\n      }\n      \n      const result = await response.json();\n      console.log(`Apple2EPlatform: API result:`, result);\n      \n      if (result.error) {\n        console.error(`Apple2EPlatform: API returned error:`, result.error);\n        throw new Error(result.error);\n      }\n      \n      if (!result.disk) {\n        console.error(`Apple2EPlatform: API result missing disk data:`, result);\n        throw new Error('API response missing disk data');\n      }\n      \n      // Decode disk image\n      const diskData = Uint8Array.from(atob(result.disk), c => c.charCodeAt(0));\n      \n      console.log(`Apple2EPlatform: Bootable disk created: ${result.filename}, ${diskData.length} bytes`);\n      \n      // Store disk blob for download\n      const diskBuffer = new ArrayBuffer(diskData.length);\n      new Uint8Array(diskBuffer).set(diskData);\n      this.currentDiskBlob = new Blob([diskBuffer], { type: 'application/octet-stream' });\n      console.log(`Apple2EPlatform: Disk blob stored for download: ${this.currentDiskBlob.size} bytes`);\n      console.log(`Apple2EPlatform: currentDiskBlob is now:`, this.currentDiskBlob ? 'set' : 'null');\n      \n      // Get a URL from serve_disk.php so doLoadHTTP can use it (needs .dsk extension)\n      console.log(`Apple2EPlatform: Getting server URL for disk with .dsk extension...`);\n      const serveResponse = await fetch(`${API_BASE_URL}/api/apple2/serve_disk.php`, {\n        method: 'POST',\n        mode: 'cors',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          disk: result.disk, // Already base64 encoded\n          filename: result.filename\n        })\n      });\n      \n      if (!serveResponse.ok) {\n        throw new Error(`Failed to get disk URL: ${serveResponse.status} ${serveResponse.statusText}`);\n      }\n      \n      const serveResult = await serveResponse.json();\n      if (serveResult.error) {\n        throw new Error(serveResult.error);\n      }\n      \n      console.log(`Apple2EPlatform: Got disk URL: ${serveResult.url}`);\n      \n      // Send URL to iframe - doLoadHTTP will load it (needs .dsk extension in URL)\n      this.iframe.contentWindow.postMessage({\n        type: 'load_disk_url',\n        data: {\n          drive: 1,\n          url: serveResult.url,\n          filename: result.filename\n        }\n      }, '*');\n      \n      // Clear loading flag after a delay\n      setTimeout(() => {\n        this.isLoadingProgram = false;\n      }, 5000);\n    } catch (error) {\n      console.error('Apple2EPlatform: Error creating bootable disk via PHP API:', error);\n      console.error('Apple2EPlatform: Error details:', {\n        message: error instanceof Error ? error.message : String(error),\n        stack: error instanceof Error ? error.stack : undefined\n      });\n      this.isLoadingProgram = false;\n      // Don't throw - just log the error so the UI doesn't break\n      // The user can still try to download manually if needed\n    }\n  }\n  \n  private loadBinaryDirectly(title: string, programData: Uint8Array): void {\n    // Use loadROM to load binary directly into RAM (as recommended by apple2js developer)\n    // This avoids the complexity of creating disk images for compiled binaries\n    if (!this.iframe || !this.iframe.contentWindow) {\n      console.error('Apple2EPlatform: Iframe not available for binary load');\n      return;\n    }\n    \n    console.log(`Apple2EPlatform: Loading binary directly into RAM: ${title}, ${programData.length} bytes`);\n    \n    // Send the binary data to the iframe to load via loadROM\n    this.iframe.contentWindow.postMessage({\n      type: 'load_rom',\n      data: {\n        title: title,\n        romData: Array.from(programData)\n      }\n    }, '*');\n  }\n  \n  private async loadCompiledProgram(title: string, programData: Uint8Array): Promise<void> {\n    if (!this.iframe || !this.iframe.contentWindow) {\n      console.error('Apple2EPlatform: Cannot load program - iframe not available');\n      this.isLoadingProgram = false;\n      return;\n    }\n    \n    // Parse binary header to get load address (for logging)\n    // But send the FULL binary (with AppleSingle header) to PHP, just like the shell script does\n    const { loadAddress, runAddress } = this.parseBinaryHeader(programData);\n    \n    // Extract filename from title\n    const filename = title.replace(/\\.[^.]*$/, '').toUpperCase().substring(0, 8) || 'PROGRAM';\n    \n    console.log(`Apple2EPlatform: Creating bootable disk for ${filename} - Load: $${loadAddress.toString(16)}, Run: $${runAddress.toString(16)}, Size: ${programData.length} bytes (full binary with header)`);\n    \n    try {\n      // Call PHP API to create bootable disk\n      // Always use production server - local Python server doesn't support PHP/POST\n      const API_BASE_URL = 'https://ide.retrogamecoders.com';\n      // Send the FULL binary (with AppleSingle header) - AppleCommander can handle it directly\n      const binaryBase64 = btoa(String.fromCharCode(...programData));\n      \n      const response = await fetch(`${API_BASE_URL}/api/apple2/create_disk.php`, {\n        method: 'POST',\n        mode: 'cors',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          binary: binaryBase64,\n          filename: filename,\n          loadAddress: loadAddress,\n          runAddress: runAddress,\n          sessionID: `apple2_${Date.now()}`\n        })\n      });\n      \n      if (!response.ok) {\n        throw new Error(`API error: ${response.status} ${response.statusText}`);\n      }\n      \n      const result = await response.json();\n      \n      if (result.error) {\n        throw new Error(result.error);\n      }\n      \n      // Decode disk image\n      const diskData = Uint8Array.from(atob(result.disk), c => c.charCodeAt(0));\n      \n      console.log(`Apple2EPlatform: Bootable disk created: ${result.filename}, ${diskData.length} bytes`);\n      \n      // Store disk blob for download\n      // Create a new ArrayBuffer to avoid SharedArrayBuffer issues\n      const diskBuffer = new ArrayBuffer(diskData.length);\n      new Uint8Array(diskBuffer).set(diskData);\n      this.currentDiskBlob = new Blob([diskBuffer], { type: 'application/octet-stream' });\n      console.log(`Apple2EPlatform: Disk blob stored for download: ${this.currentDiskBlob.size} bytes`);\n      \n      // Get a URL from serve_disk.php so doLoadHTTP can use it (needs .dsk extension)\n      console.log(`Apple2EPlatform: Getting server URL for disk with .dsk extension...`);\n      const serveResponse = await fetch(`${API_BASE_URL}/api/apple2/serve_disk.php`, {\n        method: 'POST',\n        mode: 'cors',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          disk: result.disk, // Already base64 encoded\n          filename: result.filename\n        })\n      });\n      \n      if (!serveResponse.ok) {\n        throw new Error(`Failed to get disk URL: ${serveResponse.status} ${serveResponse.statusText}`);\n      }\n      \n      const serveResult = await serveResponse.json();\n      if (serveResult.error) {\n        throw new Error(serveResult.error);\n      }\n      \n      console.log(`Apple2EPlatform: Got disk URL: ${serveResult.url}`);\n      \n      // Send URL to iframe - doLoadHTTP will load it (needs .dsk extension in URL)\n      this.iframe.contentWindow.postMessage({\n        type: 'load_disk_url',\n        data: {\n          drive: 1,\n          url: serveResult.url,\n          filename: result.filename\n        }\n      }, '*');\n      \n      // Clear loading flag after a delay\n      setTimeout(() => {\n        this.isLoadingProgram = false;\n      }, 5000);\n    } catch (error) {\n      console.error('Apple2EPlatform: Error creating bootable disk via PHP API:', error);\n      this.isLoadingProgram = false;\n      // No fallback - we need the PHP API to work\n      throw error;\n    }\n  }\n  \n  private sendROMToEmulator(rom: Uint8Array): void {\n    if (!this.iframe || !this.iframe.contentWindow) {\n      console.error('Apple2EPlatform: Cannot send ROM - iframe not available');\n      this.isLoadingProgram = false;\n      return;\n    }\n    \n    // Convert Uint8Array to string (assuming it's text/BASIC)\n    const program = new TextDecoder().decode(rom);\n    console.log('Apple2EPlatform: Sending program to iframe:', program.substring(0, 50));\n    this.iframe.contentWindow.postMessage({\n      type: 'load_basic',\n      data: { program: program }\n    }, '*');\n    \n    // Clear loading flag after a delay (in case of errors, the iframe handler will also clear it)\n    setTimeout(() => {\n      this.isLoadingProgram = false;\n    }, 2000);\n  }\n\n  getROMExtension(rom: Uint8Array): string {\n    // For BASIC programs, return .bas\n    return '.bas';\n  }\n\n  readAddress(addr: number): number {\n    // Not implemented for iframe-based emulator\n    return 0;\n  }\n\n  writeAddress(addr: number, val: number): void {\n    // Not implemented for iframe-based emulator\n  }\n\n  getMemoryMap() {\n    return {\n      main: [\n        { name: 'Zero Page RAM', start: 0x0, size: 0x100, type: 'ram' },\n        { name: 'Line Input RAM', start: 0x200, size: 0x100, type: 'ram' },\n        { name: 'Text/Lores Page 1', start: 0x400, size: 0x400, type: 'ram' },\n        { name: 'Hires Page 1', start: 0x2000, size: 0x2000, type: 'ram' },\n        { name: 'Hires Page 2', start: 0x4000, size: 0x2000, type: 'ram' },\n        { name: 'I/O', start: 0xc000, size: 0x1000, type: 'io' },\n        { name: 'ROM', start: 0xd000, size: 0x3000, type: 'rom' },\n      ]\n    };\n  }\n\n  showHelp(): string {\n    return 'https://github.com/whscullin/apple2js#readme';\n  }\n}\n\n// Register the platform\nPLATFORMS['apple2e'] = Apple2EPlatform;\n\n// Export for dynamic loading\nexport default Apple2EPlatform;\n\n"],
  "mappings": "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",
  "names": []
}
