import{H as f}from"./chunk-KXQZZRQB.js";import"./chunk-WAARL7ET.js";var p=class{constructor(e){this.pauseResumeSupported=!1;this.mainElement=e,window.addEventListener("message",o=>{o.data&&o.data.type==="emulator_capabilities"?(console.log("X86DOSBoxPlatform: Received emulator capabilities:",o.data.capabilities),o.data.capabilities&&typeof o.data.capabilities.pauseResume=="boolean"&&(this.pauseResumeSupported=o.data.capabilities.pauseResume,console.log("X86DOSBoxPlatform: Pause/resume supported:",this.pauseResumeSupported),this.updateControlButtons())):o.data&&o.data.type==="debug_objects"&&(console.log("X86DOSBoxPlatform: Received debug message from iframe:",o.data.message),console.log("Note: Debug objects are available in the iframe context, not the main window"))})}getName(){return"x86 (DOSBox)"}getDescription(){return"x86 DOSBox - Run C programs in a DOS environment with Turbo C"}async init(){console.log("X86DOSBoxPlatform init() called")}async start(){console.log("X86DOSBoxPlatform start() called - using iframe approach"),this.setupCompilationListener(),this.pauseResumeSupported=!1,setTimeout(()=>this.updateControlButtons(),100);let e=document.getElementById("x86dosbox-iframe");e?console.log("X86DOSBoxPlatform: iframe already exists, reusing"):(e=document.createElement("iframe"),e.id="x86dosbox-iframe",e.style.width="100%",e.style.height="600px",e.style.border="1px solid #ccc",e.style.backgroundColor="#000",this.mainElement.innerHTML="",this.mainElement.appendChild(e),console.log("X86DOSBoxPlatform: iframe created"),e.src="x86dosbox-iframe.html"),this.setupIframeWithAutoCompilation().catch(o=>{console.error("X86DOSBoxPlatform: Error in setupIframeWithAutoCompilation:",o)})}stop(){console.log("X86DOSBoxPlatform stop() called");let e=document.getElementById("x86dosbox-iframe");e&&(e.src=e.src,console.log("X86DOSBoxPlatform: Reloaded iframe for stop/reset"))}reset(){console.log("X86DOSBoxPlatform reset() called");let e=document.getElementById("x86dosbox-iframe");e&&(e.src=e.src,console.log("X86DOSBoxPlatform: Reloaded iframe for reset"))}pause(){console.log("X86DOSBoxPlatform: Pause functionality disabled")}resume(){console.log("X86DOSBoxPlatform: Resume functionality disabled")}isRunning(){return!0}getToolForFilename(e){let o=e.toLowerCase();return o.endsWith(".c")||o.endsWith(".bas")||o.endsWith(".pas")||o.endsWith(".asm"),"none"}getDefaultExtension(){return".c"}getPresets(){return[{id:"hello.bas",name:"Hello World (QBASIC)",category:"QBASIC Tutorial"},{id:"graphics.bas",name:"Graphics Demo (QBASIC)"},{id:"hellodos.c",name:"Hello World (C)",category:"TurboC Tutorial"},{id:"graphics.c",name:"BGI Graphics Demo (C)"},{id:"ansitest.c",name:"ANSI Escape Codes Test (C)"},{id:"cursors.c",name:"Cursor Control Test (C)"},{id:"hello.pas",name:"Hello World (Pascal)",category:"Turbo Pascal Tutorial"},{id:"graphics.pas",name:"Graphics Demo (Pascal)"},{id:"hello.asm",name:"Hello World (NASM)",category:"NASM Tutorial"},{id:"simple.asm",name:"Simple Graphics (NASM)"},{id:"pattern.asm",name:"Pattern Demo (NASM)"},{id:"graphics.asm",name:"Advanced Graphics (NASM)"}]}loadROM(e,o){var n,d,c;console.log("X86DOSBoxPlatform loadROM called with title:",e,"and",o.length,"bytes");let a=document.getElementById("x86dosbox-iframe");if(a&&a.contentWindow)if(o&&o.length>0){console.log("X86DOSBoxPlatform: Program detected, sending via postMessage");let s="program.c";if(e&&(e.endsWith(".c")||e.endsWith(".bas")||e.endsWith(".pas")||e.endsWith(".asm")))s=e;else{let r=(d=(n=window.IDE)==null?void 0:n.getCurrentMainFilename)==null?void 0:d.call(n);if(r&&(r.endsWith(".c")||r.endsWith(".bas")||r.endsWith(".pas")||r.endsWith(".asm")))s=r;else{let i=(c=window.IDE)==null?void 0:c.getCurrentProject(),l=(i==null?void 0:i.getFiles())||{},t=Object.keys(l);t.length>0&&(s=t[0])}}console.log("X86DOSBoxPlatform: Using filename:",s),a.contentWindow.postMessage({type:"compiled_program",program:o,filename:s,autoLoad:!0},"*")}else console.error("X86DOSBoxPlatform: No program data to load");else console.error("X86DOSBoxPlatform: iframe not found or contentWindow not available")}getMemoryMap(){return{main:[{name:"DOS Memory",start:0,size:1048576,type:"ram"}]}}getROMExtension(e){return".exe"}updateControlButtons(){let e=document.getElementById("dbg_pause"),o=document.getElementById("dbg_go");e?(e.style.display="none",console.log("X86DOSBoxPlatform: Pause button disabled")):console.log("X86DOSBoxPlatform: Pause button not found"),o?(o.style.display="none",console.log("X86DOSBoxPlatform: Resume button disabled")):console.log("X86DOSBoxPlatform: Resume button not found")}async setupIframeWithAutoCompilation(){var a;console.log("X86DOSBoxPlatform: Setting up iframe with auto-compilation");let e=window.autoCompileEnabled===!0;console.log("X86DOSBoxPlatform: Auto-compile enabled:",e);let o=(a=window.IDE)==null?void 0:a.getCurrentOutput();o&&o instanceof Uint8Array?(console.log("X86DOSBoxPlatform: Found compiled program, loading iframe"),this.loadROM("compiled_program",o)):(console.log("X86DOSBoxPlatform: No compiled program found, sending source code directly to emulator"),await this.sendSourceCodeToEmulator())}async sendSourceCodeToEmulator(){console.log("X86DOSBoxPlatform: Sending source code directly to emulator");let e=0,o=5,a=()=>{var d,c,s;let n=document.getElementById("x86dosbox-iframe");if(n&&n.contentWindow){console.log("X86DOSBoxPlatform: Iframe ready, getting source code");let r=(d=window.IDE)==null?void 0:d.getCurrentProject,i=(c=window.IDE)==null?void 0:c.getCurrentMainFilename,l,t;if(r&&i){let m=r(),u=i();if(console.log("X86DOSBoxPlatform: Current file:",u),m&&u){let g=m.getFile(u);g&&(l=u,t=g,console.log("X86DOSBoxPlatform: Got content from project.getFile(), length:",t==null?void 0:t.length))}}if(!t&&((s=window.IDE)==null?void 0:s.getCurrentEditor)){let m=window.IDE.getCurrentEditor();m&&m.getValue&&(t=m.getValue(),console.log("X86DOSBoxPlatform: Got content from editor, length:",t==null?void 0:t.length))}if(!l||!t)if(e++,e<o){console.log(`X86DOSBoxPlatform: No source code to send, retrying in 1 second (attempt ${e}/${o})`),setTimeout(a,1e3);return}else{console.log("X86DOSBoxPlatform: Max retries reached, giving up on auto-loading source code");return}let x=typeof t=="string"?t:new TextDecoder().decode(t);console.log("X86DOSBoxPlatform: Sending source code to emulator for file:",l),n.contentWindow.postMessage({type:"compiled_program",program:new TextEncoder().encode(x),filename:l,autoLoad:!0},"*")}else console.log("X86DOSBoxPlatform: Iframe not ready yet, retrying in 500ms"),setTimeout(a,500)};setTimeout(a,3e3)}setupCompilationListener(){if(console.log("X86DOSBoxPlatform: Setting up compilation listener"),window.x86dosboxCompilationListenerSetup){console.log("X86DOSBoxPlatform: Compilation listener already set up, skipping");return}window.x86dosboxCompilationListenerSetup=!0;let e=window.setCompileOutput;window.setCompileOutput=o=>{e&&e(o);let a=window.autoCompileEnabled===!0,n=window.isManualCompilation===!0;console.log("X86DOSBoxPlatform: Compilation output received - autoCompileEnabled:",a,"isManualCompilation:",n),console.log("X86DOSBoxPlatform: Raw autoCompileEnabled value:",window.autoCompileEnabled),console.log("X86DOSBoxPlatform: Output type:",typeof o,"is Uint8Array:",o instanceof Uint8Array),o&&o instanceof Uint8Array&&(console.log("X86DOSBoxPlatform: Compilation completed, sending program to iframe"),setTimeout(()=>{this.loadROM("compiled_program",o)},1e3))}}};f.x86dosbox=p;var D=p;export{D as default};
//# sourceMappingURL=x86dosbox-HNOEVBF3.js.map
